/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var R0=Object.create;var Ai=Object.defineProperty;var M0=Object.getOwnPropertyDescriptor;var D0=Object.getOwnPropertyNames;var U0=Object.getPrototypeOf,O0=Object.prototype.hasOwnProperty;var $0=(o,e,t)=>e in o?Ai(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Vf=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),Nf=(o,e)=>{for(var t in e)Ai(o,t,{get:e[t],enumerable:!0})},og=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of D0(e))!O0.call(o,n)&&n!==t&&Ai(o,n,{get:()=>e[n],enumerable:!(r=M0(e,n))||r.enumerable});return o};var Qo=(o,e,t)=>(t=o!=null?R0(U0(o)):{},og(e||!o||!o.__esModule?Ai(t,"default",{value:o,enumerable:!0}):t,o)),B0=o=>og(Ai({},"__esModule",{value:!0}),o);var Et=(o,e,t)=>$0(o,typeof e!="symbol"?e+"":e,t);var Yn=Vf((VD,sg)=>{"use strict";function Lo(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function ng(o,e){for(var t="",r=0,n=-1,s=0,i,a=0;a<=o.length;++a){if(a<o.length)i=o.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,a):t=o.slice(n+1,a),r=a-n-1;n=a,s=0}else i===46&&s!==-1?++s:s=-1}return t}function V0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var Is={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),Lo(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=ng(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Lo(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=ng(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Lo(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Lo(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Is.normalize(e)},relative:function(e,t){if(Lo(e),Lo(t),e===t||(e=Is.resolve(e),t=Is.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var a=t.length,l=a-i,c=s<l?s:l,f=-1,u=0;u<=c;++u){if(u===c){if(l>c){if(t.charCodeAt(i+u)===47)return t.slice(i+u+1);if(u===0)return t.slice(i+u)}else s>c&&(e.charCodeAt(r+u)===47?f=u:u===0&&(f=0));break}var d=e.charCodeAt(r+u),p=t.charCodeAt(i+u);if(d!==p)break;d===47&&(f=u)}var m="";for(u=r+f+1;u<=n;++u)(u===n||e.charCodeAt(u)===47)&&(m.length===0?m+="..":m+="/..");return m.length>0?m+t.slice(i+f):(i+=f,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(Lo(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!s){n=i;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Lo(e);var r=0,n=-1,s=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(c===47){if(!s){r=i+1;break}}else l===-1&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(n=i):(a=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!s){r=i+1;break}}else n===-1&&(s=!1,n=i+1);return n===-1?"":e.slice(r,n)}},extname:function(e){Lo(e);for(var t=-1,r=0,n=-1,s=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?t===-1?t=a:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||n===-1||i===0||i===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return V0("/",e)},parse:function(e){Lo(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var i=-1,a=0,l=-1,c=!0,f=e.length-1,u=0;f>=s;--f){if(r=e.charCodeAt(f),r===47){if(!c){a=f+1;break}continue}l===-1&&(c=!1,l=f+1),r===46?i===-1?i=f:u!==1&&(u=1):i!==-1&&(u=-1)}return i===-1||l===-1||u===0||u===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(a,i),t.base=e.slice(a,l)),t.ext=e.slice(i,l)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Is.posix=Is;sg.exports=Is});var Kb=Vf((a4,zb)=>{var Hb=require("url").parse,qI=require("events"),WI=require("https"),jI=require("http"),zI=require("util"),KI=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],jb=[239,187,191],GI=58,JI=32,qb=10,QI=13,Wb=1024*256,YI=/^(cookie|authorization)$/i;function XI(o){return jb.every(function(e,t){return o[t]===e})}function At(o,e){var t=At.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function i(g){t!==At.CLOSED&&(t=At.CONNECTING,m("error",new ma("error",{message:g})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==At.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,p())},s.reconnectInterval))}var a,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,f="",u="",d=null;function p(){var g=Hb(o),I=g.protocol==="https:";if(g.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(g.headers["Last-Event-ID"]=l),r){var L=n?eC(r):r;for(var C in L){var w=L[C];w&&(g.headers[C]=w)}}g.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(g.createConnection=e.createConnection);var E=e&&e.proxy;if(E){var F=Hb(e.proxy);I=F.protocol==="https:",g.protocol=I?"https:":"http:",g.path=o,g.headers.Host=g.host,g.hostname=F.hostname,g.host=F.host,g.port=F.port}if(e&&e.https){for(var U in e.https)if(KI.indexOf(U)!==-1){var V=e.https[U];V!==void 0&&(g[U]=V)}}e&&e.withCredentials!==void 0&&(g.withCredentials=e.withCredentials),a=(I?WI:jI).request(g,function(P){if(s.connectionInProgress=!1,P.statusCode===500||P.statusCode===502||P.statusCode===503||P.statusCode===504){m("error",new ma("error",{status:P.statusCode,message:P.statusMessage})),i();return}if(P.statusCode===301||P.statusCode===302||P.statusCode===307){var $=P.headers.location;if(!$){m("error",new ma("error",{status:P.statusCode,message:P.statusMessage}));return}var re=new URL(o).origin,W=new URL($).origin;n=re!==W,P.statusCode===307&&(d=o),o=$,process.nextTick(p);return}if(P.statusCode!==200)return m("error",new ma("error",{status:P.statusCode,message:P.statusMessage})),s.close();t=At.OPEN,P.on("close",function(){P.removeAllListeners("close"),P.removeAllListeners("end"),i()}),P.on("end",function(){P.removeAllListeners("close"),P.removeAllListeners("end"),i()}),m("open",new ma("open"));var q,M,G=0,B=-1,Q=0,N=0;P.on("data",function(O){q?(O.length>q.length-N&&(Q=q.length*2+O.length,Q>Wb&&(Q=q.length+O.length+Wb),M=Buffer.alloc(Q),q.copy(M,0,0,N),q=M),O.copy(q,N),N+=O.length):(q=O,XI(q)&&(q=q.slice(jb.length)),N=q.length);for(var J=0,oe=N;J<oe;){c&&(q[J]===qb&&++J,c=!1);for(var me=-1,he=B,se,pe=G;me<0&&pe<oe;++pe)se=q[pe],se===GI?he<0&&(he=pe-J):se===QI?(c=!0,me=pe-J):se===qb&&(me=pe-J);if(me<0){G=oe-J,B=he;break}else G=0,B=-1;y(q,J,he,me),J+=me+1}J===oe?(q=void 0,N=0):J>0&&(q=q.slice(J,N),N=q.length)})}),a.on("error",function(P){s.connectionInProgress=!1,i(P.message)}),a.setNoDelay&&a.setNoDelay(!0),a.end()}p();function m(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==At.CLOSED&&(t=At.CLOSED,a.abort&&a.abort(),a.xhr&&a.xhr.abort&&a.xhr.abort())};function y(g,I,L,C){if(C===0){if(f.length>0){var w=u||"message";m(w,new ZI(w,{data:f.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),f=""}u=void 0}else if(L>0){var E=L<0,F=0,U=g.slice(I,I+(E?C:L)).toString();E?F=C:g[I+L+1]!==JI?F=L+1:F=L+2,I+=F;var V=C-F,P=g.slice(I,I+V).toString();if(U==="data")f+=P+`
`;else if(U==="event")u=P;else if(U==="id")l=P;else if(U==="retry"){var $=parseInt(P,10);Number.isNaN($)||(s.reconnectInterval=$)}}}}zb.exports=At;zI.inherits(At,qI.EventEmitter);At.prototype.constructor=At;["open","error","message"].forEach(function(o){Object.defineProperty(At.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(At,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(At,"OPEN",{enumerable:!0,value:1});Object.defineProperty(At,"CLOSED",{enumerable:!0,value:2});At.prototype.CONNECTING=0;At.prototype.OPEN=1;At.prototype.CLOSED=2;At.prototype.close=function(){this._close()};At.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};At.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};At.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function ma(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function ZI(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function eC(o){var e={};for(var t in o)YI.test(t)||(e[t]=o[t]);return e}});var gc=Vf((nV,ui)=>{var be=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},gt=-1,bt=1,Ge=0;be.Diff=function(o,e){return[o,e]};be.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new be.Diff(Ge,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,i=this.diff_commonPrefix(o,e),a=o.substring(0,i);o=o.substring(i),e=e.substring(i),i=this.diff_commonSuffix(o,e);var l=o.substring(o.length-i);o=o.substring(0,o.length-i),e=e.substring(0,e.length-i);var c=this.diff_compute_(o,e,s,n);return a&&c.unshift(new be.Diff(Ge,a)),l&&c.push(new be.Diff(Ge,l)),this.diff_cleanupMerge(c),c};be.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new be.Diff(bt,e)];if(!e)return[new be.Diff(gt,o)];var s=o.length>e.length?o:e,i=o.length>e.length?e:o,a=s.indexOf(i);if(a!=-1)return n=[new be.Diff(bt,s.substring(0,a)),new be.Diff(Ge,i),new be.Diff(bt,s.substring(a+i.length))],o.length>e.length&&(n[0][0]=n[2][0]=gt),n;if(i.length==1)return[new be.Diff(gt,o),new be.Diff(bt,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],f=l[1],u=l[2],d=l[3],p=l[4],m=this.diff_main(c,u,t,r),y=this.diff_main(f,d,t,r);return m.concat([new be.Diff(Ge,p)],y)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};be.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new be.Diff(Ge,""));for(var i=0,a=0,l=0,c="",f="";i<s.length;){switch(s[i][0]){case bt:l++,f+=s[i][1];break;case gt:a++,c+=s[i][1];break;case Ge:if(a>=1&&l>=1){s.splice(i-a-l,a+l),i=i-a-l;for(var u=this.diff_main(c,f,!1,t),d=u.length-1;d>=0;d--)s.splice(i,0,u[d]);i=i+u.length}l=0,a=0,c="",f="";break}i++}return s.pop(),s};be.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),i=s,a=2*s,l=new Array(a),c=new Array(a),f=0;f<a;f++)l[f]=-1,c[f]=-1;l[i+1]=0,c[i+1]=0;for(var u=r-n,d=u%2!=0,p=0,m=0,y=0,g=0,I=0;I<s&&!(new Date().getTime()>t);I++){for(var L=-I+p;L<=I-m;L+=2){var C=i+L,w;L==-I||L!=I&&l[C-1]<l[C+1]?w=l[C+1]:w=l[C-1]+1;for(var E=w-L;w<r&&E<n&&o.charAt(w)==e.charAt(E);)w++,E++;if(l[C]=w,w>r)m+=2;else if(E>n)p+=2;else if(d){var F=i+u-L;if(F>=0&&F<a&&c[F]!=-1){var U=r-c[F];if(w>=U)return this.diff_bisectSplit_(o,e,w,E,t)}}}for(var V=-I+y;V<=I-g;V+=2){var F=i+V,U;V==-I||V!=I&&c[F-1]<c[F+1]?U=c[F+1]:U=c[F-1]+1;for(var P=U-V;U<r&&P<n&&o.charAt(r-U-1)==e.charAt(n-P-1);)U++,P++;if(c[F]=U,U>r)g+=2;else if(P>n)y+=2;else if(!d){var C=i+u-V;if(C>=0&&C<a&&l[C]!=-1){var w=l[C],E=i+w-C;if(U=r-U,w>=U)return this.diff_bisectSplit_(o,e,w,E,t)}}}}return[new be.Diff(gt,o),new be.Diff(bt,e)]};be.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),i=e.substring(0,r),a=o.substring(t),l=e.substring(r),c=this.diff_main(s,i,!1,n),f=this.diff_main(a,l,!1,n);return c.concat(f)};be.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",f=0,u=-1,d=t.length;u<l.length-1;){u=l.indexOf(`
`,f),u==-1&&(u=l.length-1);var p=l.substring(f,u+1);(r.hasOwnProperty?r.hasOwnProperty(p):r[p]!==void 0)?c+=String.fromCharCode(r[p]):(d==s&&(p=l.substring(f),u=l.length),c+=String.fromCharCode(d),r[p]=d,t[d++]=p),f=u+1}return c}var s=4e4,i=n(o);s=65535;var a=n(e);return{chars1:i,chars2:a,lineArray:t}};be.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};be.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};be.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};be.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,i=1;;){var a=o.substring(n-i),l=e.indexOf(a);if(l==-1)return s;i+=l,(l==0||o.substring(n-i)==e.substring(0,i))&&(s=i,i++)}};be.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(m,y,g){for(var I=m.substring(g,g+Math.floor(m.length/4)),L=-1,C="",w,E,F,U;(L=y.indexOf(I,L+1))!=-1;){var V=n.diff_commonPrefix(m.substring(g),y.substring(L)),P=n.diff_commonSuffix(m.substring(0,g),y.substring(0,L));C.length<P+V&&(C=y.substring(L-P,L)+y.substring(L,L+V),w=m.substring(0,g-P),E=m.substring(g+V),F=y.substring(0,L-P),U=y.substring(L+V))}return C.length*2>=m.length?[w,E,F,U,C]:null}var i=s(t,r,Math.ceil(t.length/4)),a=s(t,r,Math.ceil(t.length/2)),l;if(!i&&!a)return null;a?i?l=i[4].length>a[4].length?i:a:l=a:l=i;var c,f,u,d;o.length>e.length?(c=l[0],f=l[1],u=l[2],d=l[3]):(u=l[0],d=l[1],c=l[2],f=l[3]);var p=l[4];return[c,f,u,d,p]};be.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=0,a=0,l=0,c=0;s<o.length;)o[s][0]==Ge?(t[r++]=s,i=l,a=c,l=0,c=0,n=o[s][1]):(o[s][0]==bt?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(i,a)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new be.Diff(gt,n)),o[t[r-1]+1][0]=bt,r--,r--,s=r>0?t[r-1]:-1,i=0,a=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==gt&&o[s][0]==bt){var f=o[s-1][1],u=o[s][1],d=this.diff_commonOverlap_(f,u),p=this.diff_commonOverlap_(u,f);d>=p?(d>=f.length/2||d>=u.length/2)&&(o.splice(s,0,new be.Diff(Ge,u.substring(0,d))),o[s-1][1]=f.substring(0,f.length-d),o[s+1][1]=u.substring(d),s++):(p>=f.length/2||p>=u.length/2)&&(o.splice(s,0,new be.Diff(Ge,f.substring(0,p))),o[s-1][0]=bt,o[s-1][1]=u.substring(0,u.length-p),o[s+1][0]=gt,o[s+1][1]=f.substring(p),s++),s++}s++}};be.prototype.diff_cleanupSemanticLossless=function(o){function e(p,m){if(!p||!m)return 6;var y=p.charAt(p.length-1),g=m.charAt(0),I=y.match(be.nonAlphaNumericRegex_),L=g.match(be.nonAlphaNumericRegex_),C=I&&y.match(be.whitespaceRegex_),w=L&&g.match(be.whitespaceRegex_),E=C&&y.match(be.linebreakRegex_),F=w&&g.match(be.linebreakRegex_),U=E&&p.match(be.blanklineEndRegex_),V=F&&m.match(be.blanklineStartRegex_);return U||V?5:E||F?4:I&&!C&&w?3:C||w?2:I||L?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==Ge&&o[t+1][0]==Ge){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],i=this.diff_commonSuffix(r,n);if(i){var a=n.substring(n.length-i);r=r.substring(0,r.length-i),n=a+n.substring(0,n.length-i),s=a+s}for(var l=r,c=n,f=s,u=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=u&&(u=d,l=r,c=n,f=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,f?o[t+1][1]=f:(o.splice(t+1,1),t--))}t++}};be.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;be.whitespaceRegex_=/\s/;be.linebreakRegex_=/[\r\n]/;be.blanklineEndRegex_=/\n\r?\n$/;be.blanklineStartRegex_=/^\r?\n\r?\n/;be.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=!1,a=!1,l=!1,c=!1;s<o.length;)o[s][0]==Ge?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,i=l,a=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==gt?c=!0:l=!0,n&&(i&&a&&l&&c||n.length<this.Diff_EditCost/2&&i+a+l+c==3)&&(o.splice(t[r-1],0,new be.Diff(gt,n)),o[t[r-1]+1][0]=bt,r--,n=null,i&&a?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};be.prototype.diff_cleanupMerge=function(o){o.push(new be.Diff(Ge,""));for(var e=0,t=0,r=0,n="",s="",i;e<o.length;)switch(o[e][0]){case bt:r++,s+=o[e][1],e++;break;case gt:t++,n+=o[e][1],e++;break;case Ge:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(s,n),i!==0&&(e-t-r>0&&o[e-t-r-1][0]==Ge?o[e-t-r-1][1]+=s.substring(0,i):(o.splice(0,0,new be.Diff(Ge,s.substring(0,i))),e++),s=s.substring(i),n=n.substring(i)),i=this.diff_commonSuffix(s,n),i!==0&&(o[e][1]=s.substring(s.length-i)+o[e][1],s=s.substring(0,s.length-i),n=n.substring(0,n.length-i))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new be.Diff(gt,n)),e++),s.length&&(o.splice(e,0,new be.Diff(bt,s)),e++),e++):e!==0&&o[e-1][0]==Ge?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var a=!1;for(e=1;e<o.length-1;)o[e-1][0]==Ge&&o[e+1][0]==Ge&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),a=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),a=!0)),e++;a&&this.diff_cleanupMerge(o)};be.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,i;for(i=0;i<o.length&&(o[i][0]!==bt&&(t+=o[i][1].length),o[i][0]!==gt&&(r+=o[i][1].length),!(t>e));i++)n=t,s=r;return o.length!=i&&o[i][0]===gt?s:s+(e-n)};be.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,i=0;i<o.length;i++){var a=o[i][0],l=o[i][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(a){case bt:e[i]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case gt:e[i]='<del style="background:#ffe6e6;">'+c+"</del>";break;case Ge:e[i]="<span>"+c+"</span>";break}}return e.join("")};be.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==bt&&(e[t]=o[t][1]);return e.join("")};be.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==gt&&(e[t]=o[t][1]);return e.join("")};be.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],i=o[n][1];switch(s){case bt:t+=i.length;break;case gt:r+=i.length;break;case Ge:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};be.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case bt:e[t]="+"+encodeURI(o[t][1]);break;case gt:e[t]="-"+o[t][1].length;break;case Ge:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};be.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),i=0;i<s.length;i++){var a=s[i].substring(1);switch(s[i].charAt(0)){case"+":try{t[r++]=new be.Diff(bt,decodeURI(a))}catch(f){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);var c=o.substring(n,n+=l);s[i].charAt(0)=="="?t[r++]=new be.Diff(Ge,c):t[r++]=new be.Diff(gt,c);break;default:if(s[i])throw new Error("Invalid diff operation in diff_fromDelta: "+s[i])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};be.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};be.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(w,E){var F=w/e.length,U=Math.abs(t-E);return n.Match_Distance?F+U/n.Match_Distance:U?1:F}var i=this.Match_Threshold,a=o.indexOf(e,t);a!=-1&&(i=Math.min(s(0,a),i),a=o.lastIndexOf(e,t+e.length),a!=-1&&(i=Math.min(s(0,a),i)));var l=1<<e.length-1;a=-1;for(var c,f,u=e.length+o.length,d,p=0;p<e.length;p++){for(c=0,f=u;c<f;)s(p,t+f)<=i?c=f:u=f,f=Math.floor((u-c)/2+c);u=f;var m=Math.max(1,t-f+1),y=Math.min(t+f,o.length)+e.length,g=Array(y+2);g[y+1]=(1<<p)-1;for(var I=y;I>=m;I--){var L=r[o.charAt(I-1)];if(p===0?g[I]=(g[I+1]<<1|1)&L:g[I]=(g[I+1]<<1|1)&L|((d[I+1]|d[I])<<1|1)|d[I+1],g[I]&l){var C=s(p,I-1);if(C<=i)if(i=C,a=I-1,a>t)m=Math.max(1,2*t-a);else break}}if(s(p+1,t)>i)break;d=g}return a};be.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};be.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new be.Diff(Ge,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new be.Diff(Ge,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};be.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],i=new be.patch_obj,a=0,l=0,c=0,f=r,u=r,d=0;d<n.length;d++){var p=n[d][0],m=n[d][1];switch(!a&&p!==Ge&&(i.start1=l,i.start2=c),p){case bt:i.diffs[a++]=n[d],i.length2+=m.length,u=u.substring(0,c)+m+u.substring(c);break;case gt:i.length1+=m.length,i.diffs[a++]=n[d],u=u.substring(0,c)+u.substring(c+m.length);break;case Ge:m.length<=2*this.Patch_Margin&&a&&n.length!=d+1?(i.diffs[a++]=n[d],i.length1+=m.length,i.length2+=m.length):m.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(i,f),s.push(i),i=new be.patch_obj,a=0,f=u,l=c);break}p!==bt&&(l+=m.length),p!==gt&&(c+=m.length)}return a&&(this.patch_addContext_(i,f),s.push(i)),s};be.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new be.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new be.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};be.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var i=o[s].start2+r,a=this.diff_text1(o[s].diffs),l,c=-1;if(a.length>this.Match_MaxBits?(l=this.match_main(e,a.substring(0,this.Match_MaxBits),i),l!=-1&&(c=this.match_main(e,a.substring(a.length-this.Match_MaxBits),i+a.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,a,i),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-i;var f;if(c==-1?f=e.substring(l,l+a.length):f=e.substring(l,c+this.Match_MaxBits),a==f)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+a.length);else{var u=this.diff_main(a,f,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(u)/a.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(u);for(var d=0,p,m=0;m<o[s].diffs.length;m++){var y=o[s].diffs[m];y[0]!==Ge&&(p=this.diff_xIndex(u,d)),y[0]===bt?e=e.substring(0,l+p)+y[1]+e.substring(l+p):y[0]===gt&&(e=e.substring(0,l+p)+e.substring(l+this.diff_xIndex(u,d+y[1].length))),y[0]!==gt&&(d+=y[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};be.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=Ge)s.unshift(new be.Diff(Ge,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var i=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=Ge)s.push(new be.Diff(Ge,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var i=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,i),n.length1+=i,n.length2+=i}return t};be.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,i="";r.diffs.length!==0;){var a=new be.patch_obj,l=!0;for(a.start1=n-i.length,a.start2=s-i.length,i!==""&&(a.length1=a.length2=i.length,a.diffs.push(new be.Diff(Ge,i)));r.diffs.length!==0&&a.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],f=r.diffs[0][1];c===bt?(a.length2+=f.length,s+=f.length,a.diffs.push(r.diffs.shift()),l=!1):c===gt&&a.diffs.length==1&&a.diffs[0][0]==Ge&&f.length>2*e?(a.length1+=f.length,n+=f.length,l=!1,a.diffs.push(new be.Diff(c,f)),r.diffs.shift()):(f=f.substring(0,e-a.length1-this.Patch_Margin),a.length1+=f.length,n+=f.length,c===Ge?(a.length2+=f.length,s+=f.length):l=!1,a.diffs.push(new be.Diff(c,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}i=this.diff_text2(a.diffs),i=i.substring(i.length-this.Patch_Margin);var u=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);u!==""&&(a.length1+=u.length,a.length2+=u.length,a.diffs.length!==0&&a.diffs[a.diffs.length-1][0]===Ge?a.diffs[a.diffs.length-1][1]+=u:a.diffs.push(new be.Diff(Ge,u))),l||o.splice(++t,0,a)}}};be.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};be.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var i=new be.patch_obj;for(e.push(i),i.start1=parseInt(s[1],10),s[2]===""?(i.start1--,i.length1=1):s[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(s[2],10)),i.start2=parseInt(s[3],10),s[4]===""?(i.start2--,i.length2=1):s[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(s[4],10)),r++;r<t.length;){var a=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(a=="-")i.diffs.push(new be.Diff(gt,l));else if(a=="+")i.diffs.push(new be.Diff(bt,l));else if(a==" ")i.diffs.push(new be.Diff(Ge,l));else{if(a=="@")break;if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return e};be.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};be.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case bt:r="+";break;case gt:r="-";break;case Ge:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};ui.exports=be;ui.exports.diff_match_patch=be;ui.exports.DIFF_DELETE=gt;ui.exports.DIFF_INSERT=bt;ui.exports.DIFF_EQUAL=Ge});var $D={};Nf($D,{default:()=>Bf});module.exports=B0($D);var lt=require("obsidian"),y0=require("obsidian"),b0=Qo(Yn());var ct=require("obsidian");var Qt=()=>new Map,Na=o=>{let e=Qt();return o.forEach((t,r)=>{e.set(r,t)}),e},Ur=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},ig=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},ag=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Kr=()=>new Set;var qa=o=>o[o.length-1];var lg=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},lo=Array.from;var Hf=Array.isArray;var Wa=class{constructor(){this._observers=Qt()}on(e,t){return Ur(this._observers,e,Kr).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return lo((this._observers.get(e)||Qt()).values()).forEach(r=>r(...t))}destroy(){this._observers=Qt()}},xn=class{constructor(){this._observers=Qt()}on(e,t){Ur(this._observers,e,Kr).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return lo((this._observers.get(e)||Qt()).values()).forEach(r=>r(...t))}destroy(){this._observers=Qt()}};var wr=Math.floor;var Ls=Math.abs;var wn=(o,e)=>o<e?o:e,co=(o,e)=>o>e?o:e,HD=Number.isNaN,cg=Math.pow;var ja=o=>o!==0?o<0:1/o<0;var Wf=Number.MAX_SAFE_INTEGER,qD=Number.MIN_SAFE_INTEGER,WD=1<<31;var fg=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&wr(o)===o),jD=Number.isNaN,zD=Number.parseInt;var jf=String.fromCharCode,KD=String.fromCodePoint,GD=jf(65535),N0=o=>o.toLowerCase(),H0=/^\s*/g,q0=o=>o.replace(H0,""),W0=/([A-Z])/g,zf=(o,e)=>q0(o.replace(W0,t=>`${e}${N0(t)}`));var j0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Ts=typeof TextEncoder!="undefined"?new TextEncoder:null,z0=o=>Ts.encode(o),dg=Ts?z0:j0;var Es=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Es&&Es.decode(new Uint8Array).length===1&&(Es=null);var Zn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Mt=()=>new Zn;var Ga=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var ht=o=>{let e=new Uint8Array(Ga(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},K0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(co(t,e)*2),o.cpos=0)},Yt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Ja=Yt;var De=(o,e)=>{for(;e>127;)Yt(o,128|127&e),e=wr(e/128);Yt(o,127&e)},Qa=(o,e)=>{let t=ja(e);for(t&&(e=-e),Yt(o,(e>63?128:0)|(t?64:0)|63&e),e=wr(e/64);e>0;)Yt(o,(e>127?128:0)|127&e),e=wr(e/128)},Kf=new Uint8Array(3e4),G0=Kf.length/3,J0=(o,e)=>{if(e.length<G0){let t=Ts.encodeInto(e,Kf).written||0;De(o,t);for(let r=0;r<t;r++)Yt(o,Kf[r])}else It(o,dg(e))},Q0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;De(o,r);for(let n=0;n<r;n++)Yt(o,t.codePointAt(n))},Jr=Ts&&Ts.encodeInto?J0:Q0;var Mi=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=wn(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(co(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},It=(o,e)=>{De(o,e.byteLength),Mi(o,e)},Gf=(o,e)=>{K0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},Y0=(o,e)=>Gf(o,4).setFloat32(0,e,!1),X0=(o,e)=>Gf(o,8).setFloat64(0,e,!1),Z0=(o,e)=>Gf(o,8).setBigInt64(0,e,!1);var mg=new DataView(new ArrayBuffer(4)),eS=o=>(mg.setFloat32(0,o),mg.getFloat32(0)===o),Ps=(o,e)=>{switch(typeof e){case"string":Yt(o,119),Jr(o,e);break;case"number":fg(e)&&Ls(e)<=2147483647?(Yt(o,125),Qa(o,e)):eS(e)?(Yt(o,124),Y0(o,e)):(Yt(o,123),X0(o,e));break;case"bigint":Yt(o,122),Z0(o,e);break;case"object":if(e===null)Yt(o,126);else if(Hf(e)){Yt(o,117),De(o,e.length);for(let t=0;t<e.length;t++)Ps(o,e[t])}else if(e instanceof Uint8Array)Yt(o,116),It(o,e);else{Yt(o,118);let t=Object.keys(e);De(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Jr(o,n),Ps(o,e[n])}}break;case"boolean":Yt(o,e?120:121);break;default:Yt(o,127)}},Ri=class extends Zn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&De(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var hg=o=>{o.count>0&&(Qa(o.encoder,o.count===1?o.s:-o.s),o.count>1&&De(o.encoder,o.count-2))},es=class{constructor(){this.encoder=new Zn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(hg(this),this.count=1,this.s=e)}toUint8Array(){return hg(this),ht(this.encoder)}};var gg=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Qa(o.encoder,e),o.count>1&&De(o.encoder,o.count-2)}},As=class{constructor(){this.encoder=new Zn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(gg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return gg(this),ht(this.encoder)}},Ka=class{constructor(){this.sarr=[],this.s="",this.lensE=new es}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Zn;return this.sarr.push(this.s),this.s="",Jr(e,this.sarr.join("")),Mi(e,this.lensE.toUint8Array()),ht(e)}};var Qr=o=>new Error(o),fo=()=>{throw Qr("Method unimplemented")},Yr=()=>{throw Qr("Unexpected case")};var yg=Qr("Unexpected end of array"),bg=Qr("Integer out of Range"),Rs=class{constructor(e){this.arr=e,this.pos=0}},Or=o=>new Rs(o),vg=o=>o.pos!==o.arr.length;var Qf=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Wt=o=>Qf(o,Ve(o));var ts=o=>o.arr[o.pos++];var Ve=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>Wf)throw bg}throw yg},Za=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if((e&128)===0)return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>Wf)throw bg}throw yg};var tS=o=>{let e=Ve(o);if(e===0)return"";{let t=String.fromCodePoint(ts(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(ts(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},rS=o=>Es.decode(Wt(o)),uo=Es?rS:tS;var Yf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},oS=o=>Yf(o,4).getFloat32(0,!1),nS=o=>Yf(o,8).getFloat64(0,!1),sS=o=>Yf(o,8).getBigInt64(0,!1);var iS=[o=>{},o=>null,Za,oS,nS,sS,o=>!1,o=>!0,uo,o=>{let e=Ve(o),t={};for(let r=0;r<e;r++){let n=uo(o);t[n]=Ms(o)}return t},o=>{let e=Ve(o),t=[];for(let r=0;r<e;r++)t.push(Ms(o));return t},Wt],Ms=o=>iS[127-ts(o)](o),Di=class extends Rs{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),vg(this)?this.count=Ve(this)+1:this.count=-1),this.count--,this.s}};var rs=class extends Rs{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Za(this);let e=ja(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ve(this)+2)}return this.count--,this.s}};var Ds=class extends Rs{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Za(this),t=e&1;this.diff=wr(e/2),this.count=1,t&&(this.count=Ve(this)+2)}return this.s+=this.diff,this.count--,this.s}},Xa=class{constructor(e){this.decoder=new rs(e),this.str=uo(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var YD=crypto.subtle,xg=crypto.getRandomValues.bind(crypto);var Oi=()=>xg(new Uint32Array(1))[0];var aS="10000000-1000-4000-8000"+-1e11,Us=()=>aS.replace(/[018]/g,o=>(o^Oi()&15>>o/4).toString(16));var po=Date.now;var Yo=o=>new Promise(o);var lS=Promise.all.bind(Promise);var eu=o=>o===void 0?null:o;var tu=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},_g=new tu,ru=!0;try{typeof localStorage!="undefined"&&localStorage&&(_g=localStorage,ru=!1)}catch(o){}var el=_g,Sg=o=>ru||addEventListener("storage",o),kg=o=>ru||removeEventListener("storage",o);var Cg=Object.assign,fS=Object.keys,Lg=(o,e)=>{for(let t in o)e(o[t],t)},Eg=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},$i=o=>fS(o).length;var Tg=o=>{for(let e in o)return!1;return!0},uS=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},ou=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),nu=(o,e)=>o===e||$i(o)===$i(e)&&uS(o,(t,r)=>(t!==void 0||ou(e,r))&&e[r]===t);var Bi=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Bi(o,e,t+1)}};var Fg=o=>o,dS=(o,e)=>o===e;var Os=(o,e)=>{if(o==null||e==null)return dS(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!Os(o.get(t),e.get(t)))return!1;break}case Object:if($i(o)!==$i(e))return!1;for(let t in o)if(!ou(o,t)||!Os(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!Os(o[t],e[t]))return!1;break;default:return!1}return!0},Pg=(o,e)=>e.includes(o);var $s=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]",tl=typeof window!="undefined"&&typeof document!="undefined"&&!$s,e3=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Eo,pS=[],mS=()=>{if(Eo===void 0)if($s){Eo=Qt();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Eo.set(e,""),e=r):e!==null?(Eo.set(e,r),e=null):pS.push(r)}e!==null&&Eo.set(e,"")}else typeof location=="object"?(Eo=Qt(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Eo.set(`--${zf(e,"-")}`,t),Eo.set(`-${zf(e,"-")}`,t)}})):Eo=Qt();return Eo},au=o=>mS().has(o);var lu=o=>$s?eu(process.env[o.toUpperCase().replaceAll("-","_")]):eu(el.getItem(o));var hS=o=>au("--"+o)||lu(o)!==null,t3=hS("production"),Ag=$s&&Pg(process.env.FORCE_COLOR,["true","1","2"]),Rg=!au("no-colors")&&(!$s||process.stdout.isTTY||Ag)&&(!$s||au("color")||Ag||lu("COLORTERM")!==null||(lu("TERM")||"").includes("color"));var Dg=o=>new Uint8Array(o),gS=(o,e,t)=>new Uint8Array(o,e,t),Ug=o=>new Uint8Array(o),yS=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=jf(o[t]);return btoa(e)},bS=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),vS=o=>{let e=atob(o),t=Dg(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},xS=o=>{let e=Buffer.from(o,"base64");return gS(e.buffer,e.byteOffset,e.byteLength)},Og=tl?yS:bS,$g=tl?vS:xS;var Bg=o=>{let e=Dg(o.byteLength);return e.set(o),e};var cu=class{constructor(e,t){this.left=e,this.right=t}},pr=(o,e)=>new cu(o,e);var Ng=(o,e)=>o.forEach(t=>e(t.left,t.right));var To=typeof document!="undefined"?document:{},wS=o=>To.createElement(o),_S=()=>To.createDocumentFragment(),SS=o=>To.createTextNode(o),r3=typeof DOMParser!="undefined"?new DOMParser:null;var kS=(o,e)=>(Ng(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var IS=o=>{let e=_S();for(let t=0;t<o.length;t++)Wg(e,o[t]);return e},Hg=(o,e)=>(Wg(o,IS(e)),o);var Vi=(o,e=[],t=[])=>Hg(kS(wS(o),e),t);var Bs=SS;var qg=o=>ig(o,(e,t)=>`${t}:${e};`).join("");var Wg=(o,e)=>o.appendChild(e),o3=To.ELEMENT_NODE,n3=To.TEXT_NODE,s3=To.CDATA_SECTION_NODE,i3=To.COMMENT_NODE,a3=To.DOCUMENT_NODE,l3=To.DOCUMENT_TYPE_NODE,c3=To.DOCUMENT_FRAGMENT_NODE;var Fo=Symbol;var Ni=Fo(),Hi=Fo(),uu=Fo(),du=Fo(),pu=Fo(),qi=Fo(),mu=Fo(),Wi=Fo(),hu=Fo(),zg=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var f3=po();var ES={[Ni]:pr("font-weight","bold"),[Hi]:pr("font-weight","normal"),[uu]:pr("color","blue"),[pu]:pr("color","green"),[du]:pr("color","grey"),[qi]:pr("color","red"),[mu]:pr("color","purple"),[Wi]:pr("color","orange"),[hu]:pr("color","black")},TS=o=>{var i;o.length===1&&((i=o[0])==null?void 0:i.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Qt(),n=[],s=0;for(;s<o.length;s++){let a=o[s],l=ES[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let c=qg(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let a=o[s];a instanceof Symbol||n.push(a)}return n},FS=Rg?TS:zg,Kg=(...o)=>{console.log(...FS(o)),PS.forEach(e=>e.print(o))};var PS=Kr();var Gg=o=>({[Symbol.iterator](){return this},next:o}),Jg=(o,e)=>Gg(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),rl=(o,e)=>Gg(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var zi=class{constructor(e,t){this.clock=e,this.len=t}},os=class{constructor(){this.clients=new Map}},fy=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let i=0;i<r.length;i++){let a=r[i];vy(o,s,a.clock,a.len,t)}}),US=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=wr((t+r)/2),s=o[n],i=s.clock;if(i<=e){if(e<i+s.len)return n;t=n+1}else r=n-1}return null},Mu=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&US(t,e.clock)!==null},Du=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=co(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},yu=o=>{let e=new os;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let i=t+1;i<o.length;i++)lg(s,o[i].clients.get(n)||[]);e.clients.set(n,s)}});return Du(e),e},cl=(o,e,t,r)=>{Ur(o.clients,e,()=>[]).push(new zi(t,r))},Uu=()=>new os,OS=o=>{let e=Uu();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i.deleted){let a=i.id.clock,l=i.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new zi(a,l))}}n.length>0&&e.clients.set(r,n)}),e},Cn=(o,e)=>{De(o.restEncoder,e.clients.size),lo(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),De(o.restEncoder,t);let n=r.length;De(o.restEncoder,n);for(let s=0;s<n;s++){let i=r[s];o.writeDsClock(i.clock),o.writeDsLen(i.len)}})},Ki=o=>{let e=new os,t=Ve(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Ve(o.restDecoder),s=Ve(o.restDecoder);if(s>0){let i=Ur(e.clients,n,()=>[]);for(let a=0;a<s;a++)i.push(new zi(o.readDsClock(),o.readDsLen()))}}return e},Xg=(o,e,t)=>{let r=new os,n=Ve(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let i=Ve(o.restDecoder),a=Ve(o.restDecoder),l=t.clients.get(i)||[],c=Ot(t,i);for(let f=0;f<a;f++){let u=o.readDsClock(),d=u+o.readDsLen();if(u<c){c<d&&cl(r,i,c,d-c);let p=Po(l,u),m=l[p];for(!m.deleted&&m.id.clock<u&&(l.splice(p+1,0,vl(e,m,u-m.id.clock)),p++);p<l.length&&(m=l[p++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&l.splice(p,0,vl(e,m,d-m.id.clock)),m.delete(e))}else cl(r,i,u,d-u)}}if(r.clients.size>0){let s=new Zo;return De(s.restEncoder,0),Cn(s,r),s.toUint8Array()}return null};var uy=Oi,Xo=class o extends Wa{constructor({guid:e=Us(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=uy(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new ml,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Yo(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Yo(c=>{let f=u=>{(u===void 0||u===!0)&&(this.off("sync",f),c())};this.on("sync",f)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&ut(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(lo(this.subdocs).map(e=>e.guid))}transact(e,t=null){return ut(this,e,t)}get(e,t=jt){let r=Ur(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==jt&&n!==t)if(n===jt){let s=new t;s._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=r._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,js)}getText(e=""){return this.get(e,Zi)}getMap(e=""){return this.get(e,zs)}getXmlElement(e=""){return this.get(e,ea)}getXmlFragment(e=""){return this.get(e,Ks)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){lo(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new o({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,ut(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Hs=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ve(this.restDecoder)}readDsLen(){return Ve(this.restDecoder)}},fl=class extends Hs{readLeftID(){return Ye(Ve(this.restDecoder),Ve(this.restDecoder))}readRightID(){return Ye(Ve(this.restDecoder),Ve(this.restDecoder))}readClient(){return Ve(this.restDecoder)}readInfo(){return ts(this.restDecoder)}readString(){return uo(this.restDecoder)}readParentInfo(){return Ve(this.restDecoder)===1}readTypeRef(){return Ve(this.restDecoder)}readLen(){return Ve(this.restDecoder)}readAny(){return Ms(this.restDecoder)}readBuf(){return Bg(Wt(this.restDecoder))}readJSON(){return JSON.parse(uo(this.restDecoder))}readKey(){return uo(this.restDecoder)}},bu=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ve(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Ve(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Ln=class extends bu{constructor(e){super(e),this.keys=[],Ve(e),this.keyClockDecoder=new Ds(Wt(e)),this.clientDecoder=new rs(Wt(e)),this.leftClockDecoder=new Ds(Wt(e)),this.rightClockDecoder=new Ds(Wt(e)),this.infoDecoder=new Di(Wt(e),ts),this.stringDecoder=new Xa(Wt(e)),this.parentInfoDecoder=new Di(Wt(e),ts),this.typeRefDecoder=new rs(Wt(e)),this.lenDecoder=new rs(Wt(e))}readLeftID(){return new In(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new In(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ms(this.restDecoder)}readBuf(){return Wt(this.restDecoder)}readJSON(){return Ms(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},qs=class{constructor(){this.restEncoder=Mt()}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){De(this.restEncoder,e)}writeDsLen(e){De(this.restEncoder,e)}},ns=class extends qs{writeLeftID(e){De(this.restEncoder,e.client),De(this.restEncoder,e.clock)}writeRightID(e){De(this.restEncoder,e.client),De(this.restEncoder,e.clock)}writeClient(e){De(this.restEncoder,e)}writeInfo(e){Ja(this.restEncoder,e)}writeString(e){Jr(this.restEncoder,e)}writeParentInfo(e){De(this.restEncoder,e?1:0)}writeTypeRef(e){De(this.restEncoder,e)}writeLen(e){De(this.restEncoder,e)}writeAny(e){Ps(this.restEncoder,e)}writeBuf(e){It(this.restEncoder,e)}writeJSON(e){Jr(this.restEncoder,JSON.stringify(e))}writeKey(e){Jr(this.restEncoder,e)}},ul=class{constructor(){this.restEncoder=Mt(),this.dsCurrVal=0}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,De(this.restEncoder,t)}writeDsLen(e){e===0&&Yr(),De(this.restEncoder,e-1),this.dsCurrVal+=e}},Zo=class extends ul{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new As,this.clientEncoder=new es,this.leftClockEncoder=new As,this.rightClockEncoder=new As,this.infoEncoder=new Ri(Ja),this.stringEncoder=new Ka,this.parentInfoEncoder=new Ri(Ja),this.typeRefEncoder=new es,this.lenEncoder=new es}toUint8Array(){let e=Mt();return De(e,0),It(e,this.keyClockEncoder.toUint8Array()),It(e,this.clientEncoder.toUint8Array()),It(e,this.leftClockEncoder.toUint8Array()),It(e,this.rightClockEncoder.toUint8Array()),It(e,ht(this.infoEncoder)),It(e,this.stringEncoder.toUint8Array()),It(e,ht(this.parentInfoEncoder)),It(e,this.typeRefEncoder.toUint8Array()),It(e,this.lenEncoder.toUint8Array()),Mi(e,ht(this.restEncoder)),ht(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ps(this.restEncoder,e)}writeBuf(e){It(this.restEncoder,e)}writeJSON(e){Ps(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},$S=(o,e,t,r)=>{r=co(r,e[0].id.clock);let n=Po(e,r);De(o.restEncoder,e.length-n),o.writeClient(t),De(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let i=n+1;i<e.length;i++)e[i].write(o,0)},Ou=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{Ot(e,s)>n&&r.set(s,n)}),xl(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),De(o.restEncoder,r.size),lo(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{$S(o,e.clients.get(n),n,s)})},BS=(o,e)=>{let t=Qt(),r=Ve(o.restDecoder);for(let n=0;n<r;n++){let s=Ve(o.restDecoder),i=new Array(s),a=o.readClient(),l=Ve(o.restDecoder);t.set(a,{i:0,refs:i});for(let c=0;c<s;c++){let f=o.readInfo();switch(31&f){case 0:{let u=o.readLen();i[c]=new _r(Ye(a,l),u),l+=u;break}case 10:{let u=Ve(o.restDecoder);i[c]=new Sr(Ye(a,l),u),l+=u;break}default:{let u=(f&192)===0,d=new Dt(Ye(a,l),null,(f&128)===128?o.readLeftID():null,null,(f&64)===64?o.readRightID():null,u?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,u&&(f&32)===32?o.readString():null,$y(o,f));i[c]=d,l+=d.length}}}}return t},VS=(o,e,t)=>{let r=[],n=lo(t.keys()).sort((p,m)=>p-m);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let p=t.get(n[n.length-1]);for(;p.refs.length===p.i;)if(n.pop(),n.length>0)p=t.get(n[n.length-1]);else return null;return p},i=s();if(i===null)return null;let a=new ml,l=new Map,c=(p,m)=>{let y=l.get(p);(y==null||y>m)&&l.set(p,m)},f=i.refs[i.i++],u=new Map,d=()=>{for(let p of r){let m=p.id.client,y=t.get(m);y?(y.i--,a.clients.set(m,y.refs.slice(y.i)),t.delete(m),y.i=0,y.refs=[]):a.clients.set(m,[p]),n=n.filter(g=>g!==m)}r.length=0};for(;;){if(f.constructor!==Sr){let m=Ur(u,f.id.client,()=>Ot(e,f.id.client))-f.id.clock;if(m<0)r.push(f),c(f.id.client,f.id.clock-1),d();else{let y=f.getMissing(o,e);if(y!==null){r.push(f);let g=t.get(y)||{refs:[],i:0};if(g.refs.length===g.i)c(y,Ot(e,y)),d();else{f=g.refs[g.i++];continue}}else(m===0||m<f.length)&&(f.integrate(o,m),u.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(i!==null&&i.i<i.refs.length)f=i.refs[i.i++];else{if(i=s(),i===null)break;f=i.refs[i.i++]}}if(a.clients.size>0){let p=new Zo;return Ou(p,a,new Map),De(p.restEncoder,0),{missing:l,update:p.toUint8Array()}}return null},NS=(o,e)=>Ou(o,e.doc.store,e.beforeState),HS=(o,e,t,r=new Ln(o))=>ut(e,n=>{n.local=!1;let s=!1,i=n.doc,a=i.store,l=BS(r,i),c=VS(n,a,l),f=a.pendingStructs;if(f){for(let[d,p]of f.missing)if(p<Ot(a,d)){s=!0;break}if(c){for(let[d,p]of c.missing){let m=f.missing.get(d);(m==null||m>p)&&f.missing.set(d,p)}f.update=hl([f.update,c.update])}}else a.pendingStructs=c;let u=Xg(r,n,a);if(a.pendingDs){let d=new Ln(Or(a.pendingDs));Ve(d.restDecoder);let p=Xg(d,n,a);u&&p?a.pendingDs=hl([u,p]):a.pendingDs=u||p}else a.pendingDs=u;if(s){let d=a.pendingStructs.update;a.pendingStructs=null,dy(n.doc,d)}},t,!1);var dy=(o,e,t,r=Ln)=>{let n=Or(e);HS(n,o,t,new r(n))},Ro=(o,e,t)=>dy(o,e,t,fl),qS=(o,e,t=new Map)=>{Ou(o,e.store,t),Cn(o,OS(e.store))},WS=(o,e=new Uint8Array([0]),t=new Zo)=>{let r=py(e);qS(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(ok(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===ns)return tk(n.map((s,i)=>i===0?s:sk(s)));if(t.constructor===Zo)return hl(n)}return n[0]},na=(o,e)=>WS(o,e,new ns),jS=o=>{let e=new Map,t=Ve(o.restDecoder);for(let r=0;r<t;r++){let n=Ve(o.restDecoder),s=Ve(o.restDecoder);e.set(n,s)}return e},py=o=>jS(new Hs(Or(o))),my=(o,e)=>(De(o.restEncoder,e.size),lo(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{De(o.restEncoder,t),De(o.restEncoder,r)}),o),zS=(o,e)=>my(o,xl(e.store)),KS=(o,e=new ul)=>(o instanceof Map?my(e,o):zS(e,o),e.toUint8Array()),hy=o=>KS(o,new qs),vu=class{constructor(){this.l=[]}},Zg=()=>new vu,ey=(o,e)=>o.l.push(e),ty=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},gy=(o,e,t)=>Bi(o.l,[e,t]),In=class{constructor(e,t){this.client=e,this.clock=t}},Ns=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ye=(o,e)=>new In(o,e);var yy=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Yr()};var dl=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,i)=>{let a=s.get("ds"),l=s.get("ids"),c=f=>this.clients.set(f,i);a.observe(f=>{f.changes.added.forEach(u=>{u.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(i,yu([this.dss.get(i)||Uu(),Ki(new Hs(Or(d)))]))})})}),this.dss.set(i,yu(a.map(f=>Ki(new Hs(Or(f)))))),l.observe(f=>f.changes.added.forEach(u=>u.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,i=s.get(r);i||(i=new zs,i.set("ids",new js),i.set("ds",new js),s.set(r,i)),i.get("ids").push([t]),s.observe(a=>{setTimeout(()=>{let l=s.get(r);if(l!==i){i=l,this.clients.forEach((u,d)=>{r===u&&i.get("ids").push([d])});let c=new qs,f=this.dss.get(r);f&&(Cn(c,f),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{let l=i.get("ds"),c=a.deleteSet;if(a.local&&c.clients.size>0&&n(a,c)){let f=new qs;Cn(f,c),l.push([f.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Mu(r,e))return t;return null}},pl=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var $u=o=>new pl(o.type==null?null:Ye(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ye(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),xu=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},GS=(o,e,t=0)=>new xu(o,e,t),ol=(o,e,t)=>{let r=null,n=null;return o._item===null?n=yy(o):r=Ye(o._item.id.client,o._item.id.clock),new pl(r,n,e,t)},Bu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return ol(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return ol(o,Ye(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return ol(o,r.lastId,t);r=r.right}return ol(o,null,t)};var Vu=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,i=o.assoc,a=null,l=0;if(r!==null){if(Ot(t,r.client)<=r.clock)return null;let c=cy(t,r),f=c.item;if(!(f instanceof Dt))return null;if(a=f.parent,a._item===null||!a._item.deleted){l=f.deleted||!f.countable?0:c.diff+(i>=0?0:1);let u=f.left;for(;u!==null;)!u.deleted&&u.countable&&(l+=u.length),u=u.left}}else{if(s!==null)a=e.get(s);else if(n!==null){if(Ot(t,n.client)<=n.clock)return null;let{item:c}=cy(t,n);if(c instanceof Dt&&c.content instanceof Ao)a=c.content.type;else return null}else throw Yr();i>=0?l=a._length:l=0}return GS(a,l,o.assoc)},Nu=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Ns(o.item,e.item)&&Ns(o.type,e.type)&&o.assoc===e.assoc,wu=class{constructor(e,t){this.ds=e,this.sv=t}};var JS=(o,e)=>new wu(o,e),v3=JS(Uu(),new Map);var Vs=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Mu(e.ds,o.id),_u=(o,e)=>{let t=Ur(o.meta,_u,Kr),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<Ot(r,s)&&En(o,Ye(s,n))}),fy(o,e.ds,n=>{}),t.add(e))};var ml=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},xl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},Ot=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},by=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Yr()}t.push(e)},Po=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let i=wr(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[i],s=n.id.clock,s<=e){if(e<s+n.length)return i;t=i+1}else r=i-1;i=wr((t+r)/2)}throw Yr()},QS=(o,e)=>{let t=o.clients.get(e.client);return t[Po(t,e.clock)]},il=QS,Su=(o,e,t)=>{let r=Po(e,t),n=e[r];return n.id.clock<t&&n instanceof Dt?(e.splice(r+1,0,vl(o,n,t-n.id.clock)),r+1):r},En=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Su(o,t,e.clock)]},ry=(o,e,t)=>{let r=e.clients.get(t.client),n=Po(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==_r&&r.splice(n+1,0,vl(o,s,t.clock-s.id.clock+1)),s},YS=(o,e,t)=>{let r=o.clients.get(e.id.client);r[Po(r,e.id.clock)]=t},vy=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,i=Su(o,e,t),a;do a=e[i++],s<a.id.clock+a.length&&Su(o,e,s),n(a);while(i<e.length&&e[i].id.clock<s)},ku=class{constructor(e,t,r){this.doc=e,this.deleteSet=new os,this.beforeState=xl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},oy=(o,e)=>e.deleteSet.clients.size===0&&!ag(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Du(e.deleteSet),NS(o,e),Cn(o,e.deleteSet),!0),ny=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ur(o.changed,e,Kr).add(t)},al=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Dt&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},XS=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){let a=n[i],l=a.clock+a.len;for(let c=Po(s,a.clock),f=s[c];c<s.length&&f.id.clock<l;f=s[++c]){let u=s[c];if(a.clock+a.len<=u.id.clock)break;u instanceof Dt&&u.deleted&&!u.keep&&t(u)&&u.gc(e,!1)}}}},ZS=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let i=t[s],a=wn(n.length-1,1+Po(n,i.clock+i.len-1));for(let l=a,c=n[l];l>0&&c.id.clock>=i.clock;c=n[l])l-=1+al(n,l)}})};var xy=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,i=t._mergeStructs;try{Du(s),t.afterState=xl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(f=>f.target._item===null||!f.target._item.deleted),l.forEach(f=>{f.currentTarget=c,f._path=null}),l.sort((f,u)=>f.path.length-u.path.length),gy(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Bi(a,[]),t._needFormattingCleanup&&gk(t)}finally{r.gc&&XS(s,n,r.gcFilter),ZS(s,n),t.afterState.forEach((f,u)=>{let d=t.beforeState.get(u)||0;if(d!==f){let p=n.clients.get(u),m=co(Po(p,d),1);for(let y=p.length-1;y>=m;)y-=1+al(p,y)}});for(let f=i.length-1;f>=0;f--){let{client:u,clock:d}=i[f].id,p=n.clients.get(u),m=Po(p,d);m+1<p.length&&al(p,m+1)>1||m>0&&al(p,m)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Kg(Wi,Ni,"[yjs] ",Hi,qi,"Changed the client-id because another client seems to be using it."),r.clientID=uy()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let f=new ns;oy(f,t)&&r.emit("update",[f.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let f=new Zo;oy(f,t)&&r.emit("updateV2",[f.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(f=>{f.clientID=r.clientID,f.collectionid==null&&(f.collectionid=r.collectionid),r.subdocs.add(f)}),c.forEach(f=>r.subdocs.delete(f)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(f=>f.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):xy(o,e+1)}}},ut=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,i=null;o._transaction===null&&(s=!0,o._transaction=new ku(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{i=e(o._transaction)}finally{if(s){let a=o._transaction===n[0];o._transaction=null,a&&xy(n,0)}}return i};function*ek(o){let e=Ve(o.restDecoder);for(let t=0;t<e;t++){let r=Ve(o.restDecoder),n=o.readClient(),s=Ve(o.restDecoder);for(let i=0;i<r;i++){let a=o.readInfo();if(a===10){let l=Ve(o.restDecoder);yield new Sr(Ye(n,s),l),s+=l}else if((31&a)!==0){let l=(a&192)===0,c=new Dt(Ye(n,s),null,(a&128)===128?o.readLeftID():null,null,(a&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(a&32)===32?o.readString():null,$y(o,a));yield c,s+=c.length}else{let l=o.readLen();yield new _r(Ye(n,s),l),s+=l}}}}var Gi=class{constructor(e,t){this.gen=ek(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Sr);return this.curr}};var Ji=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},tk=o=>hl(o,fl,ns);var rk=(o,e)=>{if(o.constructor===_r){let{client:t,clock:r}=o.id;return new _r(Ye(t,r+e),o.length-e)}else if(o.constructor===Sr){let{client:t,clock:r}=o.id;return new Sr(Ye(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new Dt(Ye(r,n+e),null,Ye(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},hl=(o,e=Ln,t=Zo)=>{if(o.length===1)return o[0];let r=o.map(f=>new e(Or(f))),n=r.map(f=>new Gi(f,!0)),s=null,i=new t,a=new Ji(i);for(;n=n.filter(d=>d.curr!==null),n.sort((d,p)=>{if(d.curr.id.client===p.curr.id.client){let m=d.curr.id.clock-p.curr.id.clock;return m===0?d.curr.constructor===p.curr.constructor?0:d.curr.constructor===Sr?1:-1:m}else return p.curr.id.client-d.curr.id.client}),n.length!==0;){let f=n[0],u=f.curr.id.client;if(s!==null){let d=f.curr,p=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=f.next(),p=!0;if(d===null||d.id.client!==u||p&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)Sn(a,s.struct,s.offset),s={struct:d,offset:0},f.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Sr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Sn(a,s.struct,s.offset);let m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Sr(Ye(u,s.struct.id.clock+s.struct.length),m),offset:0}}else{let m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===Sr?s.struct.length-=m:d=rk(d,m)),s.struct.mergeWith(d)||(Sn(a,s.struct,s.offset),s={struct:d,offset:0},f.next())}}else s={struct:f.curr,offset:0},f.next();for(let d=f.curr;d!==null&&d.id.client===u&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Sr;d=f.next())Sn(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Sn(a,s.struct,s.offset),s=null),Hu(a);let l=r.map(f=>Ki(f)),c=yu(l);return Cn(i,c),i.toUint8Array()},ok=(o,e,t=Ln,r=Zo)=>{let n=py(e),s=new r,i=new Ji(s),a=new t(Or(o)),l=new Gi(a,!1);for(;l.curr;){let f=l.curr,u=f.id.client,d=n.get(u)||0;if(l.curr.constructor===Sr){l.next();continue}if(f.id.clock+f.length>d)for(Sn(i,f,co(d-f.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)Sn(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}Hu(i);let c=Ki(a);return Cn(s,c),s.toUint8Array()};var wy=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:ht(o.encoder.restEncoder)}),o.encoder.restEncoder=Mt(),o.written=0)},Sn=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&wy(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),De(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},Hu=o=>{wy(o);let e=o.encoder.restEncoder;De(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];De(e,r.written),Mi(e,r.restEncoder)}},nk=(o,e,t,r)=>{let n=new t(Or(o)),s=new Gi(n,!1),i=new r,a=new Ji(i);for(let c=s.curr;c!==null;c=s.next())Sn(a,e(c),0);Hu(a);let l=Ki(n);return Cn(i,l),i.toUint8Array()};var sk=o=>nk(o,Fg,Ln,ns),sy="You must not compute changes after the event-handler fired.",Ws=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ik(this.currentTarget,this.target))}deletes(e){return Mu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Qr(sy);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),i,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))i="delete",a=qa(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",a=qa(l.content.getContent())):(i="add",a=void 0)}else if(this.deletes(s))i="delete",a=qa(s.content.getContent());else return;e.set(n,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Qr(sy);let t=this.target,r=Kr(),n=Kr(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,n.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}},ik=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},_y=80,qu=0,Iu=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=qu++}},ak=o=>{o.timestamp=qu++},Sy=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=qu++},lk=(o,e,t)=>{if(o.length>=_y){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return Sy(r,e,t),r}else{let r=new Iu(e,t);return o.push(r),r}},wl=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,i)=>Ls(e-s.index)<Ls(e-i.index)?s:i),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,ak(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&Ls(t.index-n)<r.parent.length/_y?(Sy(t,r,n),t):lk(o._searchMarker,r,n)},Qi=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=co(e,n.index+t))}};var _l=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;Ur(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;gy(r._eH,t,e)},jt=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Zg(),this._dEH=Zg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw fo()}clone(){throw fo()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){ey(this._eH,e)}observeDeep(e){ey(this._dEH,e)}unobserve(e){ty(this._eH,e)}unobserveDeep(e){ty(this._dEH,e)}toJSON(){}},ky=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let i=s.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)n.push(i[a]),r--;e=0}}s=s.right}return n},Iy=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var Yi=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Cy=(o,e)=>{let t=[];return Yi(o,(r,n)=>{t.push(e(r,n,o))}),t},ck=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Ly=(o,e)=>{let t=wl(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},gl=(o,e,t,r)=>{let n=t,s=o.doc,i=s.clientID,a=s.store,l=t===null?e._start:t.right,c=[],f=()=>{c.length>0&&(n=new Dt(Ye(i,Ot(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Gs(c)),n.integrate(o,0),c=[])};r.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(f(),u.constructor){case Uint8Array:case ArrayBuffer:n=new Dt(Ye(i,Ot(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new ra(new Uint8Array(u))),n.integrate(o,0);break;case Xo:n=new Dt(Ye(i,Ot(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new oa(u)),n.integrate(o,0);break;default:if(u instanceof jt)n=new Dt(Ye(i,Ot(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Ao(u)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),f()},Ey=()=>Qr("Length exceeded!"),Ty=(o,e,t,r)=>{if(t>e._length)throw Ey();if(t===0)return e._searchMarker&&Qi(e._searchMarker,t,r.length),gl(o,e,null,r);let n=t,s=wl(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&En(o,Ye(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&Qi(e._searchMarker,n,r.length),gl(o,e,i,r)},fk=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return gl(o,e,n,t)},Fy=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,i=wl(e,t),a=e._start;for(i!==null&&(a=i.p,t-=i.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&En(o,Ye(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&En(o,Ye(a.id.client,a.id.clock+r)),a.delete(o),r-=a.length),a=a.right;if(r>0)throw Ey();e._searchMarker&&Qi(e._searchMarker,n,-s+r)},yl=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},Wu=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,i=s.clientID,a;if(r==null)a=new Gs([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Gs([r]);break;case Uint8Array:a=new ra(r);break;case Xo:a=new oa(r);break;default:if(r instanceof jt)a=new Ao(r);else throw new Error("Unexpected content type")}new Dt(Ye(i,Ot(s.store,i)),n,n&&n.lastId,null,null,e,t,a).integrate(o,0)},ju=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Py=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Ay=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var uk=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Vs(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},nl=o=>Jg(o.entries(),e=>!e[1].deleted),Cu=class extends Ws{constructor(e,t){super(e,t),this._transaction=t}},js=class o extends jt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new o;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new o}clone(){let e=new o;return e.insert(0,this.toArray().map(t=>t instanceof jt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),_l(this,e,new Cu(this,e))}insert(e,t){this.doc!==null?ut(this.doc,r=>{Ty(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?ut(this.doc,t=>{fk(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?ut(this.doc,r=>{Fy(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Ly(this,e)}toArray(){return Iy(this)}slice(e=0,t=this.length){return ky(this,e,t)}toJSON(){return this.map(e=>e instanceof jt?e.toJSON():e)}map(e){return Cy(this,e)}forEach(e){Yi(this,e)}[Symbol.iterator](){return ck(this)}_write(e){e.writeTypeRef(Ak)}},dk=o=>new js,Lu=class extends Ws{constructor(e,t,r){super(e,t),this.keysChanged=r}},zs=class o extends jt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new o}clone(){let e=new o;return this.forEach((t,r)=>{e.set(r,t instanceof jt?t.clone():t)}),e}_callObserver(e,t){_l(this,e,new Lu(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof jt?n.toJSON():n}}),e}get size(){return[...nl(this._map)].length}keys(){return rl(nl(this._map),e=>e[0])}values(){return rl(nl(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return rl(nl(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ut(this.doc,t=>{yl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?ut(this.doc,r=>{Wu(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return ju(this,e)}has(e){return Ay(this,e)}clear(){this.doc!==null?ut(this.doc,e=>{this.forEach(function(t,r,n){yl(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Rk)}},pk=o=>new zs,kn=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&nu(o,e),Xi=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Yr(),this.right.content.constructor){case zt:this.right.deleted||Js(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},iy=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case zt:e.right.deleted||Js(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&En(o,Ye(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},sl=(o,e,t,r)=>{let n=new Map,s=r?wl(e,t):null;if(s){let i=new Xi(s.p.left,s.p,s.index,n);return iy(o,i,t-s.index)}else{let i=new Xi(null,e._start,0,n);return iy(o,i,t)}},Ry=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===zt&&kn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((i,a)=>{let l=t.left,c=t.right,f=new Dt(Ye(s,Ot(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new zt(a,i));f.integrate(o,0),t.right=f,t.forward()})},Js=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},My=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===zt&&kn((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Dy=(o,e,t,r)=>{var a;let n=o.doc,s=n.clientID,i=new Map;for(let l in r){let c=r[l],f=(a=t.currentAttributes.get(l))!=null?a:null;if(!kn(f,c)){i.set(l,f);let{left:u,right:d}=t;t.right=new Dt(Ye(s,Ot(n.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new zt(l,c)),t.right.integrate(o,0),t.forward()}}return i},gu=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,p)=>{n[p]===void 0&&(n[p]=null)});let s=o.doc,i=s.clientID;My(t,n);let a=Dy(o,e,t,n),l=r.constructor===String?new en(r):r instanceof jt?new Ao(r):new ss(r),{left:c,right:f,index:u}=t;e._searchMarker&&Qi(e._searchMarker,t.index,l.getLength()),f=new Dt(Ye(i,Ot(s.store,i)),c,c&&c.lastId,f,f&&f.id,e,null,l),f.integrate(o,0),t.right=f,t.index=u,t.forward(),Ry(o,e,t,a)},ay=(o,e,t,r,n)=>{let s=o.doc,i=s.clientID;My(t,n);let a=Dy(o,e,t,n);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===zt));){if(!t.right.deleted)switch(t.right.content.constructor){case zt:{let{key:l,value:c}=t.right.content,f=n[l];if(f!==void 0){if(kn(f,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&En(o,Ye(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new Dt(Ye(i,Ot(s.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new en(l)),t.right.integrate(o,0),t.forward()}Ry(o,e,t,a)},Uy=(o,e,t,r,n)=>{var c,f;let s=e,i=Qt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===zt){let u=s.content;i.set(u.key,u)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let u=e.content;switch(u.constructor){case zt:{let{key:d,value:p}=u,m=(c=r.get(d))!=null?c:null;(i.get(d)!==u||m===p)&&(e.delete(o),a++,!l&&((f=n.get(d))!=null?f:null)===p&&m!==p&&(m===null?n.delete(d):n.set(d,m))),!l&&!e.deleted&&Js(n,u);break}}}e=e.right}return a},mk=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===zt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},hk=o=>{let e=0;return ut(o.doc,t=>{let r=o._start,n=o._start,s=Qt(),i=Na(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case zt:Js(i,n.content);break;default:e+=Uy(t,r,n,s,i),s=Na(i),r=n;break}n=n.right}}),e},gk=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&vy(o,t.store.clients.get(r),s,n,i=>{!i.deleted&&i.content.constructor===zt&&i.constructor!==_r&&e.add(i.parent)})}ut(t,r=>{fy(o,o.deleteSet,n=>{if(n instanceof _r||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===zt?e.add(s):mk(r,n)});for(let n of e)hk(n)})},ly=(o,e,t)=>{let r=t,n=Na(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ao:case ss:case en:t<e.right.length&&En(o,Ye(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&Uy(o,s,e.right,n,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&Qi(i._searchMarker,e.index,-r+t),e},Eu=class extends Ws{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];ut(e,r=>{var p,m,y;let n=new Map,s=new Map,i=this.target._start,a=null,l={},c="",f=0,u=0,d=()=>{if(a!==null){let g=null;switch(a){case"delete":u>0&&(g={delete:u}),u=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},n.size>0&&(g.attributes={},n.forEach((I,L)=>{I!==null&&(g.attributes[L]=I)}))),c="";break;case"retain":f>0&&(g={retain:f},Tg(l)||(g.attributes=Cg({},l))),f=0;break}g&&t.push(g),a=null}};for(;i!==null;){switch(i.content.constructor){case Ao:case ss:this.adds(i)?this.deletes(i)||(d(),a="insert",c=i.content.getContent()[0],d()):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),u+=1):i.deleted||(a!=="retain"&&(d(),a="retain"),f+=1);break;case en:this.adds(i)?this.deletes(i)||(a!=="insert"&&(d(),a="insert"),c+=i.content.str):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),u+=i.length):i.deleted||(a!=="retain"&&(d(),a="retain"),f+=i.length);break;case zt:{let{key:g,value:I}=i.content;if(this.adds(i)){if(!this.deletes(i)){let L=(p=n.get(g))!=null?p:null;kn(L,I)?I!==null&&i.delete(r):(a==="retain"&&d(),kn(I,(m=s.get(g))!=null?m:null)?delete l[g]:l[g]=I)}}else if(this.deletes(i)){s.set(g,I);let L=(y=n.get(g))!=null?y:null;kn(L,I)||(a==="retain"&&d(),l[g]=L)}else if(!i.deleted){s.set(g,I);let L=l[g];L!==void 0&&(kn(L,I)?L!==null&&i.delete(r):(a==="retain"&&d(),I===null?delete l[g]:l[g]=I))}i.deleted||(a==="insert"&&d(),Js(n,i.content));break}}i=i.right}for(d();t.length>0;){let g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},Zi=class o extends jt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new o}clone(){let e=new o;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Eu(this,e,t);_l(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===en&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?ut(this.doc,r=>{let n=new Xi(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(i.insert!==void 0){let a=!t&&typeof i.insert=="string"&&s===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&gu(r,this,n,a,i.attributes||{})}else i.retain!==void 0?ay(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&ly(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,i=this.doc,a="",l=this._start;function c(){if(a.length>0){let u={},d=!1;s.forEach((m,y)=>{d=!0,u[y]=m});let p={insert:a};d&&(p.attributes=u),n.push(p),a=""}}let f=()=>{for(;l!==null;){if(Vs(l,e)||t!==void 0&&Vs(l,t))switch(l.content.constructor){case en:{let u=s.get("ychange");e!==void 0&&!Vs(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Vs(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case Ao:case ss:{c();let u={insert:l.content.getContent()[0]};if(s.size>0){let d={};u.attributes=d,s.forEach((p,m)=>{d[m]=p})}n.push(u);break}case zt:Vs(l,e)&&(c(),Js(s,l.content));break}l=l.right}c()};return e||t?ut(i,u=>{e&&_u(u,e),t&&_u(u,t),f()},"cleanup"):f(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?ut(n,s=>{let i=sl(s,this,e,!r);r||(r={},i.currentAttributes.forEach((a,l)=>{r[l]=a})),gu(s,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?ut(n,s=>{let i=sl(s,this,e,!r);gu(s,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?ut(r,n=>{ly(n,sl(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?ut(n,s=>{let i=sl(s,this,e,!1);i.right!==null&&ay(s,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?ut(this.doc,t=>{yl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?ut(this.doc,r=>{Wu(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return ju(this,e)}getAttributes(){return Py(this)}_write(e){e.writeTypeRef(Mk)}},yk=o=>new Zi,ji=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ea||t.constructor===Ks)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Ks=class o extends jt{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new o}clone(){let e=new o;return e.insert(0,this.toArray().map(t=>t instanceof jt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ji(this,e)}querySelector(e){e=e.toUpperCase();let r=new ji(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),lo(new ji(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){_l(this,e,new Tu(this,t,e))}toString(){return Cy(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Yi(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?ut(this.doc,r=>{Ty(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)ut(this.doc,r=>{let n=e&&e instanceof jt?e._item:e;gl(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Qr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?ut(this.doc,r=>{Fy(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Iy(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Ly(this,e)}slice(e=0,t=this.length){return ky(this,e,t)}forEach(e){Yi(this,e)}_write(e){e.writeTypeRef(Uk)}},bk=o=>new Ks,ea=class o extends Ks{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new o(this.nodeName)}clone(){let e=new o(this.nodeName),t=this.getAttributes();return Lg(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof jt?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let n=r.length;for(let a=0;a<n;a++){let l=r[a];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?ut(this.doc,t=>{yl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?ut(this.doc,r=>{Wu(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return ju(this,e)}hasAttribute(e){return Ay(this,e)}getAttributes(e){return e?uk(this,e):Py(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let i in s){let a=s[i];typeof a=="string"&&n.setAttribute(i,a)}return Yi(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(Dk),e.writeKey(this.nodeName)}},vk=o=>new ea(o.readKey()),Tu=class extends Ws{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},Fu=class o extends zs{constructor(e){super(),this.hookName=e}_copy(){return new o(this.hookName)}clone(){let e=new o(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Ok),e.writeKey(this.hookName)}},xk=o=>new Fu(o.readKey()),Pu=class o extends Zi{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new o}clone(){let e=new o;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let i in e.attributes[n])s.push({key:i,value:e.attributes[n][i]});s.sort((i,a)=>i.key<a.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){let a=s.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef($k)}},wk=o=>new Pu,ta=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw fo()}mergeWith(e){return!1}write(e,t,r){throw fo()}integrate(e,t){throw fo()}},_k=0,_r=class extends ta{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),by(e.doc.store,this)}write(e,t){e.writeInfo(_k),e.writeLen(this.length-t)}getMissing(e,t){return null}},ra=class o{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new o(this.content)}splice(e){throw fo()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},Sk=o=>new ra(o.readBuf()),bl=class o{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new o(this.len)}splice(e){let t=new o(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){cl(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},kk=o=>new bl(o.readLen()),Oy=(o,e)=>new Xo({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),oa=class o{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new o(Oy(this.doc.guid,this.opts))}splice(e){throw fo()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Ik=o=>new oa(Oy(o.readString(),o.readAny())),ss=class o{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new o(this.embed)}splice(e){throw fo()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Ck=o=>new ss(o.readJSON()),zt=class o{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new o(this.key,this.value)}splice(e){throw fo()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},Lk=o=>new zt(o.readKey(),o.readJSON()),Au=class o{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new o(this.arr)}splice(e){let t=new o(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},Ek=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new Au(t)},Gs=class o{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new o(this.arr)}splice(e){let t=new o(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},Tk=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Gs(t)},en=class o{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new o(this.str)}splice(e){let t=new o(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},Fk=o=>new en(o.readString()),Pk=[dk,pk,yk,vk,bk,xk,wk],Ak=0,Rk=1,Mk=2,Dk=3,Uk=4,Ok=5,$k=6,Ao=class o{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new o(this.type._copy())}splice(e){throw fo()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},Bk=o=>new Ao(Pk[o.readTypeRef()](o)),cy=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Ye(t.client,t.clock+r)),n=il(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof Dt);return{item:n,diff:r}};var vl=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new Dt(Ye(r,n+t),e,Ye(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ye(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var Dt=class o extends ta{constructor(e,t,r,n,s,i,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ot(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ot(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===In&&this.id.client!==this.parent.client&&this.parent.clock>=Ot(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ry(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=En(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===_r||this.right&&this.right.constructor===_r)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===o&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===o&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===In){let r=il(t,this.parent);r.constructor===_r?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=ry(e,e.doc.store,Ye(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),s.add(n),Ns(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(Ns(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(il(e.doc.store,n.origin)))s.has(il(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),by(e.doc.store,this),this.content.integrate(e,this),ny(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new _r(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ye(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Ns(e.origin,this.lastId)&&this.right===e&&Ns(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),cl(e.deleteSet,this.id.client,this.id.clock,this.length),ny(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Yr();this.content.gc(e),t?YS(e,this,new _r(this.id,this.length)):this.content=new bl(this.length)}write(e,t){let r=t>0?Ye(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let a=this.parent;if(a._item!==void 0){let l=a._item;if(l===null){let c=yy(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===In?(e.writeParentInfo(!1),e.writeLeftID(a)):Yr();s!==null&&e.writeString(s)}this.content.write(e,t)}},$y=(o,e)=>Vk[e&31](o),Vk=[()=>{Yr()},kk,Ek,Sk,Fk,Ck,Lk,Bk,Tk,Ik,()=>{Yr()}],Nk=10,Sr=class extends ta{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Yr()}write(e,t){e.writeInfo(Nk),De(e.restEncoder,this.length-t)}getMissing(e,t){return null}},By=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Vy="__ $YJS$ __";By[Vy]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");By[Vy]=!0;var as=o=>Yo((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Ny=(o,e)=>Yo((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Qr(s.target.error)),n.onsuccess=s=>{let i=s.target.result;i.onversionchange=()=>{i.close()},t(i)}}),Hy=o=>as(indexedDB.deleteDatabase(o)),qy=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),Qs=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>jk(r,n))},zu=(o,e)=>as(o.count(e)),Wy=(o,e)=>as(o.get(e)),Ku=(o,e)=>as(o.delete(e)),jy=(o,e,t)=>as(o.put(e,t));var Sl=(o,e)=>as(o.add(e)),zy=(o,e,t)=>as(o.getAll(e,t));var Hk=(o,e,t)=>{let r=null;return Wk(o,e,n=>(r=n,!1),t).then(()=>r)},Ky=(o,e=null)=>Hk(o,e,"prev");var qk=(o,e)=>Yo((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var Wk=(o,e,t,r="next")=>qk(o.openKeyCursor(e,r),n=>t(n.key)),jk=(o,e)=>o.objectStore(e);var Gy=(o,e)=>IDBKeyRange.upperBound(o,e),Jy=(o,e)=>IDBKeyRange.lowerBound(o,e);var Gu="custom",Qy="updates",Yy=500,Xy=(o,e=()=>{},t=()=>{})=>{let[r]=Qs(o.db,[Qy]);return zy(r,Jy(o._dbref,!1)).then(n=>{o._destroyed||(e(r),ut(o.doc,()=>{n.forEach(s=>Ro(o.doc,s))},o,!1))}).then(()=>Ky(r).then(n=>{o._dbref=n+1})).then(()=>zu(r).then(n=>{o._dbsize=n})).then(()=>(o._destroyed||t(r),r))},Kk=(o,e=!0)=>Xy(o).then(t=>{(e||o._dbsize>=Yy)&&Sl(t,na(o.doc)).then(()=>Ku(t,Gy(o._dbref,!0))).then(()=>zu(t).then(r=>{o._dbsize=r}))});var Tn=class extends xn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._serverSynced=void 0,this._origin=void 0,this._db=Ny(e,r=>qy(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Yo(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Xy(this,i=>Sl(i,na(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=Qs(this.db,[Qy]);Sl(s,r),++this._dbsize>=Yy&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{Kk(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}once(e,t){return e==="synced"&&this.synced?(setTimeout(()=>t(this),0),this):super.once(e,t)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Hy(this.name)})}get(e){return this._db.then(t=>{let[r]=Qs(t,[Gu],"readonly");return Wy(r,e)})}set(e,t){return this._db.then(r=>{let[n]=Qs(r,[Gu]);return jy(n,t,e)})}del(e){return this._db.then(t=>{let[r]=Qs(t,[Gu]);return Ku(r,e)})}hasUserData(){return this._dbsize>3}async markServerSynced(){return this._serverSynced=!0,this.set("serverSync",1)}async getServerSynced(){if(this._serverSynced!==void 0)return this._serverSynced;let e=await this.get("serverSync");return this._serverSynced=e===1,this._serverSynced}get hasServerSync(){return this._serverSynced===!0}async setOrigin(e){return this._origin=e,this.set("origin",e)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this.get("origin"),this._origin)}isReady(e=!1){return this.synced&&(e||this.hasServerSync||this._origin==="local")}async awaitingServerUpdates(){let e=await this.getServerSynced(),t=await this.getOrigin();return!e&&t!=="local"&&!this.hasUserData()}};var Nr=Qo(Yn());var Zy=new Map,Ju=class{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:$g(t.newValue||"")}),Sg(this._onChange)}postMessage(e){el.setItem(this.room,Og(Ug(e)))}close(){kg(this._onChange)}},Gk=typeof BroadcastChannel=="undefined"?Ju:BroadcastChannel,Qu=o=>Ur(Zy,o,()=>{let e=Kr(),t=new Gk(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),eb=(o,e)=>(Qu(o).subs.add(e),e),tb=(o,e)=>{let t=Qu(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Zy.delete(o)),r},ls=(o,e,t=null)=>{let r=Qu(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))};var rb=0,kl=1,ob=2,Il=(o,e)=>{De(o,rb);let t=hy(e);It(o,t)},Yu=(o,e,t)=>{De(o,kl),It(o,na(e,t))},Qk=(o,e,t)=>Yu(e,t,Wt(o)),nb=(o,e,t)=>{try{Ro(e,Wt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},sb=(o,e)=>{De(o,ob),It(o,e)},Yk=nb,ib=(o,e,t,r)=>{let n=Ve(o);switch(n){case rb:Qk(o,e,t);break;case kl:nb(o,t,r);break;case ob:Yk(o,t,r);break;default:throw new Error("Unknown message type")}return n};var Zk=0;var ab=(o,e,t)=>{switch(Ve(o)){case Zk:t(e,uo(o))}};var Xu=3e4,Cl=class extends xn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=po();this.getLocalState()!==null&&Xu/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&Xu<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Ll(this,r,"timeout")},wr(Xu/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:po()});let i=[],a=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&i.push(t):(a.push(t),Os(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:a,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Ll=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let i=o.meta.get(s);o.meta.set(s,{clock:i.clock+1,lastUpdated:po()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Ys=(o,e,t=o.states)=>{let r=e.length,n=Mt();De(n,r);for(let s=0;s<r;s++){let i=e[s],a=t.get(i)||null,l=o.meta.get(i).clock;De(n,i),De(n,l),Jr(n,JSON.stringify(a))}return ht(n)};var lb=(o,e,t)=>{let r=Or(e),n=po(),s=[],i=[],a=[],l=[],c=Ve(r);for(let f=0;f<c;f++){let u=Ve(r),d=Ve(r),p=JSON.parse(uo(r)),m=o.meta.get(u),y=o.states.get(u),g=m===void 0?0:m.clock;(g<d||g===d&&p===null&&o.states.has(u))&&(p===null?u===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(u):o.states.set(u,p),o.meta.set(u,{clock:d,lastUpdated:n}),m===void 0&&p!==null?s.push(u):m!==void 0&&p===null?l.push(u):p!==null&&(Os(p,y)||a.push(u),i.push(u)))}(s.length>0||a.length>0||l.length>0)&&o.emit("change",[{added:s,updated:a,removed:l},t]),(s.length>0||i.length>0||l.length>0)&&o.emit("update",[{added:s,updated:i,removed:l},t])};var Zu=o=>Eg(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");var ed;try{ed=new TextDecoder}catch(o){}var Me,fs,ae=0;var mb=[],oI=105,nI=57342,sI=57343,cb=57337;var fb=6,Xs={},sa=11281e4,tn=1681e4;var td=mb,rd=0,tt={},Pt,Fl,Pl=0,aa=0,Kt,Xr,$t=[],od=[],kr,mr,ia,ub={useRecords:!1,mapsAsObjects:!0},la=!1,hb=2;try{new Function("")}catch(o){hb=1/0}var us=class o{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,r]of Object.entries(e.keyMap))this.mapKey.set(r,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,n]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,n);return t}decodeKeys(e){if(!this._keyMap||e.constructor.name!="Map")return e;if(!this._mapKey){this._mapKey=new Map;for(let[r,n]of Object.entries(this._keyMap))this._mapKey.set(n,r)}let t={};return e.forEach((r,n)=>t[Zr(this._mapKey.has(n)?this._mapKey.get(n):n)]=r),t}mapDecode(e,t){let r=this.decode(e);if(this._keyMap)switch(r.constructor.name){case"Array":return r.map(n=>this.decodeKeys(n))}return r}decode(e,t){if(Me)return vb(()=>(Al(),this?this.decode(e,t):o.prototype.decode.call(ub,e,t)));fs=t>-1?t:e.length,ae=0,rd=0,aa=0,Fl=null,td=mb,Kt=null,Me=e;try{mr=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw Me=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof o){if(tt=this,kr=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return Pt=this.structures,El();(!Pt||Pt.length>0)&&(Pt=[])}else tt=ub,(!Pt||Pt.length>0)&&(Pt=[]),kr=null;return El()}decodeMultiple(e,t){let r,n=0;try{let s=e.length;la=!0;let i=this?this.decode(e,s):ld.decode(e,s);if(t){if(t(i)===!1)return;for(;ae<s;)if(n=ae,t(El())===!1)return}else{for(r=[i];ae<s;)n=ae,r.push(El());return r}}catch(s){throw s.lastPosition=n,s.values=r,s}finally{la=!1,Al()}}};function El(){try{let o=ot();if(Kt){if(ae>=Kt.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}ae=Kt.postBundlePosition,Kt=null}if(ae==fs)Pt=null,Me=null,Xr&&(Xr=null);else if(ae>fs){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!la)throw new Error("Data read, but end of buffer not reached");return o}catch(o){throw Al(),(o instanceof RangeError||o.message.startsWith("Unexpected end of buffer"))&&(o.incomplete=!0),o}}function ot(){let o=Me[ae++],e=o>>5;if(o=o&31,o>23)switch(o){case 24:o=Me[ae++];break;case 25:if(e==7)return cI();o=mr.getUint16(ae),ae+=2;break;case 26:if(e==7){let t=mr.getFloat32(ae);if(tt.useFloat32>2){let r=Rl[(Me[ae]&127)<<1|Me[ae+1]>>7];return ae+=4,(r*t+(t>0?.5:-.5)>>0)/r}return ae+=4,t}o=mr.getUint32(ae),ae+=4;break;case 27:if(e==7){let t=mr.getFloat64(ae);return ae+=8,t}if(e>1){if(mr.getUint32(ae)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");o=mr.getUint32(ae+4)}else tt.int64AsNumber?(o=mr.getUint32(ae)*4294967296,o+=mr.getUint32(ae+4)):o=mr.getBigUint64(ae);ae+=8;break;case 31:switch(e){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let t=[],r,n=0;for(;(r=ot())!=Xs;){if(n>=sa)throw new Error(`Array length exceeds ${sa}`);t[n++]=r}return e==4?t:e==3?t.join(""):Buffer.concat(t);case 5:let s;if(tt.mapsAsObjects){let i={},a=0;if(tt.keyMap)for(;(s=ot())!=Xs;){if(a++>=tn)throw new Error(`Property count exceeds ${tn}`);i[Zr(tt.decodeKey(s))]=ot()}else for(;(s=ot())!=Xs;){if(a++>=tn)throw new Error(`Property count exceeds ${tn}`);i[Zr(s)]=ot()}return i}else{ia&&(tt.mapsAsObjects=!0,ia=!1);let i=new Map;if(tt.keyMap){let a=0;for(;(s=ot())!=Xs;){if(a++>=tn)throw new Error(`Map size exceeds ${tn}`);i.set(tt.decodeKey(s),ot())}}else{let a=0;for(;(s=ot())!=Xs;){if(a++>=tn)throw new Error(`Map size exceeds ${tn}`);i.set(s,ot())}}return i}case 7:return Xs;default:throw new Error("Invalid major type for indefinite length "+e)}default:throw new Error("Unknown token "+o)}switch(e){case 0:return o;case 1:return~o;case 2:return lI(o);case 3:if(aa>=ae)return Fl.slice(ae-Pl,(ae+=o)-Pl);if(aa==0&&fs<140&&o<32){let n=o<16?gb(o):aI(o);if(n!=null)return n}return iI(o);case 4:if(o>=sa)throw new Error(`Array length exceeds ${sa}`);let t=new Array(o);for(let n=0;n<o;n++)t[n]=ot();return t;case 5:if(o>=tn)throw new Error(`Map size exceeds ${sa}`);if(tt.mapsAsObjects){let n={};if(tt.keyMap)for(let s=0;s<o;s++)n[Zr(tt.decodeKey(ot()))]=ot();else for(let s=0;s<o;s++)n[Zr(ot())]=ot();return n}else{ia&&(tt.mapsAsObjects=!0,ia=!1);let n=new Map;if(tt.keyMap)for(let s=0;s<o;s++)n.set(tt.decodeKey(ot()),ot());else for(let s=0;s<o;s++)n.set(ot(),ot());return n}case 6:if(o>=cb){let n=Pt[o&8191];if(n)return n.read||(n.read=nd(n)),n.read();if(o<65536){if(o==sI){let s=ei(),i=ot(),a=ot();id(i,a);let l={};if(tt.keyMap)for(let c=2;c<s;c++){let f=tt.decodeKey(a[c-2]);l[Zr(f)]=ot()}else for(let c=2;c<s;c++){let f=a[c-2];l[Zr(f)]=ot()}return l}else if(o==nI){let s=ei(),i=ot();for(let a=2;a<s;a++)id(i++,ot());return ot()}else if(o==cb)return hI();if(tt.getShared&&(ad(),n=Pt[o&8191],n))return n.read||(n.read=nd(n)),n.read()}}let r=$t[o];if(r)return r.handlesRead?r(ot):r(ot());{let n=ot();for(let s=0;s<od.length;s++){let i=od[s](o,n);if(i!==void 0)return i}return new mo(n,o)}case 7:switch(o){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let n=(kr||cs())[o];if(n!==void 0)return n;throw new Error("Unknown token "+o)}default:if(isNaN(o)){let n=new Error("Unexpected end of CBOR data");throw n.incomplete=!0,n}throw new Error("Unknown CBOR token "+o)}}var db=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function nd(o){if(!o)throw new Error("Structure is required in record definition");function e(){let t=Me[ae++];if(t=t&31,t>23)switch(t){case 24:t=Me[ae++];break;case 25:t=mr.getUint16(ae),ae+=2;break;case 26:t=mr.getUint32(ae),ae+=4;break;default:throw new Error("Expected array header, but got "+Me[ae-1])}let r=this.compiledReader;for(;r;){if(r.propertyCount===t)return r(ot);r=r.next}if(this.slowReads++>=hb){let s=this.length==t?this:this.slice(0,t);return r=tt.keyMap?new Function("r","return {"+s.map(i=>tt.decodeKey(i)).map(i=>db.test(i)?Zr(i)+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"}"):new Function("r","return {"+s.map(i=>db.test(i)?Zr(i)+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"}"),this.compiledReader&&(r.next=this.compiledReader),r.propertyCount=t,this.compiledReader=r,r(ot)}let n={};if(tt.keyMap)for(let s=0;s<t;s++)n[Zr(tt.decodeKey(this[s]))]=ot();else for(let s=0;s<t;s++)n[Zr(this[s])]=ot();return n}return o.slowReads=0,e}function Zr(o){if(typeof o=="string")return o==="__proto__"?"__proto_":o;if(typeof o=="number"||typeof o=="boolean"||typeof o=="bigint")return o.toString();if(o==null)return o+"";throw new Error("Invalid property name type "+typeof o)}var iI=sd;function sd(o){let e;if(o<16&&(e=gb(o)))return e;if(o>64&&ed)return ed.decode(Me.subarray(ae,ae+=o));let t=ae+o,r=[];for(e="";ae<t;){let n=Me[ae++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=Me[ae++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Me[ae++]&63,i=Me[ae++]&63;r.push((n&31)<<12|s<<6|i)}else if((n&248)===240){let s=Me[ae++]&63,i=Me[ae++]&63,a=Me[ae++]&63,l=(n&7)<<18|s<<12|i<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(e+=Xt.apply(String,r),r.length=0)}return r.length>0&&(e+=Xt.apply(String,r)),e}var Xt=String.fromCharCode;function aI(o){let e=ae,t=new Array(o);for(let r=0;r<o;r++){let n=Me[ae++];if((n&128)>0){ae=e;return}t[r]=n}return Xt.apply(String,t)}function gb(o){if(o<4)if(o<2){if(o===0)return"";{let e=Me[ae++];if((e&128)>1){ae-=1;return}return Xt(e)}}else{let e=Me[ae++],t=Me[ae++];if((e&128)>0||(t&128)>0){ae-=2;return}if(o<3)return Xt(e,t);let r=Me[ae++];if((r&128)>0){ae-=3;return}return Xt(e,t,r)}else{let e=Me[ae++],t=Me[ae++],r=Me[ae++],n=Me[ae++];if((e&128)>0||(t&128)>0||(r&128)>0||(n&128)>0){ae-=4;return}if(o<6){if(o===4)return Xt(e,t,r,n);{let s=Me[ae++];if((s&128)>0){ae-=5;return}return Xt(e,t,r,n,s)}}else if(o<8){let s=Me[ae++],i=Me[ae++];if((s&128)>0||(i&128)>0){ae-=6;return}if(o<7)return Xt(e,t,r,n,s,i);let a=Me[ae++];if((a&128)>0){ae-=7;return}return Xt(e,t,r,n,s,i,a)}else{let s=Me[ae++],i=Me[ae++],a=Me[ae++],l=Me[ae++];if((s&128)>0||(i&128)>0||(a&128)>0||(l&128)>0){ae-=8;return}if(o<10){if(o===8)return Xt(e,t,r,n,s,i,a,l);{let c=Me[ae++];if((c&128)>0){ae-=9;return}return Xt(e,t,r,n,s,i,a,l,c)}}else if(o<12){let c=Me[ae++],f=Me[ae++];if((c&128)>0||(f&128)>0){ae-=10;return}if(o<11)return Xt(e,t,r,n,s,i,a,l,c,f);let u=Me[ae++];if((u&128)>0){ae-=11;return}return Xt(e,t,r,n,s,i,a,l,c,f,u)}else{let c=Me[ae++],f=Me[ae++],u=Me[ae++],d=Me[ae++];if((c&128)>0||(f&128)>0||(u&128)>0||(d&128)>0){ae-=12;return}if(o<14){if(o===12)return Xt(e,t,r,n,s,i,a,l,c,f,u,d);{let p=Me[ae++];if((p&128)>0){ae-=13;return}return Xt(e,t,r,n,s,i,a,l,c,f,u,d,p)}}else{let p=Me[ae++],m=Me[ae++];if((p&128)>0||(m&128)>0){ae-=14;return}if(o<15)return Xt(e,t,r,n,s,i,a,l,c,f,u,d,p,m);let y=Me[ae++];if((y&128)>0){ae-=15;return}return Xt(e,t,r,n,s,i,a,l,c,f,u,d,p,m,y)}}}}}function lI(o){return tt.copyBuffers?Uint8Array.prototype.slice.call(Me,ae,ae+=o):Me.subarray(ae,ae+=o)}var yb=new Float32Array(1),Tl=new Uint8Array(yb.buffer,0,4);function cI(){let o=Me[ae++],e=Me[ae++],t=(o&127)>>2;if(t===31)return e||o&3?NaN:o&128?-1/0:1/0;if(t===0){let r=((o&3)<<8|e)/16777216;return o&128?-r:r}return Tl[3]=o&128|(t>>1)+56,Tl[2]=(o&7)<<5|e>>3,Tl[1]=e<<5,Tl[0]=0,yb[0]}var S3=new Array(4096);var mo=class{constructor(e,t){this.value=e,this.tag=t}};$t[0]=o=>new Date(o);$t[1]=o=>new Date(Math.round(o*1e3));$t[2]=o=>{let e=BigInt(0);for(let t=0,r=o.byteLength;t<r;t++)e=BigInt(o[t])+(e<<BigInt(8));return e};$t[3]=o=>BigInt(-1)-$t[2](o);$t[4]=o=>+(o[1]+"e"+o[0]);$t[5]=o=>o[1]*Math.exp(o[0]*Math.log(2));var id=(o,e)=>{o=o-57344;let t=Pt[o];t&&t.isShared&&((Pt.restoreStructures||(Pt.restoreStructures=[]))[o]=t),Pt[o]=e,e.read=nd(e)};$t[oI]=o=>{let e=o.length,t=o[1];id(o[0],t);let r={};for(let n=2;n<e;n++){let s=t[n-2];r[Zr(s)]=o[n]}return r};$t[14]=o=>Kt?Kt[0].slice(Kt.position0,Kt.position0+=o):new mo(o,14);$t[15]=o=>Kt?Kt[1].slice(Kt.position1,Kt.position1+=o):new mo(o,15);var fI={Error,RegExp};$t[27]=o=>(fI[o[0]]||Error)(o[1],o[2]);var bb=o=>{if(Me[ae++]!=132){let t=new Error("Packed values structure must be followed by a 4 element array");throw Me.length<ae&&(t.incomplete=!0),t}let e=o();if(!e||!e.length){let t=new Error("Packed values structure must be followed by a 4 element array");throw t.incomplete=!0,t}return kr=kr?e.concat(kr.slice(e.length)):e,kr.prefixes=o(),kr.suffixes=o(),o()};bb.handlesRead=!0;$t[51]=bb;$t[fb]=o=>{if(!kr)if(tt.getShared)ad();else return new mo(o,fb);if(typeof o=="number")return kr[16+(o>=0?2*o:-2*o-1)];let e=new Error("No support for non-integer packed references yet");throw o===void 0&&(e.incomplete=!0),e};$t[28]=o=>{Xr||(Xr=new Map,Xr.id=0);let e=Xr.id++,t=ae,r=Me[ae],n;r>>5==4?n=[]:n={};let s={target:n};Xr.set(e,s);let i=o();return s.used?(Object.getPrototypeOf(n)!==Object.getPrototypeOf(i)&&(ae=t,n=i,Xr.set(e,{target:n}),i=o()),Object.assign(n,i)):(s.target=i,i)};$t[28].handlesRead=!0;$t[29]=o=>{let e=Xr.get(o);return e.used=!0,e.target};$t[258]=o=>new Set(o);($t[259]=o=>(tt.mapsAsObjects&&(tt.mapsAsObjects=!1,ia=!0),o())).handlesRead=!0;function Zs(o,e){return typeof o=="string"?o+e:o instanceof Array?o.concat(e):Object.assign({},o,e)}function cs(){if(!kr)if(tt.getShared)ad();else throw new Error("No packed values available");return kr}var uI=1399353956;od.push((o,e)=>{if(o>=225&&o<=255)return Zs(cs().prefixes[o-224],e);if(o>=28704&&o<=32767)return Zs(cs().prefixes[o-28672],e);if(o>=1879052288&&o<=2147483647)return Zs(cs().prefixes[o-1879048192],e);if(o>=216&&o<=223)return Zs(e,cs().suffixes[o-216]);if(o>=27647&&o<=28671)return Zs(e,cs().suffixes[o-27639]);if(o>=1811940352&&o<=1879048191)return Zs(e,cs().suffixes[o-1811939328]);if(o==uI)return{packedValues:kr,structures:Pt.slice(0),version:e};if(o==55799)return e});var dI=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,pb=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],pI=[64,68,69,70,71,72,77,78,79,85,86];for(let o=0;o<pb.length;o++)mI(pb[o],pI[o]);function mI(o,e){let t="get"+o.name.slice(0,-5),r;typeof o=="function"?r=o.BYTES_PER_ELEMENT:o=null;for(let n=0;n<2;n++){if(!n&&r==1)continue;let s=r==2?1:r==4?2:r==8?3:0;$t[n?e:e-4]=r==1||n==dI?i=>{if(!o)throw new Error("Could not find typed array for code "+e);return!tt.copyBuffers&&(r===1||r===2&&!(i.byteOffset&1)||r===4&&!(i.byteOffset&3)||r===8&&!(i.byteOffset&7))?new o(i.buffer,i.byteOffset,i.byteLength>>s):new o(Uint8Array.prototype.slice.call(i,0).buffer)}:i=>{if(!o)throw new Error("Could not find typed array for code "+e);let a=new DataView(i.buffer,i.byteOffset,i.byteLength),l=i.length>>s,c=new o(l),f=a[t];for(let u=0;u<l;u++)c[u]=f.call(a,u<<s,n);return c}}}function hI(){let o=ei(),e=ae+ot();for(let r=2;r<o;r++){let n=ei();ae+=n}let t=ae;return ae=e,Kt=[sd(ei()),sd(ei())],Kt.position0=0,Kt.position1=0,Kt.postBundlePosition=ae,ae=t,ot()}function ei(){let o=Me[ae++]&31;if(o>23)switch(o){case 24:o=Me[ae++];break;case 25:o=mr.getUint16(ae),ae+=2;break;case 26:o=mr.getUint32(ae),ae+=4;break}return o}function ad(){if(tt.getShared){let o=vb(()=>(Me=null,tt.getShared()))||{},e=o.structures||[];tt.sharedVersion=o.version,kr=tt.sharedValues=o.packedValues,Pt===!0?tt.structures=Pt=e:Pt.splice.apply(Pt,[0,e.length].concat(e))}}function vb(o){let e=fs,t=ae,r=rd,n=Pl,s=aa,i=Fl,a=td,l=Xr,c=Kt,f=new Uint8Array(Me.slice(0,fs)),u=Pt,d=tt,p=la,m=o();return fs=e,ae=t,rd=r,Pl=n,aa=s,Fl=i,td=a,Xr=l,Kt=c,Me=f,la=p,Pt=u,tt=d,mr=new DataView(Me.buffer,Me.byteOffset,Me.byteLength),m}function Al(){Me=null,Xr=null,Pt=null}var Rl=new Array(147);for(let o=0;o<256;o++)Rl[o]=+("1e"+Math.floor(45.15-o*.30103));var ld=new us({useRecords:!1}),cd=ld.decode,gI=ld.decodeMultiple,Ml={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};var Dl;try{Dl=new TextEncoder}catch(o){}var md,Ib,$l=typeof globalThis=="object"&&globalThis.Buffer,fa=typeof $l!="undefined",fd=fa?$l.allocUnsafeSlow:Uint8Array,xb=fa?$l:Uint8Array,wb=256,_b=fa?4294967296:2144337920;var ud,Y,wt,H=0,Fn,Gt=null,yI=61440,bI=/[\u0080-\uFFFF]/,$r=Symbol("record-id"),ca=class extends us{constructor(e){super(e),this.offset=0;let t,r,n,s,i,a;e=e||{};let l=xb.prototype.utf8Write?function(M,G,B){return Y.utf8Write(M,G,B)}:Dl&&Dl.encodeInto?function(M,G){return Dl.encodeInto(M,Y.subarray(G)).written}:!1,c=this,f=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=f?128:0),u>8190)throw new Error("Maximum maxSharedStructure is 8190");let d=e.sequential;d&&(u=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let p,m,y=e.sharedValues,g;if(y){g=Object.create(null);for(let M=0,G=y.length;M<G;M++)g[y[M]]=M}let I=[],L=0,C=0;this.mapEncode=function(M,G){if(this._keyMap&&!this._mapped)switch(M.constructor.name){case"Array":M=M.map(B=>this.encodeKeys(B));break}return this.encode(M,G)},this.encode=function(M,G){if(Y||(Y=new fd(8192),wt=new DataView(Y.buffer,0,8192),H=0),Fn=Y.length-10,Fn-H<2048?(Y=new fd(Y.length),wt=new DataView(Y.buffer,0,Y.length),Fn=Y.length-10,H=0):G===gd&&(H=H+7&2147483640),r=H,c.useSelfDescribedHeader&&(wt.setUint32(H,3654940416),H+=3),a=c.structuredClone?new Map:null,c.bundleStrings&&typeof M!="string"?(Gt=[],Gt.size=1/0):Gt=null,n=c.structures,n){if(n.uninitialized){let Q=c.getShared()||{};c.structures=n=Q.structures||[],c.sharedVersion=Q.version;let N=c.sharedValues=Q.packedValues;if(N){g={};for(let O=0,J=N.length;O<J;O++)g[N[O]]=O}}let B=n.length;if(B>u&&!d&&(B=u),!n.transitions){n.transitions=Object.create(null);for(let Q=0;Q<B;Q++){let N=n[Q];if(!N)continue;let O,J=n.transitions;for(let oe=0,me=N.length;oe<me;oe++){J[$r]===void 0&&(J[$r]=Q);let he=N[oe];O=J[he],O||(O=J[he]=Object.create(null)),J=O}J[$r]=Q|1048576}}d||(n.nextId=B)}if(s&&(s=!1),i=n||[],m=g,e.pack){let B=new Map;if(B.values=[],B.encoder=c,B.maxValues=e.maxPrivatePackedValues||(g?16:1/0),B.objectMap=g||!1,B.samplingPackedValues=p,Ul(M,B),B.values.length>0){Y[H++]=216,Y[H++]=51,Do(4);let Q=B.values;w(Q),Do(0),Do(0),m=Object.create(g||null);for(let N=0,O=Q.length;N<O;N++)m[Q[N]]=N}}ud=G&pd;try{if(ud)return;if(w(M),Gt&&kb(r,w),c.offset=H,a&&a.idsToInsert){H+=a.idsToInsert.length*2,H>Fn&&F(H),c.offset=H;let B=wI(Y.subarray(r,H),a.idsToInsert);return a=null,B}return G&gd?(Y.start=r,Y.end=H,Y):Y.subarray(r,H)}finally{if(n){if(C<10&&C++,n.length>u&&(n.length=u),L>1e4)n.transitions=null,C=0,L=0,I.length>0&&(I=[]);else if(I.length>0&&!d){for(let B=0,Q=I.length;B<Q;B++)I[B][$r]=void 0;I=[]}}if(s&&c.saveShared){c.structures.length>u&&(c.structures=c.structures.slice(0,u));let B=Y.subarray(r,H);return c.updateSharedData()===!1?c.encode(M):B}G&TI&&(H=r)}},this.findCommonStringsToPack=()=>(p=new Map,g||(g=Object.create(null)),M=>{let G=M&&M.threshold||4,B=this.pack?M.maxPrivatePackedValues||16:0;y||(y=this.sharedValues=[]);for(let[Q,N]of p)N.count>G&&(g[Q]=B++,y.push(Q),s=!0);for(;this.saveShared&&this.updateSharedData()===!1;);p=null});let w=M=>{H>Fn&&(Y=F(H));var G=typeof M,B;if(G==="string"){if(m){let J=m[M];if(J>=0){J<16?Y[H++]=J+224:(Y[H++]=198,J&1?w(15-J>>1):w(J-16>>1));return}else if(p&&!e.pack){let oe=p.get(M);oe?oe.count++:p.set(M,{count:1})}}let Q=M.length;if(Gt&&Q>=4&&Q<1024){if((Gt.size+=Q)>yI){let oe,me=(Gt[0]?Gt[0].length*3+Gt[1].length:0)+10;H+me>Fn&&(Y=F(H+me)),Y[H++]=217,Y[H++]=223,Y[H++]=249,Y[H++]=Gt.position?132:130,Y[H++]=26,oe=H-r,H+=4,Gt.position&&kb(r,w),Gt=["",""],Gt.size=0,Gt.position=oe}let J=bI.test(M);Gt[J?0:1]+=M,Y[H++]=J?206:207,w(Q);return}let N;Q<32?N=1:Q<256?N=2:Q<65536?N=3:N=5;let O=Q*3;if(H+O>Fn&&(Y=F(H+O)),Q<64||!l){let J,oe,me,he=H+N;for(J=0;J<Q;J++)oe=M.charCodeAt(J),oe<128?Y[he++]=oe:oe<2048?(Y[he++]=oe>>6|192,Y[he++]=oe&63|128):(oe&64512)===55296&&((me=M.charCodeAt(J+1))&64512)===56320?(oe=65536+((oe&1023)<<10)+(me&1023),J++,Y[he++]=oe>>18|240,Y[he++]=oe>>12&63|128,Y[he++]=oe>>6&63|128,Y[he++]=oe&63|128):(Y[he++]=oe>>12|224,Y[he++]=oe>>6&63|128,Y[he++]=oe&63|128);B=he-H-N}else B=l(M,H+N,O);B<24?Y[H++]=96|B:B<256?(N<2&&Y.copyWithin(H+2,H+1,H+1+B),Y[H++]=120,Y[H++]=B):B<65536?(N<3&&Y.copyWithin(H+3,H+2,H+2+B),Y[H++]=121,Y[H++]=B>>8,Y[H++]=B&255):(N<5&&Y.copyWithin(H+5,H+3,H+3+B),Y[H++]=122,wt.setUint32(H,B),H+=4),H+=B}else if(G==="number")if(!this.alwaysUseFloat&&M>>>0===M)M<24?Y[H++]=M:M<256?(Y[H++]=24,Y[H++]=M):M<65536?(Y[H++]=25,Y[H++]=M>>8,Y[H++]=M&255):(Y[H++]=26,wt.setUint32(H,M),H+=4);else if(!this.alwaysUseFloat&&M>>0===M)M>=-24?Y[H++]=31-M:M>=-256?(Y[H++]=56,Y[H++]=~M):M>=-65536?(Y[H++]=57,wt.setUint16(H,~M),H+=2):(Y[H++]=58,wt.setUint32(H,~M),H+=4);else{let Q;if((Q=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){Y[H++]=250,wt.setFloat32(H,M);let N;if(Q<4||(N=M*Rl[(Y[H]&127)<<1|Y[H+1]>>7])>>0===N){H+=4;return}else H--}Y[H++]=251,wt.setFloat64(H,M),H+=8}else if(G==="object")if(!M)Y[H++]=246;else{if(a){let N=a.get(M);if(N){if(Y[H++]=216,Y[H++]=29,Y[H++]=25,!N.references){let O=a.idsToInsert||(a.idsToInsert=[]);N.references=[],O.push(N)}N.references.push(H-r),H+=2;return}else a.set(M,{offset:H-r})}let Q=M.constructor;if(Q===Object)E(M);else if(Q===Array){B=M.length,B<24?Y[H++]=128|B:Do(B);for(let N=0;N<B;N++)w(M[N])}else if(Q===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(Y[H++]=217,Y[H++]=1,Y[H++]=3),B=M.size,B<24?Y[H++]=160|B:B<256?(Y[H++]=184,Y[H++]=B):B<65536?(Y[H++]=185,Y[H++]=B>>8,Y[H++]=B&255):(Y[H++]=186,wt.setUint32(H,B),H+=4),c.keyMap)for(let[N,O]of M)w(c.encodeKey(N)),w(O);else for(let[N,O]of M)w(N),w(O);else{for(let N=0,O=md.length;N<O;N++){let J=Ib[N];if(M instanceof J){let oe=md[N],me=oe.tag;me==null&&(me=oe.getTag&&oe.getTag.call(this,M)),me<24?Y[H++]=192|me:me<256?(Y[H++]=216,Y[H++]=me):me<65536?(Y[H++]=217,Y[H++]=me>>8,Y[H++]=me&255):me>-1&&(Y[H++]=218,wt.setUint32(H,me),H+=4),oe.encode.call(this,M,w,F);return}}if(M[Symbol.iterator]){if(ud){let N=new Error("Iterable should be serialized as iterator");throw N.iteratorNotHandled=!0,N}Y[H++]=159;for(let N of M)w(N);Y[H++]=255;return}if(M[Symbol.asyncIterator]||dd(M)){let N=new Error("Iterable/blob should be serialized as iterator");throw N.iteratorNotHandled=!0,N}if(this.useToJSON&&M.toJSON){let N=M.toJSON();if(N!==M)return w(N)}E(M)}}else if(G==="boolean")Y[H++]=M?245:244;else if(G==="bigint"){if(M<BigInt(1)<<BigInt(64)&&M>=0)Y[H++]=27,wt.setBigUint64(H,M);else if(M>-(BigInt(1)<<BigInt(64))&&M<0)Y[H++]=59,wt.setBigUint64(H,-M-BigInt(1));else if(this.largeBigIntToFloat)Y[H++]=251,wt.setFloat64(H,Number(M));else{M>=BigInt(0)?Y[H++]=194:(Y[H++]=195,M=BigInt(-1)-M);let Q=[];for(;M;)Q.push(Number(M&BigInt(255))),M>>=BigInt(8);hd(new Uint8Array(Q.reverse()),F);return}H+=8}else if(G==="undefined")Y[H++]=247;else throw new Error("Unknown type: "+G)},E=this.useRecords===!1?this.variableMapSize?M=>{let G=Object.keys(M),B=Object.values(M),Q=G.length;Q<24?Y[H++]=160|Q:Q<256?(Y[H++]=184,Y[H++]=Q):Q<65536?(Y[H++]=185,Y[H++]=Q>>8,Y[H++]=Q&255):(Y[H++]=186,wt.setUint32(H,Q),H+=4);let N;if(c.keyMap)for(let O=0;O<Q;O++)w(c.encodeKey(G[O])),w(B[O]);else for(let O=0;O<Q;O++)w(G[O]),w(B[O])}:M=>{Y[H++]=185;let G=H-r;H+=2;let B=0;if(c.keyMap)for(let Q in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(Q))&&(w(c.encodeKey(Q)),w(M[Q]),B++);else for(let Q in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(Q))&&(w(Q),w(M[Q]),B++);Y[G+++r]=B>>8,Y[G+r]=B&255}:(M,G)=>{let B,Q=i.transitions||(i.transitions=Object.create(null)),N=0,O=0,J,oe;if(this.keyMap){oe=Object.keys(M).map(he=>this.encodeKey(he)),O=oe.length;for(let he=0;he<O;he++){let se=oe[he];B=Q[se],B||(B=Q[se]=Object.create(null),N++),Q=B}}else for(let he in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(he))&&(B=Q[he],B||(Q[$r]&1048576&&(J=Q[$r]&65535),B=Q[he]=Object.create(null),N++),Q=B,O++);let me=Q[$r];if(me!==void 0)me&=65535,Y[H++]=217,Y[H++]=me>>8|224,Y[H++]=me&255;else if(oe||(oe=Q.__keys__||(Q.__keys__=Object.keys(M))),J===void 0?(me=i.nextId++,me||(me=0,i.nextId=1),me>=wb&&(i.nextId=(me=u)+1)):me=J,i[me]=oe,me<u){Y[H++]=217,Y[H++]=me>>8|224,Y[H++]=me&255,Q=i.transitions;for(let he=0;he<O;he++)(Q[$r]===void 0||Q[$r]&1048576)&&(Q[$r]=me),Q=Q[oe[he]];Q[$r]=me|1048576,s=!0}else{if(Q[$r]=me,wt.setUint32(H,3655335680),H+=3,N&&(L+=C*N),I.length>=wb-u&&(I.shift()[$r]=void 0),I.push(Q),Do(O+2),w(57344+me),w(oe),G)return;for(let he in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(he))&&w(M[he]);return}if(O<24?Y[H++]=128|O:Do(O),!G)for(let he in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(he))&&w(M[he])},F=M=>{let G;if(M>16777216){if(M-r>_b)throw new Error("Encoded buffer would be larger than maximum buffer size");G=Math.min(_b,Math.round(Math.max((M-r)*(M>67108864?1.25:2),4194304)/4096)*4096)}else G=(Math.max(M-r<<2,Y.length-1)>>12)+1<<12;let B=new fd(G);return wt=new DataView(B.buffer,0,G),Y.copy?Y.copy(B,0,r,M):B.set(Y.slice(r,M)),H-=r,r=0,Fn=B.length-10,Y=B},U=100,V=1e3;this.encodeAsIterable=function(M,G){return W(M,G,P)},this.encodeAsAsyncIterable=function(M,G){return W(M,G,q)};function*P(M,G,B){let Q=M.constructor;if(Q===Object){let N=c.useRecords!==!1;N?E(M,!0):Sb(Object.keys(M).length,160);for(let O in M){let J=M[O];N||w(O),J&&typeof J=="object"?G[O]?yield*P(J,G[O]):yield*$(J,G,O):w(J)}}else if(Q===Array){let N=M.length;Do(N);for(let O=0;O<N;O++){let J=M[O];J&&(typeof J=="object"||H-r>U)?G.element?yield*P(J,G.element):yield*$(J,G,"element"):w(J)}}else if(M[Symbol.iterator]&&!M.buffer){Y[H++]=159;for(let N of M)N&&(typeof N=="object"||H-r>U)?G.element?yield*P(N,G.element):yield*$(N,G,"element"):w(N);Y[H++]=255}else dd(M)?(Sb(M.size,64),yield Y.subarray(r,H),yield M,re()):M[Symbol.asyncIterator]?(Y[H++]=159,yield Y.subarray(r,H),yield M,re(),Y[H++]=255):w(M);B&&H>r?yield Y.subarray(r,H):H-r>U&&(yield Y.subarray(r,H),re())}function*$(M,G,B){let Q=H-r;try{w(M),H-r>U&&(yield Y.subarray(r,H),re())}catch(N){if(N.iteratorNotHandled)G[B]={},H=r+Q,yield*P.call(this,M,G[B]);else throw N}}function re(){U=V,c.encode(null,pd)}function W(M,G,B){return G&&G.chunkThreshold?U=V=G.chunkThreshold:U=100,M&&typeof M=="object"?(c.encode(null,pd),B(M,c.iterateProperties||(c.iterateProperties={}),!0)):[c.encode(M)]}async function*q(M,G){for(let B of P(M,G,!0)){let Q=B.constructor;if(Q===xb||Q===Uint8Array)yield B;else if(dd(B)){let N=B.stream().getReader(),O;for(;!(O=await N.read()).done;)yield O.value}else if(B[Symbol.asyncIterator])for await(let N of B)re(),N?yield*q(N,G.async||(G.async={})):yield c.encode(N);else yield B}}}useBuffer(e){Y=e,wt=new DataView(Y.buffer,Y.byteOffset,Y.byteLength),H=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new Ol(t,this.sharedValues,this.sharedVersion),n=this.saveShared(r,s=>(s&&s.version||0)==e);return n===!1?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach((s,i)=>this.structures[i]=s),n}};function Sb(o,e){o<24?Y[H++]=e|o:o<256?(Y[H++]=e|24,Y[H++]=o):o<65536?(Y[H++]=e|25,Y[H++]=o>>8,Y[H++]=o&255):(Y[H++]=e|26,wt.setUint32(H,o),H+=4)}var Ol=class{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}};function Do(o){o<24?Y[H++]=128|o:o<256?(Y[H++]=152,Y[H++]=o):o<65536?(Y[H++]=153,Y[H++]=o>>8,Y[H++]=o&255):(Y[H++]=154,wt.setUint32(H,o),H+=4)}var vI=typeof Blob=="undefined"?function(){}:Blob;function dd(o){if(o instanceof vI)return!0;let e=o[Symbol.toStringTag];return e==="Blob"||e==="File"}function Ul(o,e){switch(typeof o){case"string":if(o.length>3){if(e.objectMap[o]>-1||e.values.length>=e.maxValues)return;let r=e.get(o);if(r)++r.count==2&&e.values.push(o);else if(e.set(o,{count:1}),e.samplingPackedValues){let n=e.samplingPackedValues.get(o);n?n.count++:e.samplingPackedValues.set(o,{count:1})}}break;case"object":if(o)if(o instanceof Array)for(let r=0,n=o.length;r<n;r++)Ul(o[r],e);else{let r=!e.encoder.useRecords;for(var t in o)o.hasOwnProperty(t)&&(r&&Ul(t,e),Ul(o[t],e))}break;case"function":console.log(o)}}var xI=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;Ib=[Date,Set,Error,RegExp,mo,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,Ol];md=[{tag:1,encode(o,e){let t=o.getTime()/1e3;(this.useTimestamp32||o.getMilliseconds()===0)&&t>=0&&t<4294967296?(Y[H++]=26,wt.setUint32(H,t),H+=4):(Y[H++]=251,wt.setFloat64(H,t),H+=8)}},{tag:258,encode(o,e){let t=Array.from(o);e(t)}},{tag:27,encode(o,e){e([o.name,o.message])}},{tag:27,encode(o,e){e(["RegExp",o.source,o.flags])}},{getTag(o){return o.tag},encode(o,e){e(o.value)}},{encode(o,e,t){hd(o,t)}},{getTag(o){if(o.constructor===Uint8Array&&(this.tagUint8Array||fa&&this.tagUint8Array!==!1))return 64},encode(o,e,t){hd(o,t)}},Mo(68,1),Mo(69,2),Mo(70,4),Mo(71,8),Mo(72,1),Mo(77,2),Mo(78,4),Mo(79,8),Mo(85,4),Mo(86,8),{encode(o,e){let t=o.packedValues||[],r=o.structures||[];if(t.values.length>0){Y[H++]=216,Y[H++]=51,Do(4);let n=t.values;e(n),Do(0),Do(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let s=0,i=n.length;s<i;s++)packedObjectMap[n[s]]=s}if(r){wt.setUint32(H,3655335424),H+=3;let n=r.slice(0);n.unshift(57344),n.push(new mo(o.version,1399353956)),e(n)}else e(new mo(o.version,1399353956))}}];function Mo(o,e){return!xI&&e>1&&(o-=4),{tag:o,encode:function(r,n){let s=r.byteLength,i=r.byteOffset||0,a=r.buffer||r;n(fa?$l.from(a,i,s):new Uint8Array(a,i,s))}}}function hd(o,e){let t=o.byteLength;t<24?Y[H++]=64+t:t<256?(Y[H++]=88,Y[H++]=t):t<65536?(Y[H++]=89,Y[H++]=t>>8,Y[H++]=t&255):(Y[H++]=90,wt.setUint32(H,t),H+=4),H+t>=Y.length&&e(H+t),Y.set(o.buffer?o:new Uint8Array(o),H),H+=t}function wI(o,e){let t,r=e.length*2,n=o.length-r;e.sort((s,i)=>s.offset>i.offset?1:-1);for(let s=0;s<e.length;s++){let i=e[s];i.id=s;for(let a of i.references)o[a++]=s>>8,o[a]=s&255}for(;t=e.pop();){let s=t.offset;o.copyWithin(s+r,s,n),r-=2;let i=s+r;o[i++]=216,o[i++]=28,n=s}return o}function kb(o,e){wt.setUint32(Gt.position+o,H-Gt.position-o+1);let t=Gt;Gt=null,e(t[0]),e(t[1])}var yd=new ca({useRecords:!1}),_I=yd.encode,SI=yd.encodeAsIterable,kI=yd.encodeAsAsyncIterable,{NEVER:II,ALWAYS:CI,DECIMAL_ROUND:LI,DECIMAL_FIT:EI}=Ml,gd=512,TI=1024,pd=2048;var ds=0,Lb=3,ti=1,FI=2,PI=4,AI=5,RI=6,ri=[];ri[ds]=(o,e,t,r,n)=>{De(o,ds);let s=ib(e,o,t.doc,t);r&&s===kl&&!t.synced&&(t.synced=!0)};ri[Lb]=(o,e,t,r,n)=>{De(o,ti),It(o,Ys(t.awareness,Array.from(t.awareness.getStates().keys())))};ri[ti]=(o,e,t,r,n)=>{lb(t.awareness,Wt(e),t)};ri[FI]=(o,e,t,r,n)=>{ab(e,t.doc,(s,i)=>MI(t,i))};ri[PI]=(o,e,t,r,n)=>{let s=Ve(e),i=Qf(e,s);try{let a=cd(i);t.eventSubscriptions.has(a.event_type)&&t.processEvent(a)}catch(a){console.error("Failed to decode event message:",a)}};var Cb=3e4,MI=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Eb=(o,e,t)=>{let r=Or(e),n=Mt(),s=Ve(r),i=o.messageHandlers[s];return i?i(n,r,o,t,s):console.error("Unable to compute message"),n},Tb=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=po();let r=Eb(o,new Uint8Array(t.data),!0);Ga(r)>1&&e.send(ht(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,Ll(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected",intent:o.intent}])):o.wsUnsuccessfulReconnects++,o.canReconnect()&&setTimeout(Tb,wn(cg(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=po(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected",intent:o.intent}]);let t=Mt();if(De(t,ds),Il(t,o.doc),e.send(ht(t)),o.eventSubscriptions.size>0){let r=Array.from(o.eventSubscriptions);o.sendEventSubscribe(r)}if(o.awareness.getLocalState()!==null){let r=Mt();De(r,ti),It(r,Ys(o.awareness,[o.doc.clientID])),e.send(ht(r))}},o.emit("status",[{status:"connecting",intent:o.intent}])}},bd=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&ls(o.bcChannel,e,o)},Bl=class extends xn{constructor(e,t,r,{connect:n=!0,awareness:s=new Cl(r),params:i={},WebSocketPolyfill:a=WebSocket,resyncInterval:l=-1,maxBackoffTime:c=2500,disableBc:f=!1,maxConnectionErrors:u=3}={}){for(super();e[e.length-1]==="/";)e=e.slice(0,e.length-1);let d=Zu(i);this.maxBackoffTime=c,this.bcChannel=e+"/"+t,this.url=e+"/"+t+(d.length===0?"":"?"+d),this.roomname=t,this.doc=r,this._WS=a,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ri.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=n,this.maxConnectionErrors=u,this.eventSubscriptions=new Set,this.eventCallbacks=new Map,this._resyncInterval=0,l>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let p=Mt();De(p,ds),Il(p,r),this.ws.send(ht(p))}},l)),this._bcSubscriber=(p,m)=>{if(m!==this){let y=Eb(this,new Uint8Array(p),!1);Ga(y)>1&&ls(this.bcChannel,ht(y),this)}},this._updateHandler=(p,m)=>{if(m!==this){let y=Mt();De(y,ds),sb(y,p),bd(this,ht(y))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:p,updated:m,removed:y},g)=>{let I=p.concat(m).concat(y),L=Mt();De(L,ti),It(L,Ys(s,I)),bd(this,ht(L))},this._unloadHandler=()=>{Ll(this.awareness,[r.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var p;this.wsconnected&&Cb<po()-this.wsLastMessageReceived&&((p=this.ws)==null||p.close())},Cb/10),n&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}get intent(){return this.shouldConnect?"connected":"disconnected"}get connectionState(){var t,r;let e;return((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN?e="connected":((r=this.ws)==null?void 0:r.readyState)===WebSocket.CONNECTING?e="connecting":e="disconnected",{status:e,intent:this.intent}}canReconnect(){return!!this.url&&this.shouldConnect&&this.wsUnsuccessfulReconnects<this.maxConnectionErrors}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING)&&this.ws.close(1e3,"Destroyed"),this.ws=null),this.disconnect(),this.awareness.destroy(),this._observers.clear(),typeof window!="undefined"?(window.removeEventListener("unload",this._unloadHandler),window.clearInterval(this.awareness._checkInterval)):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(eb(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let e=Mt();De(e,ds),Il(e,this.doc),ls(this.bcChannel,ht(e),this);let t=Mt();De(t,ds),Yu(t,this.doc),ls(this.bcChannel,ht(t),this);let r=Mt();De(r,Lb),ls(this.bcChannel,ht(r),this);let n=Mt();De(n,ti),It(n,Ys(this.awareness,[this.doc.clientID])),ls(this.bcChannel,ht(n),this)}disconnectBc(){let e=Mt();De(e,ti),It(e,Ys(this.awareness,[this.doc.clientID],new Map)),bd(this,ht(e)),this.bcconnected&&(tb(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&(this.ws.close(),this.ws=null)}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Tb(this),this.connectBc())}refreshToken(e,t,r){for(;e[e.length-1]==="/";)e=e.slice(0,e.length-1);let s=Zu({token:r}),i=e+"/"+t+(s.length===0?"":"?"+s),a=this.url!==i;return a&&(this.url=i,this.wsUnsuccessfulReconnects=0,this.ws&&this.ws.close()),{urlChanged:a,newUrl:i}}hasUrl(e){return this.url===e}subscribeToEvents(e,t){e.forEach(r=>{this.eventSubscriptions.add(r),this.eventCallbacks.has(r)||this.eventCallbacks.set(r,[]),this.eventCallbacks.get(r).push(t)}),this.ws&&this.ws.readyState===WebSocket.OPEN&&this.sendEventSubscribe(e)}unsubscribeFromEvents(e,t){e.forEach(r=>{if(t&&this.eventCallbacks.has(r)){let n=this.eventCallbacks.get(r),s=n.indexOf(t);s>-1&&n.splice(s,1),n.length===0&&(this.eventSubscriptions.delete(r),this.eventCallbacks.delete(r))}else this.eventSubscriptions.delete(r),this.eventCallbacks.delete(r)}),this.ws&&this.ws.readyState===WebSocket.OPEN&&this.sendEventUnsubscribe(e)}sendEventSubscribe(e){let t=Mt();De(t,AI),De(t,e.length),e.forEach(r=>{Jr(t,r)}),this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(ht(t))}sendEventUnsubscribe(e){let t=Mt();De(t,RI),De(t,e.length),e.forEach(r=>{Jr(t,r)}),this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(ht(t))}processEvent(e){console.log("Received event:",e),this.emit("event",[e]),(this.eventCallbacks.get(e.event_type)||[]).forEach(r=>{try{r(e)}catch(n){console.error("Event callback error:",n)}})}};var Fb=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],Vl=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=Fb[Oi()%Fb.length]}};var Zt=new WeakMap,Pb=!1;function Hl(o){Pb=o}var eo={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3,allowStackTraces:!1},hr,gr,Nl=[];function Ab(o,e,t,r){gr=o,hr=t,r&&(eo={...eo,...r}),e.setInterval(xd,eo.batchInterval)}async function xd(){if(Nl.length===0)return;let o=[...Nl];Nl.length=0;for(let e=0;e<eo.maxRetries;e++)try{await DI();let t=o.map(vd).join(`
`)+`
`;await gr.append(hr,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===eo.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function DI(){let o=await gr.stat(hr);if(o&&o.size>eo.maxFileSize){for(let e=eo.maxBackups;e>0;e--){let t=`${hr}.${e}`,r=`${hr}.${e+1}`;await gr.exists(t)&&(e===eo.maxBackups?await gr.remove(t):await gr.rename(t,r))}await gr.exists(hr)&&await gr.rename(hr,`${hr}.1`),await gr.write(hr,"")}}function vd(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}var UI=["token","authorization","email","key"];function OI(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&UI.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Re(o,e="log"){return(...t)=>{if(Pb){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",i=t.map(OI).join(" "),a={timestamp:r,level:e,message:`${o}: ${i}`,callerInfo:s};if(!eo.disableConsole)if(eo.allowStackTraces||e==="debug"||e==="log")console[e](vd(a));else{let l={warn:"color: #ff8c00; background: rgba(255, 140, 0, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;",error:"color: #ff5555; background: rgba(255, 85, 85, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;"};console.log(`%c${vd(a)}`,l[e])}Nl.push(a)}}}async function ql(){let o=[];await gr.exists(hr)&&o.push(hr);for(let e=1;e<=eo.maxBackups;e++){let t=`${hr}.${e}`;await gr.exists(t)&&o.push(t)}return o}async function Rb(){let o=[];if(await gr.exists(hr)){let e=await gr.read(hr);o.push(e)}for(let e=1;e<=eo.maxBackups;e++){let t=`${hr}.${e}`;if(await gr.exists(t)){let r=await gr.read(t);o.push(r)}}return o.reverse().join(`
`)}var st=class{constructor(e){let t=e||this.constructor.name;this.debug=Re(`[${t}]`,"debug"),this.log=Re(`[${t}]`,"log"),this.warn=Re(`[${t}]`,"warn"),this.error=Re(`[${t}]`,"error")}setLoggers(e){this.debug=Re(`[${e}]`,"debug"),this.log=Re(`[${e}]`,"log"),this.warn=Re(`[${e}]`,"warn"),this.error=Re(`[${e}]`,"error")}};var ci=require("obsidian");var to=class o extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,o.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof o||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Wl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function $I(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||BI,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let i=o.indexOf(";",n);if(i===-1)i=o.length;else if(i<s){n=o.lastIndexOf(";",s-1)+1;continue}let a=o.slice(n,s).trim();if(t[a]===void 0){let l=o.slice(s+1,i).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[a]=r(l)}catch(c){t[a]=l}}n=i+1}return t}function Mb(o,e,t){let r=Object.assign({},t||{}),n=r.encode||VI;if(!Wl.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!Wl.test(s))throw new TypeError("argument val is invalid");let i=o+"="+s;if(r.maxAge!=null){let a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!Wl.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!Wl.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!(function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date})(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function BI(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function VI(o){return encodeURIComponent(o)}var Ob;function jl(o){if(o)try{let e=decodeURIComponent(Ob(o.split(".")[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function $b(o,e=0){let t=jl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Ob=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,i="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?i+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var Db="pb_auth",ua=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!$b(this.token)}get isAdmin(){return jl(this.token).type==="admin"}get isAuthRecord(){return jl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Db){let r=$I(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=Db){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=jl(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=Mb(t,JSON.stringify(s),e),a=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(s.model&&a>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let f=["collectionId","username","verified"];for(let u in this.model)f.includes(u)&&(s.model[u]=this.model[u]);i=Mb(t,JSON.stringify(s),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},_d=class extends ua{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",(e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)}))}},rn=class{constructor(e){this.client=e}},Sd=class extends rn{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then((()=>!0))}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then((()=>!0))}async generateAppleClientSecret(e,t,r,n,s,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},da=class extends rn{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then((n=>{var s;return n.items=((s=n.items)==null?void 0:s.map((i=>this.decode(i))))||[],n}))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then((r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new to({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]}))}async getOne(e,t){if(!e)throw new to({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((r=>this.decode(r)))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then((r=>this.decode(r)))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then((n=>this.decode(n)))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((()=>!0))}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then((i=>{let a=i.items;return r=r.concat(a),a.length==i.perPage?n(s+1):r}));return n(1)}};function Br(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function wd(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var kd=class extends da{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then((n=>{var s,i;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n}))}async delete(e,t){return super.delete(e,t).then((r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r}))}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=Br("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let i=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||wd(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return a=this.authResponse(a),i&&(function(c,f,u,d){wd(c);let p=c.beforeSend,m=c.authStore.model,y=c.authStore.onChange(((g,I)=>{(!g||(I==null?void 0:I.id)!=(m==null?void 0:m.id)||(I!=null&&I.collectionId||m!=null&&m.collectionId)&&(I==null?void 0:I.collectionId)!=(m==null?void 0:m.collectionId))&&wd(c)}));c._resetAutoRefresh=function(){y(),c.beforeSend=p,delete c._resetAutoRefresh},c.beforeSend=async(g,I)=>{var E;let L=c.authStore.token;if((E=I.query)!=null&&E.autoRefresh)return p?p(g,I):{url:g,sendOptions:I};let C=c.authStore.isValid;if(C&&$b(c.authStore.token,f))try{await u()}catch(F){C=!1}C||await d();let w=I.headers||{};for(let F in w)if(F.toLowerCase()=="authorization"&&L==w[F]&&c.authStore.token){w[F]=c.authStore.token;break}return I.headers=w,p?p(g,I):{url:g,sendOptions:I}}})(this.client,i,(()=>this.authRefresh({autoRefresh:!0})),(()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s)))),a}async authRefresh(e,t){let r={method:"POST"};return r=Br("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=Br("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then((()=>!0))}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=Br("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then((()=>!0))}},NI=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function Bb(o){if(o){o.query=o.query||{};for(let e in o)NI.includes(e)||(o.query[e]=o[e],delete o[e])}}var zl=class extends rn{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let n=e;if(r){Bb(r);let a="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+a}let s=function(a){let l=a,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(f){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let i of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,i);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let a=!1;for(let l=this.subscriptions[i].length-1;l>=0;l--)this.subscriptions[i][l]===t&&(a=!0,delete this.subscriptions[i][l],this.subscriptions[i].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(i,t));a&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch((e=>{if(!(e!=null&&e.isAbort))throw e}))}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise(((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()}))}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout((()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))}),this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",(e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then((async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()})).then((()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)})).catch((r=>{this.clientId="",this.connectErrorHandler(r)}))}))}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new to(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout((()=>{this.initConnect()}),t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Id=class extends da{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then((n=>{var s,i,a;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n}))}async delete(e,t){return super.delete(e,t).then((r=>{var n,s,i;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r}))}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then((t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]})))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=Br("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then((i=>this.authResponse(i)))}async authWithOAuth2Code(e,t,r,n,s,i,a){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=Br("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,i,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then((c=>this.authResponse(c)))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find((l=>l.name===t.provider));if(!r)throw new to(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new zl(this.client),i=null;function a(){i==null||i.close(),s.unsubscribe()}return t.urlCallback||(i=Ub(void 0)),new Promise((async(l,c)=>{var f;try{await s.subscribe("@oauth2",(async m=>{let y=s.clientId;try{if(!m.state||y!==m.state)throw new Error("State parameters don't match.");let g=Object.assign({},t);delete g.provider,delete g.scopes,delete g.createData,delete g.urlCallback;let I=await this.authWithOAuth2Code(r.name,m.code,r.codeVerifier,n,t.createData,g);l(I)}catch(g){c(new to(g))}a()}));let u={state:s.clientId};(f=t.scopes)!=null&&f.length&&(u.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,u);await(t.urlCallback||function(m){i?i.location.href=m:i=Ub(m)})(d)}catch(u){a(),c(new to(u))}}))}async authRefresh(e,t){let r={method:"POST"};return r=Br("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then((n=>this.authResponse(n)))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=Br("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then((()=>!0))}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=Br("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then((()=>!0))}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=Br("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then((()=>!0))}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=Br("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then((()=>!0))}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=Br("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then((()=>!0))}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=Br("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then((()=>!0))}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then((()=>!0))}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},i=n.split("&");for(let a of i){if(a=="")continue;let l=a.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete s[a]:s[a]=t[a]);n="";for(let a in s)s.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(s[a].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function Ub(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new to(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,i=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+i+",left="+s+",resizable,menubar=no")}var Cd=class extends da{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then((()=>!0))}},Ld=class extends rn{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new to({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Ed=class extends rn{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Td=class extends rn{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+i}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then((t=>(t==null?void 0:t.token)||""))}},Fd=class extends rn{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then((()=>!0))}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then((()=>!0))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then((()=>!0))}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then((()=>!0))}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},ps=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new _d,this.admins=new kd(this),this.collections=new Cd(this),this.files=new Td(this),this.logs=new Ld(this),this.settings=new Sd(this),this.realtime=new zl(this),this.health=new Ed(this),this.backups=new Fd(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Id(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then((async n=>{let s={};try{s=await n.json()}catch(i){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new to({url:n.url,status:n.status,data:s});return s})).catch((n=>{throw new to(n)}))}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),Bb(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let i of s)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter((t=>typeof t!="string")).length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let i of n)t.push(s+"="+encodeURIComponent(i));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var oi=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var er=class er{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return er.instance||(er.instance=new er(new oi),Zt.set(this.instance,"postie")),er.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Re("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Re("[postie]","warn")(`All Mail Log:
`+this.prettyPrintMailLog(this.allMailLog))}prettyPrintDeliveredMailLog(){Re("[postie]","warn")(`Delivered Mail Log:
`+this.prettyPrintMailLog(this.deliveredMailLog))}prettyPrintMailLog(e){let t="",r=n=>{t+=`${n}
`};return e.forEach((n,s)=>{r(`Mail #${s+1}:`),r(`  Timestamp: ${new Date(n.timestamp).toISOString()}`),r(`  Transaction ID: ${n.transactionId}`),r(`  Sender: ${n.sender.observableName||n.sender.constructor.name}`),r(`  Recipient: ${n.recipient.name||"Anonymous function"}`),r(`  Recipient Origin: ${n.recipientOrigin||"Unknown"}`),r("---")}),t}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){er.instance&&(er.instance.mailboxes=null,er.instance.allMailLog=[],er.instance.deliveredMailLog=[],er.instance.timeProvider.destroy(),er.instance.timeProvider=null,er.instance.isDelivering=!1,er.instance.isInTransaction=!1,er.instance.currentTransactionId=0,er._destroyed=!0,er.instance=void 0)}};er._destroyed=!1;var ho=er;var Pd=new Map;function Vb(){for(let[,o]of Pd)o();Pd.clear()}var pt=class extends st{constructor(t){super();this.observableName=t;this.destroyed=!1;Pd.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)ho.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),ho.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};var Gb=require("obsidian"),Jb=require("obsidian");var pa={enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1,enableAutomaticDiffResolution:!0,enableDiscordLogin:!1,enableSelfManageHosts:!0,enableToasts:!0,enablePresenceAvatars:!0,enableLiveEmbeds:!0,enablePreviewViewHooks:!0,enableMetadataViewHooks:!0,enableKanbanView:!0};function Kl(o){return o in pa}function HI(){return new Proxy({},{get:(o,e)=>e})}var on=HI();function ze(){return{...Ir.getInstance().flags}}function Pn(o,e,t=()=>{}){Ir.getInstance().flags[o]?e():t()}function Nb(o,e,t=()=>{}){o.forEach(r=>{if(Ir.getInstance().flags[r]){e();return}}),t()}var Ir=class o extends pt{constructor(){super("FeatureFlagManager"),this.flags=pa}async applyServerFlags(e){if(!this.settings)return;let r=e.filter(n=>n.override).reduce((n,s)=>(n[s.name]=s.value,n),{});this.log("applying server flags",r),await this.settings.update(n=>({...n,...r}),!0)}static getInstance(){return o.instance||(o.instance=new o),o.instance}setSettings(e){this.settings=e,this.unsubscribes.push(this.settings.subscribe(t=>{this.flags={...this.flags,...t},this.notifyListeners()}))}getFlag(e){return this.flags[e]}setFlag(e,t){this.settings&&this.settings.update(r=>({...r,[e]:t}))}static destroy(){o.instance&&o.instance.destroy(),o.instance=null}};if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkfetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Jb.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=Kb()));var mt=async(o,e)=>{var c;let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"2336be2"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},i;try{i=await(0,Gb.requestUrl)(s)}catch(f){if((c=f==null?void 0:f.message)!=null&&c.includes("net::ERR_FAILED"))return new Response(JSON.stringify({error:"Network request failed"}),{status:503,statusText:"Service Unavailable",headers:new Headers({"content-type":"application/json"})});throw f}if(!i.arrayBuffer.byteLength)return new Response(null,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});let a=new Response(i.arrayBuffer,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});if(Object.defineProperty(a,"json",{value:async()=>JSON.parse(i.text)}),ze().enableNetworkLogging){let f=i.status>=500?"error":i.status>=400?"warn":"debug",u=i.text,d;if((i.headers["content-type"]||"").includes("application/json"))try{d=JSON.parse(u)}catch(m){}Re("[CustomFetch]",f)(i.status.toString(),r,t,d||u)}if(i.status>=500)throw new Error(i.text);return a};var Gl=class extends ua{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var Bt=crypto,ro=o=>o instanceof CryptoKey;var Cr=new TextEncoder,fr=new TextDecoder,y4=2**32;function An(...o){let e=o.reduce((n,{length:s})=>n+s,0),t=new Uint8Array(e),r=0;for(let n of o)t.set(n,r),r+=n.length;return t}var Qb=o=>{let e=o;typeof e=="string"&&(e=Cr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},go=o=>Qb(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Yb=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Uo=o=>{let e=o;e instanceof Uint8Array&&(e=fr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Yb(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Ad={};Nf(Ad,{JOSEAlgNotAllowed:()=>si,JOSEError:()=>tr,JOSENotSupported:()=>_t,JWEDecryptionFailed:()=>ha,JWEInvalid:()=>Vr,JWKInvalid:()=>Jl,JWKSInvalid:()=>Ql,JWKSMultipleMatchingKeys:()=>Yl,JWKSNoMatchingKey:()=>ga,JWKSTimeout:()=>Xl,JWSInvalid:()=>yt,JWSSignatureVerificationFailed:()=>ii,JWTClaimValidationFailed:()=>yr,JWTExpired:()=>ni,JWTInvalid:()=>nr});var tr=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},yr=class extends tr{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},ni=class extends tr{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},si=class extends tr{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},_t=class extends tr{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},ha=class extends tr{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Vr=class extends tr{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},yt=class extends tr{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},nr=class extends tr{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Jl=class extends tr{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Ql=class extends tr{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},ga=class extends tr{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Yl=class extends tr{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Xl=class extends tr{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},ii=class extends tr{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var Zl=Bt.getRandomValues.bind(Bt);function nn(o,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${o}`)}function ec(o,e){return o.name===e}function Rd(o){return parseInt(o.name.slice(4),10)}function rC(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function oC(o,e){if(e.length&&!e.some(t=>o.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let r=e.pop();t+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function Zb(o,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!ec(o.algorithm,"HMAC"))throw nn("HMAC");let r=parseInt(e.slice(2),10);if(Rd(o.algorithm.hash)!==r)throw nn(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ec(o.algorithm,"RSASSA-PKCS1-v1_5"))throw nn("RSASSA-PKCS1-v1_5");let r=parseInt(e.slice(2),10);if(Rd(o.algorithm.hash)!==r)throw nn(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ec(o.algorithm,"RSA-PSS"))throw nn("RSA-PSS");let r=parseInt(e.slice(2),10);if(Rd(o.algorithm.hash)!==r)throw nn(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":{if(o.algorithm.name!=="Ed25519"&&o.algorithm.name!=="Ed448")throw nn("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!ec(o.algorithm,"ECDSA"))throw nn("ECDSA");let r=rC(e);if(o.algorithm.namedCurve!==r)throw nn(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}oC(o,t)}function ev(o,e,...t){var r;if(t.length>2){let n=t.pop();o+=`one of type ${t.join(", ")}, or ${n}.`}else t.length===2?o+=`one of type ${t[0]} or ${t[1]}.`:o+=`of type ${t[0]}.`;return e==null?o+=` Received ${e}`:typeof e=="function"&&e.name?o+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(o+=` Received an instance of ${e.constructor.name}`),o}var yo=(o,...e)=>ev("Key must be ",o,...e);function Md(o,e,...t){return ev(`Key for the ${o} algorithm must be `,e,...t)}var Dd=o=>ro(o),Vt=["CryptoKey"];var aC=(...o)=>{let e=o.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(let r of e){let n=Object.keys(r);if(!t||t.size===0){t=new Set(n);continue}for(let s of n){if(t.has(s))return!1;t.add(s)}}return!0},ai=aC;function lC(o){return typeof o=="object"&&o!==null}function rr(o){if(!lC(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var tc=(o,e)=>{if(o.startsWith("RS")||o.startsWith("PS")){let{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${o} requires key modulusLength to be 2048 bits or larger`)}};var Rn=(o,e,t=0)=>{t===0&&(e.unshift(e.length),e.unshift(6));let r=o.indexOf(e[0],t);if(r===-1)return!1;let n=o.subarray(r,r+e.length);return n.length!==e.length?!1:n.every((s,i)=>s===e[i])||Rn(o,e,r+1)},rv=o=>{switch(!0){case Rn(o,[42,134,72,206,61,3,1,7]):return"P-256";case Rn(o,[43,129,4,0,34]):return"P-384";case Rn(o,[43,129,4,0,35]):return"P-521";case Rn(o,[43,101,110]):return"X25519";case Rn(o,[43,101,111]):return"X448";case Rn(o,[43,101,112]):return"Ed25519";case Rn(o,[43,101,113]):return"Ed448";default:throw new _t("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},dC=async(o,e,t,r,n)=>{var c;let s,i,a=new Uint8Array(atob(t.replace(o,"")).split("").map(f=>f.charCodeAt(0))),l=e==="spki";switch(r){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},i=l?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},i=l?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},i=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let f=rv(a);s=f.startsWith("P-")?{name:"ECDH",namedCurve:f}:{name:f},i=l?[]:["deriveBits"];break}case"EdDSA":s={name:rv(a)},i=l?["verify"]:["sign"];break;default:throw new _t('Invalid or unsupported "alg" (Algorithm) value')}return Bt.subtle.importKey(e,a,s,(c=n==null?void 0:n.extractable)!=null?c:!1,i)};var ov=(o,e,t)=>dC(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",o,e,t);async function Ud(o,e,t){if(typeof o!="string"||o.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return ov(o,e,t)}var pC=(o,e)=>{if(!(e instanceof Uint8Array)){if(!Dd(e))throw new TypeError(Md(o,e,...Vt,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Vt.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},mC=(o,e,t)=>{if(!Dd(e))throw new TypeError(Md(o,e,...Vt));if(e.type==="secret")throw new TypeError(`${Vt.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Vt.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Vt.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Vt.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Vt.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},hC=(o,e,t)=>{o.startsWith("HS")||o==="dir"||o.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(o)?pC(o,e):mC(o,e,t)},ba=hC;function wC(o,e,t,r,n){if(n.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new o('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(i=>typeof i!="string"||i.length===0))throw new o('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(let i of r.crit){if(!s.has(i))throw new _t(`Extension Header Parameter "${i}" is not recognized`);if(n[i]===void 0)throw new o(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&r[i]===void 0)throw new o(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(r.crit)}var li=wC;var _C=(o,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${o}" option must be an array of strings`);if(e)return new Set(e)},$d=_C;var IC=Symbol();function rc(o,e){let t=`SHA-${o.slice(-3)}`;switch(o){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:o.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new _t(`alg ${o} is not supported either by JOSE or your javascript runtime`)}}function oc(o,e,t){if(ro(e))return Zb(e,o,t),e;if(e instanceof Uint8Array){if(!o.startsWith("HS"))throw new TypeError(yo(e,...Vt));return Bt.subtle.importKey("raw",e,{hash:`SHA-${o.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(yo(e,...Vt,"Uint8Array"))}var CC=async(o,e,t,r)=>{let n=await oc(o,e,"verify");tc(o,n);let s=rc(o,n.algorithm);try{return await Bt.subtle.verify(s,n,t,r)}catch(i){return!1}},av=CC;async function nc(o,e,t){var y;if(!rr(o))throw new yt("Flattened JWS must be an object");if(o.protected===void 0&&o.header===void 0)throw new yt('Flattened JWS must have either of the "protected" or "header" members');if(o.protected!==void 0&&typeof o.protected!="string")throw new yt("JWS Protected Header incorrect type");if(o.payload===void 0)throw new yt("JWS Payload missing");if(typeof o.signature!="string")throw new yt("JWS Signature missing or incorrect type");if(o.header!==void 0&&!rr(o.header))throw new yt("JWS Unprotected Header incorrect type");let r={};if(o.protected)try{let g=Uo(o.protected);r=JSON.parse(fr.decode(g))}catch(g){throw new yt("JWS Protected Header is invalid")}if(!ai(r,o.header))throw new yt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...r,...o.header},s=li(yt,new Map([["b64",!0]]),t==null?void 0:t.crit,r,n),i=!0;if(s.has("b64")&&(i=r.b64,typeof i!="boolean"))throw new yt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new yt('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=t&&$d("algorithms",t.algorithms);if(l&&!l.has(a))throw new si('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof o.payload!="string")throw new yt("JWS Payload must be a string")}else if(typeof o.payload!="string"&&!(o.payload instanceof Uint8Array))throw new yt("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=await e(r,o),c=!0),ba(a,e,"verify");let f=An(Cr.encode((y=o.protected)!=null?y:""),Cr.encode("."),typeof o.payload=="string"?Cr.encode(o.payload):o.payload),u;try{u=Uo(o.signature)}catch(g){throw new yt("Failed to base64url decode the signature")}if(!await av(a,e,u,f))throw new ii;let p;if(i)try{p=Uo(o.payload)}catch(g){throw new yt("Failed to base64url decode the payload")}else typeof o.payload=="string"?p=Cr.encode(o.payload):p=o.payload;let m={payload:p};return o.protected!==void 0&&(m.protectedHeader=r),o.header!==void 0&&(m.unprotectedHeader=o.header),c?{...m,key:e}:m}async function Bd(o,e,t){if(o instanceof Uint8Array&&(o=fr.decode(o)),typeof o!="string")throw new yt("Compact JWS must be a string or Uint8Array");let{0:r,1:n,2:s,length:i}=o.split(".");if(i!==3)throw new yt("Invalid Compact JWS");let a=await nc({payload:n,protected:r,signature:s},e,t),l={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?{...l,key:a.key}:l}var Vd=o=>Math.floor(o.getTime()/1e3);var LC=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,sc=o=>{let e=LC.exec(o);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let t=parseFloat(e[2]),r=e[3].toLowerCase(),n;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(t*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(t*3600);break;case"day":case"days":case"d":n=Math.round(t*86400);break;case"week":case"weeks":case"w":n=Math.round(t*604800);break;default:n=Math.round(t*31557600);break}return e[1]==="-"||e[4]==="ago"?-n:n};var lv=o=>o.toLowerCase().replace(/^application\//,""),EC=(o,e)=>typeof o=="string"?e.includes(o):Array.isArray(o)?e.some(Set.prototype.has.bind(new Set(o))):!1,ic=(o,e,t={})=>{let{typ:r}=t;if(r&&(typeof o.typ!="string"||lv(o.typ)!==lv(r)))throw new yr('unexpected "typ" JWT header value',"typ","check_failed");let n;try{n=JSON.parse(fr.decode(e))}catch(m){}if(!rr(n))throw new nr("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:i,subject:a,audience:l,maxTokenAge:c}=t,f=[...s];c!==void 0&&f.push("iat"),l!==void 0&&f.push("aud"),a!==void 0&&f.push("sub"),i!==void 0&&f.push("iss");for(let m of new Set(f.reverse()))if(!(m in n))throw new yr(`missing required "${m}" claim`,m,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new yr('unexpected "iss" claim value',"iss","check_failed");if(a&&n.sub!==a)throw new yr('unexpected "sub" claim value',"sub","check_failed");if(l&&!EC(n.aud,typeof l=="string"?[l]:l))throw new yr('unexpected "aud" claim value',"aud","check_failed");let u;switch(typeof t.clockTolerance){case"string":u=sc(t.clockTolerance);break;case"number":u=t.clockTolerance;break;case"undefined":u=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:d}=t,p=Vd(d||new Date);if((n.iat!==void 0||c)&&typeof n.iat!="number")throw new yr('"iat" claim must be a number',"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new yr('"nbf" claim must be a number',"nbf","invalid");if(n.nbf>p+u)throw new yr('"nbf" claim timestamp check failed',"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new yr('"exp" claim must be a number',"exp","invalid");if(n.exp<=p-u)throw new ni('"exp" claim timestamp check failed',"exp","check_failed")}if(c){let m=p-n.iat,y=typeof c=="number"?c:sc(c);if(m-u>y)throw new ni('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(m<0-u)throw new yr('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return n};async function Nd(o,e,t){var i;let r=await Bd(o,e,t);if((i=r.protectedHeader.crit)!=null&&i.includes("b64")&&r.protectedHeader.b64===!1)throw new nr("JWTs MUST NOT use unencoded payload");let s={payload:ic(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...s,key:r.key}:s}var RC,ac,uv;(typeof navigator=="undefined"||!((uv=(ac=navigator.userAgent)==null?void 0:ac.startsWith)!=null&&uv.call(ac,"Mozilla/5.0 ")))&&(RC="jose/v5.3.0");var Hd={};Nf(Hd,{decode:()=>lc,encode:()=>MC});var MC=go,lc=Uo;function va(o){if(typeof o!="string")throw new nr("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new nr("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new nr("Invalid JWT");if(!e)throw new nr("JWTs must contain a payload");let r;try{r=lc(e)}catch(s){throw new nr("Failed to base64url decode the payload")}let n;try{n=JSON.parse(fr.decode(r))}catch(s){throw new nr("Failed to parse the decoded payload as JSON")}if(!rr(n))throw new nr("Invalid JWT Claims Set");return n}var DC=`
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyDIav6xzBzyi6eQu8aJA
O8DufA/MyTMDsD9d6PmjhuPTSlVPharZSjxRkHi6sK50ZmRedQbyiBuNp0g6so30
+zunoqT9XUpvZD0+USlGvi0J48Cop+DQbbpTlAlsmX6BxhHJLUrmgU0AhHjvJLNL
rRuzzQxrn/Oi0byUHu/moitUypX1hSYrKH5meRy8zoyGb8b0qIOEKpcpVKGyD/ne
+u0Bhh6tI8t2vQDQK0RL87dc+EqlQXxtijXBSClqvJi7o3JYTtWtuaWcZ2pQdg5y
+gDMii2hZYLNdgDM+/NcJlp3fkPztVeVRpiV20gZDhqANSjWjx9iN1Jt9A97rCSH
XQIDAQAB
-----END PUBLIC KEY-----
`.trim();var or=class extends Error{constructor(t,r,n){super(t);this.type=r;this.details=n;this.name="ValidationError"}};function qd(o){return typeof o=="object"&&o!==null&&"license"in o&&typeof o.license=="string"}function cc(o){return Array.isArray(o)&&o.every(qd)}var fc=class{constructor(e){this.settings=e;this.log=Re("[EndpointManager]")}isStaging(){return!1}sanitizeUrlForLog(e){try{let t=new URL(e);return t.search="",t.toString()}catch(t){return e}}validateUrl(e){if(!e||typeof e!="string")throw new or("URL must be a non-empty string","URL_INVALID");let t;try{t=new URL(e)}catch(s){throw new or("Invalid URL format","URL_INVALID")}let r=this.isStaging();if(r){if(t.protocol!=="https:"&&t.protocol!=="http:")throw new or("Only HTTP and HTTPS URLs are allowed in development","URL_INVALID")}else if(t.protocol!=="https:")throw new or("Only HTTPS URLs are allowed in production","URL_INVALID");let n=t.hostname.toLowerCase();if((n==="localhost"||n==="127.0.0.1"||n==="::1")&&this.log(`Warning: Using localhost endpoint (development build: ${r})`),!n||n.length<3)throw new or("Invalid hostname","URL_INVALID")}async getPublicKey(){if(this._publicKeyCache)return this._publicKeyCache;try{return this._publicKeyCache=await Ud(DC,"RS256"),this._publicKeyCache}catch(e){throw new or("Failed to import public key","JWT_VERIFICATION_FAILED",e)}}getApiUrl(){return this._validatedApiUrl||"https://api.system3.md"}getAuthUrl(){return this._validatedAuthUrl||"https://auth.system3.md"}getDefaultUrls(){return{apiUrl:"https://api.system3.md",authUrl:"https://auth.system3.md",environment:"production"}}async validateAndSetEndpoints(e=1e4){let t=this.settings.get(),r=this.getActiveTenant(t);if(!r)return this.log("No active enterprise tenant configured, using defaults"),this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,{success:!0};try{let n=this.performTenantValidation(r.tenantUrl),s=new Promise((a,l)=>setTimeout(()=>l(new Error(`Validation timed out after ${e}ms`)),e));return await Promise.race([n,s])}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("Failed to validate tenant:",s),{success:!1,error:s}}}async performTenantValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return!n.apiUrl||!n.authUrl?{success:!1,error:"License missing required apiUrl or authUrl"}:n.authUrl!==e?{success:!1,error:`Tenant URL mismatch: expected ${e}, license has ${n.authUrl}`}:(this._validatedApiUrl=n.apiUrl,this._validatedAuthUrl=n.authUrl,this.log("Successfully validated enterprise tenant",{tenant:e,apiUrl:this._validatedApiUrl,authUrl:this._validatedAuthUrl,customer:n.customer}),{success:!0,licenseInfo:r.licenseInfo})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchTenantLicense(e){try{let t=new URL(e),r=`${t.protocol}//${t.host}/.well-known/relay.md/license`;this.log("Fetching tenant license from:",r);let n=await mt(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`License fetch failed: ${n.status} ${n.statusText}`);let s=await n.json(),i=[];if(cc(s))i=s;else if(s&&typeof s=="object"&&"licenses"in s&&cc(s.licenses))i=s.licenses;else if(qd(s))i=[s];else throw new or("No valid licenses found in response","LICENSE_NOT_FOUND");if(i.length===0)throw new Error("Empty license list");return{success:!0,license:i[0].license}}catch(t){let r=t instanceof Error?t.message:"Unknown error";return r.includes("Failed to fetch")||r.includes("NetworkError")||r.includes("ERR_")||r.includes("ECONNREFUSED")?r=`Unable to connect to ${e}. Please check the URL and ensure the server is running.`:r.includes("404")?r=`No tenant license found at ${e}. This may not be a valid Enterprise Relay tenant.`:r.includes("License fetch failed"),this.log("Tenant license fetch error:",r),{success:!1,error:r}}}findMatchingEndpointLicense(e,t,r){this.log(`Searching for ${r} license for ${this.sanitizeUrlForLog(t)}`);for(let n of e)try{let s=va(n.license);if(s.endpointType===r&&s.url===t)return this.log(`Found matching license for ${r}: ${this.sanitizeUrlForLog(t)}`),n}catch(s){continue}return null}async validateTenantLicense(e,t){this.log(`Tenant license validation starting: ${this.sanitizeUrlForLog(t)}`);try{let r=await this.verifyJWT(e);if(r.iss!=="https://auth.system3.md")throw new or(`Invalid token issuer: expected https://auth.system3.md, got ${r.iss}`,"LICENSE_INVALID");if(r.sub!=="endpoint-certificate")throw new or(`Invalid token subject: expected "endpoint-certificate", got ${r.sub}`,"LICENSE_INVALID");let n={issuer:r.iss||"Unknown",subject:r.sub||"Unknown",validFrom:r.iat?new Date(r.iat*1e3).toISOString():"Unknown",validTo:r.exp?new Date(r.exp*1e3).toISOString():"Unknown",isValid:!0};return this.log(`Tenant license validation successful: ${this.sanitizeUrlForLog(t)}`),{success:!0,licenseInfo:n}}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log(`Tenant license validation failed: ${this.sanitizeUrlForLog(t)} - ${n}`),{success:!1,error:n}}}validateLicenseClaims(e,t,r){if(e.iss!=="https://auth.system3.md")throw new or(`Invalid token issuer: expected https://auth.system3.md, got ${e.iss}`,"LICENSE_INVALID");if(e.sub!=="endpoint-certificate")throw new or(`Invalid token subject: expected "endpoint-certificate", got ${e.sub}`,"LICENSE_INVALID");if(e.endpointType!==t)throw new or(`License endpoint type mismatch: expected ${t}, got ${e.endpointType}`,"LICENSE_INVALID");if(e.url!==r)throw new or(`License URL mismatch: expected ${r}, got ${e.url}`,"LICENSE_INVALID")}async verifyJWT(e){try{let t=await this.getPublicKey(),{payload:r}=await Nd(e,t,{algorithms:["RS256"]});return r}catch(t){throw this.log("JWT verification failed:",t),new or(`JWT verification failed: ${t instanceof Error?t.message:"Unknown error"}`,"JWT_VERIFICATION_FAILED",t)}}clearValidatedEndpoints(){this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,this.log("Cleared validated endpoints, reverted to defaults")}hasValidatedEndpoints(){return!!(this._validatedApiUrl&&this._validatedAuthUrl)}getActiveTenant(e){if(!(!e.activeTenantId||!e.tenants))return e.tenants.find(t=>t.id===e.activeTenantId)}generateTenantId(e){try{let t=new URL(e);return`${t.hostname}:${t.port||(t.protocol==="https:"?"443":"80")}`}catch(t){return e.replace(/[^a-zA-Z0-9]/g,"_")}}async addTenant(e,t=!0){var r;try{this.validateUrl(e);let n=this.generateTenantId(e);if((r=this.settings.get().tenants)!=null&&r.some(l=>l.id===n))return{success:!1,error:"This tenant is already configured"};let i={id:n,name:e,tenantUrl:e,isValidated:!1},a;if(t){let l=await this.fetchTenantLicense(e);if(!l.success)return{success:!1,error:l.error||"Failed to fetch tenant license"};let c=await this.validateTenantLicense(l.license,e);if(!c.success)return{success:!1,error:c.error||"Tenant license validation failed"};a=c;let f=await this.verifyJWT(l.license);i={...i,name:f.customer||e,apiUrl:f.apiUrl,authUrl:f.authUrl,customer:f.customer,logo:f.logo,environment:f.environment,isValidated:!0,lastValidated:Date.now()}}return await this.settings.update(l=>({...l,tenants:[...l.tenants||[],i]})),{success:!0,tenantId:n,licenseInfo:a==null?void 0:a.licenseInfo}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async removeTenant(e){let t=this.settings.get(),r=t.tenants||[];if(!r.some(s=>s.id===e))return!1;let n={tenants:r.filter(s=>s.id!==e)};return t.activeTenantId===e&&(n.activeTenantId=void 0,this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),await this.settings.update(s=>({...s,...n})),!0}async switchToTenant(e){var n;let r=(n=this.settings.get().tenants)==null?void 0:n.find(s=>s.id===e);return r?(await this.settings.update(s=>({...s,activeTenantId:e})),r.isValidated&&r.apiUrl&&r.authUrl?(this._validatedApiUrl=r.apiUrl,this._validatedAuthUrl=r.authUrl):(this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),{success:!0}):{success:!1,error:"Tenant not found"}}async getCustomerInfo(){if(!this.hasValidatedEndpoints())return null;let e=this.settings.get(),t=this.getActiveTenant(e);if(!t)return null;try{if(t.isValidated&&t.customer)return{customer:t.customer,logo:t.logo};let r=await this.fetchTenantLicense(t.tenantUrl);if(r.success&&r.license){let n=await this.verifyJWT(r.license);return{customer:n.customer,logo:n.logo}}}catch(r){this.log("Failed to get customer info:",r)}return null}async getDefaultTenantInfo(){try{let e=await this.fetchTenantLicense("https://auth.system3.md");if(e.success&&e.license){let t=await this.verifyJWT(e.license);return{customer:t.customer,logo:t.logo,environment:"production"}}}catch(e){this.log("Failed to get default tenant info:",e)}return null}async testValidateTenant(e,t=1e4){try{let r=this.performTestValidation(e),n=new Promise((i,a)=>setTimeout(()=>a(new Error(`Validation timed out after ${t}ms`)),t));return await Promise.race([r,n])}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log("Failed to test validate endpoints:",n),{success:!1,error:n}}}async performTestValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return this.log("Test validation successful for tenant",{tenantUrl:e,apiUrl:n.apiUrl,authUrl:n.authUrl}),{success:!0,licenseInfo:r.licenseInfo}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchEndpointLicenseForUrl(e,t,r){try{let n=new URL(e),s=`${n.protocol}//${n.host}/.well-known/relay.md/license`;this.log(`Fetching ${t.toUpperCase()} licenses for test validation from:`,s);let i=await mt(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`License fetch failed: ${i.status} ${i.statusText}`);let a=await i.json();this.log("License response received from:",s);let l=[];if(cc(a))l=a;else if(a&&typeof a=="object"&&"licenses"in a&&cc(a.licenses))l=a.licenses;else if(qd(a))l=[a];else throw new or("No valid licenses found in response","LICENSE_NOT_FOUND");if(this.log(`Parsed ${l.length} licenses`),l.length===0)throw new Error("Empty license list");let c=this.findMatchingEndpointLicense(l,r,t);if(!c)throw new or(`No valid ${t.toUpperCase()} license found for: ${r}`,"LICENSE_NOT_FOUND");return{success:!0,license:c.license}}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("License fetch error:",s),{success:!1,error:`License fetch failed: ${s}`}}}};function UC(o){if("email"in o&&"name"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}if("email"in o&&"login"in o&&"avatar_url"in o){let e=o,t=(e.name||e.login).split(" ");return{name:e.name||e.login,given_name:t[0]||e.login,family_name:t.slice(1).join(" ")||"",email:e.email,picture:e.avatar_url}}if("mail"in o&&"displayName"in o){let e=o;return{name:e.displayName,given_name:e.givenName,family_name:e.surname,email:e.mail}}if("email"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name||`${e.given_name} ${e.family_name}`,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}return null}function OC(o,e,t,r){let n=r?UC(r):null;return new Vl(o,(t==null?void 0:t.name)||(n==null?void 0:n.name)||"",(t==null?void 0:t.email)||(n==null?void 0:n.email)||"",(t==null?void 0:t.picture)||(n==null?void 0:n.picture)||"",e)}var Wd=class{constructor(e,t,r){this.fullAuthUrl=e,this.info=t,this.login=r}},uc=class extends pt{constructor(t,r,n,s,i,a){var c;super();this.beforeLogin=s;this.loginSettings=i;let l=Re("[Pocketbase]","debug");this.authStore=new Gl(`pocketbase_auth_${t}`),this.endpointManager=a,this.pb=new ps(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(f,u)=>(l(f,u),u.fetch=mt,u.headers=Object.assign({},u.headers,{"Relay-Version":"2336be2"}),{url:f,options:u}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(c=this.pb.authStore.model)!=null&&c.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(f=>{f.status===404&&this.logout()}),Zt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),i=new Date(s.exp*1e3),a=new Date,l=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:i.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t,r){var n,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(n=t==null?void 0:t.meta)==null?void 0:n.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(i=>{this.log(i)}),r&&this.loginSettings.set({provider:r}),!0):(this.notifyListeners(),!1)}clearPreferredProvider(){this.loginSettings.set({provider:void 0})}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"2336be2"};return(0,ci.requestUrl)({url:`${this.endpointManager.getApiUrl()}/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"2336be2"};(0,ci.requestUrl)({url:`${this.endpointManager.getApiUrl()}/flags`,method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;Ir.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,ci.requestUrl)({url:`${this.endpointManager.getApiUrl()}/whoami`,method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}getEndpointManager(){return this.endpointManager}async validateAndApplyEndpoints(t){let r=await this.endpointManager.validateAndSetEndpoints(t);if(r.success&&this.endpointManager.hasValidatedEndpoints()){let n=Re("[Pocketbase]","debug");this.pb=new ps(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(s,i)=>(n(s,i),i.fetch=mt,i.headers=Object.assign({},i.headers,{"Relay-Version":"2336be2"}),{url:s,options:i}),this.log("Updated PocketBase instance with validated endpoints")}return r}get hasUser(){return this.user!==void 0}makeUser(t,r){var n;return OC((n=t.model)==null?void 0:n.id,t.token,t.model,r)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}getWebviewIntercepts(t){var a;let r=this.pb.buildUrl("/api/oauth2-redirect"),n=l=>{let c=l.replace(/\//g,"\\/");return new RegExp(`^${c}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},s=l=>{let c=new URL(l),u=`${c.protocol}//${c.host}${c.pathname}`.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${u}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},i=[n("https://accounts.google.com/o/oauth2/auth"),n("https://github.com/login/oauth/authorize"),n("https://discord.com/api/oauth2/authorize"),n("https://login.microsoftonline.com/common/oauth2/v2.0/authorize")];if(t){let l=t.oidc;(a=l==null?void 0:l.info)!=null&&a.authUrl&&(console.log("[OIDC Provider] Creating dynamic intercept for authUrl:",l.info.authUrl),i.push(s(l.info.authUrl)))}else i.push(new RegExp(`.*?/auth.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i"));return i}updateWebviewIntercepts(t){let r=this.getWebviewIntercepts(t);return console.log("[OIDC Provider] Updated webview intercepts:",r.map(n=>n.source)),r}async initiateManualOAuth2CodeFlow(t,r){this.beforeLogin();let n=await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError}),s=this.pb.buildUrl("/api/oauth2-redirect"),i={};for(let a of r){let l=n.authProviders.find(f=>f.name===a);if(!l){this.log(`Warning: unable to find provider: ${a}`);continue}let c=async f=>this.pb.collection("users").authWithOAuth2Code(l.name,f,l.codeVerifier,s,{fetch:t}).then(u=>(this.setup(u,l.name),u));i[a]=new Wd(l.authUrl+s,l,c)}if(Object.keys(i).length===0)throw new Error(`No valid providers found from requested list: ${r.join(", ")}`);return i}async poll(t){let r=0,n=1e3;return new Promise((s,i)=>{let a=setInterval(()=>{if(r+=1,r>=30)return clearInterval(a),i(new Error(`Auth timeout: Timed out after ${r*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.info.state.slice(0,15)).then(l=>{if(l)return clearInterval(a),s(t.login(l.code))}).catch(l=>{})},n)})}async login(t){this.beforeLogin();let r=await this.pb.collection("users").authWithOAuth2({provider:t});return this.setup(r,t)}async loginWithEmailPassword(t,r){try{this.log("Attempting email/password login...");let n=await(0,ci.requestUrl)({url:`${this.endpointManager.getAuthUrl()}/auth/login`,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})});if(n.status!==200)return this.log("Login failed:",n.status,n.text),!1;let{access_token:s}=n.json,i=await(0,ci.requestUrl)({url:`${this.endpointManager.getAuthUrl()}/auth/me`,method:"GET",headers:{Authorization:`Bearer ${s}`}});if(i.status!==200)return this.log("Failed to fetch user info:",i.status),!1;let a=i.json,l={token:s,record:{id:a.id,email:a.email,collectionId:"users",collectionName:"users",created:a.created_at||new Date().toISOString(),updated:a.updated_at||new Date().toISOString(),is_admin:a.is_admin||!1,is_active:a.is_active||!0}};this.authStore.save(l.token,l.record);let c=this.setup(l,"email");return c&&(this.log("Email/password login successful"),await this.loginSettings.set({provider:"email"})),c}catch(n){return this.log("Email/password login error:",n),!1}}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};function dv(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function $C(o){let e=va(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var dc=class{constructor(e,t=5){this.expiryMargin=300*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=$C,this.maxConnections=t,this.refreshInterval=null,Zt.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=a=>{r(a)},i=a=>{this.removeFromRefreshQueue(e),n(a)};this.refresh(e,s,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){var n;let t=this.tokenMap.get(e),r=((n=t==null?void 0:t.attempts)!=null?n:0)+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){var a;let n=this._activePromises.get(e);if(n)return n;let s=this.tokenMap.get(e);this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:(a=s==null?void 0:s.attempts)!=null?a:0}),this.callbacks.set(e,r);let i=this.onRefresh(e).then(l=>(this.onTokenRefreshed(e,l),this._activePromises.delete(e),l)).catch(l=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),l});return this._activePromises.set(e,i),i}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Error("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,i)=>s[1].expiryTime-i[1].expiryTime);for(let[s,{friendlyName:i,expiryTime:a,attempts:l}]of n){if(!e(s))continue;let c=a-r,f="";c>0?f=`expires in ${dv(c-this.expiryMargin)}`:f="expired",t.push(`${s} (${i}): ${l} attempts, (${f})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${dv(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};var sn=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var jd=class{constructor(){this.platform="s3rn";this.product="relay"}},zd=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},an=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},Oo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},bo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},$o=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},Kd=class{constructor(e,t,r,n,s,i){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=i;this.platform="s3rn";this.product="relay"}},oo=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},ln=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},ms=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},fi=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},Tt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,i,a,l,c,f,u,d,p,m,y]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(a&&!this.validateUUID(a))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&i==="folder"&&l==="doc")return new Oo(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="canvas")return new bo(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file"&&f==="hash"&&d==="contentType"&&m==="contentLength")return new Kd(s,a,c,u,p,y);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file")return new $o(s,a,c);if(r==="relay"&&n==="relay"&&i=="folder")return new an(s,a);if(r==="relay"&&n==="folder"&&i==="document")return new ln(s,a);if(r==="relay"&&n==="folder"&&i==="canvas")return new ms(s,a);if(r==="relay"&&n==="folder")return new oo(s);if(r==="relay"&&n==="relay")return new zd(s);if(n===void 0)return new jd;throw new Error("Invalid s3rn format for the given product type")}};function BC(o){return o.expiryTime||0}function VC(o,e){return(...t)=>e(o,...t)}async function NC(o,e,t,r){var c;let n=Re("[TokenStore][Refresh]","debug"),s=Re("[TokenStore][Refresh]","error");n(`${e}`);let i=Tt.decode(e),a;if(i instanceof Oo)a=JSON.stringify({docId:i.documentId,relay:i.relayId,folder:i.folderId});else if(i instanceof bo)a=JSON.stringify({docId:i.canvasId,relay:i.relayId,folder:i.folderId});else if(i instanceof an)a=JSON.stringify({docId:i.folderId,relay:i.relayId,folder:i.folderId});else if(i instanceof $o)a=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"2336be2","Content-Type":"application/json"};try{let f=o.getEndpointManager().getApiUrl(),u=await mt(`${f}/token`,{method:"POST",headers:l,body:a});if(!u.ok){n(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(f){s(f,a),r(f)}}var pc=class extends dc{constructor(t,r,n,s=5){super({log:Re("[LiveTokenStore]","debug"),refresh:VC(t,NC),getJwtExpiry:BC,getStorage:function(){return new sn("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let i=`${t}${r}`,a=this._activePromises.get(i);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let f=this.getJwtExpiry(c),u=this.tokenMap.get(i);return this.tokenMap.set(r,{...u,token:c,expiryTime:f}),this._activePromises.delete(i),c}).catch(c=>{throw this._activePromises.delete(i),c});return this._activePromises.set(i,l),l}async fetchFileToken(t,r,n,s){var p;let i=Re("[TokenStore][Fetch]","debug");i(`${t}`);let a=Tt.decode(t),l;if(a instanceof $o)l=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(p=this.loginManager.user)==null?void 0:p.token}`,"Relay-Version":"2336be2","Content-Type":"application/json"},f=this.loginManager.getEndpointManager().getApiUrl(),u=await mt(`${f}/file-token`,{method:"POST",headers:c,body:l});if(!u.ok){i(u.status,await u.text());let m=await u.json();throw new Error(m.error)}return await u.json()}async getFileToken(t,r,n,s){let i=`${t}${r}`,a=this.tokenMap.get(i);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(i),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,n,s)}};function HC(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function pv(o){let e=JSON.stringify(o),t=HC(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}function qC(o,e,t){let r={token:o.token},n=new Bl(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0,maxConnectionErrors:3});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var cn=class extends st{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.listeners=new Map,this.loginManager=s;let i=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new Xo,ze().enableDocumentHistory&&(this.ydoc.gc=!1),i&&new dl(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,i.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(Tt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=qC(this.clientToken,this.ydoc,i);let a=this.providerConnectionErrorSubscription(f=>{this.log(`[${this.path}] disconnection event`,f);let u=this._provider.canReconnect();this.disconnect(),u&&this.connect()});a.on(),this._offConnectionError=a.off;let l=this.providerStateSubscription(f=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${pv(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(Tt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.hasUrl(this.clientToken.url),n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){if(this.clientToken=t,!this._provider)throw new Error("missing provider!");let r=this._provider.refreshToken(t.url,t.docId,t.token);if(r.urlChanged){let n=r.newUrl.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${n}`)}}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){return this._provider.connectionState}get intent(){return this._provider.intent}get synced(){return this._providerSynced}disconnect(){this._provider.disconnect(),this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",t)},off:()=>{this._provider.off("status",t)}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&this._provider.destroy(),this.loginManager=null}};var gv=require("obsidian");var YB=require("obsidian"),fn=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},mc=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(i){s(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r(a.result?a.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r()}catch(s){n(s)}})}};var vo=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Re("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[i,a]=this.checkFunction();i&&r(a)},3e3),this.promiseFunction().then(i=>{this.timeoutId&&clearTimeout(this.timeoutId),n(i)},i=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(i)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},hc=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Re("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function mv(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Re("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var WC={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Mn(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return WC[e]||"application/octet-stream"}var hv=Qo(gc());function xo(o,e,t){let r=o.getText("contents"),n=r.toString(),s=new hv.diff_match_patch,i=s.diff_main(n,e);s.diff_cleanupSemantic(i);let a=0,l=ze().enableDeltaLogging?Re("[diffMatchPatch]","debug"):(...c)=>{};l("Updating YDoc:"),l("Current content length:",n.length),l("Disk buffer length:",e.length),i.length!=0&&(o.transact(()=>{for(let[c,f]of i){switch(c){case 1:l(`Inserting "${f}" at position ${a}`),r.insert(a,f),a+=f.length;break;case 0:l(`Keeping "${f}" (length: ${f.length})`),a+=f.length;break;case-1:l(`Deleting "${f}" at position ${a}`),r.delete(a,f.length);break}l("intermediate",r.toString())}},t),l("result",r.toString()),l("Update complete. New content length:",r.toString().length))}function wo(o){return o instanceof Rt}var Rt=class extends cn{constructor(t,r,n,s){let i=s.relayId?new Oo(s.relayId,s.guid,r):new ln(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this.pendingOps=[];this.requestSave=(0,gv.debounce)(this.save,2e3);this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Tn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{let a=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(a),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(a)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),Pn(on.enableDeltaLogging,()=>{let a=l=>{var f,u;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(u=(f=l.transaction.origin)==null?void 0:f.constructor)==null?void 0:u.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(a),this.unsubscribes.push(()=>{this.ytext.unobserve(a)})}),this._tfile=null}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}async process(t){this.tfile&&ze().enableAutomaticDiffResolution&&this.pendingOps.push(t)}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this.getTFile()),this._tfile}getTFile(){var t;return(t=this._parent)==null?void 0:t.getTFile(this)}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(/\r\n/g,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new fn(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=await this.sharedFolder.backgroundSync.downloadItem(this),s=new Uint8Array(n.arrayBuffer);Ro(this.ydoc,s);let i=this.text!==r,a=this.text,l=a,c=[];for(let f of this.pendingOps)if(l=f(l),c.push(f),l==r){if(this.clearDiskBuffer(),a==this.text)xo(this.ydoc,l,this);else return ze().enableDeltaLogging?this.warn("diffMatchPatch solution is stale an cannot be applied",l,this.text):this.log("diffMatchPatch solution is stale an cannot be applied"),!0;return this.pendingOps=[],!0}return this.pendingOps=[],i||this.clearDiskBuffer(),i}async connect(){return this.sharedFolder.s3rn instanceof oo?!1:(this.s3rn instanceof ln&&(this.sharedFolder.relayId?this.s3rn=new Oo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new ln(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.isReady(this.synced)}hasLocalDB(){return this._persistence.hasServerSync||this._persistence.hasUserData()}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new vo(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),new Promise(r=>{if(this.persistenceSynced){r();return}this._persistence.once("synced",()=>{this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new vo(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Mn(this.path)}save(){this.tfile&&(this.vault.modify(this.tfile,this.text),this.warn("file saved",this.path))}async markOrigin(t){await this._persistence.setOrigin(t)}async getOrigin(){return this._persistence.getOrigin()}async markSynced(){await this._persistence.markServerSynced()}async getServerSynced(){return this._persistence.getServerSynced()}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,this._parent=null}async read(){return this.text}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Dn=class extends pt{constructor(){super(),this._set=new Set}add(e){let t=this._set.size;return this._set.add(e),this._set.size>t&&this.notifyListeners(),this}delete(e){let t=this._set.delete(e);return t&&this.notifyListeners(),t}clear(){this._set.clear(),this.notifyListeners()}has(e){return this._set.has(e)}items(){return[...this._set]}get size(){return this._set.size}map(e){return this.items().map(e)}forEach(e){this.items().forEach(e)}find(e){return this.items().find(e)}some(e){for(let t of this._set)if(e(t))return!0;return!1}filter(e){let t=[];for(let r of this._set)e(r)&&t.push(r);return t}};var yc,jC=new Uint8Array(16);function Gd(){if(!yc&&(yc=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!yc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yc(jC)}var sr=[];for(let o=0;o<256;++o)sr.push((o+256).toString(16).slice(1));function yv(o,e=0){return sr[o[e+0]]+sr[o[e+1]]+sr[o[e+2]]+sr[o[e+3]]+"-"+sr[o[e+4]]+sr[o[e+5]]+"-"+sr[o[e+6]]+sr[o[e+7]]+"-"+sr[o[e+8]]+sr[o[e+9]]+"-"+sr[o[e+10]]+sr[o[e+11]]+sr[o[e+12]]+sr[o[e+13]]+sr[o[e+14]]+sr[o[e+15]]}var zC=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Jd={randomUUID:zC};function KC(o,e,t){if(Jd.randomUUID&&!e&&!o)return Jd.randomUUID();o=o||{};let r=o.random||(o.rng||Gd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return yv(r)}var di=KC;function Qd(o){return Array.isArray(o.permissionParents)}var ur=class extends pt{constructor(t){super();this.observableName=t;this.derivedMapRefCounts=new WeakMap;this.activeDerivedMaps=new Set;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}subscribe(t){let r=null;for(let s of this.activeDerivedMaps)if(s&&s.parentCallback===t){r=s;break}if(r){let s=this.derivedMapRefCounts.get(r)||0;this.derivedMapRefCounts.set(r,s+1)}let n=super.subscribe(t);return()=>{if(r){let i=(this.derivedMapRefCounts.get(r)||0)-1;i<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,i)}n()}}unsubscribe(t){for(let r of this.activeDerivedMaps)if(r&&r.parentCallback===t){let s=(this.derivedMapRefCounts.get(r)||0)-1;s<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,s);break}super.unsubscribe(t)}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Yd(this,t);return this._derivedMaps.set(t,n),this.derivedMapRefCounts.set(n,0),this.activeDerivedMaps.add(n),n}},Yd=class extends ur{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.parentCallback=()=>{let n=new Map;this.parentMap.forEach((s,i)=>{this.predicate(s,i)&&n.set(i,s)}),this._map=n,this.notifyListeners()},this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(this.parentCallback))}subscribe(t){return this.sub(),super.subscribe(t)}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsub&&(this.unsub(),this.unsub=void 0),(t=this._listeners)==null||t.clear(),this.parentCallback=null)}};var pi=class extends pt{constructor(t,r){super();this.evaluate=t;this.unsubscribes=[];this.subscriberCount=0;this.observableName="ObservablePermission";this.currentValue=this.evaluate(),r.forEach(n=>{let s=n.on(()=>{let i=this.evaluate();i!==this.currentValue&&(this.currentValue=i,this.notifyListeners())});this.unsubscribes.push(s)})}subscribe(t){if(this.destroyed)throw new Error("Cannot subscribe to destroyed ObservablePermission");this.subscriberCount++,t(this.currentValue);let r=this.on(()=>{t(this.currentValue)});return()=>{r(),this.subscriberCount--,this.subscriberCount===0&&this.destroy()}}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsubscribes.forEach(r=>r()),this.unsubscribes.length=0,(t=this._listeners)==null||t.clear())}},bc=class{constructor(e){this.relayManager=e;this.policies=new Map;this.registerBuiltinPolicies()}isAllowed(e){let t=this.getResourceType(e.resource),r=`${t}:${e.action}`,n=this.policies.get(r);if(!n)return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}};try{return{allowed:n.evaluate(e,this.relayManager),policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}catch(s){return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}}can(e,t,r,n){let s=this.getResourceType(r),i=t[1];if(t[0]!==r[0])throw new Error(`unexpected permission/resource mismatch ${t[0]} ${r[0]}`);let a=`${s}:${i}`,l=this.policies.get(a),c={principal:e,action:i,resource:r,context:n},f=l?this.getFilteredCollections(l.dependencies,c):[];return new pi(()=>this.isAllowed(c).allowed,f)}getPolicies(){return Array.from(this.policies.keys()).sort()}registerPolicy(e){let[t,r]=e.permission,n=`${t}:${r}`;this.policies.set(n,e)}getResourceType(e){return e[0]}getResourceId(e){return e[1]}getFilteredCollections(e,t){let r=[];for(let n of Object.keys(e)){let s=this.relayManager.getCollectionMapByName(n);s&&r.push(s)}return r}registerBuiltinPolicies(){this.registerPolicy({permission:["folder","delete"],description:"Delete a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDelete.bind(this)}),this.registerPolicy({permission:["folder","rename"],description:"Rename a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRename.bind(this)}),this.registerPolicy({permission:["folder","read_content"],description:"Read folder contents and add to vault",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRead.bind(this)}),this.registerPolicy({permission:["folder","edit_content"],description:"Edit notes in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderWrite.bind(this)}),this.registerPolicy({permission:["folder","upload"],description:"Upload attachments to folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource),relays:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.id===r.relayId)},storage_quotas:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource)),n=r&&this.relayManager.relays.get(r.relayId);return!!(n&&e.id===n.storageQuotaId)}},evaluate:this.evaluateFolderUpload.bind(this)}),this.registerPolicy({permission:["folder","download"],description:"Download attachments from folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDownload.bind(this)}),this.registerPolicy({permission:["folder","manage_files"],description:"Add/remove/rename files in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageFiles.bind(this)}),this.registerPolicy({permission:["relay","delete"],description:"Delete a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayDelete.bind(this)}),this.registerPolicy({permission:["relay","rename"],description:"Rename a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayRename.bind(this)}),this.registerPolicy({permission:["relay","manage_users"],description:"Manage users in relay server (add/remove/change roles)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageUsers.bind(this)}),this.registerPolicy({permission:["relay","manage_sharing"],description:"Manage relay share keys (enable/disable sharing, rotate keys)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageSharing.bind(this)}),this.registerPolicy({permission:["subscription","manage"],description:"Manage relay subscriptions and plans",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateSubscriptionManage.bind(this)}),this.registerPolicy({permission:["folder","manage_users"],description:"Manage users in folder (add/remove/change roles)",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageUsers.bind(this)})}isFolderCreator(e,t){let r=this.relayManager.remoteFolders.get(t);return(r==null?void 0:r.creatorId)===e}isRelayOwnerForFolder(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwner(e,r.relayId):!1}isRelayOwner(e,t){return!!this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e&&n.role==="Owner")}hasRelayRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.relayRoles.find(i=>i.relayId===t&&i.userId===e&&n.includes(i.role))}hasFolderRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.folderRoles.find(i=>i.sharedFolderId===t&&i.userId===e&&n.includes(i.role))}hasFolderAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.getUserFolderRole(e,t)?!0:r.private?!1:!!this.getUserRelayRole(e,r.relayId):!1}hasFolderWriteAccess(e,t){let r=this.relayManager.remoteFolders.get(t);if(!r)return!1;let n=this.getUserFolderRole(e,t);if(n&&this.roleHasWritePermission(n))return!0;if(!r.private){let s=this.getUserRelayRole(e,r.relayId);if(s&&this.roleHasWritePermission(s))return!0}return!1}hasFolderManagementAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwnerForFolder(e,t)?!0:r.private?this.hasFolderRole(e,t,["Owner"]):this.isFolderCreator(e,t):!1}getUserFolderRole(e,t){let r=this.relayManager.folderRoles.find(n=>n.sharedFolderId===t&&n.userId===e);return(r==null?void 0:r.role)||null}getUserRelayRole(e,t){let r=this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e);return(r==null?void 0:r.role)||null}roleHasWritePermission(e){return["Owner","Member"].includes(e)}hasStorageQuota(e,t){let r=this.relayManager.remoteFolders.get(e);if(!r)return!1;let n=this.relayManager.relays.get(r.relayId);if(!n)return!1;let s=n.storageQuota;return s?s.usage+t<=s.quota:!0}evaluateFolderDelete(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRename(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRead(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderWrite(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderDownload(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderManageFiles(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderUpload(e){var n;let t=this.getResourceId(e.resource),r=((n=e.context)==null?void 0:n.fileSize)||0;return this.hasFolderWriteAccess(e.principal,t)&&this.hasStorageQuota(t,r)}evaluateRelayDelete(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayRename(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageUsers(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageSharing(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateSubscriptionManage(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateFolderManageUsers(e){let t=this.getResourceId(e.resource);return this.relayManager.remoteFolders.get(t)?this.isRelayOwnerForFolder(e.principal,t)?!0:this.hasFolderRole(e.principal,t,["Owner"]):!1}};function Xd(o){return typeof o.id=="string"}function GC(o){return typeof o.name=="string"}var ep=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function bv(o){return typeof o.aggregate_root=="object"}function Zd(o){return o&&Array.isArray(o.permissionParents)}var xa=class{get aggregate_root(){}get permissionParents(){return[]}},tp=class extends pt{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get name(){return this.storageQuota.name}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get metered(){return this.storageQuota.metered}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}get aggregate_root(){var t;return["relays",(t=this.relays.find(r=>r.storageQuotaId===this.storageQuota.id))==null?void 0:t.id]}},rp=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new tp(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},vc=class extends xa{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},op=class extends pt{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}get publicKey(){return this.provider.public_key}get keyType(){return this.provider.key_type}get keyId(){return this.provider.key_id}update(t){return this.provider=t,this}},np=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new op(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},sp=class extends pt{constructor(t,r,n,s,i,a){super();this.remoteFolder=t;this.relays=r;this.relayRoles=n;this.folderRoles=s;this.users=i;this.user=a}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}set name(t){this.remoteFolder.name=t}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get creatorId(){return this.remoteFolder.creator}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get relayId(){return this.remoteFolder.relay}get role(){var s,i;let t=this.remoteFolder.creator===this.user.id,r=(s=this.relayRoles.find(a=>a.relayId===this.relay.id&&a.userId===this.user.id))==null?void 0:s.role,n=(i=this.folderRoles.find(a=>a.sharedFolderId===this.remoteFolder.id&&a.userId===this.user.id))==null?void 0:i.role;if(this.remoteFolder.private){if(n)return n}else return r||this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":r||"Member";return this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member"}get owner(){return this.role==="Owner"}get aggregate_root(){return["relays",this.remoteFolder.relay]}get permissionParents(){var r,n;let t=[];if(this.remoteFolder.private){let s=(r=this.folderRoles.find(i=>i.sharedFolderId===this.id&&i.userId===this.user.id))==null?void 0:r.id;s&&t.push(["shared_folder_roles",s])}else{let s=(n=this.relayRoles.find(i=>i.relayId===this.relayId&&i.userId===this.user.id))==null?void 0:n.id;s&&t.push(["relay_roles",s])}return t}},ip=class{constructor(e,t,r,n,s,i){this.remoteFolders=e;this.relays=t;this.folderRoles=r;this.relayRoles=n;this.users=s;this.user=i;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new sp(e,this.relays,this.relayRoles,this.folderRoles,this.users,this.user);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},ap=class{constructor(e,t,r,n,s,i,a,l){this.relays=e;this.relayRoles=t;this.relayInvitations=r;this.remoteFolders=n;this.subscriptions=s;this.storageQuotas=i;this.providers=a;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new bp(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},lp=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new mp(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},cp=class{constructor(e,t,r,n){this.folderRoles=e;this.remoteFolders=t;this.users=r;this.roles=n;this.collectionName="shared_folder_roles"}items(){return this.folderRoles.values()}clear(){this.folderRoles.clear()}get(e){return this.folderRoles.get(e)}ingest(e){let t=this.folderRoles.get(e.id);if(t)return t.update(e),this.folderRoles.notifyListeners(),t;let r=new hp(e,this.remoteFolders,this.users,this.roles);return this.folderRoles.set(r.id,r),r}delete(e){this.folderRoles.delete(e)}},fp=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new gp(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},up=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new vc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},dp=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new yp(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},pp=class extends st{constructor(e){super(),this.collections=new Map,this.relationships=new Map;for(let t of e)this.collections.set(t.collectionName,t);Zt.set(this,"Store")}getCollection(e){let t=this.collections.get(e);if(!t)throw this.error("No collection found for",e),new Error("No collection found for "+e);return t}clear(){let e=ho.getInstance();e.beginTransaction(),this.collections.forEach(t=>{t.clear()}),this.collections.clear(),this.relationships.clear(),e.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(e){return this.ingestBatch(e==null?void 0:e.items)}ingestBatch(e){if(e)return e.map(t=>this.ingest(t))}ingest(e){let t=ho.getInstance();t.beginTransaction();let r=this._ingest(e);return t.commitTransaction(),r}_ingest(e){if(!e)return;let t,r=this.collections.get(e.collectionName);if(r?t=r.ingest(e):this.error("No collection found for record",e),bv(t)){let n=t.aggregate_root;if(n){let s=e.id,i=this.relationships.get(n.join(":"))||new Set;i.add([e.collectionName,s].join(":")),this.relationships.set(n.join(":"),i)}}if(Zd(t)){let n=t.permissionParents;for(let s of n){let i=e.id,a=this.relationships.get(s.join(":"))||new Set;a.add([e.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(e.expand)for(let[,n]of Object.entries(e.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return t}delete(e){this.cascade(e.collectionName,e.id)}graphviz(){let e=`digraph G {
`;for(let[t,r]of this.collections)for(let n of r.items()){if(!Xd(n)){this.warn("record has no id",n);continue}let s=t+"_"+n.id;if(GC(n)&&(s=t+"_"+n.name),e+=`  ${t}_${n.id} [label="${s}"];
`,Xd(n)&&bv(n)&&n.aggregate_root){let[i,a]=n.aggregate_root;e+=`  ${t}_${n.id} -> ${i}_${a};
`}if(Xd(n)&&Zd(n))for(let i of n.permissionParents){let[a,l]=i;e+=`  ${t}_${n.id} -> ${a}_${l} [style=dotted];
`}}return e+="}",e}cascade(e,t){let r=this.collections.get(e),n=this.relationships.get([e,t].join(":")),s=ho.getInstance();s.beginTransaction(),r&&(this.warn("cascade delete parent",e,t),r.delete(t)),this.relationships.delete([e,t].join(":"));for(let i of n||[]){let[a,l]=i.split(":");try{let f=this.getCollection(a).get(l);if(Zd(f)){let u=f.permissionParents.filter(d=>{let[p,m]=d;try{return!!this.getCollection(p).get(m)}catch(y){return this.warn("Parent collection not found during validation",p,y),!1}});u.length===0?(this.warn("cascade delete child (no valid permission parents)",a,l),this.cascade(a,l)):this.warn("preserving child with valid permission parents",a,l,u)}else this.warn("cascade delete child",a,l),this.cascade(a,l)}catch(c){this.warn("Failed to process child during cascade",a,l,c)}}s.commitTransaction()}},mp=class extends xa{constructor(e,t,r,n){super(),this.users=r,this.roles=n,this.relays=t,this.relayRole=e}update(e){return this.relayRole=e,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let e=this.users.get(this.relayRole.user);if(!e)throw new Error(`Unable to find user: ${this.relayRole.user}`);return e}get role(){var e;return(e=this.roles.get(this.relayRole.role))==null?void 0:e.name}get relayId(){return this.relayRole.relay}get relay(){let e=this.relays.get(this.relayRole.relay);if(!e)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return e}get aggregate_root(){return["relays",this.relayRole.relay]}get permissionParents(){return[["users",this.relayRole.user]]}},hp=class extends xa{constructor(t,r,n,s){super();this.folderRole=t;this.remoteFolders=r;this.users=n;this.roles=s}update(t){return this.folderRole=t,this}get id(){return this.folderRole.id}get userId(){return this.folderRole.user}get user(){let t=this.users.get(this.folderRole.user);if(!t)throw new Error(`Unable to find user: ${this.folderRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.folderRole.role))==null?void 0:t.name}get sharedFolderId(){return this.folderRole.shared_folder}get sharedFolder(){let t=this.remoteFolders.get(this.folderRole.shared_folder);if(!t)throw new Error(`invalid role: unable to find folder ${this.folderRole.shared_folder} on role ${this.folderRole.id}`);return t}get aggregate_root(){return["shared_folders",this.folderRole.shared_folder]}get permissionParents(){return[["shared_folders",this.folderRole.shared_folder]]}},gp=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},yp=class extends pt{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get permissionParents(){return[["users",this.subscription.user]]}},bp=class extends pt{constructor(t,r,n,s,i,a,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get version(){return this.relay.version}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>{let r=t.relayId===this.id,n=t.permissionParents.length>0;return r&&n})}get subscriptions(){return this._subscriptions.filter(t=>t.relayId===this.id)}get permissionParents(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;return t?[["relay_roles",t]]:[]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},xc=class extends st{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new ur("users"),this.relays=new ur("relays"),this.providers=new ur("providers"),this.remoteFolders=new ur("remote folders"),this.relayInvitations=new ur("relay invitations"),this.relayRoles=new ur("relay roles"),this.folderRoles=new ur("folder roles"),this.roles=new ur("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new ur("subscriptions"),this.storageQuotas=new ur("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.loginManager.loggedIn?this.login():this.logout()}),this.setUser(),this.user&&(Zt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new ep(this.roles),r=new up(this.users),n=new np(this.providers),s=new ap(this.relays,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),i=new lp(this.relayRoles,this.relays,this.users,this.roles),a=new cp(this.folderRoles,this.remoteFolders,this.users,this.roles),l=new fp(this.relayInvitations,this.relays,this.roles),c=new ip(this.remoteFolders,this.relays,this.folderRoles,this.relayRoles,this.users,this.user),f=new dp(this.subscriptions,this.relays,this.users),u=new rp(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new pp([t,r,s,i,a,l,c,f,u,n]),this.policyManager=new bc(this)}getCollectionMapByName(t){switch(t){case"folder_roles":return this.folderRoles;case"relay_roles":return this.relayRoles;case"shared_folders":return this.remoteFolders;case"relays":return this.relays;case"storage_quotas":return this.storageQuotas;case"subscriptions":return this.subscriptions;default:console.warn(`Unknown collection name: ${t}`);return}}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new vc(this.authUser),this.users.set(this.user.id,this.user))}login(){var t;this.authUser&&this.authUser==((t=this.pb)==null?void 0:t.authStore.model)||(this.setUser(),this.buildGraph(),this.subscribe(),this.update())}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var i;let s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relayId===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(i=>{var a;(a=this.store)==null||a.ingest(i)});let s=this.relayInvitations.find(i=>i.relayId===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"shared_folder_roles",expand:["user","shared_folder"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:mt})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,i=>this._handleEvent(t,i),{expand:n.join(","),fetch:mt})}async refreshRemoteFolder(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("shared_folders").getOne(t.id,{expand:"shared_folder_roles_via_shared_folder"});!this.destroyed&&this.store&&this.store.ingest(r)}async refreshRelay(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("relays").getOne(t.id,{expand:"relay_roles_via_relay,shared_folders_via_relay,storage_quota"});!this.destroyed&&this.store&&this.store.ingest(r)}async update(){let t=(n,s={})=>{var i;return!this.pb||!this.pb.authStore.isValid||((i=this.pb.authStore.model)==null?void 0:i.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user,role"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("shared_folder_roles",{expand:"user,role"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let i of s)!this.destroyed&&this.store&&this.store.ingest(i)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(i=>{throw i});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var i,a;let r=di(),n=await((i=this.pb)==null?void 0:i.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("Failed to create relay");return s}async createSelfHostedRelay(t,r,n){var l;if(!this.pb)throw new Error("Not connected to relay service");let s={};if(r)s.provider=r;else if(t)s.url=t;else throw new Error("Either URL or provider ID must be provided");n&&(s.organization=n);let i=await this.pb.send("/api/collections/relays/self-host",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to create self-hosted relay");return a}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var r;return await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),!0}async createRemoteFolder(t,r,n=!1,s=void 0){var l,c;if(!this.pb)throw new Error("Failed to create folder");let i=await this.pb.collection("shared_folders").create({name:s||t.name,guid:t.guid,relay:r.id,creator:(l=this.user)==null?void 0:l.id,private:n},{expand:"relay"}),a=(c=this.store)==null?void 0:c.ingest(i);if(!a)throw new Error("Failed to create folder");return a}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(i=>{var a;return i.userId===((a=this.user)==null?void 0:a.id)&&i.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}async updateRelayRole(t,r){var a;if(!this.pb)throw new Error("Failed to update relay role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update relay role");let s=await this.pb.collection("relay_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update relay role");return i}async addFolderRole(t,r,n){var l;if(!this.pb)throw new Error("Failed to add folder role");let s=this.roles.find(c=>c.name===n);if(!s)throw new Error("Failed to find role");let i=await this.pb.collection("shared_folder_roles").create({user:r,shared_folder:t.id,role:s.id}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to add folder role");return a}async removeFolderRole(t){if(!this.pb)throw new Error("Failed to remove folder role");await this.pb.collection("shared_folder_roles").delete(t.id)}async updateFolderRole(t,r){var a;if(!this.pb)throw new Error("Failed to update folder role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update folder role");let s=await this.pb.collection("shared_folder_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update folder role");return i}async updateFolderPrivacy(t,r){var i;if(!this.pb)throw new Error("Failed to update folder privacy");let n=await this.pb.collection("shared_folders").update(t.id,{private:r}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder privacy");return s}async updateRemoteFolder(t,r){var i;if(!this.pb)throw new Error("Failed to update folder");let n=await this.pb.collection("shared_folders").update(t.id,r),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder");return s}can(t,r,n,s){if(!this.policyManager)return new pi(()=>!1,[]);let[i]=r,a=[i,n.id];return this.policyManager.can(t,r,a,s)}userCan(t,r,n){return this.user?this.can(this.user.id,t,r,n):new pi(()=>!1,[])}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null,this.policyManager=void 0}};var kv=require("obsidian");function Un(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!Un(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function un(o){return o instanceof Nt}var Nt=class o extends cn{constructor(t,r,n,s){let i=s.relayId?new bo(s.relayId,s.guid,r):new ms(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new Tn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(a){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],i=[];for(let[,a]of r.entries())s.push({...a});for(let[,a]of n.entries()){let l=t.getText(a.id);i.push({...a,text:l.toString()||a.text})}return{edges:s,nodes:i}}async markSynced(){await this._persistence.markServerSynced()}async getServerSynced(){return this._persistence.getServerSynced()}async connect(){return this.sharedFolder.s3rn instanceof oo?!1:(this.s3rn instanceof ms&&(this.sharedFolder.relayId?this.s3rn=new bo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new ms(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.isReady(this.synced)}hasLocalDB(){return this._persistence.hasServerSync||this._persistence.hasUserData()}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new vo(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",()=>{this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new vo(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}static checkExtension(t){return t.endsWith(".canvas")}async markOrigin(t){await this._persistence.setOrigin(t)}async getOrigin(){return this._persistence.getOrigin()}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&t.file===this.tfile)return await this.applyData(t.canvas.getData())}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,i=new Map,a=new Set,l=new Map,c=new Set;t.nodes.forEach(f=>{s.add(f.id);let u=n.get(f.id);u?Un(u,f)||i.set(f.id,f):(i.set(f.id,f),f.type==="text"&&this.textNode(f))});for(let f of n.keys())s.has(f)||a.add(f);t.edges.forEach(f=>{s.add(f.id);let u=r.get(f.id);u&&Un(u,f)||l.set(f.id,f)});for(let f of r.keys())s.has(f)||c.add(f);(i.size>0||a.size>0||l.size>0||c.size>0)&&ut(this.ydoc,()=>{for(let f of i.values())this.ynodes.set(f.id,f);for(let f of a)this.ynodes.delete(f);for(let f of l.values())this.yedges.set(f.id,f);for(let f of c)this.yedges.delete(f)},this)}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return Mn(this.path)}get json(){let t=o.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};function wa(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let i=t[s].match(/\d+/g),a=r[s].match(/\d+/g);if(i&&a){let l=parseInt(i[0]),c=parseInt(a[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}var Lr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var wc=class extends pt{constructor(t,r){super("Settings");this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},no=class o extends pt{constructor(t,r){super(`NamespacedSettings[${r}]`);this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new Lr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new Lr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([a])=>s.test(a)).reduce((a,[l,c])=>(a[l]=c,a),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new Lr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([f,u])=>{l.test(f)&&(c[f]=u)}),c}let s={...r},i=s;this.path.forEach(l=>{i[l]=i[l]||{},i=i[l]});let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{a.test(l)&&(i[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new Lr(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(a=>a),n=[],s=[],i=[];return r.forEach((a,l)=>{let c=a.match(/^\[(\w+)=(.+)\]$/),f=a.match(/^\((.+?)\)$/);if(c){let[,u,d]=c,p=l>0?s[l-1]:a.split("[")[0];i.push({type:"arrayMatch",key:u,value:d,level:l}),n.push(a),s.push(p)}else if(f){let[,u]=f;i.push({type:"wildcard",wildcardPattern:this.createPatternRegex(u),level:l}),n.push(a),s.push(a)}else n.push(a),s.push(a)}),[n,s,i]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>i.test(l)).reduce((l,[c,f])=>(l[c]=f,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let i=this.basePath[0];if(!Array.isArray(r[i]))return;let a=r[i].find(c=>c[s.key]===s.value);if(!a)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=a;for(let f of l){if(!c||typeof c!="object")return;c=c[f]}return c}return a}for(let i=0;i<this.basePath.length;i++){if(!r)return;r=r[this.basePath[i]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(u=>u[s.key]===s.value),f=this.basePath.slice(s.level+1);if(c>=0)if(f.length>0){let u=n[l][c];for(let p=0;p<f.length-1;p++){let m=f[p];u[m]=u[m]||{},u=u[m]}let d=f[f.length-1];u[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(f.length>0){let u={[s.key]:s.value},d=u;for(let m=0;m<f.length-1;m++){let y=f[m];d[y]={},d=d[y]}let p=f[f.length-1];d[p]=r,n[l].push(u)}else n[l].push({...r,[s.key]:s.value});return n}let i=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];i[c]=i[c]||{},i=i[c]}let a=this.basePath[this.basePath.length-1];return i[a]=r,n}getParent(){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new o(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new o(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,i=this.basePath.slice(0,-1);for(let l of i){if(!s[l])return r;s=s[l]}let a=this.basePath[this.basePath.length-1];return delete s[a],r})}subscribe(t){if(this.destroyed)throw new Lr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var Bo=class Bo extends no{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,i;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||ze().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled)return!1;for(let[a,l]of Object.entries(Bo.schema)){let c=a;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(i=this.get().otherTypes)!=null?i:Bo.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=Bo.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(Bo.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...Bo.defaultFlags}))}};Bo.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Bo.defaultFlags=Object.fromEntries(Object.entries(Bo.schema).map(([t,r])=>[t,r.defaultEnabled]));var mi=Bo;var JC={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function kc(o){return(o==null?void 0:o.type)==="markdown"}function vv(o){return(o==null?void 0:o.type)==="canvas"}function xv(o){return(o==null?void 0:o.type)==="folder"}function wv(o){return(o==null?void 0:o.type)==="file"}function _a(o){return{version:0,id:o,type:"markdown"}}function _v(o){return{version:0,id:o,type:"canvas"}}function Ic(o){return{version:0,id:o,type:"folder"}}function Sv(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var Sc=class Sc extends pt{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Sc.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var i,a;if(t.endsWith(".md")||ze().enableCanvasSync&&t.endsWith(".canvas")||!((i=t.split("/").pop())==null?void 0:i.includes(".")))return!0;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((a=this.protocols.get(s))!=null&&a.enabled)}updateFromSettings(t){Object.entries(JC).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=Mn(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!ze().enableCanvasSync&&n==="canvas"?"file":n;return"file"}};Sc.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var _c=Sc;var Sa=require("obsidian");async function vp(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Er(o){return!!o&&o instanceof On}var Cc=class extends st{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let i=n.result;i.objectStoreNames.contains("files")||i.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,i)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),i(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readonly").objectStore("files").get(t);a.onsuccess=()=>{r(a.result||null)},a.onerror=()=>{this.error("Error retrieving hash:",a.error),n(a.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);a.onsuccess=()=>r(),a.onerror=()=>{this.error("Error removing hash:",a.error),n(a.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},xp=class extends st{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof Sa.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof Sa.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await vp(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await vp(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof Sa.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},On=class extends pt{constructor(t,r,n,s){super();this.path=t;this._guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new $o(s.relayId,s.guid,r):new fi(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new xp(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get guid(){return this._guid}set guid(t){this._guid=t,this.s3rn=this._parent.relayId?new $o(this._parent.relayId,this._parent.guid,t):new fi(this._parent.guid,t)}get mimetype(){return Mn(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t,r){t!==this.path&&(this._parent=r,this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(i){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(ze().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.log(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Sa.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof oo?!1:(this.s3rn instanceof ln&&(this.sharedFolder.relayId?this.s3rn=new $o(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new fi(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};var Lc=class extends st{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new Dn;this.activeDownloads=new Dn;this.syncGroups=new ur;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Zt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,i=0,a=0;this.syncGroups.forEach(u=>{t+=u.total,r+=u.completed,n+=u.syncs,s+=u.completedSyncs,i+=u.downloads,a+=u.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,f=i>0?a/i*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(f),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:i,completedDownloads:a}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,i=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(i),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc,s;n instanceof On?s=this.syncFile(n):s=this.syncDocument(n),s.then(()=>{r.status="completed";let i=this.syncCompletionCallbacks.get(r.guid);i&&(i.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}).catch(i=>{r.status="failed";let a=this.syncCompletionCallbacks.get(r.guid);a&&(a.reject(i instanceof Error?i:new Error(String(i))),this.syncCompletionCallbacks.delete(r.guid));let l=this.syncGroups.get(r.sharedFolder);l&&(this.error("[Sync Failed]",i),l.status="failed",this.syncGroups.set(r.sharedFolder,l))}).finally(()=>{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid),this.timeProvider.setTimeout(()=>{this.processSyncQueue()},0)})}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Sync Startup Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{let n;r.doc instanceof Nt?n=this.getCanvas(r.doc):r.doc instanceof On?n=this.getSyncFile(r.doc):n=this.getDocument(r.doc),n.then(()=>{r.status="completed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(i.completedDownloads++,i.completed++,i.completed===i.total&&(i.status="completed"),this.syncGroups.set(r.sharedFolder,i))}).catch(s=>{r.status="failed";let i=this.downloadCompletionCallbacks.get(r.guid);i&&(i.reject(s instanceof Error?s:new Error(String(s))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",s)}).finally(()=>{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid),this.timeProvider.setTimeout(()=>{this.processDownloadQueue()},0)})}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Download Startup Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?new Promise((l,c)=>{a.resolve=l,a.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let i=new Promise((a,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(wa),this.processSyncQueue(),i}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(t.guid);return a?(this.processDownloadQueue(),new Promise((l,c)=>{a.resolve=l,a.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let i=new Promise((a,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(wa),this.processDownloadQueue(),i}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(wo),n=[...t.files.values()].filter(un),s=[...t.files.values()].filter(Er),i=[...r,...n,...s],a={sharedFolder:t,total:i.length,completed:0,status:"pending",downloads:0,syncs:i.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let l=[...r,...n,...s].sort(wa);for(let c of l)this.enqueueForGroupSync(c);a.status="running",this.syncGroups.set(t,a)}async enqueueForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(wa),this.processSyncQueue(),s}getAuthHeader(t){return{Authorization:`Bearer ${t.token}`}}getBaseUrl(t,r){var a;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");return s.pop(),s.push(t.docId),n.pathname=s.join("/"),((a=t.baseUrl)==null?void 0:a.replace(/\/$/,""))||n.toString()}async downloadItem(t){let r=f=>f instanceof bo?f.canvasId:f.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${Tt.encode(n)}`),!(n instanceof Oo||n instanceof bo))throw new Error(`Unable to decode S3RN: ${Tt.encode(n)}`);let s=await t.getProviderToken(),i=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,kv.requestUrl)({url:l,method:"GET",headers:i,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${Tt.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;un(t)?(s=Nt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):wo(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let i=!1;if(un(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};i=Un(s,c)}else i=n===r;if(!i&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&await a,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(Tt.encode(t.s3rn))),!0}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async getCanvas(t,r=3,n=3e3){try{let s=Nt.exportCanvasData(t.ydoc),i={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);i=JSON.parse(d)}catch(d){}let a=Un(s.edges,i.edges)&&Un(s.nodes,i.nodes),l=i.nodes.length>0,f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f);if(this.log("[getCanvas] applying content from server"),Ro(t.ydoc,u),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,i="";try{i=await t.sharedFolder.read(t)}catch(y){}let a=s===i,l=i!=="",f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f),d=new Xo;Ro(d,u);let p=d.getMap("users");if(d.getText("contents").toString()===""){if(p.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",p.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),Ro(t.ydoc,u),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncFile(t){await t.sync()}async getSyncFile(t){await t.pull()}async syncDocument(t){try{wo(t)?await this.syncDocumentWebsocket(t):un(t)&&await this.syncDocumentWebsocket(t)}catch(r){console.error(r);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),i=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),i()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var wp=require("obsidian");function _p(o){return o instanceof hi}var hi=class o extends st{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let i=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return i instanceof wp.TFolder?(this._tfolder=i,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new o(t.getVirtualPath(r.path),Us(),t)}disconnect(){this.connected=!1}move(t,r){t!==this.path&&(this._parent=r,this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof wp.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var Vo=Qo(Yn());var Ec=class extends pt{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new _c(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+Vo.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let i=this.meta.get(t);xv(i)?this.moveFolder(t,r):i&&(this.set(r,i),this.delete(t))}new(t){this.assertVPath(t);let r=di();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),kc(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),kc(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,i)=>{if(s.action==="delete"){let a=s.oldValue;(a==null?void 0:a.type)==="folder"&&r.set(a.id,i)}else if(s.action==="add"||s.action==="update"){let a=this.meta.get(i);(a==null?void 0:a.type)==="folder"&&n.set(a.id,i)}}),r.forEach((s,i)=>{let a=n.get(i);if(a&&s!==a){this.log(`Detected folder move from ${s} to ${a}`);let l=new Map;this.meta.forEach((c,f)=>{f.startsWith(a+Vo.sep)&&l.set(f,c)}),this.renames.set(s,a),this.log("setting alias",s,a),this.log("paths to move",l),l.forEach((c,f)=>{let u=f.slice(a.length),d=s+u;this.renames.set(d,f),this.log("setting alias",d,f)})}})}start(){Pn(on.enableDeltaLogging,()=>{let n=s=>{var a,l;let i="";i+=`Transaction origin: ${s.transaction.origin}${(l=(a=s.transaction.origin)==null?void 0:a.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,f)=>{c.action==="add"&&(i+=`Added ${f}: ${this.get(f)}
`),c.action==="update"&&(i+=`Updated ${f}: ${this.get(f)}
`),c.action==="delete"&&(i+=`Deleted ${f}
`)}),this.debug(i)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),i=_a(s);return this.overlay.set(t,i),i}if(r){if(kc(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,i)=>{let a;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==i&&(a=c)}),a){let l=(0,Vo.dirname)(a),c=(0,Vo.dirname)(i);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[i])=>i.length-s.length).forEach(([s,i])=>{r.has(s)||(this.moveFolder(s,i),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((i,a)=>{(a===t||a.startsWith(t+Vo.sep))&&n.set(a,i)}),this.overlay.forEach((i,a)=>{(a===t||a.startsWith(t+Vo.sep))&&n.set(a,i)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((i,a)=>{if(a===t)return;let l=a.slice(t.length),c=r+l;this.move(a,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var a;if(this.assertVPath(r),((a=this.meta.get(r))==null?void 0:a.id)===t)return;let n=new Set,s=r.split(Vo.sep),i="";for(let l=0;l<s.length-1;l++)i=s.slice(0,l+1).join(Vo.sep),n.add(i);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,_a(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=di();console.log("creating folder path",l,c),this.overlay.set(l,Ic(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function Iv(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...i){return i.length>0&&typeof i[0]=="string"&&(i[0]=t(i[0],e)),s.apply(r,i)}:s}})}var Tc=class extends st{constructor(t){super();this.sharedFolder=t;let r=t.loginManager.getEndpointManager().getAuthUrl();this.pb=new ps(r,t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),r,t.mimetype,0);return(await mt(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),r,t.mimetype,0),s=await mt(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let a=(await s.json()).downloadUrl;return(await mt(a)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),n,t.mimetype,r.byteLength),i=await mt(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),a=await i.json();if(i.status!==200)throw new Error(a.error);let l=a.uploadUrl;await mt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var Sp=class extends Dn{constructor(){super(...arguments);this.notifyListeners=(0,ct.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},Fc=class extends cn{constructor(t,r,n,s,i,a,l,c,f,u,d,p,m=!0){var g;let y=p?new an(p,r):new oo(r);super(r,y,l,s);this.appId=t;this.hashStore=f;this.backgroundSync=u;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let i=this.getVirtualPath(s.path),a=n.contains(i),l=this.getFile(s,!1);if(l){r.push(l);return}if(s instanceof ct.TFolder){let c=this.getSyncFolder(i,!1);r.push(c);return}if(Rt.checkExtension(i)){if(a){let c=this.uploadDoc(i,!1);r.push(c)}else{let c=this.getDoc(i,!1);r.push(c)}return}if(Nt.checkExtension(i))if(a){if(ze().enableCanvasSync){let c=this.uploadCanvas(i,!1);r.push(c);return}}else{let c=this.getFile(s,!1);if(c){r.push(c);return}}if(this.syncStore.canSync(i))if(a){let c=this.uploadSyncFile(i,!1);r.push(c)}else{let c=this.syncFile(i,!1);r.push(c)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=a,this.vault=i,this.files=new Map,this.fset=new Sp,this.pendingUpload=new sn(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((I,L)=>{this.existsSync(L)||(this.warn("deleting pending upload record because file is missing",L,I),this.pendingUpload.delete(L))}),this.relayManager=c,this.relayId=p,this.diskBufferStore=new mc,this._shouldConnect=(g=this.settings.connect)!=null?g:!0,this.authoritative=!m,this.syncSettingsManager=this._settings.getChild("sync",(I,L)=>new mi(I,L)),this.syncStore=new Ec(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(I=>{this.remote=I.find(L=>L.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async I=>{let L=I.find(C=>{var w;return C.id===((w=this._remote)==null?void 0:w.relay.storageQuotaId)});L!==void 0&&this.storageQuota!==L.quota&&(this.storageQuota!==void 0&&L.quota!==void 0&&L.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,L.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,L.quota),this.storageQuota=L.quota)})),this.proxy=Iv(this,this.path,I=>this.getVirtualPath(I));try{this._persistence=new Tn(this.guid,this.ydoc)}catch(I){throw this.warn("Unable to open persistence.",this.guid),console.error(I),I}s.loggedIn&&this.connect(),this.cas=new Tc(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(I){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Zt.set(this,this.path),this.setupEventSubscriptions()}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof cn&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var i;return((i=s.token)==null?void 0:i.folder)===this.guid}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ct.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n);if(t instanceof ct.TFolder)return r&&s;let i=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&i}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ct.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return ct.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof an&&(this.connected||this.shouldConnect)?super.connect().then(t=>(t&&this.setupEventSubscriptions(),t)):Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new an(this.relayId,this.guid):new oo(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._persistence.hasServerSync||this.synced)}async markSynced(){await this._persistence.markServerSynced()}async getServerSynced(){return this._persistence.getServerSynced()}hasLocalDB(){return this._persistence.hasUserData()}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new vo(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",()=>{this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new vo(t,()=>(this._persistence.synced&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof ct.TFile){let i=(0,Nr.dirname)(r);this.existsSync(i)||(await this.mkdir(i),s==null||s.push(`creating directory ${i}`))}await this.fileManager.renameFile(n,(0,ct.normalizePath)(this.getPath(r))).then(()=>{t.move(r,this)})}async _handleServerCreate(t,r,n){let s=(0,Nr.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let i=this.files.get(t),a=this.syncStore.getMeta(r);if(!a)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r)){if(i&&Er(i)&&vv(a)){let c=this._upgradeToCanvas(i,t,r,s);return{op:"upgrade",path:r,promise:c}}if(i&&Er(i)&&i.shouldPull(a))return{op:"update",path:r,promise:i.pull()};if(!i&&wv(a)){let c=this.syncStore.get(r),f=c?this.files.get(c):null;if(c&&f&&Er(f)){let u=this.remapIfHashMatches(f,c,t,r,a);return{op:"update",path:r,promise:u}}}return{op:"noop",path:r,promise:Promise.resolve()}}if(n.has(t)&&i){let c=this.getPath(i.path),f=this.vault.getAbstractFileByPath(c);if(f){let u=this._handleServerRename(i,r,f,s);return{op:"rename",path:r,from:c,to:r,promise:u}}}let l=this._handleServerCreate(r,a,s);return{op:"create",path:r,promise:l}}async remapIfHashMatches(t,r,n,s,i){try{await t.caf.hash()===i.hash&&(this.files.delete(r),this.pendingUpload.delete(s),this.files.set(n,t),t.guid=n,this.log(`Remapped file ${s} from local GUID ${r} to remote GUID ${n}`))}catch(a){throw this.error("Error during GUID remapping:",a),a}}async _upgradeToCanvas(t,r,n,s){try{let i=t.guid;this.files.delete(i),this.fset.delete(t),t.destroy(),s==null||s.push(`Upgrading ${n} from SyncFile to Canvas`),this.log(`Upgrading ${n} from SyncFile to Canvas (GUID: ${i} \u2192 ${r})`),await this.downloadCanvas(n,!1),this.log(`Successfully upgraded ${n} to Canvas`)}catch(i){throw this.error("Error during SyncFile to Canvas upgrade:",i),i}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],i=n.filter(c=>c instanceof ct.TFolder),a=n.filter(c=>c instanceof ct.TFile),l=c=>{var g,I;let f=this.isSyncableTFile(c),u=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),p=this.pendingUpload.has(this.getVirtualPath(c.path)),m=this.getVirtualPath(c.path),y=((g=this._provider)==null?void 0:g.synced)&&((I=this._persistence)==null?void 0:I.synced);if(u&&f&&!d&&!p&&y){r.push(`deleted local file ${m} for remotely deleted doc`);let L=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:m,promise:L})}};return a.forEach(l),i.forEach(l),s}syncByType(t,r,n,s){t.forEach((i,a)=>{this._assertNamespacing(a),s.contains(i.type)&&(this._assertNamespacing(a),n.push(this.applyRemoteState(i.id,a,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(f=>f.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let i=n.filter(f=>f.op==="create"),a=n.filter(f=>f.op==="rename"),l=n.map(f=>f.path);await Promise.all([...i,...a].map(f=>mv(f.promise,f)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(f=>f.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(a.length>0||i.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new hc(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Nr.join)(this.path,t.path);return this.vault.adapter.read((0,ct.normalizePath)(r))}existsSync(t){let r=(0,ct.normalizePath)((0,Nr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Nr.join)(this.path,t.path);return this.vault.adapter.exists((0,ct.normalizePath)(r))}flush(t,r){let n=(0,Nr.join)(this.path,t.path);return this.log("writing to ",(0,ct.normalizePath)(n)),this.vault.adapter.write((0,ct.normalizePath)(n),r)}getPath(t){return(0,Nr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Nr.join)(this.path,t);return this.vault.adapter.mkdir((0,ct.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Nr.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof ct.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!wo(s))throw new Error("getDoc(): unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof ct.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!un(s))throw new Error("getCanvas(): unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof ct.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(wo(t)){let n=_a(t.guid);r(t,n);return}if(un(t)){let n=_v(t.guid);r(t,n);return}if(_p(t)){let n=Ic(t.guid);r(t,n);return}if(Er(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let i=Sv(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,i);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let i=this.files.get(s);if(i)return i;let a=this.syncStore.getMeta(n);if(a){if(a.type==="markdown")return this.getDoc(n);if(a.type==="canvas")return this.getCanvas(n);if(a.type==="folder")return this.getSyncFolder(n,r);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}}if(t instanceof ct.TFolder)return this.getSyncFolder(n,r);if(t instanceof ct.TFile){if(Rt.checkExtension(n))return this.getDoc(n);if(Nt.checkExtension(n)&&ze().enableCanvasSync)return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new Nt(r,t,this.loginManager,this);if(!un(n))throw new Error("getOrCreateCanvas(): unexpected ifile type");return n.move(r,this),n}async downloadCanvas(t,r=!0){if(!Nt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!Nt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),i,a]);!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!Nt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let i=await s.getServerSynced();s.stat.size===0&&!i?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!wo(n))throw new Error("viewDoc(): unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!n){this.debug(`viewSyncFile(): file not loaded yet, guid=${r}, vpath=${t}`);return}if(!Er(n)){this.debug(`viewSyncFile(): file exists but is not SyncFile, guid=${r}, vpath=${t}, actual type=${n.constructor.name}`);return}return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new Rt(r,t,this.loginManager,this);if(!wo(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadDoc(t,r=!0){if(!Rt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!Rt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),i,a]),d=s.ydoc.getText("contents");!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!Rt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var a;let i=await s.getServerSynced();((a=s.tfile)==null?void 0:a.stat.size)===0&&!i?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new hi(r,t,this);if(!_p(n))throw new Error("unexpected ifile type");return n.move(r,this),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new On(r,t,this.hashStore,this);if(!Er(s))throw new Error(`getOrCreateSyncFile(): unexpected ifile type, guid=${t}`);return s.move(r,this),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(i),this.files.set(n,i),this.fset.add(i,r),i}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(i),this.files.set(n,i),this.fset.add(i,r),i}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof ct.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(i),this.fset.add(i,r),i}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof ct.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?i.pull():(this.log("get syncfile missing meta"),i.push()),this.files.set(n,i),this.fset.add(i,r),i}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof ct.TFolder)return this.getSyncFolder(n,r);if(t instanceof ct.TFile){if(Rt.checkExtension(n))return this.uploadDoc(n,r);if(Nt.checkExtension(n)&&ze().enableCanvasSync)return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){var n;let r=(n=this.syncStore)==null?void 0:n.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",i="";try{s=this.getVirtualPath(n)}catch(a){this.log("Moving out of shared folder")}try{i=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!s&&!i))if(i){let a=this.syncStore.get(i);if(!a)return;let l=this.files.get(a);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(i)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(a);else{if(!this.syncStore.get(i))return;let f=[];l instanceof hi&&this.syncStore.forEach((u,d)=>{if(d.startsWith(i+Nr.sep)){let p=d.replace(i,s);f.push([u.id,d,p])}}),this.ydoc.transact(()=>{this.syncStore.move(i,s),l&&l.move(s,this),f.forEach(u=>{let[d,p,m]=u;this.syncStore.move(p,m);let y=this.files.get(d);y&&y.move(m,this)})},this),this.syncStore.resolveMove(i)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}setupEventSubscriptions(){this._provider&&this._provider.wsconnected&&(this._provider.subscribeToEvents(["document.updated"],this.handleDocumentUpdateEvent.bind(this)),this.debug("Subscribed to document.updated events"))}handleDocumentUpdateEvent(t){this.debug("Document update event received:",{eventId:t.event_id,docId:t.doc_id,timestamp:new Date(Number(t.timestamp)).toISOString(),user:t.user,updateSize:t.update?t.update.length:0});let r=this.files.get(t.doc_id);r?this.debug(`Document ${r.path} received remote update`):this.debug(`Received update for unknown document ${t.doc_id}`)}destroy(){var t,r,n;this.destroyed=!0,this._provider&&this._provider.unsubscribeFromEvents(["document.updated"]),this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},Pc=class extends Dn{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,ct.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(i=>{let a=!1;this.items().forEach(l=>{let c=i.find(f=>f.guid==l.guid);l.remote!=c&&(a=!0),l.remote=c}),a&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}get manager(){return this.relayManager}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let i=this.find(f=>f.path==t&&f.guid==r);if(i)return i;let a=this.find(f=>f.guid==r);if(a)throw new Error(`This folder is already mounted at ${a.path}.`);if(this.find(f=>f.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let i=this._new(t,r,n,s);return this.notifyListeners(),i}};var ff=require("@codemirror/state"),OG=require("@codemirror/view"),Jt=require("obsidian");function z(){}function ge(o,e){for(let t in e)o[t]=e[t];return o}function Cv(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function kp(o){return o()}function Rc(){return Object.create(null)}function xe(o){o.forEach(kp)}function nt(o){return typeof o=="function"}function X(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Ac;function Tr(o,e){return o===e?!0:(Ac||(Ac=document.createElement("a")),Ac.href=e,o===Ac.href)}function Lv(o){return Object.keys(o).length===0}function Ht(o,...e){if(o==null){for(let r of e)r(void 0);return z}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function No(o){let e;return Ht(o,t=>e=t)(),e}function de(o,e,t){o.$$.on_destroy.push(Ht(e,t))}function ke(o,e,t,r){if(o){let n=Ev(o,e,t,r);return o[0](n)}}function Ev(o,e,t,r){return o[1]&&r?ge(t.ctx.slice(),o[1](r(e))):t.ctx}function Ie(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],i=Math.max(e.dirty.length,n.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|n[a];return s}return e.dirty|n}return e.dirty}function Ce(o,e,t,r,n,s){if(n){let i=Ev(e,t,r,s);o.p(i,n)}}function Le(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Pe(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Ip(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Fr(o){return o==null?"":o}function gi(o,e,t){return o.set(t),e}function hs(o){return o&&nt(o.destroy)?o.destroy:z}var Cp=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Mc=class o{constructor(e){Et(this,"_listeners","WeakMap"in Cp?new WeakMap:void 0);Et(this,"_observer");Et(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)o.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Mc.entries="WeakMap"in Cp?new WeakMap:void 0;var Tv=!1;function Fv(){Tv=!0}function Pv(){Tv=!1}function b(o,e){o.appendChild(e)}function Ee(o,e,t){let r=Av(o);if(!r.getElementById(e)){let n=x("style");n.id=e,n.textContent=t,ZC(r,n)}}function Av(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function ZC(o,e){return b(o.head||o,e),e.sheet}function S(o,e,t){o.insertBefore(e,t||null)}function _(o){o.parentNode&&o.parentNode.removeChild(o)}function Je(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function x(o){return document.createElement(o)}function ir(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function K(o){return document.createTextNode(o)}function T(){return K(" ")}function ve(){return K("")}function j(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function Dc(o){return function(e){return e.preventDefault(),o.call(this,e)}}function Uc(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}var e2=["width","height"];function t2(o,e){let t=Object.getOwnPropertyDescriptors(o.__proto__);for(let r in e)e[r]==null?o.removeAttribute(r):r==="style"?o.style.cssText=e[r]:r==="__value"?o.value=o[r]=e[r]:t[r]&&t[r].set&&e2.indexOf(r)===-1?o[r]=e[r]:h(o,r,e[r])}function ka(o,e){for(let t in e)h(o,t,e[t])}function r2(o,e){Object.keys(e).forEach(t=>{o2(o,t,e[t])})}function o2(o,e,t){let r=e.toLowerCase();r in o?o[r]=typeof o[r]=="boolean"&&t===""?!0:t:e in o?o[e]=typeof o[e]=="boolean"&&t===""?!0:t:h(o,e,t)}function Rv(o){return/-/.test(o)?r2:t2}function Mv(o){return Array.from(o.childNodes)}function te(o,e){e=""+e,o.data!==e&&(o.data=e)}function Ke(o,e){o.value=e==null?"":e}function le(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Bn(o,e,t){for(let r=0;r<o.options.length;r+=1){let n=o.options[r];if(n.__value===e){n.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Te(o,e,t){o.classList.toggle(e,!!t)}function Oc(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var $n=class{constructor(e=!1){Et(this,"is_svg",!1);Et(this,"e");Et(this,"n");Et(this,"t");Et(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=ir(t.nodeName):this.e=x(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)S(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(_)}};function Dv(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function yi(o,e){return new o(e)}var Vn;function Hr(o){Vn=o}function Ia(){if(!Vn)throw new Error("Function called outside component initialization");return Vn}function dt(o){Ia().$$.on_mount.push(o)}function dn(o){Ia().$$.on_destroy.push(o)}function it(){let o=Ia();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=Oc(e,t,{cancelable:r});return n.slice().forEach(i=>{i.call(o,s)}),!s.defaultPrevented}return!0}}function Pr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var gs=[];var vt=[],vi=[],Tp=[],Uv=Promise.resolve(),Fp=!1;function Pp(){Fp||(Fp=!0,Uv.then(La))}function Ap(){return Pp(),Uv}function Ca(o){vi.push(o)}function $c(o){Tp.push(o)}var Ep=new Set,bi=0;function La(){if(bi!==0)return;let o=Vn;do{try{for(;bi<gs.length;){let e=gs[bi];bi++,Hr(e),l2(e.$$)}}catch(e){throw gs.length=0,bi=0,e}for(Hr(null),gs.length=0,bi=0;vt.length;)vt.pop()();for(let e=0;e<vi.length;e+=1){let t=vi[e];Ep.has(t)||(Ep.add(t),t())}vi.length=0}while(gs.length);for(;Tp.length;)Tp.pop()();Fp=!1,Ep.clear(),Hr(o)}function l2(o){if(o.fragment!==null){o.update(),xe(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Ca)}}function Ov(o){let e=[],t=[];vi.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),vi=e}var Bc=new Set,ys;function ce(){ys={r:0,c:[],p:ys}}function fe(){ys.r||xe(ys.c),ys=ys.p}function v(o,e){o&&o.i&&(Bc.delete(o),o.i(e))}function k(o,e,t,r){if(o&&o.o){if(Bc.has(o))return;Bc.add(o),ys.c.push(()=>{Bc.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function xi(o,e){let t=e.token={};function r(n,s,i,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=a);let c=n&&(e.current=n)(l),f=!1;e.block&&(e.blocks?e.blocks.forEach((u,d)=>{d!==s&&u&&(ce(),k(u,1,1,()=>{e.blocks[d]===u&&(e.blocks[d]=null)}),fe())}):e.block.d(1),c.c(),v(c,1),c.m(e.mount(),e.anchor),f=!0),e.block=c,e.blocks&&(e.blocks[s]=c),f&&La()}if(Cv(o)){let n=Ia();if(o.then(s=>{Hr(n),r(e.then,1,e.value,s),Hr(null)},s=>{if(Hr(n),r(e.catch,2,e.error,s),Hr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function Vc(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function Se(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Nc(o,e){o.d(1),e.delete(o.key)}function Ea(o,e){k(o,1,1,()=>{e.delete(o.key)})}function pn(o,e,t,r,n,s,i,a,l,c,f,u){let d=o.length,p=s.length,m=d,y={};for(;m--;)y[o[m].key]=m;let g=[],I=new Map,L=new Map,C=[];for(m=p;m--;){let U=u(n,s,m),V=t(U),P=i.get(V);P?r&&C.push(()=>P.p(U,e)):(P=c(V,U),P.c()),I.set(V,g[m]=P),V in y&&L.set(V,Math.abs(m-y[V]))}let w=new Set,E=new Set;function F(U){v(U,1),U.m(a,f),i.set(U.key,U),f=U.first,p--}for(;d&&p;){let U=g[p-1],V=o[d-1],P=U.key,$=V.key;U===V?(f=U.first,d--,p--):I.has($)?!i.has(P)||w.has(P)?F(U):E.has($)?d--:L.get(P)>L.get($)?(E.add(P),F(U)):(w.add($),d--):(l(V,i),d--)}for(;d--;){let U=o[d];I.has(U.key)||l(U,i)}for(;p;)F(g[p-1]);return xe(C),g}function Ne(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let i=o[s],a=e[s];if(a){for(let l in i)l in a||(r[l]=1);for(let l in a)n[l]||(t[l]=a[l],n[l]=1);o[s]=a}else for(let l in i)n[l]=1}for(let i in r)i in t||(t[i]=void 0);return t}function We(o){return typeof o=="object"&&o!==null?o:{}}var c2=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],f2=new Set([...c2]);function Hc(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function D(o){o&&o.c()}function A(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),Ca(()=>{let s=o.$$.on_mount.map(kp).filter(nt);o.$$.on_destroy?o.$$.on_destroy.push(...s):xe(s),o.$$.on_mount=[]}),n.forEach(Ca)}function R(o,e){let t=o.$$;t.fragment!==null&&(Ov(t.after_update),xe(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function d2(o,e){o.$$.dirty[0]===-1&&(gs.push(o),Pp(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ee(o,e,t,r,n,s,i=null,a=[-1]){let l=Vn;Hr(o);let c=o.$$={fragment:null,ctx:[],props:s,update:z,not_equal:n,bound:Rc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Rc(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let f=!1;if(c.ctx=t?t(o,e.props||{},(u,d,...p)=>{let m=p.length?p[0]:d;return c.ctx&&n(c.ctx[u],c.ctx[u]=m)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](m),f&&d2(o,u)),d}):[],c.update(),f=!0,xe(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){Fv();let u=Mv(e.target);c.fragment&&c.fragment.l(u),u.forEach(_)}else c.fragment&&c.fragment.c();e.intro&&v(o.$$.fragment),A(o,e.target,e.anchor),Pv(),La()}Hr(l)}var p2;typeof HTMLElement=="function"&&(p2=class extends HTMLElement{constructor(e,t,r){super();Et(this,"$$ctor");Et(this,"$$s");Et(this,"$$c");Et(this,"$$cn",!1);Et(this,"$$d",{});Et(this,"$$r",!1);Et(this,"$$p_d",{});Et(this,"$$l",{});Et(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let i;return{c:function(){i=x("slot"),s!=="default"&&h(i,"name",s)},m:function(c,f){S(c,i,f)},d:function(c){c&&_(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=Dv(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=Rp(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=Rp(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let i of this.$$l[s]){let a=this.$$c.$on(s,i);this.$$l_u.set(i,a)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Rp(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Rp(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Z=class{constructor(){Et(this,"$$");Et(this,"$$set")}$destroy(){R(this,1),this.$destroy=z}$on(e,t){if(!nt(t))return z;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!Lv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");var h2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Mp=h2;function $v(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Dp(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=ge(r,t[n]);return{c(){e=ir(o[11]),ka(e,r)},m(n,s){S(n,e,s)},p(n,s){ka(e,r=Ne(t,[s&32&&n[12]]))},d(n){n&&_(e)}}}function Bv(o){let e=o[11],t,r=o[11]&&Dp(o);return{c(){r&&r.c(),t=ve()},m(n,s){r&&r.m(n,s),S(n,t,s)},p(n,s){n[11]?e?X(e,n[11])?(r.d(1),r=Dp(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=Dp(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&_(t),r&&r.d(n)}}}function g2(o){let e,t,r,n,s,i=Se(o[5]),a=[];for(let d=0;d<i.length;d+=1)a[d]=Bv($v(o,i,d));let l=o[10].default,c=ke(l,o,o[9],null),f=[Mp,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],u={};for(let d=0;d<f.length;d+=1)u=ge(u,f[d]);return{c(){e=ir("svg");for(let d=0;d<a.length;d+=1)a[d].c();t=ve(),c&&c.c(),ka(e,u)},m(d,p){S(d,e,p);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(e,null);b(e,t),c&&c.m(e,null),s=!0},p(d,[p]){if(p&32){i=Se(d[5]);let m;for(m=0;m<i.length;m+=1){let y=$v(d,i,m);a[m]?a[m].p(y,p):(a[m]=Bv(y),a[m].c(),a[m].m(e,t))}for(;m<a.length;m+=1)a[m].d(1);a.length=i.length}c&&c.p&&(!s||p&512)&&Ce(c,l,d,d[9],s?Ie(l,d[9],p,null):Le(d[9]),null),ka(e,u=Ne(f,[Mp,p&128&&d[7],(!s||p&4)&&{width:d[2]},(!s||p&4)&&{height:d[2]},(!s||p&2)&&{stroke:d[1]},(!s||p&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||p&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(v(c,d),s=!0)},o(d){k(c,d),s=!1},d(d){d&&_(e),Je(a,d),c&&c.d(d)}}}function y2(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=Ip(e,r),{$$slots:s={},$$scope:i}=e,{name:a=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:f=2}=e,{absoluteStrokeWidth:u=!1}=e,{iconNode:d}=e,p=(...m)=>m.filter((y,g,I)=>!!y&&I.indexOf(y)===g).join(" ");return o.$$set=m=>{t(8,e=ge(ge({},e),Pe(m))),t(7,n=Ip(e,r)),"name"in m&&t(0,a=m.name),"color"in m&&t(1,l=m.color),"size"in m&&t(2,c=m.size),"strokeWidth"in m&&t(3,f=m.strokeWidth),"absoluteStrokeWidth"in m&&t(4,u=m.absoluteStrokeWidth),"iconNode"in m&&t(5,d=m.iconNode),"$$scope"in m&&t(9,i=m.$$scope)},e=Pe(e),[a,l,c,f,u,d,p,n,e,i,s]}var Up=class extends Z{constructor(e){super(),ee(this,e,y2,g2,X,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},je=Up;function b2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function v2(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[b2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function x2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Op=class extends Z{constructor(e){super(),ee(this,e,x2,v2,X,{})}},$p=Op;function w2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function _2(o){let e,t,r=[{name:"arrow-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[w2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function S2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Bp=class extends Z{constructor(e){super(),ee(this,e,S2,_2,X,{})}},Vp=Bp;function k2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function I2(o){let e,t,r=[{name:"check"},o[1],{iconNode:o[0]}],n={$$slots:{default:[k2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function C2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 6 9 17l-5-5"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Np=class extends Z{constructor(e){super(),ee(this,e,C2,I2,X,{})}},Ta=Np;function L2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function E2(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[L2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function T2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Hp=class extends Z{constructor(e){super(),ee(this,e,T2,E2,X,{})}},qp=Hp;function F2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function P2(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[F2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function A2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Wp=class extends Z{constructor(e){super(),ee(this,e,A2,P2,X,{})}},jp=Wp;function R2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function M2(o){let e,t,r=[{name:"circle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[R2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function D2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var zp=class extends Z{constructor(e){super(),ee(this,e,D2,M2,X,{})}},Kp=zp;function U2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function O2(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[U2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function $2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Gp=class extends Z{constructor(e){super(),ee(this,e,$2,O2,X,{})}},Jp=Gp;function B2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function V2(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[B2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function N2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Qp=class extends Z{constructor(e){super(),ee(this,e,N2,V2,X,{})}},Fa=Qp;function H2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function q2(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[H2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function W2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Yp=class extends Z{constructor(e){super(),ee(this,e,W2,q2,X,{})}},Xp=Yp;function j2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function z2(o){let e,t,r=[{name:"folder-lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[j2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function K2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var Zp=class extends Z{constructor(e){super(),ee(this,e,K2,z2,X,{})}},bs=Zp;function G2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function J2(o){let e,t,r=[{name:"folder-open"},o[1],{iconNode:o[0]}],n={$$slots:{default:[G2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function Q2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var em=class extends Z{constructor(e){super(),ee(this,e,Q2,J2,X,{})}},tm=em;function Y2(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function X2(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Y2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function Z2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var rm=class extends Z{constructor(e){super(),ee(this,e,Z2,X2,X,{})}},Ho=rm;function eL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function tL(o){let e,t,r=[{name:"home"},o[1],{iconNode:o[0]}],n={$$slots:{default:[eL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function rL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}],["polyline",{points:"9 22 9 12 15 12 15 22"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var om=class extends Z{constructor(e){super(),ee(this,e,rL,tL,X,{})}},nm=om;function oL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function nL(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[oL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function sL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var sm=class extends Z{constructor(e){super(),ee(this,e,sL,nL,X,{})}},im=sm;function iL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function aL(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[iL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function lL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var am=class extends Z{constructor(e){super(),ee(this,e,lL,aL,X,{})}},_o=am;function cL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function fL(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[cL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function uL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var lm=class extends Z{constructor(e){super(),ee(this,e,uL,fL,X,{})}},cm=lm;function dL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function pL(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[dL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function mL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var fm=class extends Z{constructor(e){super(),ee(this,e,mL,pL,X,{})}},um=fm;function hL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function gL(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[hL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function yL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var dm=class extends Z{constructor(e){super(),ee(this,e,yL,gL,X,{})}},mn=dm;function bL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function vL(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[bL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function xL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var pm=class extends Z{constructor(e){super(),ee(this,e,xL,vL,X,{})}},mm=pm;function wL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function _L(o){let e,t,r=[{name:"square-pen"},o[1],{iconNode:o[0]}],n={$$slots:{default:[wL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function SL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var hm=class extends Z{constructor(e){super(),ee(this,e,SL,_L,X,{})}},Pa=hm;function kL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function IL(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[kL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function CL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var gm=class extends Z{constructor(e){super(),ee(this,e,CL,IL,X,{})}},ym=gm;function LL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function EL(o){let e,t,r=[{name:"user-round-x"},o[1],{iconNode:o[0]}],n={$$slots:{default:[LL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function TL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M2 21a8 8 0 0 1 11.873-7"}],["circle",{cx:"10",cy:"8",r:"5"}],["path",{d:"m17 17 5 5"}],["path",{d:"m22 17-5 5"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var bm=class extends Z{constructor(e){super(),ee(this,e,TL,EL,X,{})}},vm=bm;function FL(o){let e,t=o[2].default,r=ke(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&Ce(r,t,n,n[3],e?Ie(t,n[3],s,null):Le(n[3]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function PL(o){let e,t,r=[{name:"x"},o[1],{iconNode:o[0]}],n={$$slots:{default:[FL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ge(n,r[s]);return e=new je({props:n}),{c(){D(e.$$.fragment)},m(s,i){A(e,s,i),t=!0},p(s,[i]){let a=i&3?Ne(r,[r[0],i&2&&We(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function AL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return o.$$set=i=>{t(1,e=ge(ge({},e),Pe(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Pe(e),[s,e,r,n]}var xm=class extends Z{constructor(e){super(),ee(this,e,AL,PL,X,{})}},wm=xm;function RL(o){Ee(o,"svelte-cpi6rl","button.notebook.svelte-cpi6rl{color:var(--color-base-40);background-color:transparent}button.notebook-synced.svelte-cpi6rl{color:var(--color-accent)}button.system3-connected.svelte-cpi6rl{color:var(--color-accent)}button.system3-disconnected.svelte-cpi6rl{color:var(--color-base-40)}")}function ML(o){let e,t,r,n,s,i;return t=new _o({props:{class:"svg-icon inline-icon"}}),{c(){var a;e=x("button"),D(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-cpi6rl"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(a=o[0].view.file)==null?void 0:a.name)},m(a,l){S(a,e,l),A(t,e,null),i=!0},p(a,l){var c;(!i||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(a[0].tracking?"notebook-synced":"notebook")+" svelte-cpi6rl"))&&h(e,"class",r),(!i||l&1&&n!==(n=a[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!i||l&1&&s!==(s=(c=a[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(a){i||(v(t.$$.fragment,a),i=!0)},o(a){k(t.$$.fragment,a),i=!1},d(a){a&&_(e),R(t)}}}function DL(o){let e,t,r,n,s,i,a,l,c,f,u,d,p;return t=new _o({props:{class:"svg-icon inline-icon"}}),l=new mn({props:{class:"svg-icon inline-icon"}}),{c(){var m;e=x("button"),D(t.$$.fragment),i=T(),a=x("button"),D(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-cpi6rl"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(m=o[0].view.file)==null?void 0:m.name),h(a,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-cpi6rl"),h(a,"aria-label",f=`${o[2].relay.name} (${o[1].status})`),h(a,"tabindex","0")},m(m,y){S(m,e,y),A(t,e,null),S(m,i,y),S(m,a,y),A(l,a,null),u=!0,d||(p=[j(a,"click",o[4]),j(a,"keypress",o[5])],d=!0)},p(m,y){var g;(!u||y&1&&r!==(r="clickable-icon view-action system3-view-action "+(m[0].tracking?"notebook-synced":"notebook")+" svelte-cpi6rl"))&&h(e,"class",r),(!u||y&1&&n!==(n=m[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!u||y&1&&s!==(s=(g=m[0].view.file)==null?void 0:g.name))&&h(e,"data-filename",s),(!u||y&2&&c!==(c="system3-"+m[1].status+" clickable-icon view-action system3-view-action svelte-cpi6rl"))&&h(a,"class",c),(!u||y&6&&f!==(f=`${m[2].relay.name} (${m[1].status})`))&&h(a,"aria-label",f)},i(m){u||(v(t.$$.fragment,m),v(l.$$.fragment,m),u=!0)},o(m){k(t.$$.fragment,m),k(l.$$.fragment,m),u=!1},d(m){m&&(_(e),_(i),_(a)),R(t),R(l),d=!1,xe(p)}}}function UL(o){let e,t,r,n,s;return t=new vm({props:{class:"svg-icon inline-icon"}}),{c(){e=x("button"),D(t.$$.fragment),h(e,"class","clickable-icon view-action system3-view-action mod-warning"),h(e,"aria-label","Login to enable Live edits"),h(e,"tabindex","0")},m(i,a){S(i,e,a),A(t,e,null),r=!0,n||(s=[j(e,"click",o[4]),j(e,"keypress",o[5])],n=!0)},p:z,i(i){r||(v(t.$$.fragment,i),r=!0)},o(i){k(t.$$.fragment,i),r=!1},d(i){i&&_(e),R(t),n=!1,xe(s)}}}function OL(o){let e,t,r,n,s=[UL,DL,ML],i=[];function a(l,c){return l[3]?0:l[2]?1:2}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,[c]){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r))},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function $L(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,{isLoggedOut:i=!1}=e,{onLogin:a=void 0}=e,l={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},c=()=>{i&&a?a():r.toggleConnection()},f=u=>{u.key==="Enter"&&c()};return o.$$set=u=>{"view"in u&&t(0,r=u.view),"state"in u&&t(1,n=u.state),"remote"in u&&t(2,s=u.remote),"isLoggedOut"in u&&t(3,i=u.isLoggedOut),"onLogin"in u&&t(6,a=u.onLogin)},[r,n,s,i,c,f,a]}var _m=class extends Z{constructor(e){super(),ee(this,e,$L,OL,X,{view:0,state:1,remote:2,isLoggedOut:3,onLogin:6},RL)}},Sm=_m;var Vv=require("obsidian");var km=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Re("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Vv.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"2336be2"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{var t;if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,(t=this.onOffline)==null||t.forEach(r=>r(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Nv=km;var VW=require("obsidian"),vs=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),this.onClick=async()=>!0,!0}};var Gc=require("@codemirror/state"),Wv=require("@codemirror/view");function Hv(o,e){let t=Object.keys(e).map(r=>BL(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function BL(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},i=t(s);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(a,i),o[e]=a,l;function a(...c){return i===s&&o[e]===a&&l(),i.apply(this,c)}function l(){o[e]===a&&(n?o[e]=s:delete o[e]),i!==s&&(i=s,Object.setPrototypeOf(a,r||Function))}}var qo=class qo extends st{constructor(){super("Patcher");this.unsubscribes=[];this.patchedMethods=new WeakMap;typeof window!="undefined"&&(window.relayPatches&&window.relayPatches.length>0&&console.warn(`Found ${window.relayPatches.length} existing unsubscribers on window.relayPatches at startup - possible memory leak or incomplete cleanup`),window.relayPatches=[])}static getInstance(){return qo.instance||(qo.instance=new qo),qo.instance}patch(t,r){var f,u;let n=this.patchedMethods.get(t)||new Set,s=Object.keys(r),i=s.filter(d=>n.has(d));if(i.length>0){this.warn(`Methods [${i.join(", ")}] already patched on ${(f=t.constructor)==null?void 0:f.name}, skipping duplicates`);let d={};if(s.filter(p=>!i.includes(p)).forEach(p=>d[p]=r[p]),Object.keys(d).length===0)return this.debug("All methods conflicted, returning no-op unsubscriber"),()=>{};r=d}let a=new Set([...n,...Object.keys(r)]);this.patchedMethods.set(t,a);let l=Hv(t,r);return this.unsubscribes.push(l),typeof window!="undefined"&&window.relayPatches&&window.relayPatches.push(l),this.debug("Applied monkeypatch",{target:(u=t.constructor)==null?void 0:u.name,methods:Object.keys(r),patchCount:this.unsubscribes.length}),()=>{Object.keys(r).forEach(p=>a.delete(p)),a.size===0&&this.patchedMethods.delete(t);let d=this.unsubscribes.indexOf(l);if(d>=0&&this.unsubscribes.splice(d,1),typeof window!="undefined"&&window.relayPatches){let p=window.relayPatches.indexOf(l);p>=0&&window.relayPatches.splice(p,1)}l()}}getCount(){return this.unsubscribes.length}cleanup(){let t=this.unsubscribes.length;this.debug("Starting cleanup of monkeypatches",{count:t}),this.unsubscribes.forEach((r,n)=>{try{r(),this.debug("Cleaned up monkeypatch",{index:n+1,total:t})}catch(s){this.error("Error during monkeypatch cleanup",{index:n+1,error:s})}}),this.unsubscribes.length=0,typeof window!="undefined"&&window.relayPatches&&(window.relayPatches.length=0),this.log("Completed cleanup of monkeypatches",{cleanedCount:t})}static destroy(){qo.instance&&(qo.instance.cleanup(),qo.instance=null),typeof window!="undefined"&&window.relayPatches&&(window.relayPatches.length=0)}hasRegisteredPatches(){return this.unsubscribes.length>0}};qo.instance=null;var Aa=qo,Ar=()=>Aa.getInstance();var jv=Qo(gc());var zv=require("obsidian");var qc=class{constructor(e,t,r,n){this.containerEl=e;this.before=t;this.text=r,this.onClick=n,this.display()}display(){if(!this.containerEl||!this.before)return!0;let e=this.containerEl,t=this.before;if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var Gj=require("obsidian");var Dj=require("obsidian");var Wc=class extends st{constructor(t){var r;super();this.destroyed=!1;this.view=t,this.setLoggers(`[PreviewRenderer][${(r=t.file)==null?void 0:r.path}]`),this.debug("created")}render(t,r){var n,s;if(this.destroyed){this.debug("Skipping render - renderer destroyed");return}if(!ze().enablePreviewViewHooks){this.debug("Preview view hooks disabled via flags");return}if(r!=="preview"){this.debug("Skipping render - not in preview mode");return}try{this.debug("Rendering preview from document"),this.view.text=t.text,this.view.previewMode.renderer.set(t.text),(s=(n=this.view).onInternalDataChange)==null||s.call(n),this.debug("Preview render completed")}catch(i){this.error("Error rendering preview:",i)}}destroy(){this.destroyed=!0,this.debug("destroyed"),this.view=null}};var qv=Qo(gc());var zc=require("obsidian");var jc=class extends st{constructor(t){var r;super();this.destroyed=!1;this.view=t,this.setLoggers(`[MetadataRenderer][${(r=t.file)==null?void 0:r.path}]`),this.debug("created")}render(t,r){if(this.destroyed){this.debug("Skipping render - renderer destroyed");return}if(!ze().enableMetadataViewHooks){this.debug("Metadata view hooks disabled via flags");return}try{this.debug("Rendering metadata from document");let n=this.view.metadataEditor;if(!n){this.debug("No metadata editor available");return}let i=(0,zc.getFrontMatterInfo)(t.text).frontmatter;if(i){n.synchronize((0,zc.parseYaml)(i));for(let a of n.rendered)a.renderProperty(a.entry,!0)}else this.debug("No frontmatter found in document")}catch(n){this.error("Error rendering metadata:",n)}}destroy(){this.destroyed=!0,this.debug("destroyed"),this.view=null}};var Nn=class extends st{constructor(t,r){super();this.unsubscribes=[];this.destroyed=!1;this.saving=!1;this.view=t,this.document=r,this.setLoggers(`[ViewHookPlugin][${r.path}]`),this.debug("created"),this.renderers=[],this.renderers.push(new Wc(t)),this.renderers.push(new jc(t)),this._ytext=this.document.ytext,this.installMarkdownHooks(this.view),this.setupDocumentObserver(),this.renderAll()}installMarkdownHooks(t){let r=this;ze().enableMetadataViewHooks&&this.unsubscribes.push(Ar().patch(t,{saveFrontmatter(n){return function(s){r.debug("saveFrontmatter hook triggered"),r.saving=!0;let i=n.call(this,s);return r.saving=!1,i}}})),this.unsubscribes.push(Ar().patch(t,{save(n){return function(s){var a,l;let i=n.call(this,s);try{((l=(a=r.view).getMode)==null?void 0:l.call(a))==="preview"&&r.saving&&(r.debug("Syncing metadata changes to CRDT during save"),xo(r.document.ydoc,r.view.text,r.document))}catch(c){r.error("Error syncing during save:",c)}return i}}})),ze().enablePreviewViewHooks&&this.unsubscribes.push(Ar().patch(t.previewMode,{edit(n){return function(s){var i,a;if(r.debug("Preview edit hook triggered"),((a=(i=r.view).getMode)==null?void 0:a.call(i))==="preview"){if(r.view.editor){let l=r.incrementalBufferChange(s);r.view.editor.cm.dispatch({changes:l}),r.debug("Dispatched preview edit to CodeMirror")}else xo(r.document.ydoc,s,r.document),r.debug("Synced preview edit directly to CRDT");return}return n.call(this,s)}}}))}setupDocumentObserver(){this.observer=async(t,r)=>{if(!this.active()){this.debug("Received yjs event against a non-active view");return}if(this.destroyed){this.debug("Received yjs event but plugin was destroyed");return}this.debug("Document changed, updating all renderers"),this.renderAll()},this._ytext.observe(this.observer)}active(){return!this.destroyed&&!!this.view}renderAll(){var r,n,s,i;let t=((n=(r=this.view).getMode)==null?void 0:n.call(r))||((i=(s=this.view).getViewType)==null?void 0:i.call(s))||"unknown";this.debug(`Rendering all components for mode: ${t}`),this.renderers.forEach(a=>{try{a.render(this.document,t)}catch(l){this.error("Error in renderer:",l)}})}incrementalBufferChange(t){let r=this.view.editor.cm.state.doc.toString(),n=new qv.default,s=n.diff_main(r,t);n.diff_cleanupSemantic(s);let i=[],a=0;for(let[l,c]of s)switch(l){case 0:a+=c.length;break;case 1:i.push({from:a,to:a,insert:c}),a+=c.length;break;case-1:i.push({from:a,to:a+c.length,insert:""});break}return i}async initialize(){await this.document.whenReady(),this.view.previewMode.renderer.set(this.document.text),this.renderAll(),this.document.connect(),this.debug("ViewHookPlugin initialized")}destroy(){var t;this.destroyed=!0,this.debug("destroyed"),this.observer&&((t=this._ytext)==null||t.unobserve(this.observer)),this.unsubscribes.forEach(r=>r()),this.unsubscribes.length=0,this.renderers.forEach(r=>r.destroy()),this.renderers.length=0,this._ytext=null,this.view=null,this.document=null}};var VL=25,Iz=Gc.Facet.define({combine(o){return o[o.length-1]}}),Kc=Gc.Annotation.define(),Im=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.error=(...e)=>{};this.embed=!1;var a,l,c;this.unsubscribes=[],this.editor=e,this.sourceView=this.editor.dom.closest(".markdown-source-view"),this.connectionManager=this.editor.state.field(Wo);let t=this.editor.dom.closest(".relay-live-editor"),n=(a=this.sourceView)==null?void 0:a.classList.contains("mod-inside-iframe");if(!t&&!n){this.destroyed=!0;return}if(this.view=(l=this.connectionManager)==null?void 0:l.findView(this.editor),this.document=this.getDocument(),!this.document){this.destroyed=!0;return}this.view?this.viewHookPlugin=new Nn(this.view.view,this.document):this.embed=!0,this.log=Re(`[LiveCMPluginValue][${this.document.path}]`,"log"),this.warn=Re(`[LiveCMPluginValue][${this.document.path}]`,"warn"),this.error=Re(`[LiveCMPluginValue][${this.document.path}]`,"error"),this.debug=Re(`[LiveCMPluginValue][${this.document.path}]`,"debug"),this.debug("created");let s=this,i=!1;(c=this.view)!=null&&c.view?this.unsubscribes.push(Ar().patch(this.view.view,{setViewData(f){return function(u,d){if(d)so(s.view)&&s.view.document.text===u&&(s.view.tracking=!0),s.resync();else if(i){let p=s.incrementalBufferChange(u);e.dispatch({changes:p});return}return f.call(this,u,d)}},saveFrontmatter(f){return function(u){i=!0;let d=f.call(this,u);return i=!1,d}},requestSave(f){return function(){let u=f.call(this);try{this.app.metadataCache.trigger("resolve",this.file)}catch(d){}return u}}})):this.document.connect(),this.document.connected?this.resync():this.document.onceConnected().then(()=>{this.resync()}),this.viewHookPlugin&&this.viewHookPlugin.initialize().catch(f=>{this.error("Error initializing ViewHookPlugin:",f)}),this._observer=async(f,u)=>{if(this.document=this.getDocument(),!this.active(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(u.origin!==this){let d=f.delta,p=[],m=0;for(let y=0;y<d.length;y++){let g=d[y];g.insert!=null?p.push({from:m,to:m,insert:g.insert}):g.delete!=null?(p.push({from:m,to:m+g.delete,insert:""}),m+=g.delete):g.retain!=null&&(m+=g.retain)}so(this.view)&&!this.view.tracking||ze().enableEditorTweens&&this.keyFrameCounter>VL?(this.keyFrameCounter=0,p=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),this.active(this.view)&&(e.dispatch({changes:p,annotations:[Kc.of(this.editor)]}),so(this.view)&&(this.view.tracking=!0))}},this.observer=(f,u)=>{var d;try{(d=this._observer)==null||d.call(this,f,u)}catch(p){p instanceof RangeError&&so(this.view)&&(this.view.tracking=!1)}},this._ytext=this.document.ytext,this._ytext.observe(this.observer)}getDocument(){var r,n,s;let t=this.editor.state.field(zv.editorInfoField).file;if(t){if(((r=this.document)==null?void 0:r._tfile)===t)return this.document;let i=(n=this.connectionManager)==null?void 0:n.sharedFolders.lookup(t.path);if(i)return this.document=i.proxy.getDoc(t.path),this.document}if(this.view=(s=this.connectionManager)==null?void 0:s.findView(this.editor),this.view&&this.view.document instanceof Rt)return this.view.document}active(e){return so(e)||this.embed&&this.document}mergeBanner(){return this.destroyed||!this.editor?()=>{}:(this.banner=new qc(this.sourceView,this.editor.dom,"Merge conflict -- click to resolve",async()=>{var r;if(!this.document)return!0;let e=await this.document.diskBuffer();return await this.document.checkStale()&&((r=this.connectionManager)==null||r.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.destroyed||!this.editor||!this.document||(this.document.clearDiskBuffer(),this.resync())}})),!0}),()=>{})}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new jv.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],i=0;for(let[a,l]of n)switch(a){case 0:i+=l.length;break;case 1:s.push({from:i,to:i,insert:l}),i+=l.length;break;case-1:s.push({from:i,to:i+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(so(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();so(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Kc.of(this.editor)]})}else if(this.active(this.view)&&this.document){await this.document.whenSynced();let e=await this.getKeyFrame();this.active(this.view)&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Kc.of(this.editor)]})}}async getKeyFrame(e=!1){var t,r;return!this.active(this.view)||this.destroyed?[]:((t=this.document)==null?void 0:t.text)===this.editor.state.doc.toString()?(so(this.view)&&(this.view.tracking=!0),[]):(ze().enableDeltaLogging&&this.warn(`|${(r=this.document)==null?void 0:r.text}|
|${this.editor.state.doc.toString()}|`),this.document?(this.warn("ytext and editor buffer need syncing"),!this.document.hasLocalDB()&&this.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(so(this.view)&&!this.view.tracking?this.view.checkStale():this.document&&await this.document.checkStale()&&!this.destroyed&&this.editor&&this.mergeBanner(),this.active(this.view)&&!this.destroyed?[this.getBufferChange(this.document.text,e)]:[])):(this.warn("no document"),[]))}update(e){var r,n;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Kc)===this.editor||this.destroyed)return;this.document=this.getDocument();let t=(r=this.document)==null?void 0:r.ytext;t&&((n=t.doc)==null||n.transact(()=>{let s=0;e.changes.iterChanges((i,a,l,c,f)=>{let u=f.sliceString(0,f.length,`
`);i!==a&&t.delete(i+s,a-i),u.length>0&&t.insert(i+s,u),s+=u.length-(a-i)})},this),this.embed&&this.document&&this.document.requestSave())}destroy(){var e,t;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.unsubscribes.forEach(r=>{r()}),this.unsubscribes.length=0,(t=this.viewHookPlugin)==null||t.destroy(),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Kv=Wv.ViewPlugin.fromClass(Im);var Jc=require("@codemirror/state"),Rr=require("@codemirror/view");var Gv=require("obsidian");var Jv=Rr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),NL=Jc.Annotation.define(),Cm=class extends Rr.WidgetType{constructor(e,t){super(),this.color=e,this.name=t}toDOM(e){return Vi("span",[pr("class","cm-ySelectionCaret"),pr("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Bs("\u2060"),Vi("div",[pr("class","cm-ySelectionCaretDot")]),Bs("\u2060"),Vi("div",[pr("class","cm-ySelectionInfo")],[Bs(this.name)]),Bs("\u2060")])}eq(e){return e.color===this.color}compare(e){return e.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Lm=class{constructor(e){this.destroyed=!1;var i,a;this.editor=e,this.decorations=Jc.RangeSet.of([]),this.connectionManager=this.editor.state.field(Wo);let t=this.editor.dom.closest(".markdown-source-view"),r=this.editor.dom.closest(".relay-live-editor"),s=t==null?void 0:t.classList.contains("mod-inside-iframe");if(!r&&!s){this.destroyed=!0;return}if(this.view=(i=this.connectionManager)==null?void 0:i.findView(e),this.view&&this.view instanceof Hn){let l=(a=this.view.document)==null?void 0:a._provider;this._listener=({added:c,updated:f,removed:u},d,p)=>{c.concat(f).concat(u).findIndex(y=>{var g;return y!==((g=this._awareness)==null?void 0:g.doc.clientID)})>=0&&e.dispatch({annotations:[NL.of([])]})},l&&(this._awareness=l.awareness,this._awareness.on("change",this._listener))}}getDocument(){var r,n,s,i;let t=this.editor.state.field(Gv.editorInfoField).file;if(t){if(((r=this.document)==null?void 0:r._tfile)===t)return this.document;let a=(n=this.connectionManager)==null?void 0:n.sharedFolders.lookup(t.path);if(a)return this.document=a.proxy.getDoc(t.path),this.document}return this.view=(s=this.connectionManager)==null?void 0:s.findView(this.editor),(i=this.view)==null?void 0:i.document}destroy(){var e;this.destroyed=!0,this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c;if(this.destroyed)return;let t=e.view;this.document=this.getDocument();let r=(c=this.document)==null?void 0:c.ytext;if(!(this.document&&r&&r.doc))return;let n=this.document._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,i=r.doc,a=[],l=this._awareness.getLocalState();if(l!=null){let f=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),u=f?e.state.selection.main:null,d=l.cursor==null?null:$u(l.cursor.anchor),p=l.cursor==null?null:$u(l.cursor.head);if(u!=null){let m=Bu(r,u.anchor),y=Bu(r,u.head);(l.cursor==null||!Nu(d,m)||!Nu(p,y))&&s.setLocalStateField("cursor",{anchor:m,head:y})}else l.cursor!=null&&f&&s.setLocalStateField("cursor",null)}s.getStates().forEach((f,u)=>{if(u===s.doc.clientID)return;let d=f.cursor;if(d==null||d.anchor==null||d.head==null)return;let p=Vu(d.anchor,i),m=Vu(d.head,i);if(p==null||m==null||p.type!==r||m.type!==r)return;if(p.index>e.state.doc.length||m.index>e.state.doc.length){Re("[RemoteSelections]","warn")(`cursor positions (${p.index}, ${m.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=Rr.Decoration.none;return}let{color:y="#30bced",name:g="Anonymous"}=f.user||{},I=f.user&&f.user.colorLight||y+"33",L=wn(p.index,m.index),C=co(p.index,m.index),w=e.view.state.doc.lineAt(L),E=e.view.state.doc.lineAt(C);if(w.number===E.number)a.push({from:L,to:C,value:Rr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})});else{a.push({from:L,to:w.from+w.length,value:Rr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})}),a.push({from:E.from,to:C,value:Rr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})});for(let F=w.number+1;F<E.number;F++){let U=e.view.state.doc.line(F).from;a.push({from:U,to:U,value:Rr.Decoration.line({attributes:{style:`background-color: ${I}`,class:"cm-yLineSelection"}})})}}a.push({from:m.index,to:m.index,value:Rr.Decoration.widget({side:m.index-p.index>0?-1:1,block:!1,widget:new Cm(y,g)})})}),this.decorations=Rr.Decoration.set(a,!0)}},Qv=Rr.ViewPlugin.fromClass(Lm,{decorations:o=>o.decorations});var Qc=require("@codemirror/state"),hn=require("@codemirror/view"),Yv=require("@codemirror/view"),Vz=require("obsidian");var zz=Qc.Annotation.define(),Tm=class extends Yv.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},Em=Qc.StateEffect.define(),Fm=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(Wo),this.decorations=hn.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:Em.of(null)})},!this.connectionManager){Re("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Re(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var n,s;let r=(s=(n=this.view)==null?void 0:n.document)==null?void 0:s.getTFile();if(this.connectionManager&&this.app&&r){this.connectionManager.onMeta(r,this.cb);let i=this.app.metadataCache.getFileCache(r);i&&(this.updateFromMetadata(i),this.editor.dispatch({effects:Em.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(hn.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(i,a,l)=>{var u;(((u=l.spec)==null?void 0:u.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:a})})}),t}updateFromMetadata(e){var r,n,s,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.tfile))return;let t=new Map;for(let a of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}for(let a of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,i,a,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.sharedFolder)||!((l=(a=this.view)==null?void 0:a.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let f=null;for(let[p,m]of r)if(c.from<=m.to&&c.to>=m.from){f=m,r.delete(p);break}if(!f)continue;let u=this.app.metadataCache.getFirstLinkpathDest(f.link,this.view.document.path);u&&!this.view.document.sharedFolder.checkPath(u.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>hn.Decoration.widget({widget:new Tm,side:1}).range(t));e.length>0?this.decorations=hn.Decoration.set(e,!0):this.decorations=hn.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(Em))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Xv=hn.ViewPlugin.fromClass(Fm,{decorations:o=>o.decorations});function gn(){}gn.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var i=this;function a(w){return s?(setTimeout(function(){s(void 0,w)},0),!0):w}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,f=1,u=l+c;n.maxEditLength&&(u=Math.min(u,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,p=Date.now()+d,m=[{oldPos:-1,lastComponent:void 0}],y=this.extractCommon(m[0],t,e,0);if(m[0].oldPos+1>=c&&y+1>=l)return a([{value:this.join(t),count:t.length}]);var g=-1/0,I=1/0;function L(){for(var w=Math.max(g,-f);w<=Math.min(I,f);w+=2){var E=void 0,F=m[w-1],U=m[w+1];F&&(m[w-1]=void 0);var V=!1;if(U){var P=U.oldPos-w;V=U&&0<=P&&P<l}var $=F&&F.oldPos+1<c;if(!V&&!$){m[w]=void 0;continue}if(!$||V&&F.oldPos+1<U.oldPos?E=i.addToPath(U,!0,void 0,0):E=i.addToPath(F,void 0,!0,1),y=i.extractCommon(E,t,e,w),E.oldPos+1>=c&&y+1>=l)return a(HL(i,E.lastComponent,t,e,i.useLongestToken));m[w]=E,E.oldPos+1>=c&&(I=Math.min(I,w-1)),y+1>=l&&(g=Math.max(g,w+1))}f++}if(s)(function w(){setTimeout(function(){if(f>u||Date.now()>p)return s();L()||w()},0)})();else for(;f<=u&&Date.now()<=p;){var C=L();if(C)return C}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,i=r.length,a=e.oldPos,l=a-n,c=0;l+1<s&&a+1<i&&this.equals(t[l+1],r[a+1]);)l++,a++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function HL(o,e,t,r,n){for(var s=[],i;e;)s.push(e),i=e.previousComponent,delete e.previousComponent,e=i;s.reverse();for(var a=0,l=s.length,c=0,f=0;a<l;a++){var u=s[a];if(u.removed){if(u.value=o.join(r.slice(f,f+u.count)),f+=u.count,a&&s[a-1].added){var p=s[a-1];s[a-1]=s[a],s[a]=p}}else{if(!u.added&&n){var d=t.slice(c,c+u.count);d=d.map(function(y,g){var I=r[f+g];return I.length>y.length?I:y}),u.value=o.join(d)}else u.value=o.join(t.slice(c,c+u.count));c+=u.count,u.added||(f+=u.count)}}var m=s[l-1];return l>1&&typeof m.value=="string"&&(m.added||m.removed)&&o.equals("",m.value)&&(s[l-2].value+=m.value,s.pop()),s}var Gz=new gn;function qL(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Zv=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,ex=/\S/,Dm=new gn;Dm.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!ex.test(o)&&!ex.test(e)};Dm.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Zv.test(e[t])&&Zv.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function tx(o,e,t){return t=qL(t,{ignoreWhitespace:!0}),Dm.diff(o,e,t)}var Um=new gn;Um.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function WL(o,e,t){return Um.diff(o,e,t)}var jL=new gn;jL.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var zL=new gn;zL.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Yc(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Yc=function(e){return typeof e}:Yc=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yc(o)}function Pm(o){return KL(o)||GL(o)||JL(o)||QL()}function KL(o){if(Array.isArray(o))return Am(o)}function GL(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function JL(o,e){if(o){if(typeof o=="string")return Am(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Am(o,e)}}function Am(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function QL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var YL=Object.prototype.toString,Ra=new gn;Ra.useLongestToken=!0;Ra.tokenize=Um.tokenize;Ra.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,i){return typeof i=="undefined"?t:i}:r;return typeof o=="string"?o:JSON.stringify(Rm(o,null,null,n),n,"  ")};Ra.equals=function(o,e){return gn.prototype.equals.call(Ra,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Rm(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var i;if(YL.call(o)==="[object Array]"){for(e.push(o),i=new Array(o.length),t.push(i),s=0;s<o.length;s+=1)i[s]=Rm(o[s],e,t,r,n);return e.pop(),t.pop(),i}if(o&&o.toJSON&&(o=o.toJSON()),Yc(o)==="object"&&o!==null){e.push(o),i={},t.push(i);var a=[],l;for(l in o)o.hasOwnProperty(l)&&a.push(l);for(a.sort(),s=0;s<a.length;s+=1)l=a[s],i[l]=Rm(o[l],e,t,r,l);e.pop(),t.pop()}else i=o;return i}var Mm=new gn;Mm.tokenize=function(o){return o.slice()};Mm.join=Mm.removeEmpty=function(o){return o};function rx(o,e,t,r,n,s,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var a=WL(t,r,i);if(!a)return;a.push({value:"",lines:[]});function l(I){return I.map(function(L){return" "+L})}for(var c=[],f=0,u=0,d=[],p=1,m=1,y=function(L){var C=a[L],w=C.lines||C.value.replace(/\n$/,"").split(`
`);if(C.lines=w,C.added||C.removed){var E;if(!f){var F=a[L-1];f=p,u=m,F&&(d=i.context>0?l(F.lines.slice(-i.context)):[],f-=d.length,u-=d.length)}(E=d).push.apply(E,Pm(w.map(function(M){return(C.added?"+":"-")+M}))),C.added?m+=w.length:p+=w.length}else{if(f)if(w.length<=i.context*2&&L<a.length-2){var U;(U=d).push.apply(U,Pm(l(w)))}else{var V,P=Math.min(w.length,i.context);(V=d).push.apply(V,Pm(l(w.slice(0,P))));var $={oldStart:f,oldLines:p-f+P,newStart:u,newLines:m-u+P,lines:d};if(L>=a.length-2&&w.length<=i.context){var re=/\n$/.test(t),W=/\n$/.test(r),q=w.length==0&&d.length>$.oldLines;!re&&q&&t.length>0&&d.splice($.oldLines,0,"\\ No newline at end of file"),(!re&&!q||!W)&&d.push("\\ No newline at end of file")}c.push($),f=0,u=0,d=[]}p+=w.length,m+=w.length}},g=0;g<a.length;g++)y(g);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var ox=require("obsidian");var Xc=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Zc=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let i=0;i<r.lines.length;i+=1){let a=r.lines[i];if(a.startsWith("+")||a.startsWith("-")){let l=i,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let f=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),u=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new Xc({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:f,file2Lines:u})),n+=f.length,s+=u.length,i+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function Om(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Ma(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function Da(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function wi(o){return o!==""?o:"\u200E"}var oK=require("obsidian");var Mr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var jo=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var ef=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof Rt){xo(e.ydoc,t,e);return}else if(e instanceof fn){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new Mr({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),jo.build(t),new Mr({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),jo.build(t),new Mr({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),jo.build(t),new Mr({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new Mr({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),jo.build(t),new Mr({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new Mr({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),jo.build(t),new Mr({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Ma({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Ma({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=Ma({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=Ma({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=Da({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=Da({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Om({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Om({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=Da({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=Da({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var _i="system3-differences-view";async function nx(o,e){e.originalLeaf||(e.originalLeaf=o.activeLeaf||void 0),o.detachLeavesOfType(_i);let t=o.getLeaf(!0);t.setViewState({type:_i,active:!0,state:e}),o.revealLeaf(t)}var tf=class extends ox.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];let r=this.constructor.name;this.log=Re(`[${r}]`,"log")}async getContent(t){return t instanceof Rt?t.text:t instanceof fn?t.contents:await this.app.vault.read(t)}getViewType(){return _i}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}closeAndReturnToOriginal(){var t;(t=this.state)!=null&&t.originalLeaf&&this.state.originalLeaf.parent&&this.app.workspace.setActiveLeaf(this.state.originalLeaf,{focus:!0}),this.leaf.detach()}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=rx(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));if(this.fileDifferences=Zc.fromParsedDiff(t),this.fileDifferences.differences.length===0){if(this.file1Content!==this.file2Content){if(this.log("byte level difference with differ equivalence",this.file1Content.length,this.file2Content.length),ze().enableDeltaLogging){let s=this.file1Content||"",i=this.file2Content||"",a=Math.max(s.length,i.length);for(let l=0;l<a;l++){let c=l<s.length?s.charCodeAt(l):void 0,f=l<i.length?i.charCodeAt(l):void 0;if(c!==f){let u=c!==void 0?`0x${c.toString(16).padStart(2,"0")}`:"EOF",d=f!==void 0?`0x${f.toString(16).padStart(2,"0")}`:"EOF";this.log(`Byte difference at position ${l}: file1=${c} (${u}), file2=${f} (${d})`)}}}await this.modify(this.state.file2,this.file1Content||"")}this.closeAndReturnToOriginal()}}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new Mr({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),jo.build(r),new Mr({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof Rt){xo(t.ydoc,r,this);return}else if(t instanceof fn){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){var t,r;!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),await((r=(t=this.state).onResolve)==null?void 0:r.call(t)),this.closeAndReturnToOriginal())}async acceptAllFromRight(){var t,r;!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),await((r=(t=this.state).onResolve)==null?void 0:r.call(t)),this.closeAndReturnToOriginal())}buildLines(t){var i,a,l;let r=0,n=0,s=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((a=this.file2Lines)==null?void 0:a.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(f=>f.file1Start===r&&f.file2Start===n);if(c!=null){let f=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(f,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let f=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:wi(f),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new ef(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=wi(t);else if(t!=null&&r!=null){let i=tx(r,t);for(let a of i){if(a.removed)continue;let l=document.createElement("span");l.textContent=wi(a.value),a.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=wi(t),i.classList.add(n),s.appendChild(i)}else s.textContent=wi(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var rf=class extends st{constructor(t,r){super();this.connectionManager=t;if(this.view=r.view,this.canvas=r.view.canvas,this.relayCanvas=r.canvas,this.unsubscribes=[],this.relayCanvasView=r,this.observedTextNodes=new Set,this.trackedEmbedViews=new Set,this.install(),ze().enableLiveEmbeds)for(let n of this.getEmbedViews())n.file&&this.connectEmbedView(n)}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[]),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=i=>{let a=this.canvas.nodes.get(n);a&&(a.setText(r.toString()),this.canvas.markDirty(a))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}getEmbedViews(){return[...this.canvas.nodes.values()].map(t=>t.child).filter(t=>!!t)}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}isEmbedAlreadyTracked(t){return this.trackedEmbedViews.has(t)}connectEmbedView(t){t.file&&(this.trackedEmbedViews.add(t),this.unsubscribes.push((()=>{let r=new Nn(t,this.relayCanvas.sharedFolder.proxy.getDoc(t.file.path));return r.initialize().catch(n=>{this.error("Error initializing ViewHookPlugin for canvas embed:",n)}),()=>{this.trackedEmbedViews.delete(t),r.destroy()}})()))}install(){var c;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(c=this.view.file)==null?void 0:c.path,this.relayCanvas.path);let t=this,r=Nt.exportCanvasData(this.relayCanvas.ydoc),n=r.nodes.length>0||r.edges.length>0;this.relayCanvas.hasLocalDB()&&n&&this.canvas.importData(r,!0),this.unsubscribes.push(Ar().patch(this.canvas,{requestSave(f){return function(){let u=f.call(this);try{t.relayCanvas.importFromView(t.view)}catch(d){t.log(d)}return u}},applyHistory(f){return function(u){let d=f.call(this,u);try{t.relayCanvas.importFromView(t.view)}catch(p){t.log(p)}return d}}}));let i=(f,u)=>{var m,y,g,I;let d="";if(d+=`Transaction origin: ${f.transaction.origin} ${(y=(m=f.transaction.origin)==null?void 0:m.constructor)==null?void 0:y.name}
`,this.relayCanvas||this.log("relay canvas is already destroyed"),!this.canvas){this.log("canvas is already destroyed");return}if(!((g=this.view.file)!=null&&g.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(f.transaction.origin===this.relayCanvas)return;let p=Nt.exportCanvasData(this.relayCanvas.ydoc);for(let[L,C]of f.changes.keys)d+=`key: ${L} action: ${C.action}

`;this.debug(d),this.debug("importing data",(I=this.view.file)==null?void 0:I.path,this.relayCanvas.path,p),this.canvas.importData(p,!0),this.canvas.requestSave();for(let L of f.keysChanged){let C=u.get(L);if(C){if(this.canvas.nodes.has(C.id)&&(this.observeNode(C.getData()),ze().enableLiveEmbeds)){let w=C.child;w!=null&&w.file&&!this.isEmbedAlreadyTracked(w)&&this.connectEmbedView(w)}this.canvas.markMoved(C),this.canvas.markDirty(C)}}},a=f=>i(f,this.canvas.nodes);this.relayCanvas.ynodes.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(a)});for(let[,f]of this.relayCanvas.ynodes)this.observeNode(f);let l=f=>i(f,this.canvas.edges);this.relayCanvas.yedges.observe(l),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(l)}),this.relayCanvasView.tracking=!0}};var of=require("@codemirror/state"),ix=require("@codemirror/view");var KK=of.Facet.define({combine(o){return o[o.length-1]}}),sx=of.Annotation.define(),$m=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(Wo),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Re(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Re(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=Re(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(i,a)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(a.origin!==this){let c=i.delta,f=[],u=0;for(let d=0;d<c.length;d++){let p=c[d];p.insert!=null?f.push({from:u,to:u,insert:p.insert}):p.delete!=null?(f.push({from:u,to:u+p.delete,insert:""}),u+=p.delete):p.retain!=null&&(u+=p.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:f,annotations:[sx.of(this.editor)]})}},this.observer=(i,a)=>{var l;try{(l=this._observer)==null||l.call(this,i,a)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,i;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(a=>{if(a&&a.node)return a.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(i=this.view)==null?void 0:i.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(sx)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,i,a,l,c)=>{let f=c.sliceString(0,c.length,`
`);s!==i&&t.delete(s+n,i-s),f.length>0&&t.insert(s+n,f),n+=f.length-(i-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},ax=ix.ViewPlugin.fromClass($m);var yG=require("obsidian");function ZL(o){Ee(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function eE(o){let e,t;return{c(){e=x("span"),t=K(o[5]),h(e,"class","initial svelte-18fffd7"),le(e,"font-size",o[4])},m(r,n){S(r,e,n),b(e,t)},p(r,n){n&32&&te(t,r[5]),n&16&&le(e,"font-size",r[4])},d(r){r&&_(e)}}}function tE(o){let e,t,r,n;return{c(){e=x("img"),Tr(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,i){S(s,e,i),r||(n=j(e,"error",o[6]),r=!0)},p(s,i){i&1&&!Tr(e.src,t=s[0].picture)&&h(e,"src",t),i&2&&h(e,"alt",s[1])},d(s){s&&_(e),r=!1,n()}}}function rE(o){let e;function t(s,i){return!s[3]&&s[0].picture?tE:eE}let r=t(o,-1),n=r(o);return{c(){e=x("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),le(e,"width",o[2]),le(e,"height",o[2])},m(s,i){S(s,e,i),n.m(e,null)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),i&4&&le(e,"width",s[2]),i&4&&le(e,"height",s[2])},i:z,o:z,d(s){s&&_(e),n.d()}}}function oE(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function nE(o,e,t){let r,n,s,{user:i}=e,{alt:a="Profile picture"}=e,{size:l="40px"}=e,c=!1;function f(){t(3,c=!0)}return o.$$set=u=>{"user"in u&&t(0,i=u.user),"alt"in u&&t(1,a=u.alt),"size"in u&&t(2,l=u.size)},o.$$.update=()=>{o.$$.dirty&1&&t(5,r=i.name?i.name.charAt(0).toUpperCase():"?"),o.$$.dirty&4&&t(7,n=oE(l)),o.$$.dirty&132&&t(4,s=`${parseFloat(l)/2}${n}`)},[i,a,l,c,s,r,f,n]}var Bm=class extends Z{constructor(e){super(),ee(this,e,nE,rE,X,{user:0,alt:1,size:2},ZL)}},Ua=Bm;var Si=[];function sE(o,e){return{subscribe:we(o,e).subscribe}}function we(o,e=z){let t,r=new Set;function n(a){if(X(o,a)&&(o=a,t)){let l=!Si.length;for(let c of r)c[1](),Si.push(c,o);if(l){for(let c=0;c<Si.length;c+=2)Si[c][0](Si[c+1]);Si.length=0}}}function s(a){n(a(o))}function i(a,l=z){let c=[a,l];return r.add(c),r.size===1&&(t=e(n,s)||z),a(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:i}}function at(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return sE(t,(i,a)=>{let l=!1,c=[],f=0,u=z,d=()=>{if(f)return;u();let m=e(r?c[0]:c,i,a);s?i(m):u=nt(m)?m:z},p=n.map((m,y)=>Ht(m,g=>{c[y]=g,f&=~(1<<y),l&&d()},()=>{f|=1<<y}));return l=!0,d(),function(){xe(p),u(),l=!1}})}function iE(o){Ee(o,"svelte-1o6nljh",'.user-awareness-container{display:flex;align-items:center;flex-shrink:0;margin-left:12px;position:relative}.user-awareness.svelte-1o6nljh.svelte-1o6nljh{position:relative;display:flex;align-items:center}.avatar-stack.svelte-1o6nljh.svelte-1o6nljh{display:flex;align-items:center;cursor:pointer;position:relative;transition:width 0.2s ease;overflow:visible}.stacked-avatar.svelte-1o6nljh.svelte-1o6nljh{position:relative}.avatar-stack.multi-user.svelte-1o6nljh .stacked-avatar.svelte-1o6nljh{transition:margin-left 0.2s ease}@media(hover: hover) and (pointer: fine){.avatar-stack.multi-user.svelte-1o6nljh:hover .stacked-avatar.svelte-1o6nljh{margin-left:-10px !important;margin-right:2px;transition-delay:300ms}}.more-indicator.svelte-1o6nljh.svelte-1o6nljh{width:2em;height:2em;border-radius:50%;background-color:var(--background-modifier-border);border:2px solid var(--text-muted);display:flex;align-items:center;justify-content:center;font-size:0.6em;font-weight:600;color:var(--text-muted);position:relative}.user-popover.svelte-1o6nljh.svelte-1o6nljh{position:absolute;top:100%;right:0;margin-top:8px;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:8px;box-shadow:var(--shadow-s);min-width:200px;max-width:300px;z-index:1000}.user-popover.svelte-1o6nljh.svelte-1o6nljh::before{content:"";position:absolute;top:-8px;right:20px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--background-modifier-border)}.user-popover.svelte-1o6nljh.svelte-1o6nljh::after{content:"";position:absolute;top:-7px;right:20px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--background-secondary)}.popover-header.svelte-1o6nljh.svelte-1o6nljh{padding:12px 16px 8px 16px;font-size:12px;font-weight:600;color:var(--text-muted);border-bottom:1px solid var(--background-modifier-border);background:var(--background-secondary);border-radius:8px 8px 0 0}.user-list.svelte-1o6nljh.svelte-1o6nljh{padding:8px 0;max-height:200px;overflow-y:auto}.user-item.svelte-1o6nljh.svelte-1o6nljh{display:flex;align-items:center;gap:12px;padding:6px 16px;cursor:default}.user-item.svelte-1o6nljh.svelte-1o6nljh:hover{background-color:var(--background-modifier-hover)}.user-name.svelte-1o6nljh.svelte-1o6nljh{font-size:14px;color:var(--text-normal);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.avatar-with-border.svelte-1o6nljh.svelte-1o6nljh{border-radius:50%;border:2px solid;display:inline-block;overflow:hidden;flex-shrink:0;background:var(--background-primary);box-sizing:border-box;padding:1px}.user-avatar.svelte-1o6nljh.svelte-1o6nljh{width:2em;height:2em;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative}.user-initial.svelte-1o6nljh.svelte-1o6nljh{color:white;font-size:1em;font-weight:600}')}function lx(o,e,t){let r=o.slice();return r[16]=e[t],r[18]=t,r}function cx(o,e,t){let r=o.slice();return r[16]=e[t],r[18]=t,r}function fx(o){let e,t,r=[],n=new Map,s,i,a,l,c,f=Se(o[4]),u=m=>m[16].id;for(let m=0;m<f.length;m+=1){let y=cx(o,f,m),g=u(y);n.set(g,r[m]=ux(g,y))}let d=o[3].length>xs&&dx(o),p=o[0]&&px(o);return{c(){e=x("div"),t=x("div");for(let m=0;m<r.length;m+=1)r[m].c();s=T(),d&&d.c(),i=T(),p&&p.c(),h(t,"class","avatar-stack svelte-1o6nljh"),h(t,"role","button"),h(t,"tabindex","0"),Te(t,"multi-user",o[4].length>1),h(e,"class","user-awareness svelte-1o6nljh")},m(m,y){S(m,e,y),b(e,t);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(t,null);b(t,s),d&&d.m(t,null),o[11](t),b(e,i),p&&p.m(e,null),o[13](e),a=!0,l||(c=[j(t,"click",o[7]),j(t,"keydown",o[12])],l=!0)},p(m,y){y&16&&(f=Se(m[4]),ce(),r=pn(r,y,u,1,m,f,n,t,Ea,ux,s,cx),fe()),m[3].length>xs?d?d.p(m,y):(d=dx(m),d.c(),d.m(t,null)):d&&(d.d(1),d=null),(!a||y&16)&&Te(t,"multi-user",m[4].length>1),m[0]?p?(p.p(m,y),y&1&&v(p,1)):(p=px(m),p.c(),v(p,1),p.m(e,null)):p&&(ce(),k(p,1,1,()=>{p=null}),fe())},i(m){if(!a){for(let y=0;y<f.length;y+=1)v(r[y]);v(p),a=!0}},o(m){for(let y=0;y<r.length;y+=1)k(r[y]);k(p),a=!1},d(m){m&&_(e);for(let y=0;y<r.length;y+=1)r[y].d();d&&d.d(),o[11](null),p&&p.d(),o[13](null),l=!1,xe(c)}}}function aE(o){let e,t,r,n=o[16].name.charAt(0).toUpperCase()+"",s;return{c(){e=x("div"),t=x("div"),r=x("span"),s=K(n),h(r,"class","user-initial svelte-1o6nljh"),h(t,"class","user-avatar svelte-1o6nljh"),le(t,"background-color",o[16].color),h(e,"class","avatar-with-border svelte-1o6nljh"),le(e,"border-color",o[16].color)},m(i,a){S(i,e,a),b(e,t),b(t,r),b(r,s)},p(i,a){a&16&&n!==(n=i[16].name.charAt(0).toUpperCase()+"")&&te(s,n),a&16&&le(t,"background-color",i[16].color),a&16&&le(e,"border-color",i[16].color)},i:z,o:z,d(i){i&&_(e)}}}function lE(o){let e,t,r;return t=new Ua({props:{user:o[16].relayUser,size:"2em",alt:o[16].name}}),{c(){e=x("div"),D(t.$$.fragment),h(e,"class","avatar-with-border svelte-1o6nljh"),le(e,"border-color",o[16].color)},m(n,s){S(n,e,s),A(t,e,null),r=!0},p(n,s){let i={};s&16&&(i.user=n[16].relayUser),s&16&&(i.alt=n[16].name),t.$set(i),(!r||s&16)&&le(e,"border-color",n[16].color)},i(n){r||(v(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function ux(o,e){let t,r,n,s,i,a=[lE,aE],l=[];function c(f,u){return f[16].relayUser?0:1}return r=c(e,-1),n=l[r]=a[r](e),{key:o,first:null,c(){t=x("div"),n.c(),h(t,"class","stacked-avatar svelte-1o6nljh"),le(t,"z-index",10-e[18]),le(t,"margin-left",hx(e[18])),le(t,"transition","all 0.2s ease"),h(t,"aria-label",s=e[16].name),this.first=t},m(f,u){S(f,t,u),l[r].m(t,null),i=!0},p(f,u){e=f;let d=r;r=c(e,u),r===d?l[r].p(e,u):(ce(),k(l[d],1,1,()=>{l[d]=null}),fe(),n=l[r],n?n.p(e,u):(n=l[r]=a[r](e),n.c()),v(n,1),n.m(t,null)),(!i||u&16)&&le(t,"z-index",10-e[18]),(!i||u&16)&&le(t,"margin-left",hx(e[18])),(!i||u&16&&s!==(s=e[16].name))&&h(t,"aria-label",s)},i(f){i||(v(n),i=!0)},o(f){k(n),i=!1},d(f){f&&_(t),l[r].d()}}}function dx(o){let e,t,r=o[3].length-xs+"",n;return{c(){e=x("div"),t=K("+"),n=K(r),h(e,"class","more-indicator svelte-1o6nljh"),le(e,"z-index","11"),le(e,"margin-top","1em"),le(e,"margin-left","-1em"),le(e,"transition","all 0.2s ease")},m(s,i){S(s,e,i),b(e,t),b(e,n)},p(s,i){i&8&&r!==(r=s[3].length-xs+"")&&te(n,r)},d(s){s&&_(e)}}}function px(o){let e,t,r,n=o[3].length+"",s,i,a,l,c=[],f=new Map,u,d=Se(o[3]),p=m=>m[16].id;for(let m=0;m<d.length;m+=1){let y=lx(o,d,m),g=p(y);f.set(g,c[m]=mx(g,y))}return{c(){e=x("div"),t=x("div"),r=K("Active Users ("),s=K(n),i=K(")"),a=T(),l=x("div");for(let m=0;m<c.length;m+=1)c[m].c();h(t,"class","popover-header svelte-1o6nljh"),h(l,"class","user-list svelte-1o6nljh"),h(e,"class","user-popover svelte-1o6nljh")},m(m,y){S(m,e,y),b(e,t),b(t,r),b(t,s),b(t,i),b(e,a),b(e,l);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(l,null);u=!0},p(m,y){(!u||y&8)&&n!==(n=m[3].length+"")&&te(s,n),y&8&&(d=Se(m[3]),ce(),c=pn(c,y,p,1,m,d,f,l,Ea,mx,null,lx),fe())},i(m){if(!u){for(let y=0;y<d.length;y+=1)v(c[y]);u=!0}},o(m){for(let y=0;y<c.length;y+=1)k(c[y]);u=!1},d(m){m&&_(e);for(let y=0;y<c.length;y+=1)c[y].d()}}}function cE(o){let e,t,r,n=o[16].name.charAt(0).toUpperCase()+"",s;return{c(){e=x("div"),t=x("div"),r=x("span"),s=K(n),h(r,"class","user-initial svelte-1o6nljh"),h(t,"class","user-avatar svelte-1o6nljh"),le(t,"background-color",o[16].color),le(t,"width","20px"),le(t,"height","20px"),h(e,"class","avatar-with-border svelte-1o6nljh"),le(e,"border-color",o[16].color)},m(i,a){S(i,e,a),b(e,t),b(t,r),b(r,s)},p(i,a){a&8&&n!==(n=i[16].name.charAt(0).toUpperCase()+"")&&te(s,n),a&8&&le(t,"background-color",i[16].color),a&8&&le(e,"border-color",i[16].color)},i:z,o:z,d(i){i&&_(e)}}}function fE(o){let e,t,r;return t=new Ua({props:{user:o[16].relayUser,size:"20px",alt:o[16].name}}),{c(){e=x("div"),D(t.$$.fragment),h(e,"class","avatar-with-border svelte-1o6nljh"),le(e,"border-color",o[16].color)},m(n,s){S(n,e,s),A(t,e,null),r=!0},p(n,s){let i={};s&8&&(i.user=n[16].relayUser),s&8&&(i.alt=n[16].name),t.$set(i),(!r||s&8)&&le(e,"border-color",n[16].color)},i(n){r||(v(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function mx(o,e){let t,r,n,s,i,a=e[16].name+"",l,c=e[18]===0?" (You)":"",f,u,d,p=[fE,cE],m=[];function y(g,I){return g[16].relayUser?0:1}return r=y(e,-1),n=m[r]=p[r](e),{key:o,first:null,c(){t=x("div"),n.c(),s=T(),i=x("span"),l=K(a),f=K(c),u=T(),h(i,"class","user-name svelte-1o6nljh"),h(t,"class","user-item svelte-1o6nljh"),Te(t,"current-user",e[18]===0),this.first=t},m(g,I){S(g,t,I),m[r].m(t,null),b(t,s),b(t,i),b(i,l),b(i,f),b(t,u),d=!0},p(g,I){e=g;let L=r;r=y(e,I),r===L?m[r].p(e,I):(ce(),k(m[L],1,1,()=>{m[L]=null}),fe(),n=m[r],n?n.p(e,I):(n=m[r]=p[r](e),n.c()),v(n,1),n.m(t,s)),(!d||I&8)&&a!==(a=e[16].name+"")&&te(l,a),(!d||I&8)&&c!==(c=e[18]===0?" (You)":"")&&te(f,c),(!d||I&8)&&Te(t,"current-user",e[18]===0)},i(g){d||(v(n),d=!0)},o(g){k(n),d=!1},d(g){g&&_(t),m[r].d()}}}function uE(o){let e,t,r=o[3].length>0&&fx(o);return{c(){r&&r.c(),e=ve()},m(n,s){r&&r.m(n,s),S(n,e,s),t=!0},p(n,[s]){n[3].length>0?r?(r.p(n,s),s&8&&v(r,1)):(r=fx(n),r.c(),v(r,1),r.m(e.parentNode,e)):r&&(ce(),k(r,1,1,()=>{r=null}),fe())},i(n){t||(v(r),t=!0)},o(n){k(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}var xs=4;function hx(o){return o===0?"0":o===1?"-1em":o===2?"-1.4em":"-1.8em"}function dE(o,e,t){let r,n,{awareness:s}=e,{relayUsers:i}=e,a=!1,l,c,f=we(0),u=null,d=at([i,f],([C,w])=>{if(!s||!C)return[];let E=s.getStates(),F=[];return E.forEach((P,$)=>{let re=P.user;if(re&&re.name&&re.id){let W=C.get(re.id);F.push({name:re.name,id:re.id,color:re.color||"#30bced",colorLight:re.colorLight||re.color+"33"||"#30bced33",relayUser:W})}}),[...F.filter((P,$,re)=>re.findIndex(W=>W.id===P.id)===$).sort((P,$)=>{var re;let W=s.getLocalState(),q=(re=W==null?void 0:W.user)===null||re===void 0?void 0:re.id;return P.id===q?-1:$.id===q?1:P.relayUser&&!$.relayUser?-1:!P.relayUser&&$.relayUser?1:0})]});de(o,d,C=>t(3,r=C));let p=at([d],([C])=>{var w;if(C.length===0)return[];let E=s==null?void 0:s.getLocalState(),F=(w=E==null?void 0:E.user)===null||w===void 0?void 0:w.id,U=C.find(P=>P.id===F),V=C.filter(P=>P.id!==F);return U?C.length<=xs?[...V,U]:[...V.slice(0,xs-1),U]:V.slice(0,xs)});de(o,p,C=>t(4,n=C));function m(){t(0,a=!a)}function y(C){l&&!l.contains(C.target)&&t(0,a=!1)}dt(()=>(document.addEventListener("click",y),()=>{document.removeEventListener("click",y)})),dn(()=>{u&&u(),document.removeEventListener("click",y)});function g(C){vt[C?"unshift":"push"](()=>{c=C,t(2,c)})}let I=C=>C.key==="Enter"&&m();function L(C){vt[C?"unshift":"push"](()=>{l=C,t(1,l)})}return o.$$set=C=>{"awareness"in C&&t(8,s=C.awareness),"relayUsers"in C&&t(9,i=C.relayUsers)},o.$$.update=()=>{if(o.$$.dirty&1280&&s){u&&u();let C=()=>{f.update(w=>w+1)};s.on("change",C),f.set(0),t(10,u=()=>{s.off("change",C)})}},[a,l,c,r,n,d,p,m,s,i,u,g,I,L]}var Vm=class extends Z{constructor(e){super(),ee(this,e,dE,uE,X,{awareness:8,relayUsers:9},iE)}},gx=Vm;var nf=class extends st{constructor(t,r){super();this.destroyed=!1;this.view=t,this.doc=t.document,this.relayUsersStore=r,this.setLoggers(`[AwarenessView](${this.doc.path})`),this.install()}async install(){var t;!this.view||this.destroyed||(this.log("Installing awareness component for",(t=this.view.view.file)==null?void 0:t.path),await this.doc.whenReady(),!this.destroyed&&this.setupAwarenessComponent())}setupAwarenessComponent(){if(!this.view.view.containerEl||this.destroyed)return;let t=this.view.view.containerEl.querySelector(".inline-title");if(!t){this.warn("Could not find inline-title element to position awareness component");return}let r=document.createElement("div");r.className="title-with-awareness",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="space-between",r.style.width="100%",this.awarenessElement=document.createElement("div"),this.awarenessElement.className="user-awareness-container",t.parentNode&&(t.parentNode.insertBefore(r,t),r.appendChild(t),r.appendChild(this.awarenessElement));let n=this.doc._provider;if(!(n!=null&&n.awareness)){this.warn("No awareness provider available");return}try{this.awarenessComponent=new gx({target:this.awarenessElement,props:{awareness:n.awareness,relayUsers:this.relayUsersStore}}),this.log("Awareness component successfully mounted")}catch(s){this.warn("Failed to create awareness component:",s)}}destroy(){if(this.destroyed=!0,this.awarenessComponent)try{this.awarenessComponent.$destroy(),this.awarenessComponent=void 0,this.log("Awareness component destroyed")}catch(t){this.warn("Error destroying awareness component:",t)}if(this.awarenessElement){let t=this.awarenessElement.parentElement;if(t&&t.className==="title-with-awareness"){let r=t.querySelector(".inline-title");r&&t.parentNode&&(t.parentNode.insertBefore(r,t),t.remove())}else this.awarenessElement.remove();this.awarenessElement=void 0}this.view=null,this.doc=null}};var yx=require("obsidian");var sf=class extends st{constructor(t){var s,i,a;super();this.destroyed=!1;this.saving=!1;this.view=t,this.doc=t.document,this.unsubscribes=[],this.saving=!1;let r=this.doc._tfile,n=(s=this.view.view)==null?void 0:s.file;if(r!==n){this.error("[TextViewPlugin] CRITICAL: Document TFile mismatch!",{documentPath:this.doc.path,documentTFilePath:r==null?void 0:r.path,viewFilePath:n==null?void 0:n.path,viewType:(a=(i=this.view.view)==null?void 0:i.getViewType)==null?void 0:a.call(i),documentGuid:this.doc.guid,tFilesSame:r===n});let l=this.getDocument();l&&(this.doc=l,this.warn("[TextViewPlugin] Switched to correct document:",{newDocPath:this.doc.path,newDocGuid:this.doc.guid}))}this.view.view instanceof yx.MarkdownView&&(this.viewHookPlugin=new Nn(this.view.view,this.doc)),this.install()}getDocument(){var r,n,s,i,a;let t=this.view.view.file;if(t){if(((r=this.doc)==null?void 0:r._tfile)===t)return this.doc;this.warn("[TextViewPlugin] getDocument() lookup:",{filePath:t.path,currentDocPath:(n=this.doc)==null?void 0:n.path,currentDocTFile:(i=(s=this.doc)==null?void 0:s._tfile)==null?void 0:i.path});let l=this.view.connectionManager.sharedFolders.lookup(t.path);if(l){let c=l.proxy.getDoc(t.path);return this.warn("[TextViewPlugin] getDocument() found:",{newDocPath:c.path,newDocGuid:c.guid,newDocTFile:(a=c._tfile)==null?void 0:a.path}),this.doc=c,this.doc}}if(this.view.document)return this.warn("[TextViewPlugin] getDocument() using fallback:",{fallbackDocPath:this.view.document.path,fallbackDocGuid:this.view.document.guid}),this.view.document}async resync(){var t,r,n,s;if(ws(this.view)&&!this.view.tracking&&!this.destroyed&&this.view.view.file){if(this.doc=this.getDocument(),!this.doc){this.warn("resync() - no document available");return}if(await this.doc.whenSynced(),this.doc.text===this.view.view.getViewData()){this.view.tracking=!0,this.warn("resync() - content matches, setting tracking=true");return}else this.warn("diff in resync - DETAILED DEBUG:",{documentPath:this.doc.path,documentTFilePath:(t=this.doc._tfile)==null?void 0:t.path,viewFilePath:(r=this.view.view.file)==null?void 0:r.path,documentText:this.doc.text,viewData:this.view.view.getViewData(),documentGuid:this.doc.guid,tFilesMatching:this.doc._tfile===this.view.view.file,documentTextLength:((n=this.doc.text)==null?void 0:n.length)||0,viewDataLength:((s=this.view.view.getViewData())==null?void 0:s.length)||0});if(!this.doc.hasLocalDB()&&this.doc.text===""){this.warn("local db missing, not setting buffer");return}await this.doc.checkStale()&&this.view?(this.warn("Document is stale - showing merge banner"),this.view.checkStale().then(async a=>{a||await this.syncViewToCRDT()})):(this.warn("Document is authoritative - syncing view to CRDT state"),await this.syncViewToCRDT())}}async syncViewToCRDT(){ws(this.view)&&!this.destroyed&&this.doc&&this.view.view.file&&(this.warn("Syncing view to CRDT - setViewData"),this.saving=!0,this.view.view.setViewData(this.doc.text,!1),this.doc.save(),this.saving=!1,this.view.tracking=!0)}install(){var r;if(!this.view)return;if(!this.view.view.file){this.warn("view file not ready, deferring install"),setTimeout(()=>{var n,s;!this.destroyed&&((s=(n=this.view)==null?void 0:n.view)!=null&&s.file)&&this.install()},100);return}this.warn("connecting textfile view",(r=this.view.view.file)==null?void 0:r.path,this.view.document.path);let t=this;this.unsubscribes.push(Ar().patch(this.view.view,{setViewData(n){return function(s,i){if(t.warn("instance hook: setViewData",this.getViewType()),!t.view.view.file)return t.warn("setViewData called before file loaded, deferring to original"),n.call(this,s,i);i&&ws(t.view)&&t.doc&&t.view.view.file===t.doc.tfile&&t.view.document.text===s&&(t.view.tracking=!0);let a=n.call(this,s,i);return i&&t.resync(),a}},requestSave(n){return function(){if(t.warn("instance hook: requestSave called",this.getViewType()),ws(t.view)&&!t.saving&&t.doc)if(t.view.tracking&&!t.saving){t.warn("tracking - applying diff"),xo(t.doc.ydoc,t.view.view.getViewData(),t.doc),t.doc.save();return}else t.warn("not tracking - resync"),t.resync();return n.call(this)}}})),this.observer=(n,s)=>{if(this.doc=this.getDocument(),!this.doc){this.debug("observer - no document available");return}if(!ws(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}s.origin!==this.doc&&(this.view.tracking||(this.warn("resync from update, not tracking"),this.resync()),this.warn("setting view data"),this.saving=!0,this.view.view.setViewData(this.doc.text,!1),this.view.view.requestSave(),this.saving=!1,this.view.tracking=!0)},this.resync(),this.doc=this.getDocument(),this.doc&&(this._ytext=this.doc.ytext,this._ytext.observe(this.observer)),this.viewHookPlugin&&this.viewHookPlugin.initialize().catch(n=>{this.error("Error initializing ViewHookPlugin:",n)})}destroy(){var t,r;this.warn("destroying view"),this.destroyed=!0,this.observer&&((t=this._ytext)==null||t.unobserve(this.observer)),this.unsubscribes.forEach(n=>n()),this.unsubscribes.length=0,(r=this.viewHookPlugin)==null||r.destroy(),this.observer=null,this._ytext=null,this.view=null,this.doc=null}};var pE=3;function Nm(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&e(t.view)})}function Hm(o,e){let t=["markdown"];ze().enableKanbanView&&t.push("kanban");let r=[];o.iterateAllLeaves(n=>{var s,i,a,l;r.push({viewType:((i=(s=n.view)==null?void 0:s.getViewType)==null?void 0:i.call(s))||"unknown",filePath:((l=(a=n.view)==null?void 0:a.file)==null?void 0:l.path)||"no-file",isTextFileView:n.view instanceof Jt.TextFileView,leafType:n.view.constructor.name})}),o.iterateAllLeaves(n=>{if(n.view instanceof Jt.TextFileView){let s=n.view.getViewType();if(s==="canvas")return;t.contains(s)&&e(n.view)}})}function mE(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(((t=o[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((n=o[i].document)==null?void 0:n.path)!==((s=e[i].document)==null?void 0:s.path))return!1;return!0}var af=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}setLoginIcon(){let e=this.view.containerEl.querySelector(".view-header"),t=this.view.containerEl.querySelector(".view-header-left");if(e&&t){this.clearLoginButton();let r=document.createElement("button");r.className="view-header-left system3-login-button",r.textContent="Login to enable Live edits",r.setAttribute("aria-label","Login to enable Live edits"),r.setAttribute("tabindex","0"),r.addEventListener("click",async()=>{await this.login()}),t.insertAdjacentElement("afterend",r)}}clearLoginButton(){let e=this.view.containerEl.querySelector(".system3-login-button");e&&e.remove()}attach(){return Jt.Platform.isMobile&&(0,Jt.requireApiVersion)("1.11.0")?this.setLoginIcon():this.banner=new vs(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy(),this.clearLoginButton()}destroy(){var e;this.release(),(e=this.banner)==null||e.destroy(),this.banner=void 0,this.clearLoginButton(),this.view=null}};function so(o){return o instanceof Hn&&o.view instanceof Jt.MarkdownView&&o.document!==void 0&&o.document.text!==void 0}function ws(o){return o instanceof Hn&&o.document!==void 0&&o.document.text!==void 0}function hE(o){return o instanceof lf&&o.document!==void 0}var lf=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this.tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}offlineBanner(){if(this.shouldConnect){let e=new vs(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Sm({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.view.containerEl.addClass("relay-live-editor"),this.setConnectionDot(),this.plugin||(this.plugin=new rf(this._parent,this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;this.view.containerEl.removeClass("relay-live-editor"),(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),(r=(t=this.view.leaf).rebuildView)==null||r.call(t),this._parent=null,this.view=null,this.canvas=null}},Hn=class extends st{constructor(e,t,r,n=!0,s=!0){super(),this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}get connectionManager(){return this._parent}setMergeButton(){let e=this.view.containerEl.querySelector(".view-header"),t=this.view.containerEl.querySelector(".view-header-left");if(e&&t){this.clearMergeButton();let r=document.createElement("button");r.className="view-header-left system3-merge-button",r.textContent="Merge conflict",r.setAttribute("aria-label","Merge conflict -- click to resolve"),r.setAttribute("tabindex","0"),r.addEventListener("click",async()=>{let n=await this.document.diskBuffer();if(!await this.document.checkStale()){this.clearMergeButton();return}this._parent.openDiffView({file1:this.document,file2:n,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer(),this.clearMergeButton(),this._plugin&&typeof this._plugin.syncViewToCRDT=="function"&&await this._plugin.syncViewToCRDT()}})}),t.insertAdjacentElement("afterend",r)}}clearMergeButton(){let e=this.view.containerEl.querySelector(".system3-merge-button");e&&e.remove()}mergeBanner(){return Jt.Platform.isMobile&&(0,Jt.requireApiVersion)("1.11.0")?this.setMergeButton():this._banner=new vs(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer(),this._plugin&&typeof this._plugin.syncViewToCRDT=="function"&&await this._plugin.syncViewToCRDT()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new vs(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Sm({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;if(this.view instanceof Jt.MarkdownView&&this.view.getMode()==="preview")return!1;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){var e,t,r;return this.document.userLock=!0,this.view instanceof Jt.MarkdownView&&this.view.containerEl.addClass("relay-live-editor"),this.view instanceof Jt.MarkdownView||this._plugin||(this.warn("[LiveView] Creating TextFileViewPlugin in attach() for:",{path:this.document.path,viewType:(t=(e=this.view).getViewType)==null?void 0:t.call(e),viewFilePath:(r=this.view.file)==null?void 0:r.path}),this._plugin=new sf(this)),this.setConnectionDot(),so(this)&&!this._awarenessPlugin&&ze().enablePresenceAvatars&&(this._awarenessPlugin=new nf(this,this._parent.sharedFolders.manager.users)),new Promise(n=>this.document.whenReady().then(s=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),n(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t,r,n;this.tracking&&this.document.save(),this.view instanceof Jt.MarkdownView&&this.view.containerEl.removeClass("relay-live-editor"),(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.clearMergeButton(),this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),(r=this._awarenessPlugin)==null||r.destroy(),this._awarenessPlugin=void 0,(n=this._plugin)==null||n.destroy(),this._plugin=void 0,this.document.disconnect(),this.document.userLock=!1}destroy(){var e,t;this.release(),this.clearViewActions(),this.clearMergeButton(),(t=(e=this.view.leaf).rebuildView)==null||t.call(e),this._parent=null,this.view=null,this.document=null,this._plugin=null}},cf=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new ff.Compartment,this.log=Re("[LiveViews]","log"),this.warn=Re("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,f)=>{let u=this.metadataListeners.get(l);u==null||u(c,f)},i=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let a=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(f=>{var u,d;((u=f.document)==null?void 0:u.sharedFolder)===l&&((d=f.offlineBanner)==null||d.call(f))})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,a(l))})})),Zt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([Wo.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){nx(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return Hm(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),Nm(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(Hm(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),Nm(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return Hm(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getDoc(r),a=new Hn(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new af(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),Nm(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n){let i=n.getVirtualPath(r),a=n.syncStore.getMeta(i);if((a==null?void 0:a.type)==="canvas")if(this.loginManager.loggedIn)if(n.ready){let l=n.proxy.getCanvas(r),c=new lf(this,t,l);e.push(c)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let l=new af(this,t,()=>this.loginManager.openLoginPage());e.push(l)}else this.log(`Skipping canvas view connection for ${r} - sync store type is ${(a==null?void 0:a.type)||"unknown"}`)}}),e}findView(e){return this.views.filter(so).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(hE).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(ws).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=pE){let r=this.workspace.getActiveViewOfType(Jt.TextFileView),n=0,s=e.sort((a,l)=>l.view.leaf.activeTime-a.view.leaf.activeTime),i=new Set;for(let a of s)a instanceof Hn&&(a.view===r||i.has(a.document)?(a.canConnect=!0,i.add(a.document)):n<t?(a.canConnect=!0,i.add(a.document),n++):a.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(i=>{if(n.document==i.document&&n.view==i.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Re(r,"debug"),s=(u,d)=>{n(u,d.map(p=>{var m;return{type:p.constructor.name,file:(m=p.document)==null?void 0:m.path,canConnect:p.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let i=[];try{i=await this.getViews()}catch(u){return this.warn("[System 3][Relay][Live Views] error getting views",u),!1}let a=this.findFolders();if(a.length===0&&i.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?a.forEach(u=>{u.connect()}):this.sharedFolders.forEach(u=>{u.disconnect()});let[l,c]=this.deduplicate(i);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&mE(l,this.views)){let u=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",u)}else{let u=await this.viewsReady(l);s("Ready Views",u);let d=await this.viewsAttachedWithConnectionPool(u);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let f=Jt.moment.utc();return n(`refresh completed in ${f.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Re(e,"warn"),r=Jt.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(Wo.init(()=>this)),Kv,ax,Jv,Qv,Xv]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},Wo=ff.StateField.define({create(o){},update(o,e){return o}});var ki=require("obsidian");function gE(o){Ee(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function bx(o){let e,t,r,n;return{c(){e=x("span"),t=K(o[3]),r=K("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),le(e,"opacity","1")},m(s,i){S(s,e,i),b(e,t),b(e,r)},p(s,i){i&8&&te(t,s[3]),i&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&_(e)}}}function yE(o){let e,t,r;return t=new _o({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=x("span"),D(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){S(n,e,s),A(t,e,null),r=!0},p:z,i(n){r||(v(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function bE(o){let e,t,r,n,s,i,a,l;return t=new _o({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new mn({props:{class:"inline-icon"}}),{c(){var c;e=x("span"),D(t.$$.fragment),r=T(),n=x("span"),D(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",i="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",a=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,f){S(c,e,f),A(t,e,null),S(c,r,f),S(c,n,f),A(s,n,null),l=!0},p(c,f){var u;(!l||f&1&&i!==(i="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",i),(!l||f&5&&a!==(a=`${((u=c[2])==null?void 0:u.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",a)},i(c){l||(v(t.$$.fragment,c),v(s.$$.fragment,c),l=!0)},o(c){k(t.$$.fragment,c),k(s.$$.fragment,c),l=!1},d(c){c&&(_(e),_(r),_(n)),R(t),R(s)}}}function vE(o){let e,t,r,n,s,i=o[5]&&bx(o),a=[bE,yE],l=[];function c(f,u){return f[1]?0:1}return r=c(o,-1),n=l[r]=a[r](o),{c(){e=x("div"),i&&i.c(),t=T(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(f,u){S(f,e,u),i&&i.m(e,null),b(e,t),l[r].m(e,null),s=!0},p(f,[u]){f[5]?i?i.p(f,u):(i=bx(f),i.c(),i.m(e,t)):i&&(i.d(1),i=null);let d=r;r=c(f,u),r===d?l[r].p(f,u):(ce(),k(l[d],1,1,()=>{l[d]=null}),fe(),n=l[r],n?n.p(f,u):(n=l[r]=a[r](f),n.c()),v(n,1),n.m(e,null))},i(f){s||(v(n),s=!0)},o(f){k(n),s=!1},d(f){f&&_(e),i&&i.d(),l[r].d()}}}function xE(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:i}=e,{progress:a=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,i=c.remote),"progress"in c&&t(3,a=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{o.$$.dirty&24&&t(5,r=(l!=="completed"||a<100)&&a>0)},[n,s,i,a,l,r]}var qm=class extends Z{constructor(e){super(),ee(this,e,xE,vE,X,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},gE)}},vx=qm;function wE(o){Ee(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function _E(o){let e,t,r;return{c(){e=x("div"),t=x("span"),r=K(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){S(n,e,s),b(e,t),b(t,r)},p(n,[s]){s&1&&te(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:z,o:z,d(n){n&&_(e)}}}function SE(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var Wm=class extends Z{constructor(e){super(),ee(this,e,SE,_E,X,{text:0,label:1},wE)}},xx=Wm;function kE(o){Ee(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function IE(o){let e,t,r,n;return{c(){e=x("div"),t=x("span"),r=K(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,i){S(s,e,i),b(e,t),b(t,r)},p(s,[i]){i&1&&te(r,s[0]),i&2&&h(e,"aria-label",s[1]),i&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:z,o:z,d(s){s&&_(e)}}}function CE(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=i=>{"text"in i&&t(0,r=i.text),"label"in i&&t(1,n=i.label),"color"in i&&t(2,s=i.color)},[r,n,s]}var jm=class extends Z{constructor(e){super(),ee(this,e,CE,IE,X,{text:0,label:1,color:2},kE)}},wx=jm;var zm=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},qn=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Km=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new zm(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Gm=class extends qn{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Km(t.selfEl,n):(r&&r.destroy(),null)}},Jm=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new vx({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Qm=class extends qn{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Jm(t.selfEl,n):(r&&r.destroy(),null)}},Ym=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Xm=class extends qn{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&Rt.checkExtension(t.path)?n||new Ym(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Zm=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new wx({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},eh=class extends qn{visitFile(e,t,r,n){if(n&&!Rt.checkExtension(e.path)&&!Nt.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected)try{let s=n.proxy.viewSyncFile(e.path);if(s&&Er(s))return r&&r.file===s?r:new Zm(t.selfEl,s)}catch(s){Re("FilePillVisitor.visitFile","error")(s)}return r&&r.destroy(),null}},th=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new xx({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},rh=class extends qn{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new th(t.selfEl):(r&&r.destroy(),null)}},oh=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},nh=class extends qn{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),i=n.syncStore.get(s);if(!i)return null;let a=n.files.get(i);return!(a instanceof Rt)||!a?null:r||new oh(t.el,a,e)}catch(s){return null}return r&&r.destroy(),null}},uf=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,i)=>{let a=s.get(n),l=i.visitFolder(e,n,a,r);a&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof ki.TFolder)this.walk(s,r);else if(s instanceof ki.TFile){let i=this.getFileExplorerItem(this.fileExplorer,s);if(!i)return;this.storage.forEach((a,l)=>{let c=a.get(i),f=l.visitFile(s,i,c,r);c&&!f?a.delete(i):f&&a.set(i,f)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},df=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Nb([on.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(i=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(i=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new Gm),e.push(new Qm),Pn(on.enableDocumentStatus,()=>{e.push(new nh),e.push(new Xm(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new eh),e.push(new rh),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new uf(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let i=this.vault.getAbstractFileByPath(s);i instanceof ki.TFolder&&n.walk(i)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new uf(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof ki.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Z_=require("obsidian");function Ae(o,e,t,r){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(f){try{c(r.next(f))}catch(u){i(u)}}function l(f){try{c(r.throw(f))}catch(u){i(u)}}function c(f){f.done?s(f.value):n(f.value).then(a,l)}c((r=r.apply(o,e||[])).next())})}var So=require("obsidian");function LE(o){let e,t,r;return{c(){e=ir("svg"),t=ir("g"),r=ir("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){S(n,e,s),b(e,t),b(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:z,o:z,d(n){n&&_(e)}}}function EE(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var sh=class extends Z{constructor(e){super(),ee(this,e,EE,LE,X,{size:0})}},pf=sh;function TE(o){Ee(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function _x(o){let e,t,r,n,s,i,a,l,c,f,u,d,p;return a=new pf({props:{size:20}}),{c(){e=x("div"),t=x("div"),r=T(),n=x("div"),s=x("span"),i=x("a"),D(a.$$.fragment),l=T(),c=x("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(i,"href","https://discord.system3.md"),h(i,"target","_blank"),h(i,"rel","noopener noreferrer"),h(i,"class","menu-item svelte-4t8k3t"),le(s,"text-align","center"),le(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(m,y){S(m,e,y),b(e,t),b(e,r),b(e,n),b(n,s),b(s,i),A(a,i,null),b(i,l),b(i,c),u=!0,d||(p=hs(f=o[1].call(null,e)),d=!0)},i(m){u||(v(a.$$.fragment,m),u=!0)},o(m){k(a.$$.fragment,m),u=!1},d(m){m&&_(e),R(a),d=!1,p()}}}function FE(o){let e,t,r,n,s,i,a;r=new um({props:{size:"20px"}});let l=o[0]&&_x(o);return{c(){e=x("div"),t=x("button"),D(r.$$.fragment),n=T(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,f){S(c,e,f),b(e,t),A(r,t,null),b(e,n),l&&l.m(e,null),s=!0,i||(a=j(t,"click",Uc(o[2])),i=!0)},p(c,[f]){c[0]?l?f&1&&v(l,1):(l=_x(c),l.c(),v(l,1),l.m(e,null)):l&&(ce(),k(l,1,1,()=>{l=null}),fe())},i(c){s||(v(r.$$.fragment,c),v(l),s=!0)},o(c){k(r.$$.fragment,c),k(l),s=!1},d(c){c&&_(e),R(r),l&&l.d(),i=!1,a()}}}function PE(o,e,t){let r=!1;function n(i){let a=l=>{let c=document.querySelector(".menu-button");!i.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",a)},0),{destroy(){document.removeEventListener("click",a)}}}function s(i){i.stopPropagation(),t(0,r=!r)}return[r,n,s]}var ih=class extends Z{constructor(e){super(),ee(this,e,PE,FE,X,{},TE)}},Sx=ih;function AE(o){Ee(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function RE(o){let e,t;return{c(){e=ir("svg"),t=ir("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){S(r,e,n),b(e,t)},p:z,i:z,o:z,d(r){r&&_(e)}}}function ME(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=i=>{"size"in i&&t(2,r=i.size)},[n,s,r]}var ah=class extends Z{constructor(e){super(),ee(this,e,ME,RE,X,{size:2},AE)}},mf=ah;function DE(o){Ee(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function UE(o){let e,t,r,n,s,i;return e=new mf({props:{size:140}}),{c(){D(e.$$.fragment),t=T(),r=x("p"),r.textContent="Real-time collaboration in Obsidian",n=T(),s=x("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(a,l){A(e,a,l),S(a,t,l),S(a,r,l),S(a,n,l),S(a,s,l),i=!0},p:z,i(a){i||(v(e.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),i=!1},d(a){a&&(_(t),_(r),_(n),_(s)),R(e,a)}}}var lh=class extends Z{constructor(e){super(),ee(this,e,null,UE,X,{},DE)}},kx=lh;var hf=require("obsidian");function OE(o){Ee(o,"svelte-1rfjxfa",`.help-section.svelte-1rfjxfa{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1rfjxfa{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1rfjxfa{position:relative;max-width:640px;margin:0 auto}.why-signin.svelte-1rfjxfa:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-signin.svelte-1rfjxfa{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-signin.svelte-1rfjxfa:hover{color:var(--text-normal)}.help-content.svelte-1rfjxfa{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1rfjxfa{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1rfjxfa{opacity:1;visibility:visible}.popover.svelte-1rfjxfa:not(.visible){transition-delay:0s}.arrow.svelte-1rfjxfa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1rfjxfa{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function $E(o){let e,t,r,n;return{c(){e=x("div"),t=x("div"),r=T(),n=x("p"),n.textContent=`${Cx}`,h(t,"class","arrow svelte-1rfjxfa"),h(e,"class","popover svelte-1rfjxfa"),Te(e,"visible",o[0])},m(s,i){S(s,e,i),b(e,t),b(e,r),b(e,n),o[9](e)},p(s,i){i&1&&Te(e,"visible",s[0])},d(s){s&&_(e),o[9](null)}}}function BE(o){let e,t=o[0]&&Ix(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),S(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=Ix(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function Ix(o){let e,t;return{c(){e=x("div"),t=x("p"),t.textContent=`${Cx}`,h(e,"class","help-content svelte-1rfjxfa")},m(r,n){S(r,e,n),b(e,t)},p:z,d(r){r&&_(e)}}}function VE(o){let e,t,r,n,s,i,a,l,c,f,u,d;function p(g,I){return g[1]?BE:$E}let m=p(o,-1),y=m(o);return l=new pf({}),{c(){e=x("div"),t=x("div"),r=x("button"),r.textContent="Why do I need to sign in?",n=T(),y.c(),s=T(),i=x("div"),a=x("a"),D(l.$$.fragment),c=K(`
		Join the project on Discord`),h(r,"class","why-signin svelte-1rfjxfa"),Te(r,"mobile",o[1]),h(t,"class","help-container svelte-1rfjxfa"),h(e,"class","help-section svelte-1rfjxfa"),h(a,"href","https://discord.system3.md"),h(a,"class","discord-link svelte-1rfjxfa"),h(i,"class","footer svelte-1rfjxfa")},m(g,I){S(g,e,I),b(e,t),b(t,r),o[8](r),b(t,n),y.m(t,null),S(g,s,I),S(g,i,I),b(i,a),A(l,a,null),b(a,c),f=!0,u||(d=[j(r,"mouseenter",o[4]),j(r,"mouseleave",o[5]),j(r,"click",o[6])],u=!0)},p(g,[I]){(!f||I&2)&&Te(r,"mobile",g[1]),m===(m=p(g,I))&&y?y.p(g,I):(y.d(1),y=m(g),y&&(y.c(),y.m(t,null)))},i(g){f||(v(l.$$.fragment,g),f=!0)},o(g){k(l.$$.fragment,g),f=!1},d(g){g&&(_(e),_(s),_(i)),o[8](null),y.d(),R(l),u=!1,xe(d)}}}var Cx="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. Using an identity provider helps to prevent spam accounts and ensures secure authentication.";function NE(o,e,t){var r;let n=!1,s=!1,i,a;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function f(){s&&t(0,n=!n)}function u(p){vt[p?"unshift":"push"](()=>{i=p,t(2,i)})}function d(p){vt[p?"unshift":"push"](()=>{a=p,t(3,a)})}return o.$$.update=()=>{o.$$.dirty&128&&t(1,s=t(7,r=hf.Platform===null||hf.Platform===void 0?void 0:hf.Platform.isMobile)!==null&&r!==void 0?r:!1)},[n,s,i,a,l,c,f,r,u,d]}var ch=class extends Z{constructor(e){super(),ee(this,e,NE,VE,X,{},OE)}},Lx=ch;var uQ=require("obsidian");function HE(o){Ee(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function qE(o){let e,t,r,n,s,i=(o[0].name||"")+"",a,l,c,f,u=(o[0].email||"")+"",d,p,m,y;t=new Ua({props:{size:"2.5em",user:o[0]}});let g=o[2].default,I=ke(g,o,o[1],null);return{c(){e=x("div"),D(t.$$.fragment),r=T(),n=x("div"),s=x("div"),a=K(i),l=T(),c=x("br"),f=T(),d=K(u),p=T(),m=x("div"),I&&I.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),le(n,"display","grid"),h(m,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(L,C){S(L,e,C),A(t,e,null),b(e,r),b(e,n),b(n,s),b(s,a),b(s,l),b(s,c),b(s,f),b(s,d),b(e,p),b(e,m),I&&I.m(m,null),y=!0},p(L,[C]){let w={};C&1&&(w.user=L[0]),t.$set(w),(!y||C&1)&&i!==(i=(L[0].name||"")+"")&&te(a,i),(!y||C&1)&&u!==(u=(L[0].email||"")+"")&&te(d,u),I&&I.p&&(!y||C&2)&&Ce(I,g,L,L[1],y?Ie(g,L[1],C,null):Le(L[1]),null)},i(L){y||(v(t.$$.fragment,L),v(I,L),y=!0)},o(L){k(t.$$.fragment,L),k(I,L),y=!1},d(L){L&&_(e),R(t),I&&I.d(L)}}}function WE(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=i=>{"user"in i&&t(0,s=i.user),"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var fh=class extends Z{constructor(e){super(),ee(this,e,WE,qE,X,{user:0},HE)}},Ii=fh;var gf=require("obsidian");function jE(o){Ee(o,"svelte-1da9go9",".help-container.svelte-1da9go9.svelte-1da9go9{position:relative;display:inline-block}button.svelte-1da9go9.svelte-1da9go9{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-1da9go9.svelte-1da9go9:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-1da9go9.svelte-1da9go9:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.help-container.svelte-1da9go9>.popover.svelte-1da9go9{position:absolute;z-index:70;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.help-container.svelte-1da9go9>.popover.left.svelte-1da9go9{right:100%;margin-right:8px}.help-container.svelte-1da9go9>.popover.right.svelte-1da9go9{left:0}.arrow.svelte-1da9go9.svelte-1da9go9{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-1da9go9.svelte-1da9go9{right:8px}.arrow.right.svelte-1da9go9.svelte-1da9go9{left:8px}p.svelte-1da9go9.svelte-1da9go9{margin:0;color:var(--text-normal)}")}function Ex(o){let e,t,r,n,s;return{c(){e=x("div"),t=x("div"),r=T(),n=x("p"),s=K(o[0]),h(t,"class","arrow svelte-1da9go9"),Te(t,"left",o[4]==="left"),Te(t,"right",o[4]==="right"),h(n,"class","svelte-1da9go9"),h(e,"class","popover svelte-1da9go9"),Te(e,"left",o[4]==="left"),Te(e,"right",o[4]==="right")},m(i,a){S(i,e,a),b(e,t),b(e,r),b(e,n),b(n,s),o[9](e)},p(i,a){a&16&&Te(t,"left",i[4]==="left"),a&16&&Te(t,"right",i[4]==="right"),a&1&&te(s,i[0]),a&16&&Te(e,"left",i[4]==="left"),a&16&&Te(e,"right",i[4]==="right")},d(i){i&&_(e),o[9](null)}}}function zE(o){let e,t,r,n,s,i,a;r=new Fa({props:{size:16}});let l=o[1]&&Ex(o);return{c(){e=x("div"),t=x("button"),D(r.$$.fragment),n=T(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-1da9go9"),h(e,"class","help-container svelte-1da9go9")},m(c,f){S(c,e,f),b(e,t),A(r,t,null),o[8](t),b(e,n),l&&l.m(e,null),s=!0,i||(a=[j(t,"mouseenter",o[5]),j(t,"mouseleave",o[6]),j(t,"click",o[7])],i=!0)},p(c,[f]){c[1]?l?l.p(c,f):(l=Ex(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(v(r.$$.fragment,c),s=!0)},o(c){k(r.$$.fragment,c),s=!1},d(c){c&&_(e),R(r),o[8](null),l&&l.d(),i=!1,xe(a)}}}function KE(o,e,t){let{helpText:r}=e,n=!1,s="right",i,a;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function f(){t(1,n=!n)}function u(p){vt[p?"unshift":"push"](()=>{i=p,t(2,i)})}function d(p){vt[p?"unshift":"push"](()=>{a=p,t(3,a)})}return o.$$set=p=>{"helpText"in p&&t(0,r=p.helpText)},o.$$.update=()=>{if(o.$$.dirty&14&&n&&i&&a){let p=i.getBoundingClientRect(),m=a.getBoundingClientRect(),y=window.innerWidth;t(4,s=p.right+m.width>y-20?"left":"right")}},[r,n,i,a,s,l,c,f,u,d]}var uh=class extends Z{constructor(e){super(),ee(this,e,KE,zE,X,{helpText:0},jE)}},Tx=uh;function GE(o){Ee(o,"svelte-5o4y9d",".setting-item-name.svelte-5o4y9d{display:flex;align-items:center;gap:8px;overflow:unset}.help-button.svelte-5o4y9d{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-5o4y9d:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-5o4y9d:active{color:var(--text-normal)}.help-content.svelte-5o4y9d{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-5o4y9d{margin:0}")}var JE=o=>({}),Fx=o=>({}),QE=o=>({}),Px=o=>({}),YE=o=>({}),Ax=o=>({});function XE(o){let e;return{c(){e=K(o[0])},m(t,r){S(t,e,r)},p(t,r){r&1&&te(e,t[0])},d(t){t&&_(e)}}}function Rx(o){let e,t,r,n,s=[eT,ZE],i=[];function a(l,c){return l[3]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r))},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function ZE(o){let e,t;return e=new Tx({props:{helpText:o[1]}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function eT(o){let e,t,r,n,s;return t=new Fa({props:{size:16}}),{c(){e=x("button"),D(t.$$.fragment),h(e,"class","help-button svelte-5o4y9d"),h(e,"aria-expanded",o[2])},m(i,a){S(i,e,a),A(t,e,null),r=!0,n||(s=j(e,"click",o[4]),n=!0)},p(i,a){(!r||a&4)&&h(e,"aria-expanded",i[2])},i(i){r||(v(t.$$.fragment,i),r=!0)},o(i){k(t.$$.fragment,i),r=!1},d(i){i&&_(e),R(t),n=!1,s()}}}function tT(o){let e,t,r=o[7].description,n=ke(r,o,o[6],Fx);return{c(){e=x("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,i){S(s,e,i),n&&n.m(e,null),t=!0},p(s,i){n&&n.p&&(!t||i&64)&&Ce(n,r,s,s[6],t?Ie(r,s[6],i,JE):Le(s[6]),Fx)},i(s){t||(v(n,s),t=!0)},o(s){k(n,s),t=!1},d(s){s&&_(e),n&&n.d(s)}}}function Mx(o){let e,t,r;return{c(){e=x("div"),t=x("p"),r=K(o[1]),h(t,"class","svelte-5o4y9d"),h(e,"class","help-content svelte-5o4y9d"),Te(e,"expanded",o[2])},m(n,s){S(n,e,s),b(e,t),b(t,r)},p(n,s){s&2&&te(r,n[1]),s&4&&Te(e,"expanded",n[2])},d(n){n&&_(e)}}}function rT(o){let e,t,r,n,s,i,a,l,c,f=o[7].name,u=ke(f,o,o[6],Ax),d=u||XE(o),p=o[1]&&Rx(o),m=o[7].description,y=ke(m,o,o[6],Px),g=y||tT(o),I=o[1]&&o[2]&&o[3]&&Mx(o),L=o[7].default,C=ke(L,o,o[6],null);return{c(){e=x("div"),t=x("div"),r=x("div"),d&&d.c(),n=T(),p&&p.c(),s=T(),g&&g.c(),i=T(),I&&I.c(),a=T(),l=x("div"),C&&C.c(),h(r,"class","setting-item-name svelte-5o4y9d"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(w,E){S(w,e,E),b(e,t),b(t,r),d&&d.m(r,null),b(r,n),p&&p.m(r,null),b(t,s),g&&g.m(t,null),b(t,i),I&&I.m(t,null),b(e,a),b(e,l),C&&C.m(l,null),c=!0},p(w,[E]){u?u.p&&(!c||E&64)&&Ce(u,f,w,w[6],c?Ie(f,w[6],E,YE):Le(w[6]),Ax):d&&d.p&&(!c||E&1)&&d.p(w,c?E:-1),w[1]?p?(p.p(w,E),E&2&&v(p,1)):(p=Rx(w),p.c(),v(p,1),p.m(r,null)):p&&(ce(),k(p,1,1,()=>{p=null}),fe()),y?y.p&&(!c||E&64)&&Ce(y,m,w,w[6],c?Ie(m,w[6],E,QE):Le(w[6]),Px):g&&g.p&&(!c||E&64)&&g.p(w,c?E:-1),w[1]&&w[2]&&w[3]?I?I.p(w,E):(I=Mx(w),I.c(),I.m(t,null)):I&&(I.d(1),I=null),C&&C.p&&(!c||E&64)&&Ce(C,L,w,w[6],c?Ie(L,w[6],E,null):Le(w[6]),null)},i(w){c||(v(d,w),v(p),v(g,w),v(C,w),c=!0)},o(w){k(d,w),k(p),k(g,w),k(C,w),c=!1},d(w){w&&_(e),d&&d.d(w),p&&p.d(),g&&g.d(w),I&&I.d(),C&&C.d(w)}}}function oT(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:i=""}=e,{helpText:a=void 0}=e,l=!1,c=!1;function f(){c&&t(2,l=!l)}return o.$$set=u=>{"name"in u&&t(0,i=u.name),"helpText"in u&&t(1,a=u.helpText),"$$scope"in u&&t(6,n=u.$$scope)},o.$$.update=()=>{o.$$.dirty&32&&t(3,c=t(5,s=gf.Platform===null||gf.Platform===void 0?void 0:gf.Platform.isMobile)!==null&&s!==void 0?s:!1)},[i,a,l,c,f,s,n,r]}var dh=class extends Z{constructor(e){super(),ee(this,e,oT,rT,X,{name:0,helpText:1},GE)}},Ze=dh;function nT(o){Ee(o,"svelte-mxb9if",".continue.svelte-mxb9if.svelte-mxb9if{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-mxb9if.svelte-mxb9if{color:var(--text-muted)}.link.svelte-mxb9if.svelte-mxb9if:hover{color:var(--text-normal)}.not-working.svelte-mxb9if.svelte-mxb9if{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-mxb9if.svelte-mxb9if{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-mxb9if.svelte-mxb9if:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-mxb9if.svelte-mxb9if{height:auto;padding:0}.welcome.svelte-mxb9if.svelte-mxb9if{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.choose-another.svelte-mxb9if.svelte-mxb9if{text-align:center;margin-top:0.25rem;margin-bottom:1rem;font-size:0.85em;color:var(--text-normal)}.login-form.svelte-mxb9if.svelte-mxb9if{display:flex;flex-direction:column;gap:0.75rem;max-width:400px;margin:0 auto}.login-form.svelte-mxb9if input.svelte-mxb9if{padding:0.5rem 0.75rem;border:1px solid var(--background-modifier-border);border-radius:0.25rem;background:var(--background-primary);color:var(--text-normal);font-size:0.95em}.login-form.svelte-mxb9if input.svelte-mxb9if:focus{outline:none;border-color:var(--interactive-accent)}.login-form.svelte-mxb9if input.svelte-mxb9if:disabled{opacity:0.5;cursor:not-allowed}.email-sign-in-button.svelte-mxb9if.svelte-mxb9if{padding:0.5rem 1rem;background:var(--interactive-accent);color:var(--text-on-accent);border:none;border-radius:0.25rem;cursor:pointer;font-size:0.95em;font-weight:500}.email-sign-in-button.svelte-mxb9if.svelte-mxb9if:hover:not(:disabled){background:var(--interactive-accent-hover)}.email-sign-in-button.svelte-mxb9if.svelte-mxb9if:disabled{opacity:0.5;cursor:not-allowed}")}function sT(o){let e,t,r,n,s,i,a,l,c,f=o[6]?"Signing in...":"Sign in",u,d,p,m,y,g,I,L,C;t=new kx({});function w(V,P){if(V[7])return lT;if(V[6])return aT}let E=w(o,[-1,-1]),F=E&&E(o),U=o[4].provider&&!o[6]&&Ux(o);return g=new Lx({}),{c(){e=x("div"),D(t.$$.fragment),r=T(),n=x("div"),s=x("input"),i=T(),a=x("input"),l=T(),c=x("button"),u=K(f),p=T(),F&&F.c(),m=T(),U&&U.c(),y=T(),D(g.$$.fragment),h(s,"type","email"),h(s,"placeholder","your@email.com"),s.disabled=o[6],h(s,"class","svelte-mxb9if"),h(a,"type","password"),h(a,"placeholder","Password"),a.disabled=o[6],h(a,"class","svelte-mxb9if"),h(c,"class","email-sign-in-button svelte-mxb9if"),c.disabled=d=o[6]||!o[3]||!o[2],h(n,"class","login-form svelte-mxb9if"),h(e,"class","welcome svelte-mxb9if")},m(V,P){S(V,e,P),A(t,e,null),b(e,r),b(e,n),b(n,s),Ke(s,o[3]),b(n,i),b(n,a),Ke(a,o[2]),b(n,l),b(n,c),b(c,u),b(e,p),F&&F.m(e,null),S(V,m,P),U&&U.m(V,P),S(V,y,P),A(g,V,P),I=!0,L||(C=[j(s,"input",o[30]),j(s,"keydown",o[31]),j(a,"input",o[32]),j(a,"keydown",o[33]),j(c,"click",(0,So.debounce)(o[24]))],L=!0)},p(V,P){(!I||P[0]&64)&&(s.disabled=V[6]),P[0]&8&&s.value!==V[3]&&Ke(s,V[3]),(!I||P[0]&64)&&(a.disabled=V[6]),P[0]&4&&a.value!==V[2]&&Ke(a,V[2]),(!I||P[0]&64)&&f!==(f=V[6]?"Signing in...":"Sign in")&&te(u,f),(!I||P[0]&76&&d!==(d=V[6]||!V[3]||!V[2]))&&(c.disabled=d),E===(E=w(V,P))&&F?F.p(V,P):(F&&F.d(1),F=E&&E(V),F&&(F.c(),F.m(e,null))),V[4].provider&&!V[6]?U?U.p(V,P):(U=Ux(V),U.c(),U.m(y.parentNode,y)):U&&(U.d(1),U=null)},i(V){I||(v(t.$$.fragment,V),v(g.$$.fragment,V),I=!0)},o(V){k(t.$$.fragment,V),k(g.$$.fragment,V),I=!1},d(V){V&&(_(e),_(m),_(y)),R(t),F&&F.d(),U&&U.d(V),R(g,V),L=!1,xe(C)}}}function iT(o){let e,t,r,n,s,i,a;e=new Ze({props:{$$slots:{name:[fT],default:[cT]},$$scope:{ctx:o}}}),r=new Ze({props:{name:"Account"}}),s=new Ii({props:{user:o[5].user,$$slots:{default:[uT]},$$scope:{ctx:o}}});let l=o[28].default,c=ke(l,o,o[38],null);return{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment),n=T(),D(s.$$.fragment),i=T(),c&&c.c()},m(f,u){A(e,f,u),S(f,t,u),A(r,f,u),S(f,n,u),A(s,f,u),S(f,i,u),c&&c.m(f,u),a=!0},p(f,u){let d={};u[1]&128&&(d.$$scope={dirty:u,ctx:f}),e.$set(d);let p={};u[0]&32&&(p.user=f[5].user),u[1]&128&&(p.$$scope={dirty:u,ctx:f}),s.$set(p),c&&c.p&&(!a||u[1]&128)&&Ce(c,l,f,f[38],a?Ie(l,f[38],u,null):Le(f[38]),null)},i(f){a||(v(e.$$.fragment,f),v(r.$$.fragment,f),v(s.$$.fragment,f),v(c,f),a=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(s.$$.fragment,f),k(c,f),a=!1},d(f){f&&(_(t),_(n),_(i)),R(e,f),R(r,f),R(s,f),c&&c.d(f)}}}function aT(o){let e,t,r,n,s,i,a,l;return{c(){e=x("div"),t=x("p"),t.textContent="Continue in your browser...",r=T(),n=x("p"),s=K(`Not working?
					`),i=x("button"),i.textContent="(try again)",h(t,"class","continue svelte-mxb9if"),h(i,"class","link link-button svelte-mxb9if"),h(n,"class","not-working svelte-mxb9if")},m(c,f){S(c,e,f),b(e,t),b(e,r),b(e,n),b(n,s),b(n,i),a||(l=j(i,"click",o[36]),a=!0)},p:z,d(c){c&&_(e),a=!1,l()}}}function lT(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[8]&&o[1]&&Dx(o);return{c(){e=x("p"),t=K(o[7]),r=K("."),n=x("br"),s=T(),d&&d.c(),i=T(),a=x("p"),l=K(`Not working?
				`),c=x("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-mxb9if"),h(a,"class","not-working svelte-mxb9if")},m(p,m){S(p,e,m),b(e,t),b(e,r),b(e,n),b(e,s),d&&d.m(e,null),S(p,i,m),S(p,a,m),b(a,l),b(a,c),f||(u=j(c,"click",o[35]),f=!0)},p(p,m){m[0]&128&&te(t,p[7]),p[8]&&p[1]?d?d.p(p,m):(d=Dx(p),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(p){p&&(_(e),_(i),_(a)),d&&d.d(),f=!1,u()}}}function Dx(o){let e,t,r,n;return{c(){e=K("Already logged in? "),t=x("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-mxb9if")},m(s,i){S(s,e,i),S(s,t,i),r||(n=j(t,"click",function(){nt((0,So.debounce)(o[34]))&&(0,So.debounce)(o[34]).apply(this,arguments)}),r=!0)},p(s,i){o=s},d(s){s&&(_(e),_(t)),r=!1,n()}}}function Ux(o){let e,t,r,n;return{c(){e=x("p"),t=x("button"),t.textContent="(choose another provider)",h(t,"class","link link-button svelte-mxb9if"),h(e,"class","choose-another svelte-mxb9if")},m(s,i){S(s,e,i),b(e,t),r||(n=j(t,"click",(0,So.debounce)(o[37])),r=!0)},p:z,d(s){s&&_(e),r=!1,n()}}}function cT(o){let e,t;return e=new Sx({}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function fT(o){let e,t;return e=new mf({props:{slot:"name"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p:z,i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uT(o){let e,t,r;return{c(){e=x("button"),e.textContent="Logout"},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,So.debounce)(o[29])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function dT(o){let e,t,r,n,s=[iT,sT],i=[];function a(l,c){return l[5].hasUser&&l[5].user?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r))},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}var pT="system3-relay-auth-providers-";function mT(o){return o?o=="oidc"?"OIDC":o=="github"?"GitHub":o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}function hT(o,e,t){let r,n,s,i,a,l,c,f,u,d,p=z,m=()=>(p(),p=Ht(F,_e=>t(5,d=_e)),F),y,g,I;o.$$.on_destroy.push(()=>p());let{$$slots:L={},$$scope:C}=e,{plugin:w}=e,E=Re("LoggedIn.svelte","error"),F,U=we(!So.Platform.isIosApp),V=we(!1);de(o,V,_e=>t(6,y=_e)),m(F=w.loginManager);let P=we(!1);de(o,P,_e=>t(8,I=_e));let $=we(!1),re=we(!0);de(o,re,_e=>t(41,s=_e));let W=we("");de(o,W,_e=>t(1,r=_e));let q=Ir.getInstance();de(o,q,_e=>t(42,l=_e));let M=we("");de(o,M,_e=>t(3,a=_e));let G=we("");de(o,G,_e=>t(2,i=_e));let B={},Q=we(!1);de(o,Q,_e=>t(44,f=_e));let N=F.loginSettings;de(o,N,_e=>t(4,u=_e));let O=we([]);de(o,O,_e=>t(43,c=_e));let J=we(!1);function oe(){var _e;let Xe=((_e=F.pb)===null||_e===void 0?void 0:_e.baseUrl)||"default";return`${pT}${Xe}`}function me(){let _e=["github","google","microsoft"];return l.getFlag("enableDiscordLogin")&&_e.push("discord"),_e}function he(){try{let _e=oe(),Xe=localStorage.getItem(_e);if(Xe)return JSON.parse(Xe)}catch(_e){E("Failed to load cached providers:",_e)}return me()}function se(_e){try{let Xe=oe();localStorage.setItem(Xe,JSON.stringify(_e))}catch(Xe){E("Failed to save cached providers:",Xe)}}let pe=at([W,q],()=>{let _e=["github","google","microsoft","oidc"];return l.getFlag("enableDiscordLogin")&&_e.push("discord"),_e});de(o,pe,_e=>t(40,n=_e));let Fe=at([W,F.loginSettings,q,Q,O],()=>{if(u&&u.provider)return[u.provider];if(r!=="")return[r];if(f&&Object.keys(B).length>0){let Xe=Object.keys(B),ft=[];Xe.includes("google")&&ft.push("google"),Xe.includes("microsoft")&&ft.push("microsoft"),Xe.includes("discord")&&l.getFlag("enableDiscordLogin")&&ft.push("discord"),Xe.includes("github")&&ft.push("github"),Xe.forEach(Oe=>{Oe.startsWith("oidc")&&ft.push(Oe)});let ie=JSON.stringify(ft.sort())!==JSON.stringify(c.sort());return J.set(ie),se(ft),ft}if(c.length>0&&!f)return c;let _e=["github","google","microsoft"];return l.getFlag("enableDiscordLogin")&&_e.push("discord"),_e});function ye(){F.clearPreferredProvider(),W.set(""),ko()}let Ue=at([W,w.loginSettings,q,Q],()=>r?[r]:Object.keys(B)),He=at([Q],()=>{var _e;let Xe={};for(let ft of Object.keys(B)){let ie=B[ft];!((_e=ie==null?void 0:ie.info)===null||_e===void 0)&&_e.displayName?Xe[ft]=ie.info.displayName:Xe[ft]=mT(ft)}return Xe}),Qe,rt=we("");de(o,rt,_e=>t(7,g=_e));function Ft(){return Ae(this,void 0,void 0,function*(){w.loginManager.logout(),$.set(!1),V.set(!1),W.set(""),P.set(!1)})}function qt(){return Ae(this,void 0,void 0,function*(){try{V.set(!0),rt.set(""),(yield F.loginWithEmailPassword(a,i))?($.set(!0),new So.Notice("Login successful!"),G.set("")):rt.set("Login failed. Please check your email and password")}catch(_e){E("Email/password login error:",_e),rt.set(_e.message||"Login failed. Please try again")}finally{V.set(!1)}})}function zn(_e){return Ae(this,void 0,void 0,function*(){try{W.set(_e),(yield w.loginManager.login(_e))&&$.set(!0)}catch(Xe){U.set(!1),$.set(!1);let ft=B[_e];ft&&(window.open(ft.fullAuthUrl,"_blank"),lr(_e))}})}let qr=we(w.loginManager.pb);function Wr(){qr.set(w.loginManager.pb)}function ko(){try{let _e=s?mt:fetch;F.initiateManualOAuth2CodeFlow(_e,n).then(Xe=>{B=Xe,Q.set(!0),F.updateWebviewIntercepts(Xe)}).catch(Xe=>{let ft=Xe.message;throw ft=ft,rt.set(ft),$.set(!1),W.set(""),Xe})}catch(_e){rt.set(_e.message)}}dt(()=>{$.set(!1);let _e=he();O.set(_e),ko()});function lr(_e){return Ae(this,void 0,void 0,function*(){let Xe=B[_e];if(Xe)return W.set(_e),yield w.loginManager.poll(Xe).then(ft=>{$.set(!0),V.set(!1),rt.set("")}).catch(ft=>{P.set(!0),V.set(!1),$.set(!1),rt.set(ft.message)})})}function yn(_e){let Xe=_e.target;Xe.focus(),Xe.select(),navigator.clipboard.writeText(Xe.value).then(()=>new So.Notice("Invite link copied")).catch(ft=>{}),lr(r)}let ks=()=>{Ft()};function Dr(){a=this.value,M.set(a)}let jr=_e=>{_e.key==="Enter"&&!y&&a&&i&&qt()};function Io(){i=this.value,G.set(i)}let Kn=_e=>{_e.key==="Enter"&&!y&&a&&i&&qt()},Co=()=>{lr(r)},Gn=()=>{V.set(!1),U.set(!1),rt.set(""),W.set(""),Q.set(!1),ko()},Jn=()=>{V.set(!1),U.set(!1),rt.set(""),W.set("")},Qn=()=>{ye()};return o.$$set=_e=>{"plugin"in _e&&t(27,w=_e.plugin),"$$scope"in _e&&t(38,C=_e.$$scope)},[F,r,i,a,u,d,y,g,I,U,V,P,re,W,q,M,G,Q,N,O,pe,ye,rt,Ft,qt,ko,lr,w,L,ks,Dr,jr,Io,Kn,Co,Gn,Jn,Qn,C]}var ph=class extends Z{constructor(e){super(),ee(this,e,hT,dT,X,{plugin:27},nT,[-1,-1])}},Ox=ph;function $x(o,e,t){let r=o.slice();return r[5]=e[t],r}var gT=o=>({}),Bx=o=>({}),yT=o=>({}),Vx=o=>({});function bT(o){let e;return{c(){e=K(o[0])},m(t,r){S(t,e,r)},p(t,r){r&1&&te(e,t[0])},d(t){t&&_(e)}}}function vT(o){let e,t=Se(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Nx($x(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ve()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);S(n,e,s)},p(n,s){if(s&2){t=Se(n[1]);let i;for(i=0;i<t.length;i+=1){let a=$x(n,t,i);r[i]?r[i].p(a,s):(r[i]=Nx(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function Nx(o){let e;return{c(){e=x("div"),e.textContent=`${o[5]} `},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function xT(o){let e,t=o[1].length>0&&vT(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),S(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&_(e),t&&t.d(r)}}}function wT(o){let e,t,r,n,s,i,a,l,c=o[4].name,f=ke(c,o,o[3],Vx),u=f||bT(o),d=o[4].description,p=ke(d,o,o[3],Bx),m=p||xT(o),y=o[4].default,g=ke(y,o,o[3],null);return{c(){e=x("div"),t=x("div"),r=x("div"),u&&u.c(),n=T(),s=x("div"),m&&m.c(),i=T(),a=x("div"),g&&g.c(),h(r,"class","setting-item-name"),le(r,"display","grid"),le(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),le(t,"display","grid"),h(a,"class","setting-item-control"),h(e,"class","setting-item")},m(I,L){S(I,e,L),b(e,t),b(t,r),u&&u.m(r,null),b(t,n),b(t,s),m&&m.m(s,null),b(e,i),b(e,a),g&&g.m(a,null),l=!0},p(I,[L]){f?f.p&&(!l||L&8)&&Ce(f,c,I,I[3],l?Ie(c,I[3],L,yT):Le(I[3]),Vx):u&&u.p&&(!l||L&1)&&u.p(I,l?L:-1),p&&p.p&&(!l||L&8)&&Ce(p,d,I,I[3],l?Ie(d,I[3],L,gT):Le(I[3]),Bx),g&&g.p&&(!l||L&8)&&Ce(g,y,I,I[3],l?Ie(y,I[3],L,null):Le(I[3]),null)},i(I){l||(v(u,I),v(m,I),v(g,I),l=!0)},o(I){k(u,I),k(m,I),k(g,I),l=!1},d(I){I&&_(e),u&&u.d(I),m&&m.d(I),g&&g.d(I)}}}function _T(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i}=e,a=i!==void 0?i.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,i=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,a,i,n,r]}var mh=class extends Z{constructor(e){super(),ee(this,e,_T,wT,X,{name:0,description:2})}},$e=mh;function ST(o){Ee(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var kT=o=>({}),Hx=o=>({}),IT=o=>({}),qx=o=>({});function CT(o){let e;return{c(){e=K(o[0])},m(t,r){S(t,e,r)},p(t,r){r&1&&te(e,t[0])},d(t){t&&_(e)}}}function Wx(o){let e,t;return{c(){e=x("div"),t=K(o[1]),h(e,"class","setting-item-description")},m(r,n){S(r,e,n),b(e,t)},p(r,n){n&2&&te(t,r[1])},d(r){r&&_(e)}}}function LT(o){let e,t=o[1]&&Wx(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),S(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=Wx(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function ET(o){let e,t,r,n,s,i,a,l=o[3].name,c=ke(l,o,o[2],qx),f=c||CT(o),u=o[3].description,d=ke(u,o,o[2],Hx),p=d||LT(o),m=o[3].default,y=ke(m,o,o[2],null);return{c(){e=x("div"),t=x("div"),r=x("div"),f&&f.c(),n=T(),p&&p.c(),s=T(),i=x("div"),y&&y.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(i,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(g,I){S(g,e,I),b(e,t),b(t,r),f&&f.m(r,null),b(t,n),p&&p.m(t,null),b(e,s),b(e,i),y&&y.m(i,null),a=!0},p(g,[I]){c?c.p&&(!a||I&4)&&Ce(c,l,g,g[2],a?Ie(l,g[2],I,IT):Le(g[2]),qx):f&&f.p&&(!a||I&1)&&f.p(g,a?I:-1),d?d.p&&(!a||I&4)&&Ce(d,u,g,g[2],a?Ie(u,g[2],I,kT):Le(g[2]),Hx):p&&p.p&&(!a||I&2)&&p.p(g,a?I:-1),y&&y.p&&(!a||I&4)&&Ce(y,m,g,g[2],a?Ie(m,g[2],I,null):Le(g[2]),null)},i(g){a||(v(f,g),v(p,g),v(y,g),a=!0)},o(g){k(f,g),k(p,g),k(y,g),a=!1},d(g){g&&_(e),f&&f.d(g),p&&p.d(g),y&&y.d(g)}}}function TT(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"description"in a&&t(1,i=a.description),"$$scope"in a&&t(2,n=a.$$scope)},[s,i,n,r]}var hh=class extends Z{constructor(e){super(),ee(this,e,TT,ET,X,{name:0,description:1},ST)}},ar=hh;var jx=require("obsidian");function FT(o){let e,t=o[2].default,r=ke(t,o,o[1],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&2)&&Ce(r,t,n,n[1],e?Ie(t,n[1],s,null):Le(n[1]),null)},i(n){e||(v(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function PT(o){let e,t,r,n=o[2].default,s=ke(n,o,o[1],null);return{c(){e=x("div"),t=x("div"),s&&s.c(),h(t,"class","setting-items"),h(e,"class","setting-group")},m(i,a){S(i,e,a),b(e,t),s&&s.m(t,null),r=!0},p(i,a){s&&s.p&&(!r||a&2)&&Ce(s,n,i,i[1],r?Ie(n,i[1],a,null):Le(i[1]),null)},i(i){r||(v(s,i),r=!0)},o(i){k(s,i),r=!1},d(i){i&&_(e),s&&s.d(i)}}}function AT(o){let e,t,r,n,s=[PT,FT],i=[];function a(l,c){return l[0]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,[c]){t.p(l,c)},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function RT(o,e,t){let{$$slots:r={},$$scope:n}=e,s=(0,jx.requireApiVersion)("1.11.0");return o.$$set=i=>{"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var gh=class extends Z{constructor(e){super(),ee(this,e,RT,AT,X,{})}},St=gh;function MT(o){Ee(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function DT(o){let e,t;return e=new mm({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p:z,i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function UT(o){let e,t,r,n,s=o[3].default,i=ke(s,o,o[2],null),a=i||DT(o);return{c(){e=x("div"),a&&a.c(),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label",o[0]),h(e,"role","button"),h(e,"tabindex","0")},m(l,c){S(l,e,c),a&&a.m(e,null),t=!0,r||(n=[j(e,"click",o[1]),j(e,"keydown",o[1])],r=!0)},p(l,[c]){i&&i.p&&(!t||c&4)&&Ce(i,s,l,l[2],t?Ie(s,l[2],c,null):Le(l[2]),null),(!t||c&1)&&h(e,"aria-label",l[0])},i(l){t||(v(a,l),t=!0)},o(l){k(a,l),t=!1},d(l){l&&_(e),a&&a.d(l),r=!1,xe(n)}}}function OT(o,e,t){let{$$slots:r={},$$scope:n}=e,s=it(),{label:i="Options"}=e;function a(l){(l instanceof MouseEvent||l instanceof KeyboardEvent&&(l.key==="Enter"||l.key===" "))&&s("settings")}return o.$$set=l=>{"label"in l&&t(0,i=l.label),"$$scope"in l&&t(2,n=l.$$scope)},[i,a,n,r]}var yh=class extends Z{constructor(e){super(),ee(this,e,OT,UT,X,{label:0},MT)}},_s=yh;function $T(o){let e,t,r,n,s,i;t=new mn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let a=o[3].default,l=ke(a,o,o[2],null);return{c(){e=x("span"),D(t.$$.fragment),r=T(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),le(e,"display","flex"),le(e,"align-items","center"),le(e,"width","100%")},m(c,f){S(c,e,f),A(t,e,null),b(e,r),l&&l.m(e,null),n=!0,s||(i=[j(e,"keypress",o[0]),j(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&Ce(l,a,c,c[2],n?Ie(a,c[2],f,null):Le(c[2]),null)},i(c){n||(v(t.$$.fragment,c),v(l,c),n=!0)},o(c){k(t.$$.fragment,c),k(l,c),n=!1},d(c){c&&_(e),R(t),l&&l.d(c),s=!1,xe(i)}}}function BT(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,i=it();function a(){s&&i("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var bh=class extends Z{constructor(e){super(),ee(this,e,BT,$T,X,{relay:1})}},Oa=bh;function VT(o){let e,t,r,n,s,i;t=new Ho({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let a=o[4].default,l=ke(a,o,o[3],null);return{c(){e=x("span"),D(t.$$.fragment),r=T(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),le(e,"display","inline-flex"),le(e,"align-items","center"),le(e,"width","100%")},m(c,f){S(c,e,f),A(t,e,null),b(e,r),l&&l.m(e,null),n=!0,s||(i=[j(e,"keypress",o[0]),j(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&8)&&Ce(l,a,c,c[3],n?Ie(a,c[3],f,null):Le(c[3]),null)},i(c){n||(v(t.$$.fragment,c),v(l,c),n=!0)},o(c){k(t.$$.fragment,c),k(l,c),n=!1},d(c){c&&_(e),R(t),l&&l.d(c),s=!1,xe(i)}}}function NT(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,{remoteFolder:i=void 0}=e,a=it();function l(){var c;s&&a("manageSharedFolder",{folder:s,relay:((c=s==null?void 0:s.remote)===null||c===void 0?void 0:c.relay)||(i==null?void 0:i.relay),remoteFolder:i})}return o.$$set=c=>{"folder"in c&&t(1,s=c.folder),"remoteFolder"in c&&t(2,i=c.remoteFolder),"$$scope"in c&&t(3,n=c.$$scope)},[l,s,i,n,r]}var vh=class extends Z{constructor(e){super(),ee(this,e,NT,VT,X,{folder:1,remoteFolder:2})}},zx=vh;function HT(o){let e,t;return e=new Ho({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function qT(o){let e,t;return e=new bs({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function WT(o){let e,t,r,n,s,i,a,l=[qT,HT],c=[];function f(p,m){var y;return(y=p[0])!=null&&y.private?0:1}t=f(o,-1),r=c[t]=l[t](o);let u=o[3].default,d=ke(u,o,o[2],null);return{c(){e=x("span"),r.c(),n=T(),d&&d.c(),h(e,"role","button"),h(e,"tabindex","0"),le(e,"display","inline-flex"),le(e,"align-items","center"),le(e,"width","100%")},m(p,m){S(p,e,m),c[t].m(e,null),b(e,n),d&&d.m(e,null),s=!0,i||(a=[j(e,"keypress",o[1]),j(e,"click",o[1])],i=!0)},p(p,[m]){let y=t;t=f(p,m),t!==y&&(ce(),k(c[y],1,1,()=>{c[y]=null}),fe(),r=c[t],r||(r=c[t]=l[t](p),r.c()),v(r,1),r.m(e,n)),d&&d.p&&(!s||m&4)&&Ce(d,u,p,p[2],s?Ie(u,p[2],m,null):Le(p[2]),null)},i(p){s||(v(r),v(d,p),s=!0)},o(p){k(r),k(d,p),s=!1},d(p){p&&_(e),c[t].d(),d&&d.d(p),i=!1,xe(a)}}}function jT(o,e,t){let{$$slots:r={},$$scope:n}=e,{remoteFolder:s}=e,i=it();function a(){i("manageRemoteFolder",{remoteFolder:s,relay:s==null?void 0:s.relay})}return o.$$set=l=>{"remoteFolder"in l&&t(0,s=l.remoteFolder),"$$scope"in l&&t(2,n=l.$$scope)},[s,a,n,r]}var xh=class extends Z{constructor(e){super(),ee(this,e,jT,WT,X,{remoteFolder:0})}},yf=xh;function zT(o){let e,t;return e=new zx({props:{folder:o[0],$$slots:{default:[GT]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[2]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.folder=r[0]),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function KT(o){let e,t;return e=new yf({props:{remoteFolder:o[0].remote,$$slots:{default:[JT]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",o[1]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.remoteFolder=r[0].remote),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function GT(o){let e,t=o[0].name+"",r;return{c(){e=x("span"),r=K(t),le(e,"overflow","hidden"),le(e,"text-overflow","ellipsis"),le(e,"white-space","nowrap")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&te(r,t)},d(n){n&&_(e)}}}function JT(o){let e,t=o[0].name+"",r;return{c(){e=x("span"),r=K(t),le(e,"flex","1"),le(e,"min-width","0"),le(e,"text-overflow","ellipsis"),le(e,"white-space","nowrap")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&te(r,t)},d(n){n&&_(e)}}}function Kx(o){let e,t,r,n,s;return t=new $p({props:{size:16,class:"svg-icon"}}),n=new Oa({props:{relay:o[0].remote.relay,$$slots:{default:[QT]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=x("span"),D(t.$$.fragment),r=T(),D(n.$$.fragment),le(e,"width","16px"),le(e,"flex-shrink","0"),le(e,"display","flex"),le(e,"justify-content","center")},m(i,a){S(i,e,a),A(t,e,null),S(i,r,a),A(n,i,a),s=!0},p(i,a){let l={};a&1&&(l.relay=i[0].remote.relay),a&17&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(v(t.$$.fragment,i),v(n.$$.fragment,i),s=!0)},o(i){k(t.$$.fragment,i),k(n.$$.fragment,i),s=!1},d(i){i&&(_(e),_(r)),R(t),R(n,i)}}}function QT(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=x("span"),r=K(t),le(e,"flex","1"),le(e,"min-width","0"),le(e,"text-overflow","ellipsis"),le(e,"white-space","nowrap")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&te(r,t)},d(n){n&&_(e)}}}function YT(o){let e,t,r,n,s,i,a=[KT,zT],l=[];function c(u,d){return u[0].remote?0:1}r=c(o,-1),n=l[r]=a[r](o);let f=o[0].remote&&Kx(o);return{c(){e=x("span"),t=x("span"),n.c(),s=T(),f&&f.c(),le(t,"display","inline-flex"),le(t,"align-items","center"),le(t,"width","200px"),le(t,"min-width","200px"),le(t,"flex-shrink","0"),le(e,"display","inline-flex"),le(e,"align-items","center"),le(e,"width","100%"),le(e,"gap","8px")},m(u,d){S(u,e,d),b(e,t),l[r].m(t,null),b(e,s),f&&f.m(e,null),i=!0},p(u,[d]){let p=r;r=c(u,d),r===p?l[r].p(u,d):(ce(),k(l[p],1,1,()=>{l[p]=null}),fe(),n=l[r],n?n.p(u,d):(n=l[r]=a[r](u),n.c()),v(n,1),n.m(t,null)),u[0].remote?f?(f.p(u,d),d&1&&v(f,1)):(f=Kx(u),f.c(),v(f,1),f.m(e,null)):f&&(ce(),k(f,1,1,()=>{f=null}),fe())},i(u){i||(v(n),v(f),i=!0)},o(u){k(n),k(f),i=!1},d(u){u&&_(e),l[r].d(),f&&f.d()}}}function XT(o,e,t){let{folder:r}=e;function n(a){Pr.call(this,o,a)}function s(a){Pr.call(this,o,a)}function i(a){Pr.call(this,o,a)}return o.$$set=a=>{"folder"in a&&t(0,r=a.folder)},[r,n,s,i]}var wh=class extends Z{constructor(e){super(),ee(this,e,XT,YT,X,{folder:0})}},Gx=wh;var br=require("obsidian");var zo=require("obsidian");function ZT(o){Ee(o,"svelte-1aquw0",".input-with-icon.svelte-1aquw0{position:relative;width:100%}.secret-text-toggle-icon.svelte-1aquw0{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:12px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1aquw0:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1aquw0{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1aquw0{border:1px solid var(--color-red) !important}")}function eF(o){let e,t,r,n;return{c(){e=x("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=Fr(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1aquw0"),e.disabled=o[1]},m(s,i){S(s,e,i),r||(n=[j(e,"click",function(){nt(o[4]?(0,zo.debounce)(o[12]):null)&&(o[4]?(0,zo.debounce)(o[12]):null).apply(this,arguments)}),j(e,"input",o[15]),j(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=Fr(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1aquw0")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&_(e),r=!1,xe(n)}}}function tF(o){let e,t,r,n;return{c(){e=x("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=Fr(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1aquw0"),e.disabled=o[1]},m(s,i){S(s,e,i),r||(n=[j(e,"click",function(){nt(o[4]?(0,zo.debounce)(o[12]):null)&&(o[4]?(0,zo.debounce)(o[12]):null).apply(this,arguments)}),j(e,"input",o[14]),j(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=Fr(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1aquw0")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&_(e),r=!1,xe(n)}}}function rF(o){let e,t,r,n,s,i,a;function l(u,d){return u[6]?tF:eF}let c=l(o,-1),f=c(o);return{c(){e=x("div"),f.c(),t=T(),r=x("div"),h(r,"class","secret-text-toggle-icon svelte-1aquw0"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1aquw0")},m(u,d){S(u,e,d),f.m(e,null),b(e,t),b(e,r),i||(a=[hs(s=o[11].call(null,r)),j(r,"click",o[16]),j(r,"keypress",o[17])],i=!0)},p(u,[d]){c===(c=l(u,d))&&f?f.p(u,d):(f.d(1),f=c(u),f&&(f.c(),f.m(e,t))),d&64&&n!==(n=u[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:z,o:z,d(u){u&&_(e),f.d(),i=!1,xe(a)}}}function oF(o,e,t){let r,n,s=it(),{value:i}=e,{disabled:a=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:f=!0}=e,{successMessage:u="Copied to clipboard"}=e,{invalid:d=!1}=e,p=we(!1);de(o,p,U=>t(6,r=U));let m=we(!1);de(o,m,U=>t(19,n=U));let y;function g(U){U.key==="Enter"&&!a&&s("enter")}function I(U){y=U;let V=()=>{n?((0,zo.setIcon)(U,"clipboard-check"),U.addClass("mod-success")):((0,zo.setIcon)(U,r?"eye-off":"eye"),U.removeClass("mod-success"))},P=p.subscribe(()=>{V()}),$=m.subscribe(()=>{V()});return V(),{destroy(){P(),$()}}}function L(U){!f||!i||a||navigator.clipboard.writeText(i).then(()=>{new zo.Notice(u),m.set(!0),setTimeout(()=>{m.set(!1)},800)}).catch(V=>{console.error("Failed to copy: ",V)})}let C=U=>{t(0,i=U.currentTarget.value),s("input",U)},w=U=>{t(0,i=U.currentTarget.value),s("input",U)},E=()=>p.update(U=>!U),F=()=>p.update(U=>!U);return o.$$set=U=>{"value"in U&&t(0,i=U.value),"disabled"in U&&t(1,a=U.disabled),"placeholder"in U&&t(2,l=U.placeholder),"readonly"in U&&t(3,c=U.readonly),"copyOnClick"in U&&t(4,f=U.copyOnClick),"successMessage"in U&&t(13,u=U.successMessage),"invalid"in U&&t(5,d=U.invalid)},[i,a,l,c,f,d,r,s,p,m,g,I,L,u,C,w,E,F]}var _h=class extends Z{constructor(e){super(),ee(this,e,oF,rF,X,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},ZT)}},bf=_h;var Ah=require("obsidian");var yw=require("obsidian");var Fh=require("obsidian");var Xx=require("obsidian");function nF(o){Ee(o,"svelte-1dpxzin",".folder-suggest-wrapper.svelte-1dpxzin{position:relative;width:100%}.folder-suggest-input.svelte-1dpxzin{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.suggestion-container.svelte-1dpxzin{position:fixed;z-index:9999;box-sizing:border-box;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:6px;box-shadow:var(--shadow-s);overflow-y:auto;overflow-x:hidden}.suggestion.svelte-1dpxzin{overflow-y:auto;overflow-x:hidden;max-height:100%}.suggestion-note.svelte-1dpxzin{color:var(--text-muted);font-style:italic}")}function Jx(o,e,t){let r=o.slice();return r[31]=e[t],r[33]=t,r}function Qx(o){let e,t,r,n,s,i,a=Se(o[2]),l=[];for(let c=0;c<a.length;c+=1)l[c]=Yx(Jx(o,a,c));return{c(){e=x("div"),t=x("div");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","suggestion svelte-1dpxzin"),h(e,"class","suggestion-container svelte-1dpxzin")},m(c,f){S(c,e,f),b(e,t);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(t,null);s||(i=[hs(r=lF.call(null,e)),hs(n=o[6].call(null,e))],s=!0)},p(c,f){if(f[0]&2060){a=Se(c[2]);let u;for(u=0;u<a.length;u+=1){let d=Jx(c,a,u);l[u]?l[u].p(d,f):(l[u]=Yx(d),l[u].c(),l[u].m(t,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=a.length}},d(c){c&&_(e),Je(l,c),s=!1,xe(i)}}}function sF(o){let e=o[31]+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&4&&e!==(e=r[31]+"")&&te(t,e)},d(r){r&&_(t)}}}function iF(o){let e,t=o[31].substring(9)+"",r;return{c(){e=x("span"),e.textContent=`Create:
								`,r=K(t),h(e,"class","suggestion-note svelte-1dpxzin")},m(n,s){S(n,e,s),S(n,r,s)},p(n,s){s[0]&4&&t!==(t=n[31].substring(9)+"")&&te(r,t)},d(n){n&&(_(e),_(r))}}}function Yx(o){let e,t,r,n,s,i,a,l,c,f;function u(I,L){return L[0]&4&&(n=null),n==null&&(n=!!I[31].startsWith("[Create] ")),n?iF:sF}let d=u(o,[-1,-1]),p=d(o);function m(){return o[18](o[31])}function y(...I){return o[19](o[31],...I)}function g(){return o[20](o[33])}return{c(){e=x("div"),t=x("div"),r=x("div"),p.c(),s=T(),i=x("div"),i.innerHTML='<div class="suggestion-icon"></div>',a=T(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(i,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",l=o[33]===o[3]),h(e,"tabindex","-1"),Te(e,"is-selected",o[33]===o[3])},m(I,L){S(I,e,L),b(e,t),b(t,r),p.m(r,null),b(e,s),b(e,i),b(e,a),c||(f=[j(e,"mousedown",Dc(o[15])),j(e,"click",m),j(e,"keydown",y),j(e,"mouseenter",g)],c=!0)},p(I,L){o=I,d===(d=u(o,L))&&p?p.p(o,L):(p.d(1),p=d(o),p&&(p.c(),p.m(r,null))),L[0]&8&&l!==(l=o[33]===o[3])&&h(e,"aria-selected",l),L[0]&8&&Te(e,"is-selected",o[33]===o[3])},d(I){I&&_(e),p.d(),c=!1,xe(f)}}}function aF(o){let e,t,r,n,s,i,a=o[4]&&o[2].length>0&&Qx(o);return{c(){e=x("div"),t=x("input"),r=T(),a&&a.c(),n=ve(),h(t,"type","text"),h(t,"placeholder",o[0]),h(t,"class","folder-suggest-input svelte-1dpxzin"),h(e,"class","folder-suggest-wrapper svelte-1dpxzin")},m(l,c){S(l,e,c),b(e,t),o[16](t),Ke(t,o[5]),S(l,r,c),a&&a.m(l,c),S(l,n,c),s||(i=[j(t,"input",o[17]),j(t,"input",o[8]),j(t,"keydown",o[7]),j(t,"focus",o[9]),j(t,"blur",o[10])],s=!0)},p(l,c){c[0]&1&&h(t,"placeholder",l[0]),c[0]&32&&t.value!==l[5]&&Ke(t,l[5]),l[4]&&l[2].length>0?a?a.p(l,c):(a=Qx(l),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:z,o:z,d(l){l&&(_(e),_(r),_(n)),o[16](null),a&&a.d(l),s=!1,xe(i)}}}function lF(o){return document.body.appendChild(o),{destroy(){o.remove()}}}function cF(o,e,t){function r(N){return setTimeout(()=>{f=N,C()},0),{destroy(){}}}let{app:n}=e,{value:s=""}=e,{placeholder:i="Choose or create folder..."}=e,{blockedPaths:a=new Set}=e,l=it(),c,f,u=[],d=-1,p=!1,m=s||"/",y=!1;function g(N){let O=N.toLowerCase(),J=[],oe=se=>{if(a.has(se.path)&&se.path!=="/")return;let pe=se.path.toLowerCase(),Fe=(se.path.startsWith("/")?se.path:"/"+se.path).toLowerCase();if((!O||pe.includes(O)||Fe.includes(O))&&!a.has(se.path)){let Ue=se.path.startsWith("/")?se.path:"/"+se.path;J.push(Ue)}for(let Ue of se.children)Ue instanceof Xx.TFolder&&oe(Ue)},me=n.vault.getRoot();oe(me);let he=N.trim();if(he&&!J.includes(he)){let se=he.startsWith("/")?he:"/"+he;J.unshift(`[Create] ${se}`)}return J.slice(0,100)}function I(){return Ae(this,void 0,void 0,function*(){t(2,u=g(m)),u.length>0?(t(4,p=!0),t(3,d=0),yield Ap()):L()})}function L(){t(4,p=!1),t(2,u=[]),t(3,d=-1)}function C(){if(!c||!f)return;let N=c.getBoundingClientRect(),O=window.innerWidth,J=window.innerHeight;f.style.position="fixed",f.style.zIndex="9999";let oe=O<768,se=Math.min(u.length*40+8,oe?240:300);if(f.style.top="",f.style.bottom="",f.style.left="",f.style.right="",f.style.transform="",oe){let pe=J-N.bottom,Fe=N.top;f.style.left="10px",f.style.right="10px",f.style.width="auto",pe<se+10&&Fe>se+10?(f.style.bottom=`${J-N.top+2}px`,f.style.maxHeight=`${se}px`,f.style.height=""):(f.style.bottom=`${J-N.bottom-2}px`,f.style.maxHeight=`${Math.min(se,pe-10)}px`,f.style.height="",f.style.transform="translateY(-100%)")}else{let pe=Math.max(N.width,350),Fe=Math.min(pe,O-N.left-20);f.style.left=`${N.left}px`,f.style.top=`${N.bottom+2}px`,f.style.width=`${Fe}px`,f.style.maxHeight=`${se}px`,f.style.height=""}}function w(N){let O=N;N.startsWith("[Create] ")&&(O=N.substring(9)),t(5,m=O),t(12,s=O),l("select",{value:O}),L(),c==null||c.blur()}function E(N){if(!p){(N.key==="Enter"&&m.trim()||N.key==="Tab"&&!N.shiftKey&&m.trim())&&(N.preventDefault(),w(m.trim()));return}switch(N.key){case"ArrowDown":N.preventDefault(),t(3,d=Math.min(d+1,u.length-1));break;case"ArrowUp":N.preventDefault(),t(3,d=Math.max(d-1,-1));break;case"Enter":N.preventDefault(),d>=0?w(u[d]):m.trim()&&w(m.trim());break;case"Escape":N.preventDefault(),L();break;case"Tab":N.shiftKey||(N.preventDefault(),d>=0?w(u[d]):u.length>0?w(u[0]):m.trim()&&w(m.trim()));break}}function F(){y=!0,t(12,s=m),l("input",{value:m}),I()}function U(){!y&&m==="/"&&(t(5,m=""),t(12,s="")),t(2,u=g(m||"")),u.length>0&&(t(4,p=!0),t(3,d=0))}function V(N){setTimeout(()=>{f!=null&&f.contains(document.activeElement)||L()},200)}function P(N){w(N)}function $(N){!(c!=null&&c.contains(N.target))&&!(f!=null&&f.contains(N.target))&&L()}function re(){p&&C()}dt(()=>{document.addEventListener("click",$),window.addEventListener("resize",re)}),dn(()=>{document.removeEventListener("click",$),window.removeEventListener("resize",re)});function W(N){Pr.call(this,o,N)}function q(N){vt[N?"unshift":"push"](()=>{c=N,t(1,c)})}function M(){m=this.value,t(5,m)}let G=N=>P(N),B=(N,O)=>O.key==="Enter"&&P(N),Q=N=>t(3,d=N);return o.$$set=N=>{"app"in N&&t(13,n=N.app),"value"in N&&t(12,s=N.value),"placeholder"in N&&t(0,i=N.placeholder),"blockedPaths"in N&&t(14,a=N.blockedPaths)},[i,c,u,d,p,m,r,E,F,U,V,P,s,n,a,W,q,M,G,B,Q]}var Sh=class extends Z{constructor(e){super(),ee(this,e,cF,aF,X,{app:13,value:12,placeholder:0,blockedPaths:14},nF,[-1,-1])}},Zx=Sh;function fF(o){let e,t,r,n;function s(a){o[8](a)}let i={app:o[0],placeholder:o[2],blockedPaths:o[4]()};return o[3]!==void 0&&(i.value=o[3]),t=new Zx({props:i}),vt.push(()=>Hc(t,"value",s)),t.$on("select",o[5]),{c(){e=x("div"),D(t.$$.fragment),h(e,"class","folder-select-input")},m(a,l){S(a,e,l),A(t,e,null),n=!0},p(a,[l]){let c={};l&1&&(c.app=a[0]),l&4&&(c.placeholder=a[2]),!r&&l&8&&(r=!0,c.value=a[3],$c(()=>r=!1)),t.$set(c)},i(a){n||(v(t.$$.fragment,a),n=!0)},o(a){k(t.$$.fragment,a),n=!1},d(a){a&&_(e),R(t)}}}function uF(o,e,t){let r,n=z,s=()=>(n(),n=Ht(l,m=>t(7,r=m)),l);o.$$.on_destroy.push(()=>n());let{app:i}=e,{sharedFolders:a}=e,{selectedFolder:l}=e;s();let{placeholder:c="Choose or create folder..."}=e,f="";function u(){return new Set(a.filter(m=>!!m.relayId).map(m=>m.path))}function d(m){let y=m.detail.value;t(3,f=y),l.set(y)}function p(m){f=m,t(3,f),t(7,r)}return o.$$set=m=>{"app"in m&&t(0,i=m.app),"sharedFolders"in m&&t(6,a=m.sharedFolders),"selectedFolder"in m&&s(t(1,l=m.selectedFolder)),"placeholder"in m&&t(2,c=m.placeholder)},o.$$.update=()=>{o.$$.dirty&136&&r&&r!==f&&t(3,f=r)},[i,l,c,f,u,d,a,r,p]}var kh=class extends Z{constructor(e){super(),ee(this,e,uF,fF,X,{app:0,sharedFolders:6,selectedFolder:1,placeholder:2})}},ew=kh;function dF(o){Ee(o,"svelte-1cvg97u",".faint.svelte-1cvg97u.svelte-1cvg97u{color:var(--text-faint)}.breadcrumb-container.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:8px;overflow:hidden}.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;min-width:0}.breadcrumb-item.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;cursor:pointer;min-width:0}.breadcrumb-text.svelte-1cvg97u.svelte-1cvg97u{display:inline-block}@media(max-width: 768px){.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u:last-child{flex:1;min-width:0;overflow:hidden}.middle-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{display:none}.last-item.svelte-1cvg97u.svelte-1cvg97u{overflow:hidden}.last-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}")}function tw(o,e,t){let r=o.slice();return r[6]=e[t],r[8]=t,r}function pF(o){let e,t;return e=new jp({props:{size:16,class:"breadcrumb-separator"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function rw(o){let e,t,r;var n=o[2](o[6]);function s(i,a){return{props:{class:"svg-icon breadcrumb-icon"}}}return n&&(e=yi(n,s(o))),{c(){e&&D(e.$$.fragment),t=ve()},m(i,a){e&&A(e,i,a),S(i,t,a),r=!0},p(i,a){if(a&1&&n!==(n=i[2](i[6]))){if(e){ce();let l=e;k(l.$$.fragment,1,0,()=>{R(l,1)}),fe()}n?(e=yi(n,s(i,a)),D(e.$$.fragment),v(e.$$.fragment,1),A(e,t.parentNode,t)):e=null}},i(i){r||(e&&v(e.$$.fragment,i),r=!0)},o(i){e&&k(e.$$.fragment,i),r=!1},d(i){i&&_(t),e&&R(e,i)}}}function mF(o){let e;function t(s,i){return s[6].remoteFolder.name?vF:bF}let r=t(o,-1),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function hF(o){let e=o[6].folder.name+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&1&&e!==(e=r[6].folder.name+"")&&te(t,e)},d(r){r&&_(t)}}}function gF(o){let e;function t(s,i){return s[6].relay.name?wF:xF}let r=t(o,-1),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function yF(o){let e=o[6].text+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&1&&e!==(e=r[6].text+"")&&te(t,e)},d(r){r&&_(t)}}}function bF(o){let e;return{c(){e=x("span"),e.textContent="(Untitled folder)",h(e,"class","faint svelte-1cvg97u")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function vF(o){let e=o[6].remoteFolder.name+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&1&&e!==(e=r[6].remoteFolder.name+"")&&te(t,e)},d(r){r&&_(t)}}}function xF(o){let e;return{c(){e=x("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-1cvg97u")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function wF(o){let e=o[6].relay.name+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&1&&e!==(e=r[6].relay.name+"")&&te(t,e)},d(r){r&&_(t)}}}function ow(o){let e,t,r,n=o[2](o[6]),s,i,a,l,c,f,u,d=o[8]>0&&pF(o),p=n&&rw(o);function m(C,w){if(C[6].type==="text")return yF;if(C[6].type==="relay")return gF;if(C[6].type==="folder")return hF;if(C[6].type==="remoteFolder")return mF}let y=m(o,-1),g=y&&y(o);function I(){return o[3](o[6])}function L(...C){return o[4](o[6],...C)}return{c(){d&&d.c(),e=T(),t=x("span"),r=x("span"),p&&p.c(),s=T(),i=x("span"),g&&g.c(),l=T(),h(i,"class","breadcrumb-text svelte-1cvg97u"),h(r,"tabindex","0"),h(r,"role","button"),h(r,"class",a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"),h(t,"class","breadcrumb-item-wrapper svelte-1cvg97u")},m(C,w){d&&d.m(C,w),S(C,e,w),S(C,t,w),b(t,r),p&&p.m(r,null),b(r,s),b(r,i),g&&g.m(i,null),b(t,l),c=!0,f||(u=[j(r,"click",I),j(r,"keypress",L)],f=!0)},p(C,w){o=C,w&1&&(n=o[2](o[6])),n?p?(p.p(o,w),w&1&&v(p,1)):(p=rw(o),p.c(),v(p,1),p.m(r,s)):p&&(ce(),k(p,1,1,()=>{p=null}),fe()),y===(y=m(o,w))&&g?g.p(o,w):(g&&g.d(1),g=y&&y(o),g&&(g.c(),g.m(i,null))),(!c||w&1&&a!==(a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"))&&h(r,"class",a)},i(C){c||(v(d),v(p),c=!0)},o(C){k(d),k(p),c=!1},d(C){C&&(_(e),_(t)),d&&d.d(C),p&&p.d(),g&&g.d(),f=!1,xe(u)}}}function Ih(o){let e,t,r=Se(o[0]),n=[];for(let i=0;i<r.length;i+=1)n[i]=ow(tw(o,r,i));let s=i=>k(n[i],1,1,()=>{n[i]=null});return{c(){e=x(o[1]);for(let i=0;i<n.length;i+=1)n[i].c();Rv(o[1])(e,{class:"breadcrumb-container svelte-1cvg97u"})},m(i,a){S(i,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);t=!0},p(i,a){if(a&5){r=Se(i[0]);let l;for(l=0;l<r.length;l+=1){let c=tw(i,r,l);n[l]?(n[l].p(c,a),v(n[l],1)):(n[l]=ow(c),n[l].c(),v(n[l],1),n[l].m(e,null))}for(ce(),l=r.length;l<n.length;l+=1)s(l);fe()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)v(n[a]);t=!0}},o(i){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)k(n[a]);t=!1},d(i){i&&_(e),Je(n,i)}}}function _F(o){let e=o[1],t,r,n=o[1]&&Ih(o);return{c(){n&&n.c(),t=ve()},m(s,i){n&&n.m(s,i),S(s,t,i)},p(s,[i]){s[1]?e?X(e,s[1])?(n.d(1),n=Ih(s),e=s[1],n.c(),n.m(t.parentNode,t)):n.p(s,i):(n=Ih(s),e=s[1],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=s[1])},i:z,o(s){k(n,s),r=!1},d(s){s&&_(t),n&&n.d(s)}}}function nw(o){o.onClick&&o.onClick()}function SF(o,e,t){let{items:r}=e,{element:n="h4"}=e,s=it();function i(c){var f;switch(c.type){case"home":return nm;case"relay":return mn;case"folder":return _o;case"remoteFolder":return!((f=c.remoteFolder)===null||f===void 0)&&f.private?bs:Ho;default:return null}}let a=c=>nw(c),l=(c,f)=>{(f.key==="Enter"||f.key===" ")&&nw(c)};return o.$$set=c=>{"items"in c&&t(0,r=c.items),"element"in c&&t(1,n=c.element)},[r,n,i,a,l]}var Ch=class extends Z{constructor(e){super(),ee(this,e,SF,_F,X,{items:0,element:1},dF)}},Ko=Ch;function kF(o){Ee(o,"svelte-1r8auw9",".folder-transformation.svelte-1r8auw9{display:flex;align-items:center;padding:8px 12px;background:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;gap:8px}.folder-transformation.readonly.svelte-1r8auw9{background:var(--background-secondary);border:1px solid var(--background-modifier-border)}.folder-state.svelte-1r8auw9{display:flex;align-items:center;gap:6px}.folder-name.svelte-1r8auw9{font-weight:500;color:var(--text-normal);white-space:nowrap}.clear-button.svelte-1r8auw9{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:2px;margin-left:auto}.clear-button.svelte-1r8auw9:hover{background:var(--background-modifier-hover);color:var(--text-normal)}.folder-select-button.svelte-1r8auw9{width:100%;min-height:3em;text-align:left}")}function IF(o){let e,t,r,n,s;return{c(){e=x("div"),t=x("button"),r=K(o[3]),h(t,"class","mod-cta folder-select-button svelte-1r8auw9"),h(e,"class","folder-suggest-container")},m(i,a){S(i,e,a),b(e,t),b(t,r),n||(s=j(t,"click",o[8]),n=!0)},p(i,a){a&8&&te(r,i[3])},i:z,o:z,d(i){i&&_(e),n=!1,s()}}}function CF(o){let e,t,r,n,s,i=[TF,EF,LF],a=[];function l(f,u){return f[6]?0:f[2]?1:2}t=l(o,-1),r=a[t]=i[t](o);let c=!o[4]&&sw(o);return{c(){e=x("div"),r.c(),n=T(),c&&c.c(),h(e,"class","folder-transformation svelte-1r8auw9"),Te(e,"readonly",o[4])},m(f,u){S(f,e,u),a[t].m(e,null),b(e,n),c&&c.m(e,null),s=!0},p(f,u){let d=t;t=l(f,u),t===d?a[t].p(f,u):(ce(),k(a[d],1,1,()=>{a[d]=null}),fe(),r=a[t],r?r.p(f,u):(r=a[t]=i[t](f),r.c()),v(r,1),r.m(e,n)),f[4]?c&&(c.d(1),c=null):c?c.p(f,u):(c=sw(f),c.c(),c.m(e,null)),(!s||u&16)&&Te(e,"readonly",f[4])},i(f){s||(v(r),s=!0)},o(f){k(r),s=!1},d(f){f&&_(e),a[t].d(),c&&c.d()}}}function LF(o){let e,t,r,n,s,i;return t=new Ho({props:{class:"svg-icon folder-icon"}}),{c(){e=x("div"),D(t.$$.fragment),r=T(),n=x("span"),s=K(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9")},m(a,l){S(a,e,l),A(t,e,null),b(e,r),b(e,n),b(n,s),i=!0},p(a,l){(!i||l&32)&&te(s,a[5])},i(a){i||(v(t.$$.fragment,a),i=!0)},o(a){k(t.$$.fragment,a),i=!1},d(a){a&&_(e),R(t)}}}function EF(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y;t=new tm({props:{class:"svg-icon folder-icon"}}),a=new Vp({props:{class:"svg-icon arrow-icon"}});let g=[PF,FF],I=[];function L(C,w){return C[1]?0:1}return f=L(o,-1),u=I[f]=g[f](o),{c(){e=x("div"),D(t.$$.fragment),r=T(),n=x("span"),s=K(o[5]),i=T(),D(a.$$.fragment),l=T(),c=x("div"),u.c(),d=T(),p=x("span"),m=K(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9"),h(p,"class","folder-name svelte-1r8auw9"),h(c,"class","folder-state svelte-1r8auw9")},m(C,w){S(C,e,w),A(t,e,null),b(e,r),b(e,n),b(n,s),S(C,i,w),A(a,C,w),S(C,l,w),S(C,c,w),I[f].m(c,null),b(c,d),b(c,p),b(p,m),y=!0},p(C,w){(!y||w&32)&&te(s,C[5]);let E=f;f=L(C,w),f!==E&&(ce(),k(I[E],1,1,()=>{I[E]=null}),fe(),u=I[f],u||(u=I[f]=g[f](C),u.c()),v(u,1),u.m(c,d)),(!y||w&32)&&te(m,C[5])},i(C){y||(v(t.$$.fragment,C),v(a.$$.fragment,C),v(u),y=!0)},o(C){k(t.$$.fragment,C),k(a.$$.fragment,C),k(u),y=!1},d(C){C&&(_(e),_(i),_(l),_(c)),R(t),R(a,C),I[f].d()}}}function TF(o){let e,t;return e=new Ko({props:{element:"div",items:[{type:"relay",relay:o[0].relay},{type:"remoteFolder",remoteFolder:o[0]}]}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.items=[{type:"relay",relay:r[0].relay},{type:"remoteFolder",remoteFolder:r[0]}]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function FF(o){let e,t;return e=new Ho({props:{class:"svg-icon folder-icon"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function PF(o){let e,t;return e=new bs({props:{class:"svg-icon folder-icon"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function sw(o){let e,t,r;return{c(){e=x("button"),e.textContent="\xD7",h(e,"class","clear-button svelte-1r8auw9")},m(n,s){S(n,e,s),t||(r=j(e,"click",o[7]),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function AF(o){let e,t,r,n,s=[CF,IF],i=[];function a(l,c){return l[0]?0:1}return t=a(o,-1),r=i[t]=s[t](o),{c(){e=x("div"),r.c(),h(e,"class","folder-selector")},m(l,c){S(l,e,c),i[t].m(e,null),n=!0},p(l,[c]){let f=t;t=a(l,c),t===f?i[t].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),v(r,1),r.m(e,null))},i(l){n||(v(r),n=!0)},o(l){k(r),n=!1},d(l){l&&_(e),i[t].d()}}}function RF(o,e,t){let r,n,s,{selectedItem:i=void 0}=e,{isPrivate:a=!1}=e,{showTransformation:l=!1}=e,{selectButtonText:c="Choose a folder..."}=e,{readonly:f=!1}=e,u=it();function d(){u("clear")}function p(){u("select")}return o.$$set=m=>{"selectedItem"in m&&t(0,i=m.selectedItem),"isPrivate"in m&&t(1,a=m.isPrivate),"showTransformation"in m&&t(2,l=m.showTransformation),"selectButtonText"in m&&t(3,c=m.selectButtonText),"readonly"in m&&t(4,f=m.readonly)},o.$$.update=()=>{o.$$.dirty&1&&t(6,r=i&&typeof i=="object"),o.$$.dirty&1&&t(9,n=typeof i=="string"?i:""),o.$$.dirty&512&&t(5,s=n?n.split("/").pop()||n:"")},[i,a,l,c,f,s,r,d,p,n]}var Lh=class extends Z{constructor(e){super(),ee(this,e,RF,AF,X,{selectedItem:0,isPrivate:1,showTransformation:2,selectButtonText:3,readonly:4},kF)}},$a=Lh;var PX=require("obsidian");function iw(o,e,t){let r=o.slice();return r[23]=e[t],r}function aw(o,e,t){let r=o.slice();return r[26]=e[t],r[28]=t,r}var MF=o=>({item:o&8}),lw=o=>({item:o[26],index:o[28]}),DF=o=>({item:o&8}),cw=o=>({item:o[26],index:o[28]});function UF(o){let e=o[26]+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&8&&e!==(e=r[26]+"")&&te(t,e)},d(r){r&&_(t)}}}function OF(o){let e;return{c(){e=x("div"),h(e,"class","suggestion-icon")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function fw(o){let e,t,r,n,s,i,a,l,c,f,u=o[13].suggestion,d=ke(u,o,o[12],cw),p=d||UF(o),m=o[13]["suggestion-aux"],y=ke(m,o,o[12],lw),g=y||OF(o);function I(){return o[17](o[26])}function L(...w){return o[18](o[26],...w)}function C(){return o[19](o[28])}return{c(){e=x("div"),t=x("div"),r=x("div"),p&&p.c(),n=T(),s=x("div"),g&&g.c(),i=T(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(s,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",a=o[28]===o[4]),h(e,"tabindex","-1"),Te(e,"is-selected",o[28]===o[4])},m(w,E){S(w,e,E),b(e,t),b(t,r),p&&p.m(r,null),b(e,n),b(e,s),g&&g.m(s,null),b(e,i),l=!0,c||(f=[j(e,"mousedown",Dc(o[14])),j(e,"click",I),j(e,"keydown",L),j(e,"mouseenter",C)],c=!0)},p(w,E){o=w,d?d.p&&(!l||E&4104)&&Ce(d,u,o,o[12],l?Ie(u,o[12],E,DF):Le(o[12]),cw):p&&p.p&&(!l||E&8)&&p.p(o,l?E:-1),y&&y.p&&(!l||E&4104)&&Ce(y,m,o,o[12],l?Ie(m,o[12],E,MF):Le(o[12]),lw),(!l||E&16&&a!==(a=o[28]===o[4]))&&h(e,"aria-selected",a),(!l||E&16)&&Te(e,"is-selected",o[28]===o[4])},i(w){l||(v(p,w),v(g,w),l=!0)},o(w){k(p,w),k(g,w),l=!1},d(w){w&&_(e),p&&p.d(w),g&&g.d(w),c=!1,xe(f)}}}function uw(o){let e,t,r=o[23].command+"",n,s,i,a=o[23].purpose+"",l,c;return{c(){e=x("div"),t=x("span"),n=K(r),s=T(),i=x("span"),l=K(a),c=T(),h(t,"class","prompt-instruction-command"),h(e,"class","prompt-instruction")},m(f,u){S(f,e,u),b(e,t),b(t,n),b(e,s),b(e,i),b(i,l),b(e,c)},p(f,u){u&2&&r!==(r=f[23].command+"")&&te(n,r),u&2&&a!==(a=f[23].purpose+"")&&te(l,a)},d(f){f&&_(e)}}}function $F(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y=Se(o[3]),g=[];for(let w=0;w<y.length;w+=1)g[w]=fw(aw(o,y,w));let I=w=>k(g[w],1,1,()=>{g[w]=null}),L=Se(o[1]),C=[];for(let w=0;w<L.length;w+=1)C[w]=uw(iw(o,L,w));return{c(){e=x("div"),t=x("div"),r=x("input"),n=T(),s=x("div"),i=T(),a=x("div"),l=T(),c=x("div");for(let w=0;w<g.length;w+=1)g[w].c();f=T(),u=x("div");for(let w=0;w<C.length;w+=1)C[w].c();h(r,"type","text"),h(r,"placeholder",o[0]),h(r,"class","prompt-input"),h(r,"autocapitalize","off"),h(r,"spellcheck","false"),h(r,"enterkeyhint","done"),h(s,"class","prompt-input-cta"),h(a,"class","search-input-clear-button"),h(t,"class","prompt-input-container"),h(c,"class","prompt-results"),h(u,"class","prompt-instructions"),h(e,"class","prompt")},m(w,E){S(w,e,E),b(e,t),b(t,r),o[15](r),Ke(r,o[5]),b(t,n),b(t,s),b(t,i),b(t,a),b(e,l),b(e,c);for(let F=0;F<g.length;F+=1)g[F]&&g[F].m(c,null);b(e,f),b(e,u);for(let F=0;F<C.length;F+=1)C[F]&&C[F].m(u,null);d=!0,p||(m=[j(r,"input",o[16]),j(r,"input",o[7]),j(r,"keydown",o[6])],p=!0)},p(w,[E]){if((!d||E&1)&&h(r,"placeholder",w[0]),E&32&&r.value!==w[5]&&Ke(r,w[5]),E&4376){y=Se(w[3]);let F;for(F=0;F<y.length;F+=1){let U=aw(w,y,F);g[F]?(g[F].p(U,E),v(g[F],1)):(g[F]=fw(U),g[F].c(),v(g[F],1),g[F].m(c,null))}for(ce(),F=y.length;F<g.length;F+=1)I(F);fe()}if(E&2){L=Se(w[1]);let F;for(F=0;F<L.length;F+=1){let U=iw(w,L,F);C[F]?C[F].p(U,E):(C[F]=uw(U),C[F].c(),C[F].m(u,null))}for(;F<C.length;F+=1)C[F].d(1);C.length=L.length}},i(w){if(!d){for(let E=0;E<y.length;E+=1)v(g[E]);d=!0}},o(w){g=g.filter(Boolean);for(let E=0;E<g.length;E+=1)k(g[E]);d=!1},d(w){w&&_(e),o[15](null),Je(g,w),Je(C,w),p=!1,xe(m)}}}function BF(o,e,t){let{$$slots:r={},$$scope:n}=e,{placeholder:s="Search..."}=e,{autofocus:i=!1}=e,{onSelect:a=()=>{}}=e,{getSuggestions:l=()=>[]}=e,{instructions:c=[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Select"},{command:"Esc",purpose:"Cancel"}]}=e,f=it(),u,d=[],p=0,m="";function y(){t(3,d=l(m)),t(4,p=0)}function g($){a($),f("select",{item:$})}function I($){switch($.key){case"ArrowDown":$.preventDefault(),t(4,p=Math.min(p+1,d.length-1));break;case"ArrowUp":$.preventDefault(),t(4,p=Math.max(p-1,-1));break;case"Enter":$.preventDefault(),p>=0?g(d[p]):m.trim()&&d.length===0&&f("customInput",{value:m.trim()});break;case"Tab":$.shiftKey||($.preventDefault(),p>=0?g(d[p]):d.length>0&&g(d[0]));break}}function L(){y(),f("input",{value:m})}function C($){g($)}dt(()=>{i&&u&&setTimeout(()=>{u.focus()},10),y()});function w($){Pr.call(this,o,$)}function E($){vt[$?"unshift":"push"](()=>{u=$,t(2,u)})}function F(){m=this.value,t(5,m)}let U=$=>C($),V=($,re)=>re.key==="Enter"&&C($),P=$=>t(4,p=$);return o.$$set=$=>{"placeholder"in $&&t(0,s=$.placeholder),"autofocus"in $&&t(9,i=$.autofocus),"onSelect"in $&&t(10,a=$.onSelect),"getSuggestions"in $&&t(11,l=$.getSuggestions),"instructions"in $&&t(1,c=$.instructions),"$$scope"in $&&t(12,n=$.$$scope)},[s,c,u,d,p,m,I,L,C,i,a,l,n,r,w,E,F,U,V,P]}var Eh=class extends Z{constructor(e){super(),ee(this,e,BF,$F,X,{placeholder:0,autofocus:9,onSelect:10,getSuggestions:11,instructions:1})}},vf=Eh;function VF(o){let e,t;return e=new Ko({props:{element:"div",items:[{type:"relay",relay:o[5].relay},{type:"remoteFolder",remoteFolder:o[5]}]}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.items=[{type:"relay",relay:r[5].relay},{type:"remoteFolder",remoteFolder:r[5]}]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function NF(o){let e,t;return e=new vf({props:{placeholder:o[0],autofocus:o[1],onSelect:o[2],getSuggestions:o[3],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Add folder to vault"},{command:"Esc",purpose:"Cancel"}],$$slots:{suggestion:[VF,({item:r})=>({5:r}),({item:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&4&&(s.onSelect=r[2]),n&96&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function HF(o,e,t){let{availableFolders:r}=e,{placeholder:n="Search folders..."}=e,{autofocus:s=!1}=e,{onSelect:i=()=>{}}=e;function a(l){let c=l.toLowerCase();return r.filter(u=>{var d;let p=(u.name||"").toLowerCase(),m=(((d=u.relay)===null||d===void 0?void 0:d.name)||"").toLowerCase();return!!u.relay.name&&u.name&&(p.includes(c)||m.includes(c))}).sort((u,d)=>{let p=`${u.relay.name} / ${u.name}`,m=`${d.relay.name} / ${d.name}`;return p.localeCompare(m)}).slice(0,100)}return o.$$set=l=>{"availableFolders"in l&&t(4,r=l.availableFolders),"placeholder"in l&&t(0,n=l.placeholder),"autofocus"in l&&t(1,s=l.autofocus),"onSelect"in l&&t(2,i=l.onSelect)},[n,s,i,a,r]}var Th=class extends Z{constructor(e){super(),ee(this,e,HF,NF,X,{availableFolders:4,placeholder:0,autofocus:1,onSelect:2})}},dw=Th;var pw=require("obsidian"),Ci=class extends pw.Modal{constructor(t,r,n,s){super(t);this.ComponentClass=r;this.componentProps=n;this.onSelect=s}onOpen(){let{modalEl:t}=this,r=t.closest(".modal-container");t.style.display="none";let n=r||t;this.component=new this.ComponentClass({target:n,props:{...this.componentProps,autofocus:!0,onSelect:s=>{this.onSelect(s),this.close()}}})}onClose(){var t;(t=this.component)==null||t.$destroy()}destroy(){this.onSelect=null,this.componentProps=null,this.ComponentClass=null}};var xf=class extends Ci{constructor(e,t,r){super(e,dw,{availableFolders:t,placeholder:"Search folders..."},r)}};function qF(o){Ee(o,"svelte-djtxkf","span.error.svelte-djtxkf{flex:auto;align-content:center}.section.svelte-djtxkf{margin-bottom:24px}")}function mw(o){let e,t,r,n,s;return t=new Ze({props:{name:"Remote folder"}}),n=new $a({props:{selectedItem:o[5],selectButtonText:"Choose a folder..."}}),n.$on("clear",o[12]),n.$on("select",o[13]),{c(){e=x("div"),D(t.$$.fragment),r=T(),D(n.$$.fragment),h(e,"class","section svelte-djtxkf")},m(i,a){S(i,e,a),A(t,e,null),b(e,r),A(n,e,null),s=!0},p(i,a){let l={};a&32&&(l.selectedItem=i[5]),n.$set(l)},i(i){s||(v(t.$$.fragment,i),v(n.$$.fragment,i),s=!0)},o(i){k(t.$$.fragment,i),k(n.$$.fragment,i),s=!1},d(i){i&&_(e),R(t),R(n)}}}function WF(o){let e,t,r,n;return{c(){e=x("input"),h(e,"type","text"),e.disabled=t=!o[5]},m(s,i){S(s,e,i),Ke(e,o[6]),r||(n=j(e,"input",o[14]),r=!0)},p(s,i){i&32&&t!==(t=!s[5])&&(e.disabled=t),i&64&&e.value!==s[6]&&Ke(e,s[6])},d(s){s&&_(e),r=!1,n()}}}function jF(o){let e,t;return e=new ew({props:{app:o[0],sharedFolders:o[3],selectedFolder:o[9]}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&8&&(s.sharedFolders=r[3]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function hw(o){let e,t;return{c(){e=x("span"),t=K(o[7]),h(e,"class","mod-warning error svelte-djtxkf")},m(r,n){S(r,e,n),b(e,t)},p(r,n){n&128&&te(t,r[7])},d(r){r&&_(e)}}}function zF(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y,g,I=!o[1]&&o[2].length>0&&mw(o);s=new $e({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[WF]},$$scope:{ctx:o}}}),a=new $e({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[jF]},$$scope:{ctx:o}}});let L=o[7]&&hw(o);return{c(){e=x("div"),e.textContent="Add to vault",t=T(),r=x("div"),I&&I.c(),n=T(),D(s.$$.fragment),i=T(),D(a.$$.fragment),l=T(),c=x("div"),L&&L.c(),f=T(),u=x("button"),d=K("Confirm"),h(e,"class","modal-title"),h(u,"class","mod-cta"),u.disabled=p=!o[5]||!o[6].trim(),h(c,"class","modal-button-container"),h(r,"class","modal-content")},m(C,w){S(C,e,w),S(C,t,w),S(C,r,w),I&&I.m(r,null),b(r,n),A(s,r,null),b(r,i),A(a,r,null),b(r,l),b(r,c),L&&L.m(c,null),b(c,f),b(c,u),b(u,d),m=!0,y||(g=j(u,"click",function(){nt((0,Fh.debounce)(o[15]))&&(0,Fh.debounce)(o[15]).apply(this,arguments)}),y=!0)},p(C,[w]){o=C,!o[1]&&o[2].length>0?I?(I.p(o,w),w&6&&v(I,1)):(I=mw(o),I.c(),v(I,1),I.m(r,n)):I&&(ce(),k(I,1,1,()=>{I=null}),fe());let E={};w&65632&&(E.$$scope={dirty:w,ctx:o}),s.$set(E);let F={};w&65545&&(F.$$scope={dirty:w,ctx:o}),a.$set(F),o[7]?L?L.p(o,w):(L=hw(o),L.c(),L.m(c,f)):L&&(L.d(1),L=null),(!m||w&96&&p!==(p=!o[5]||!o[6].trim()))&&(u.disabled=p)},i(C){m||(v(I),v(s.$$.fragment,C),v(a.$$.fragment,C),m=!0)},o(C){k(I),k(s.$$.fragment,C),k(a.$$.fragment,C),m=!1},d(C){C&&(_(e),_(t),_(r)),I&&I.d(),R(s),R(a),L&&L.d(),y=!1,g()}}}function KF(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{availableFolders:i=[]}=e,{sharedFolders:a}=e,{onConfirm:l}=e,c=s,f=(s==null?void 0:s.name)||"",u=we("/");de(o,u,C=>t(8,r=C));let d="",p=s,m=new xf(n,i,C=>{t(5,c=C)});dt(()=>{!s&&i.length>0&&setTimeout(()=>{m.open()},100)}),dn(()=>{m.close(),m.destroy()});let y=()=>{t(5,c=void 0),t(6,f="")},g=()=>{m.open()};function I(){f=this.value,t(6,f),t(5,c),t(11,p)}let L=async()=>{if(!c){t(7,d="Please select a remote folder");return}if(!f.trim()){t(7,d="Please enter a folder name");return}l(c,f,r||"/").catch(C=>{t(7,d=C.message)})};return o.$$set=C=>{"app"in C&&t(0,n=C.app),"remoteFolder"in C&&t(1,s=C.remoteFolder),"availableFolders"in C&&t(2,i=C.availableFolders),"sharedFolders"in C&&t(3,a=C.sharedFolders),"onConfirm"in C&&t(4,l=C.onConfirm)},o.$$.update=()=>{o.$$.dirty&2080&&c!==p&&(c&&t(6,f=c.name||""),t(11,p=c))},[n,s,i,a,l,c,f,d,r,u,m,p,y,g,I,L]}var Ph=class extends Z{constructor(e){super(),ee(this,e,KF,zF,X,{app:0,remoteFolder:1,availableFolders:2,sharedFolders:3,onConfirm:4},qF)}},gw=Ph;var Wn=class extends yw.Modal{constructor(t,r,n,s,i){super(t);this.sharedFolders=r;this.remoteFolder=n;this.availableFolders=s;this.onConfirm=i;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new gw({target:t,props:{remoteFolder:this.remoteFolder,availableFolders:this.availableFolders,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy(),this.onConfirm=null,this.sharedFolders=null,this.remoteFolder=void 0,this.availableFolders.length=0}};var Ew=require("obsidian"),Tw=Qo(Yn());function GF(o){Ee(o,"svelte-zmx7zz","span.faint.svelte-zmx7zz{color:var(--text-faint)}div.spacer.svelte-zmx7zz{height:3em}")}function bw(o,e,t){let r=o.slice();return r[33]=e[t],r[34]=e,r[35]=t,r}function vw(o,e,t){let r=o.slice();return r[36]=e[t],r}function xw(o,e,t){let r=o.slice();return r[39]=e[t],r}function JF(o){let e,t,r,n,s,i,a,l;function c(u){o[18](u)}let f={disabled:o[5],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[4]};return o[3]!==void 0&&(f.value=o[3]),e=new bf({props:f}),vt.push(()=>Hc(e,"value",c)),e.$on("input",o[14]),e.$on("enter",function(){nt((0,br.debounce)(o[19]))&&(0,br.debounce)(o[19]).apply(this,arguments)}),{c(){D(e.$$.fragment),r=T(),n=x("button"),s=K("Join"),h(n,"class","mod-cta system3-button"),n.disabled=o[5]},m(u,d){A(e,u,d),S(u,r,d),S(u,n,d),b(n,s),i=!0,a||(l=j(n,"click",function(){nt((0,br.debounce)(o[20]))&&(0,br.debounce)(o[20]).apply(this,arguments)}),a=!0)},p(u,d){o=u;let p={};d[0]&32&&(p.disabled=o[5]),d[0]&16&&(p.invalid=o[4]),!t&&d[0]&8&&(t=!0,p.value=o[3],$c(()=>t=!1)),e.$set(p),(!i||d[0]&32)&&(n.disabled=o[5])},i(u){i||(v(e.$$.fragment,u),i=!0)},o(u){k(e.$$.fragment,u),i=!1},d(u){u&&(_(r),_(n)),R(e,u),a=!1,l()}}}function QF(o){let e,t;return e=new $e({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[JF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&56|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function YF(o){let e;return{c(){e=x("span"),e.textContent="Relay Servers",h(e,"slot","name"),le(e,"display","inline-flex"),le(e,"align-items","center")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function XF(o){let e,t;function r(){return o[22](o[39])}return e=new _s({}),e.$on("settings",r),{c(){D(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){o=n},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function ZF(o){let e;return{c(){e=x("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function eP(o){let e=o[39].name+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[39].name+"")&&te(t,e)},d(r){r&&_(t)}}}function tP(o){let e;function t(s,i){return s[39].name?eP:ZF}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function rP(o){let e,t;return e=new Oa({props:{slot:"name",relay:o[39],$$slots:{default:[tP]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[39]),n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ww(o){let e,t;return e=new ar({props:{$$slots:{name:[rP],default:[XF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function oP(o){let e,t,r;return{c(){e=x("button"),e.textContent="Create",h(e,"class","mod-cta system3-button")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,br.debounce)(o[23])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function nP(o){let e,t,r,n=Se(o[7].values().filter(Qd).sort(Cw)),s=[];for(let a=0;a<n.length;a+=1)s[a]=ww(xw(o,n,a));let i=a=>k(s[a],1,1,()=>{s[a]=null});return t=new $e({props:{description:"",name:"",$$slots:{default:[oP]},$$scope:{ctx:o}}}),{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=T(),D(t.$$.fragment)},m(a,l){for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);S(a,e,l),A(t,a,l),r=!0},p(a,l){if(l[0]&1152){n=Se(a[7].values().filter(Qd).sort(Cw));let f;for(f=0;f<n.length;f+=1){let u=xw(a,n,f);s[f]?(s[f].p(u,l),v(s[f],1)):(s[f]=ww(u),s[f].c(),v(s[f],1),s[f].m(e.parentNode,e))}for(ce(),f=n.length;f<s.length;f+=1)i(f);fe()}let c={};l[1]&2048&&(c.$$scope={dirty:l,ctx:a}),t.$set(c)},i(a){if(!r){for(let l=0;l<n.length;l+=1)v(s[l]);v(t.$$.fragment,a),r=!0}},o(a){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)k(s[l]);k(t.$$.fragment,a),r=!1},d(a){a&&_(e),Je(s,a),R(t,a)}}}function _w(o){let e,t;return e=new $e({props:{description:"No shared folders on this device. Share folders from a Relay Server's settings page to begin collaboration."}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function sP(o){let e,t;function r(){return o[28](o[36])}return e=new _s({}),e.$on("settings",function(){nt((0,br.debounce)(r))&&(0,br.debounce)(r).apply(this,arguments)}),{c(){D(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){o=n},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function iP(o){let e,t;function r(){return o[27](o[36])}return e=new _s({}),e.$on("settings",function(){nt((0,br.debounce)(r))&&(0,br.debounce)(r).apply(this,arguments)}),{c(){D(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){o=n},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function aP(o){let e,t,r,n,s=[iP,sP],i=[];function a(l,c){return l[36].remote?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r))},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function lP(o){let e,t;return e=new Gx({props:{folder:o[36],slot:"name"}}),e.$on("manageSharedFolder",o[24]),e.$on("manageRemoteFolder",o[25]),e.$on("manageRelay",o[26]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.folder=r[36]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Sw(o){let e,t;return e=new ar({props:{$$slots:{name:[lP],default:[aP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&192|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function cP(o){let e,t,r;return{c(){e=x("button"),e.textContent="Add folder",h(e,"class","mod-cta system3-button"),h(e,"aria-label","Add shared folder to vault"),le(e,"max-width","8em")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,br.debounce)(o[17])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function fP(o){let e=o[6].items().length===0,t,r,n,s,i=e&&_w(o),a=Se(o[6].items().sort(Lw)),l=[];for(let f=0;f<a.length;f+=1)l[f]=Sw(vw(o,a,f));let c=f=>k(l[f],1,1,()=>{l[f]=null});return n=new ar({props:{name:"",$$slots:{default:[cP]},$$scope:{ctx:o}}}),{c(){i&&i.c(),t=T();for(let f=0;f<l.length;f+=1)l[f].c();r=T(),D(n.$$.fragment)},m(f,u){i&&i.m(f,u),S(f,t,u);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(f,u);S(f,r,u),A(n,f,u),s=!0},p(f,u){if(u[0]&64&&(e=f[6].items().length===0),e?i?u[0]&64&&v(i,1):(i=_w(f),i.c(),v(i,1),i.m(t.parentNode,t)):i&&(ce(),k(i,1,1,()=>{i=null}),fe()),u[0]&12480){a=Se(f[6].items().sort(Lw));let p;for(p=0;p<a.length;p+=1){let m=vw(f,a,p);l[p]?(l[p].p(m,u),v(l[p],1)):(l[p]=Sw(m),l[p].c(),v(l[p],1),l[p].m(r.parentNode,r))}for(ce(),p=a.length;p<l.length;p+=1)c(p);fe()}let d={};u[1]&2048&&(d.$$scope={dirty:u,ctx:f}),n.$set(d)},i(f){if(!s){v(i);for(let u=0;u<a.length;u+=1)v(l[u]);v(n.$$.fragment,f),s=!0}},o(f){k(i),l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)k(l[u]);k(n.$$.fragment,f),s=!1},d(f){f&&(_(t),_(r)),i&&i.d(f),Je(l,f),R(n,f)}}}function kw(o){let e,t,r,n,s,i;return r=new Ze({props:{name:"Subscriptions",helpText:"Subscriptions are tied to each Relay Server, not to your user account. Modify and cancel your subscription via our payment processor Stripe."}}),s=new St({props:{$$slots:{default:[gP]},$$scope:{ctx:o}}}),{c(){e=x("div"),t=T(),D(r.$$.fragment),n=T(),D(s.$$.fragment),h(e,"class","spacer svelte-zmx7zz")},m(a,l){S(a,e,l),S(a,t,l),A(r,a,l),S(a,n,l),A(s,a,l),i=!0},p(a,l){let c={};l[0]&257|l[1]&2048&&(c.$$scope={dirty:l,ctx:a}),s.$set(c)},i(a){i||(v(r.$$.fragment,a),v(s.$$.fragment,a),i=!0)},o(a){k(r.$$.fragment,a),k(s.$$.fragment,a),i=!1},d(a){a&&(_(e),_(t),_(n)),R(r,a),R(s,a)}}}function uP(o){let e,t,r,n;function s(){return o[30](o[33],o[34],o[35])}return{c(){e=x("button"),e.textContent="Manage",t=T(),h(e,"class","mod-cta system3-button")},m(i,a){S(i,e,a),S(i,t,a),r||(n=j(e,"click",function(){nt((0,br.debounce)(s))&&(0,br.debounce)(s).apply(this,arguments)}),r=!0)},p(i,a){o=i},d(i){i&&(_(e),_(t)),r=!1,n()}}}function dP(o){let e;return{c(){e=x("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function pP(o){let e=o[33].relay.name+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&256&&e!==(e=r[33].relay.name+"")&&te(t,e)},d(r){r&&_(t)}}}function mP(o){let e;function t(s,i){return s[33].relay.name?pP:dP}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=T()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function hP(o){let e,t;return e=new Oa({props:{slot:"name",relay:o[33].relay,$$slots:{default:[mP]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[29]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.relay=r[33].relay),n[0]&256|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Iw(o){let e,t;return e=new ar({props:{name:"",description:o[33].cancelAt?o[11](o[33].cancelAt):"",$$slots:{name:[hP],default:[uP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.description=r[33].cancelAt?r[11](r[33].cancelAt):""),n[0]&257|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function gP(o){let e,t,r=Se(o[8].values()),n=[];for(let i=0;i<r.length;i+=1)n[i]=Iw(bw(o,r,i));let s=i=>k(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=ve()},m(i,a){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,a);S(i,e,a),t=!0},p(i,a){if(a[0]&2305){r=Se(i[8].values());let l;for(l=0;l<r.length;l+=1){let c=bw(i,r,l);n[l]?(n[l].p(c,a),v(n[l],1)):(n[l]=Iw(c),n[l].c(),v(n[l],1),n[l].m(e.parentNode,e))}for(ce(),l=r.length;l<n.length;l+=1)s(l);fe()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)v(n[a]);t=!0}},o(i){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)k(n[a]);t=!1},d(i){i&&_(e),Je(n,i)}}}function yP(o){let e,t,r,n,s,i,a,l,c,f,u,d,p=o[2].values().length>0,m,y;e=new Ze({props:{name:"Join a Relay Server"}}),r=new St({props:{$$slots:{default:[QF]},$$scope:{ctx:o}}}),s=new Ze({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[YF]},$$scope:{ctx:o}}}),a=new St({props:{$$slots:{default:[nP]},$$scope:{ctx:o}}}),c=new Ze({props:{name:"My vault",helpText:"The following Shared Folders have been added to your vault. You can see what Relay Server a Shared Folder is connected to below."}}),u=new St({props:{$$slots:{default:[fP]},$$scope:{ctx:o}}});let g=p&&kw(o);return{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment),n=T(),D(s.$$.fragment),i=T(),D(a.$$.fragment),l=T(),D(c.$$.fragment),f=T(),D(u.$$.fragment),d=T(),g&&g.c(),m=ve()},m(I,L){A(e,I,L),S(I,t,L),A(r,I,L),S(I,n,L),A(s,I,L),S(I,i,L),A(a,I,L),S(I,l,L),A(c,I,L),S(I,f,L),A(u,I,L),S(I,d,L),g&&g.m(I,L),S(I,m,L),y=!0},p(I,L){let C={};L[0]&56|L[1]&2048&&(C.$$scope={dirty:L,ctx:I}),r.$set(C);let w={};L[1]&2048&&(w.$$scope={dirty:L,ctx:I}),s.$set(w);let E={};L[0]&128|L[1]&2048&&(E.$$scope={dirty:L,ctx:I}),a.$set(E);let F={};L[0]&192|L[1]&2048&&(F.$$scope={dirty:L,ctx:I}),u.$set(F),L[0]&4&&(p=I[2].values().length>0),p?g?(g.p(I,L),L[0]&4&&v(g,1)):(g=kw(I),g.c(),v(g,1),g.m(m.parentNode,m)):g&&(ce(),k(g,1,1,()=>{g=null}),fe())},i(I){y||(v(e.$$.fragment,I),v(r.$$.fragment,I),v(s.$$.fragment,I),v(a.$$.fragment,I),v(c.$$.fragment,I),v(u.$$.fragment,I),v(g),y=!0)},o(I){k(e.$$.fragment,I),k(r.$$.fragment,I),k(s.$$.fragment,I),k(a.$$.fragment,I),k(c.$$.fragment,I),k(u.$$.fragment,I),k(g),y=!1},d(I){I&&(_(t),_(n),_(i),_(l),_(f),_(d),_(m)),R(e,I),R(r,I),R(s,I),R(a,I),R(c,I),R(u,I),g&&g.d(I)}}}function Cw(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function Lw(o,e){return o.remote&&!e.remote?-1:e.remote&&!o.remote||o.name>e.name?1:-1}function bP(o,e,t){let r,n,s=z,i=()=>(s(),s=Ht(u,se=>t(7,n=se)),u),a,l=z,c=()=>(l(),l=Ht(d,se=>t(8,a=se)),d);o.$$.on_destroy.push(()=>s()),o.$$.on_destroy.push(()=>l());let{plugin:f}=e,{relays:u}=e;i();let{subscriptions:d}=e;c();let p=f.sharedFolders;de(o,p,se=>t(6,r=se));let m="",y=!1,g=!1,I=it();function L(se){se&&I("manageRelay",{relay:se})}function C(se){if(!se)return"Active";let pe=Ah.moment.utc(),Fe=Ah.moment.utc(se),ye=Fe.diff(pe,"days");return ye<=0?"Subscription has ended":ye===1?"Active for 1 more day":ye>31?`Ends on ${Fe.format("YYYY-MM-DD")}`:`Active for ${ye} more days`}function w(se,pe){se&&I("manageSharedFolder",{folder:se,relay:pe})}function E(se){se&&I("manageRemoteFolder",{remoteFolder:se})}function F(){t(4,y=!1)}function U(se){return Ae(this,void 0,void 0,function*(){try{t(5,g=!0);let pe=yield f.relayManager.acceptInvitation(se).catch(Fe=>{throw Fe.status===429&&new br.Notice("Slow down"),Fe});t(5,g=!1),I("joinRelay",{relay:pe})}catch(pe){t(4,y=!0),t(5,g=!1)}})}function V(){I("createRelay")}function P(se,pe,Fe){return Ae(this,void 0,void 0,function*(){let ye=(0,Ew.normalizePath)((0,Tw.join)(Fe,pe));f.app.vault.getFolderByPath(ye)===null&&(yield f.app.vault.createFolder(ye));let Ue=f.sharedFolders.new(ye,se.guid,se.relay.guid);return Ue.remote=se,Ue})}function $(){let se=[];n.values().forEach(Fe=>{Fe.folders&&Fe.folders.values().forEach(ye=>{r.items().some(He=>{var Qe;return((Qe=He.remote)===null||Qe===void 0?void 0:Qe.id)===ye.id})||se.push(ye)})}),new Wn(f.app,f.sharedFolders,void 0,se,P).open()}function re(se){m=se,t(3,m)}let W=()=>U(m),q=()=>U(m);function M(se){Pr.call(this,o,se)}let G=se=>{L(se)},B=()=>V();function Q(se){Pr.call(this,o,se)}function N(se){Pr.call(this,o,se)}function O(se){Pr.call(this,o,se)}let J=se=>{E(se.remote)},oe=se=>{let pe=n.values().find(Fe=>{var ye;return((ye=se.remote)==null?void 0:ye.relay.guid)===Fe.guid});w(se,pe)};function me(se){Pr.call(this,o,se)}let he=async(se,pe,Fe)=>{if(!se.token){let He=await f.relayManager.getSubscriptionToken(se);gi(d,pe[Fe].token=He,a)}let ye=se.id,Ue=se.token;window.open(f.buildApiUrl(`/subscriptions/${ye}/manage?token=${Ue}`),"_blank")};return o.$$set=se=>{"plugin"in se&&t(0,f=se.plugin),"relays"in se&&i(t(1,u=se.relays)),"subscriptions"in se&&c(t(2,d=se.subscriptions))},[f,u,d,m,y,g,r,n,a,p,L,C,w,E,F,U,V,$,re,W,q,M,G,B,Q,N,O,J,oe,me,he]}var Rh=class extends Z{constructor(e){super(),ee(this,e,bP,yP,X,{plugin:0,relays:1,subscriptions:2},GF,[-1,-1])}},Go=Rh;var Ct=require("obsidian");var d_=Qo(Yn());function vP(o){Ee(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function xP(o){let e,t,r;return t=new cm({props:{class:"svg-icon"}}),{c(){e=x("span"),D(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){S(n,e,s),A(t,e,null),r=!0},p:z,i(n){r||(v(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}var Mh=class extends Z{constructor(e){super(),ee(this,e,null,xP,X,{},vP)}},wf=Mh;function wP(o){Ee(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function _P(o){let e,t,r,n,s,i;return{c(){e=x("div"),t=x("div"),n=T(),s=x("div"),i=K(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),le(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(a,l){S(a,e,l),b(e,t),S(a,n,l),S(a,s,l),b(s,i)},p(a,[l]){l&1&&le(t,"width",a[0]+"%"),l&1&&r!==(r=a[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&te(i,a[1])},i:z,o:z,d(a){a&&(_(e),_(n),_(s))}}}function SP(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var Dh=class extends Z{constructor(e){super(),ee(this,e,SP,_P,X,{diskUsagePercentage:0,text:1},wP)}},Fw=Dh;var Vw=require("obsidian");var EZ=require("obsidian");var Pw=require("obsidian");function kP(o){Ee(o,"svelte-pb1sr8",".suggestion-create-prefix.svelte-pb1sr8{color:var(--text-muted);font-style:italic}.suggestion-action.svelte-pb1sr8{color:var(--text-muted);font-size:var(--font-smaller)}.suggestion-icon.svelte-pb1sr8{display:flex;align-items:center}.system3-svg-icon{color:var(--text-muted);opacity:0.6}")}function IP(o){let e=o[10].path+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&1024&&e!==(e=r[10].path+"")&&te(t,e)},d(r){r&&_(t)}}}function CP(o){let e,t=o[10].path+"",r;return{c(){e=x("span"),e.textContent="Create: ",r=K(t),h(e,"class","suggestion-create-prefix svelte-pb1sr8")},m(n,s){S(n,e,s),S(n,r,s)},p(n,s){s&1024&&t!==(t=n[10].path+"")&&te(r,t)},d(n){n&&(_(e),_(r))}}}function LP(o){let e;function t(s,i){return s[10].isCreate?CP:IP}let r=t(o,-1),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function EP(o){let e;return{c(){e=x("div"),h(e,"class","suggestion-icon svelte-pb1sr8")},m(t,r){S(t,e,r)},i:z,o:z,d(t){t&&_(e)}}}function TP(o){let e,t,r;return t=new _o({props:{class:"system3-svg-icon",size:16}}),{c(){e=x("div"),D(t.$$.fragment),h(e,"class","suggestion-icon svelte-pb1sr8")},m(n,s){S(n,e,s),A(t,e,null),r=!0},i(n){r||(v(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function FP(o){let e;return{c(){e=x("span"),e.textContent="Enter to create",h(e,"class","suggestion-action svelte-pb1sr8")},m(t,r){S(t,e,r)},i:z,o:z,d(t){t&&_(e)}}}function PP(o){let e,t,r,n,s=[FP,TP,EP],i=[];function a(l,c){return l[10].isCreate?0:l[10].isShared&&!l[10].hasRelay?1:2}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e!==f&&(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),t=i[e],t||(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r))},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function AP(o){let e,t;return e=new vf({props:{placeholder:o[0],autofocus:o[1],onSelect:o[3],getSuggestions:o[2],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}],$$slots:{"suggestion-aux":[PP,({item:r})=>({10:r}),({item:r})=>r?1024:0],suggestion:[LP,({item:r})=>({10:r}),({item:r})=>r?1024:0]},$$scope:{ctx:o}}}),e.$on("customInput",o[9]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&3072&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function RP(o,e,t){let{app:r}=e,{placeholder:n="Choose or create folder..."}=e,{blockedPaths:s=new Set}=e,{sharedFolders:i}=e,{autofocus:a=!1}=e,{onSelect:l=()=>{}}=e;function c(p){let m=new Map;i&&i.forEach(E=>{m.set(E.path,!!E.relayId)});let y=p.toLowerCase(),g=[],I=new Set,L=E=>{if(!(s.has(E.path)&&E.path!=="/")){if((!y||E.path.toLowerCase().includes(y))&&!s.has(E.path)){let F=m.has(E.path),U=m.get(E.path)||!1;g.push({path:E.path,isCreate:!1,isShared:F,hasRelay:U}),I.add(E.path.toLowerCase())}for(let F of E.children)F instanceof Pw.TFolder&&L(F)}},C=r.vault.getRoot();L(C);let w=p.trim();return w&&!I.has(w.toLowerCase())&&g.unshift({path:w,isCreate:!0,isShared:!1,hasRelay:!1}),g.sort((E,F)=>E.isCreate&&!F.isCreate?-1:!E.isCreate&&F.isCreate?1:E.isShared&&!E.hasRelay&&(!F.isShared||F.hasRelay)?-1:F.isShared&&!F.hasRelay&&(!E.isShared||E.hasRelay)?1:E.path.localeCompare(F.path)),g.slice(0,100)}function f(p){l(p.path)}function u(p){l(p)}let d=p=>u(p.detail.value);return o.$$set=p=>{"app"in p&&t(5,r=p.app),"placeholder"in p&&t(0,n=p.placeholder),"blockedPaths"in p&&t(6,s=p.blockedPaths),"sharedFolders"in p&&t(7,i=p.sharedFolders),"autofocus"in p&&t(1,a=p.autofocus),"onSelect"in p&&t(8,l=p.onSelect)},[n,a,c,f,u,r,s,i,l,d]}var Uh=class extends Z{constructor(e){super(),ee(this,e,RP,AP,X,{app:5,placeholder:0,blockedPaths:6,sharedFolders:7,autofocus:1,onSelect:8},kP)}},Aw=Uh;var Li=class extends Ci{constructor(e,t="Choose or create folder...",r=new Set,n,s){super(e,Aw,{app:e,placeholder:t,blockedPaths:r,sharedFolders:n},s)}};var Sf=we({});function MP(o,e,t,r="error",n,s="client"){Sf.update(i=>({...i,[o]:{message:e,details:t,type:r,visible:!0,autoDismiss:n!=null?n:5e3,source:s}}))}function Rw(o){Sf.update(e=>({...e,[o]:{...e[o],visible:!1}}))}function _f(o,e,t,r="error",n){MP(o,e,t,r,n,"server")}function dr(o,e="An error occurred"){var r,n,s;let t=`server-error-${Date.now()}`;if(o.status===403){let i=((r=o.body)==null?void 0:r.message)||o.message||"Permission denied",a=(n=o.body)==null?void 0:n.details;_f(t,i,a,"error",7e3)}else if(o.status>=400&&o.status<500){let i=((s=o.body)==null?void 0:s.message)||o.message||e;_f(t,i,void 0,"error",5e3)}else o.status>=500?_f(t,"Server error occurred",o.message,"error",8e3):_f(t,e,o.message,"error",5e3)}function DP(o){Ee(o,"svelte-y144a4",".share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:500px;max-width:600px}@media(max-width: 768px){.share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:100vw;max-width:100vw;margin:0;border-radius:0;height:100vh;max-height:100vh}}.section.svelte-y144a4.svelte-y144a4{margin-bottom:24px}.search-container.svelte-y144a4.svelte-y144a4{margin-bottom:12px}.search-input.svelte-y144a4.svelte-y144a4{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-y144a4.svelte-y144a4{max-height:300px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary)}.user-item.svelte-y144a4.svelte-y144a4{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);gap:12px}.user-item.svelte-y144a4.svelte-y144a4:last-child{border-bottom:none}.user-item.svelte-y144a4.svelte-y144a4:hover:not(.is-current-user){background:var(--background-modifier-hover)}.user-item.is-current-user.svelte-y144a4.svelte-y144a4{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-y144a4.svelte-y144a4{margin:0;cursor:pointer}.user-avatar.svelte-y144a4.svelte-y144a4{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-y144a4 img.svelte-y144a4{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-y144a4.svelte-y144a4{flex:1;min-width:0}.user-name.svelte-y144a4.svelte-y144a4{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-y144a4.svelte-y144a4{font-size:0.8em;color:var(--text-muted);font-style:italic;margin-left:auto}.no-users.svelte-y144a4.svelte-y144a4{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-y144a4.svelte-y144a4{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.modal-button-container.users-step.svelte-y144a4.svelte-y144a4{justify-content:space-between}button.svelte-y144a4.svelte-y144a4:disabled{opacity:0.5;cursor:not-allowed}.checkbox-container.svelte-y144a4.svelte-y144a4{cursor:pointer}")}function Mw(o,e,t){let r=o.slice();return r[38]=e[t],r}function UP(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y,g,I,L,C,w,E,F,U,V;s=new Ze({props:{name:"Selected Folder"}}),a=new $a({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],readonly:!0}}),f=new Ze({props:{name:"Users"}});function P(W,q){return W[7].length===0?BP:$P}let $=P(o,[-1,-1]),re=$(o);return{c(){e=x("div"),e.textContent="Add Users to Folder",t=T(),r=x("div"),n=x("div"),D(s.$$.fragment),i=T(),D(a.$$.fragment),l=T(),c=x("div"),D(f.$$.fragment),u=T(),d=x("div"),p=x("input"),m=T(),y=x("div"),re.c(),g=T(),I=x("div"),L=x("button"),L.textContent="Back",C=T(),w=x("button"),w.textContent="Share",h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(p,"type","text"),h(p,"placeholder","Search users by name..."),h(p,"class","search-input svelte-y144a4"),h(d,"class","search-container svelte-y144a4"),h(y,"class","user-list svelte-y144a4"),h(c,"class","section svelte-y144a4"),h(L,"class","mod-muted svelte-y144a4"),h(w,"class","mod-cta svelte-y144a4"),w.disabled=E=!1,h(I,"class","modal-button-container users-step svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(W,q){S(W,e,q),S(W,t,q),S(W,r,q),b(r,n),A(s,n,null),b(n,i),A(a,n,null),b(r,l),b(r,c),A(f,c,null),b(c,u),b(c,d),b(d,p),Ke(p,o[6]),b(c,m),b(c,y),re.m(y,null),b(r,g),b(r,I),b(I,L),b(I,C),b(I,w),o[28](r),F=!0,U||(V=[j(p,"input",o[25]),j(L,"click",o[15]),j(w,"click",o[14])],U=!0)},p(W,q){let M={};q[0]&16&&(M.selectedItem=W[4]),q[0]&4&&(M.isPrivate=W[2]),a.$set(M),q[0]&64&&p.value!==W[6]&&Ke(p,W[6]),$===($=P(W,q))&&re?re.p(W,q):(re.d(1),re=$(W),re&&(re.c(),re.m(y,null)))},i(W){F||(v(s.$$.fragment,W),v(a.$$.fragment,W),v(f.$$.fragment,W),F=!0)},o(W){k(s.$$.fragment,W),k(a.$$.fragment,W),k(f.$$.fragment,W),F=!1},d(W){W&&(_(e),_(t),_(r)),R(s),R(a),R(f),re.d(),o[28](null),U=!1,xe(V)}}}function OP(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[2]?"Add Users":"Share",p,m,y,g,I;s=new Ze({props:{name:"Folder"}}),a=new $a({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],selectButtonText:"Choose or create folder..."}}),a.$on("clear",o[11]),a.$on("select",o[16]);let L=o[0].version>0&&Ow(o);return{c(){e=x("div"),e.textContent="Share a folder",t=T(),r=x("div"),n=x("div"),D(s.$$.fragment),i=T(),D(a.$$.fragment),l=T(),L&&L.c(),c=T(),f=x("div"),u=x("button"),p=K(d),h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(u,"class","mod-cta svelte-y144a4"),u.disabled=m=!o[4]&&!o[3].trim(),h(f,"class","modal-button-container svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(C,w){S(C,e,w),S(C,t,w),S(C,r,w),b(r,n),A(s,n,null),b(n,i),A(a,n,null),b(r,l),L&&L.m(r,null),b(r,c),b(r,f),b(f,u),b(u,p),o[24](r),y=!0,g||(I=j(u,"click",o[12]),g=!0)},p(C,w){let E={};w[0]&16&&(E.selectedItem=C[4]),w[0]&4&&(E.isPrivate=C[2]),a.$set(E),C[0].version>0?L?(L.p(C,w),w[0]&1&&v(L,1)):(L=Ow(C),L.c(),v(L,1),L.m(r,c)):L&&(ce(),k(L,1,1,()=>{L=null}),fe()),(!y||w[0]&4)&&d!==(d=C[2]?"Add Users":"Share")&&te(p,d),(!y||w[0]&24&&m!==(m=!C[4]&&!C[3].trim()))&&(u.disabled=m)},i(C){y||(v(s.$$.fragment,C),v(a.$$.fragment,C),v(L),y=!0)},o(C){k(s.$$.fragment,C),k(a.$$.fragment,C),k(L),y=!1},d(C){C&&(_(e),_(t),_(r)),R(s),R(a),L&&L.d(),o[24](null),g=!1,I()}}}function $P(o){let e,t=Se(o[7]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Uw(Mw(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ve()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);S(n,e,s)},p(n,s){if(s[0]&8320){t=Se(n[7]);let i;for(i=0;i<t.length;i+=1){let a=Mw(n,t,i);r[i]?r[i].p(a,s):(r[i]=Uw(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function BP(o){let e,t=o[6]?"No users found":"No users available",r;return{c(){e=x("div"),r=K(t),h(e,"class","no-users svelte-y144a4")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s[0]&64&&t!==(t=n[6]?"No users found":"No users available")&&te(r,t)},d(n){n&&_(e)}}}function VP(o){let e=$w(o[38].user.name)+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&128&&e!==(e=$w(r[38].user.name)+"")&&te(t,e)},d(r){r&&_(t)}}}function NP(o){let e,t,r;return{c(){e=x("img"),Tr(e.src,t=o[38].user.picture)||h(e,"src",t),h(e,"alt",r=o[38].user.name),h(e,"class","svelte-y144a4")},m(n,s){S(n,e,s)},p(n,s){s[0]&128&&!Tr(e.src,t=n[38].user.picture)&&h(e,"src",t),s[0]&128&&r!==(r=n[38].user.name)&&h(e,"alt",r)},d(n){n&&_(e)}}}function Dw(o){let e;return{c(){e=x("div"),e.textContent="Required (You)",h(e,"class","user-status svelte-y144a4")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function Uw(o){let e,t,r,n,s,i,a,l,c,f=o[38].user.name+"",u,d,p,m,y;function g(F,U){return F[38].user.picture?NP:VP}let I=g(o,[-1,-1]),L=I(o),C=o[38].isCurrentUser&&Dw(o);function w(){return o[26](o[38])}function E(...F){return o[27](o[38],...F)}return{c(){e=x("div"),t=x("input"),s=T(),i=x("div"),L.c(),a=T(),l=x("div"),c=x("div"),u=K(f),d=T(),C&&C.c(),p=T(),h(t,"type","checkbox"),t.checked=r=o[38].selected,t.disabled=n=o[38].isCurrentUser,h(t,"class","user-checkbox svelte-y144a4"),h(t,"tabindex","-1"),h(i,"class","user-avatar svelte-y144a4"),h(c,"class","user-name svelte-y144a4"),h(l,"class","user-info svelte-y144a4"),h(e,"class","user-item svelte-y144a4"),h(e,"role","button"),h(e,"tabindex","0"),Te(e,"is-current-user",o[38].isCurrentUser)},m(F,U){S(F,e,U),b(e,t),b(e,s),b(e,i),L.m(i,null),b(e,a),b(e,l),b(l,c),b(c,u),b(e,d),C&&C.m(e,null),b(e,p),m||(y=[j(e,"click",w),j(e,"keydown",E)],m=!0)},p(F,U){o=F,U[0]&128&&r!==(r=o[38].selected)&&(t.checked=r),U[0]&128&&n!==(n=o[38].isCurrentUser)&&(t.disabled=n),I===(I=g(o,U))&&L?L.p(o,U):(L.d(1),L=I(o),L&&(L.c(),L.m(i,null))),U[0]&128&&f!==(f=o[38].user.name+"")&&te(u,f),o[38].isCurrentUser?C||(C=Dw(o),C.c(),C.m(e,p)):C&&(C.d(1),C=null),U[0]&128&&Te(e,"is-current-user",o[38].isCurrentUser)},d(F){F&&_(e),L.d(),C&&C.d(),m=!1,xe(y)}}}function Ow(o){let e,t;return e=new $e({props:{name:"Private",description:"Only selected users can access this folder",$$slots:{default:[HP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&4|n[1]&1024&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function HP(o){let e,t,r,n,s,i;return{c(){e=x("div"),t=x("input"),r=T(),n=x("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[2]),h(e,"tabindex","0"),h(e,"class","checkbox-container svelte-y144a4"),Te(e,"is-enabled",o[2])},m(a,l){S(a,e,l),b(e,t),t.checked=o[2],b(e,r),b(e,n),s||(i=[j(t,"change",o[21]),j(e,"keypress",o[22]),j(e,"click",o[23])],s=!0)},p(a,l){l[0]&4&&(t.checked=a[2]),l[0]&4&&h(e,"aria-checked",a[2]),l[0]&4&&Te(e,"is-enabled",a[2])},d(a){a&&_(e),s=!1,xe(i)}}}function qP(o){let e,t,r,n,s=[OP,UP],i=[];function a(l,c){return l[1]==="main"?0:l[1]==="users"?1:-1}return~(e=a(o,[-1,-1]))&&(t=i[e]=s[e](o)),{c(){t&&t.c(),r=ve()},m(l,c){~e&&i[e].m(l,c),S(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?~e&&i[e].p(l,c):(t&&(ce(),k(i[f],1,1,()=>{i[f]=null}),fe()),~e?(t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r)):t=null)},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),~e&&i[e].d(l)}}}function $w(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function WP(o,e,t){let r,n,s;var i;let{app:a}=e,{relay:l}=e,{relayManager:c}=e,{sharedFolders:f}=e,{onConfirm:u}=e,d="main",p=!1,m="",y="",g=we(new Set(!((i=c.user)===null||i===void 0)&&i.id?[c.user.id]:[]));de(o,g,pe=>t(30,r=pe));let I=we("");de(o,I,pe=>t(6,n=pe));let L,C=()=>new Set(f.filter(pe=>!!pe.relayId).map(pe=>pe.path)).add("/"),w=at([c.relayRoles],([pe])=>Array.from(pe.values()).filter(Fe=>Fe.relayId===l.id).map(Fe=>Fe.user)),E=at([w,g],([pe,Fe])=>{var ye;let Ue=(ye=c.user)===null||ye===void 0?void 0:ye.id;return pe.map(He=>{let Qe=Ue===He.id,rt=Fe.has(He.id)||Qe;return{user:He,selected:rt,isCurrentUser:Qe}})}),F=at([E,I],([pe,Fe])=>{if(!Fe||Fe.trim()==="")return pe;let ye=Fe.toLowerCase().trim();return pe.filter(Ue=>Ue.user.name.toLowerCase().includes(ye))}),U=at([F],([pe])=>pe.sort((Fe,ye)=>Fe.user.name.localeCompare(ye.user.name)));de(o,U,pe=>t(7,s=pe));function V(){t(4,y=""),t(3,m="")}function P(){!y&&m.trim()&&t(4,y=m.trim()),p?t(1,d="users"):re()}function $(pe){pe.isCurrentUser||g.update(Fe=>{let ye=new Set(Fe);return ye.has(pe.user.id)?ye.delete(pe.user.id):ye.add(pe.user.id),ye})}function re(){return Ae(this,void 0,void 0,function*(){var pe;!y&&m.trim()&&t(4,y=m.trim());try{let Fe=(pe=c.user)===null||pe===void 0?void 0:pe.id,Ue=Array.from(r).filter(He=>He!==Fe);yield u(y,y.split("/").pop()||"",p,Ue)}catch(Fe){dr(Fe,"Failed to share folder.")}})}function W(){t(1,d="main")}function q(pe){t(4,y=pe),t(3,m=pe)}function M(){new Li(a,"Choose or create folder...",C(),f,q).open()}let G=pe=>{pe.key==="Tab"&&B(pe)};dt(()=>(document.addEventListener("keydown",G),y||setTimeout(()=>{M()},100),()=>{document.removeEventListener("keydown",G)}));function B(pe){if(!L)return;let Fe=L.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),ye=Fe[0],Ue=Fe[Fe.length-1];pe.shiftKey?document.activeElement===ye&&(pe.preventDefault(),Ue.focus()):document.activeElement===Ue&&(pe.preventDefault(),ye.focus())}function Q(){p=this.checked,t(2,p)}let N=()=>t(2,p=!p),O=()=>t(2,p=!p);function J(pe){vt[pe?"unshift":"push"](()=>{L=pe,t(5,L)})}function oe(){n=this.value,I.set(n)}let me=pe=>$(pe),he=(pe,Fe)=>{(Fe.key==="Enter"||Fe.key===" ")&&(Fe.preventDefault(),$(pe))};function se(pe){vt[pe?"unshift":"push"](()=>{L=pe,t(5,L)})}return o.$$set=pe=>{"app"in pe&&t(17,a=pe.app),"relay"in pe&&t(0,l=pe.relay),"relayManager"in pe&&t(18,c=pe.relayManager),"sharedFolders"in pe&&t(19,f=pe.sharedFolders),"onConfirm"in pe&&t(20,u=pe.onConfirm)},[l,d,p,m,y,L,n,s,g,I,U,V,P,$,re,W,M,a,c,f,u,Q,N,O,J,oe,me,he,se]}var Oh=class extends Z{constructor(e){super(),ee(this,e,WP,qP,X,{app:17,relay:0,relayManager:18,sharedFolders:19,onConfirm:20},DP,[-1,-1])}},Bw=Oh;var kf=class extends Vw.Modal{constructor(t,r,n,s,i){super(t);this.relay=r;this.sharedFolders=n;this.relayManager=s;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new Bw({target:t,props:{app:this.app,relay:this.relay,relayManager:this.relayManager,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s,i)=>{let a=await this.onConfirm(r,n,s,i);return this.close(),a}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}destroy(){this.relay=null,this.sharedFolders=null,this.relayManager=null,this.onConfirm=null}};function jP(o){Ee(o,"svelte-1r0liue",`.el-pre.svelte-1r0liue.svelte-1r0liue{position:relative;margin:1em 0}pre.language-toml.svelte-1r0liue.svelte-1r0liue{position:relative;background:var(--code-background);border-radius:var(--radius-s);padding:1em;overflow-x:auto;font-family:var(--font-monospace);font-size:var(--code-size);line-height:var(--line-height-normal);tab-size:4;border:1px solid var(--background-modifier-border)}code.language-toml.svelte-1r0liue.svelte-1r0liue{display:block;color:var(--code-normal);white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:inherit;user-select:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}.copy-code-button.svelte-1r0liue.svelte-1r0liue{position:absolute;top:0.5em;right:0.5em;padding:0.25em;background:transparent;border:none;color:var(--text-muted);cursor:pointer;opacity:0;transition:opacity 0.2s ease,
			color 0.2s ease;display:flex;align-items:center;justify-content:center;box-shadow:none !important}.el-pre.svelte-1r0liue:hover .copy-code-button.svelte-1r0liue{opacity:0.7;box-shadow:none}.copy-code-button.svelte-1r0liue.svelte-1r0liue:hover{opacity:1 !important;color:var(--text-normal);background:transparent;border:none;box-shadow:none !important}.copy-code-button.svelte-1r0liue.svelte-1r0liue:focus{outline:none;border:none;opacity:1;color:var(--interactive-accent);background:transparent;box-shadow:none !important}.svg-icon.svelte-1r0liue.svelte-1r0liue{width:16px;height:16px}.error-message.svelte-1r0liue.svelte-1r0liue{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}`)}function zP(o){let e;return{c(){e=x("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-1r0liue")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function KP(o){let e,t,r,n,s,i,a,l,c;function f(p,m){return p[1]?JP:GP}let u=f(o,-1),d=u(o);return{c(){e=x("div"),t=x("pre"),r=x("code"),n=x("button"),s=K(`
				`),d.c(),i=K(`
			`),h(r,"class","language-toml is-loaded svelte-1r0liue"),h(n,"class","copy-code-button svelte-1r0liue"),h(n,"aria-label",a=o[1]?"Copied to clipboard":"Copy"),h(t,"class","language-toml svelte-1r0liue"),h(e,"class","el-pre svelte-1r0liue")},m(p,m){S(p,e,m),b(e,t),b(t,r),r.innerHTML=o[2],b(t,n),b(n,s),d.m(n,null),b(n,i),l||(c=[j(n,"click",o[3]),j(n,"keydown",o[4])],l=!0)},p(p,m){m&4&&(r.innerHTML=p[2]),u!==(u=f(p,m))&&(d.d(1),d=u(p),d&&(d.c(),d.m(n,i))),m&2&&a!==(a=p[1]?"Copied to clipboard":"Copy")&&h(n,"aria-label",a)},d(p){p&&_(e),d.d(),l=!1,xe(c)}}}function GP(o){let e,t,r;return{c(){e=ir("svg"),t=ir("rect"),r=ir("path"),h(t,"x","8"),h(t,"y","8"),h(t,"width","14"),h(t,"height","14"),h(t,"rx","2"),h(t,"ry","2"),h(r,"d","M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24"),h(e,"height","24"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","svg-icon lucide-copy svelte-1r0liue")},m(n,s){S(n,e,s),b(e,t),b(e,r)},d(n){n&&_(e)}}}function JP(o){let e,t;return{c(){e=ir("svg"),t=ir("polyline"),h(t,"points","20,6 9,17 4,12"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24"),h(e,"height","24"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","svg-icon lucide-check svelte-1r0liue")},m(r,n){S(r,e,n),b(e,t)},d(r){r&&_(e)}}}function QP(o){let e;function t(s,i){return s[0]?KP:zP}let r=t(o,-1),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},i:z,o:z,d(s){s&&_(e),n.d(s)}}}function YP(o){let e=[],t=o.split(`
`);for(let r of t){let n=r.trim();if(n==="")e.push({type:"newline",value:r});else if(n.startsWith("#"))e.push({type:"comment",value:r});else if(n.startsWith("[[")&&n.endsWith("]]")){let s=r.match(/^(\s*)\[\[([^\]]+)\]\](\s*)$/);if(s){let[,i,a,l]=s;e.push({type:"array-table",value:r,parts:{leading:i,tableName:a,trailing:l}})}else e.push({type:"text",value:r})}else if(n.startsWith("[")&&n.endsWith("]")){let s=r.match(/^(\s*)\[([^\]]+)\](\s*)$/);if(s){let[,i,a,l]=s;e.push({type:"table",value:r,parts:{leading:i,tableName:a,trailing:l}})}else e.push({type:"text",value:r})}else if(n.includes("=")){let s=r.match(/^(\s*)([^=]+?)\s*=\s*(.+)(\s*)$/);if(s){let[,i,a,l,c]=s;e.push({type:"key-value",value:r,parts:{leading:i,key:a.trim(),value:l.trim(),trailing:c}})}else e.push({type:"text",value:r})}else e.push({type:"text",value:r})}return e}function XP(o){return o.map(e=>{switch(e.type){case"comment":return`<span class="token comment">${e.value}</span>`;case"newline":return e.value;case"table":let{leading:t,tableName:r,trailing:n}=e.parts;return`${t}<span class="token punctuation">[</span><span class="token table class-name">${r}</span><span class="token punctuation">]</span>${n}`;case"array-table":let{leading:s,tableName:i,trailing:a}=e.parts;return`${s}<span class="token punctuation">[[</span><span class="token table class-name">${i}</span><span class="token punctuation">]]</span>${a}`;case"key-value":let{leading:l,key:c,value:f,trailing:u}=e.parts,d=f;return f.startsWith('"')&&f.endsWith('"')?d=`<span class="token string">${f}</span>`:/^\d+$/.test(f)?d=`<span class="token number">${f}</span>`:d=`<span class="token string">${f}</span>`,`${l}<span class="token key property">${c}</span> <span class="token punctuation">=</span> ${d}${u}`;default:return e.value}}).join(`
`)}function ZP(o,e,t){let r,{toml:n=""}=e,s=!1;function i(){return Ae(this,void 0,void 0,function*(){try{yield navigator.clipboard.writeText(n),t(1,s=!0),setTimeout(()=>{t(1,s=!1)},2e3)}catch(l){console.error("Failed to copy text: ",l)}})}function a(l){l.key==="Enter"&&(l.preventDefault(),i())}return o.$$set=l=>{"toml"in l&&t(0,n=l.toml)},o.$$.update=()=>{o.$$.dirty&1&&t(2,r=n?XP(YP(n)):"")},[n,s,r,i,a]}var $h=class extends Z{constructor(e){super(),ee(this,e,ZP,QP,X,{toml:0},jP)}},If=$h;var Bh=require("obsidian");function eA(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function tA(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function jn(o){let e=eA(o);return tA(e)}function rA(o){Ee(o,"svelte-sj7m72",`div.spacer.svelte-sj7m72{height:3em}.faint.svelte-sj7m72{color:var(--text-faint) !important}.edit-members-button.svelte-sj7m72{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-sj7m72:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-sj7m72:focus{outline:none;color:var(--icon-color-focus)}.share-key-container.svelte-sj7m72{width:100%}.share-key-disabled-notice.svelte-sj7m72{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-sj7m72{text-align:right}input.system3-updating.svelte-sj7m72{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-sj7m72{border:1px solid var(--color-red) !important}.admin-toggle-btn.svelte-sj7m72{background:none;border:none;box-shadow:none;color:var(--text-muted);font-size:0.9em;cursor:pointer;padding:0;margin-left:8px}.admin-toggle-btn.svelte-sj7m72:hover{color:var(--text-normal);text-decoration:underline}.relay-auth-section.svelte-sj7m72{margin:16px 0}.loading-message.svelte-sj7m72{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.error-message.svelte-sj7m72{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}`)}function Nw(o,e,t){let r=o.slice();return r[87]=e[t],r}function Hw(o,e,t){let r=o.slice();return r[90]=e[t],r}function qw(o,e,t){let r=o.slice();return r[93]=e[t],r}function Ww(o){let e,t;return e=new $e({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[oA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&132225|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function oA(o){let e,t,r,n;return{c(){e=x("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=Fr((o[17]?"system3-updating":"")+(o[10]?"":" system3-input-invalid"))+" svelte-sj7m72")},m(s,i){S(s,e,i),Ke(e,o[0].name),o[68](e),r||(n=[j(e,"input",o[67]),j(e,"input",o[51])],r=!0)},p(s,i){i[0]&132096&&t!==(t=Fr((s[17]?"system3-updating":"")+(s[10]?"":" system3-input-invalid"))+" svelte-sj7m72")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&Ke(e,s[0].name)},d(s){s&&_(e),o[68](null),r=!1,xe(n)}}}function jw(o){let e,t=o[20]?"View as member":"View as admin",r,n,s;return{c(){e=x("button"),r=K(t),h(e,"class","admin-toggle-btn svelte-sj7m72")},m(i,a){S(i,e,a),b(e,r),n||(s=j(e,"click",o[69]),n=!0)},p(i,a){a[0]&1048576&&t!==(t=i[20]?"View as member":"View as admin")&&te(r,t)},d(i){i&&_(e),n=!1,s()}}}function nA(o){let e,t=o[18]&&o[19]&&jw(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),S(r,e,n)},p(r,n){r[18]&&r[19]?t?t.p(r,n):(t=jw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function zw(o){let e,t;return e=new ar({props:{$$slots:{name:[lA],default:[iA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&6291458|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Kw(o){let e,t;function r(){return o[71](o[93])}return e=new _s({props:{label:"Add to vault",$$slots:{default:[sA]},$$scope:{ctx:o}}}),e.$on("settings",function(){nt((0,Ct.debounce)(r))&&(0,Ct.debounce)(r).apply(this,arguments)}),{c(){D(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){o=n;let i={};s[3]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function sA(o){let e,t;return e=new Xp({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p:z,i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function iA(o){let e=!o[22].some(s)&&No(o[1].relayManager.userCan(["folder","read_content"],o[93])),t,r,n;function s(...l){return o[65](o[93],...l)}let i=e&&Kw(o);function a(){return o[72](o[93])}return r=new _s({}),r.$on("settings",function(){nt((0,Ct.debounce)(a))&&(0,Ct.debounce)(a).apply(this,arguments)}),{c(){i&&i.c(),t=T(),D(r.$$.fragment)},m(l,c){i&&i.m(l,c),S(l,t,c),A(r,l,c),n=!0},p(l,c){o=l,c[0]&6291458&&(e=!o[22].some(s)&&No(o[1].relayManager.userCan(["folder","read_content"],o[93]))),e?i?(i.p(o,c),c[0]&6291458&&v(i,1)):(i=Kw(o),i.c(),v(i,1),i.m(t.parentNode,t)):i&&(ce(),k(i,1,1,()=>{i=null}),fe())},i(l){n||(v(i),v(r.$$.fragment,l),n=!0)},o(l){k(i),k(r.$$.fragment,l),n=!1},d(l){l&&_(t),i&&i.d(l),R(r,l)}}}function aA(o){let e=o[93].name+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&2097152&&e!==(e=r[93].name+"")&&te(t,e)},d(r){r&&_(t)}}}function lA(o){let e,t;function r(){return o[70](o[93])}return e=new yf({props:{remoteFolder:o[93],slot:"name",$$slots:{default:[aA]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",r),{c(){D(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){o=n;let i={};s[0]&2097152&&(i.remoteFolder=o[93]),s[0]&2097152|s[3]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function Gw(o){let e=o[20]?No(o[1].relayManager.userCan(["folder","manage_users"],o[93])):No(o[1].relayManager.userCan(["folder","read_content"],o[93])),t,r,n=e&&zw(o);return{c(){n&&n.c(),t=ve()},m(s,i){n&&n.m(s,i),S(s,t,i),r=!0},p(s,i){i[0]&3145730&&(e=s[20]?No(s[1].relayManager.userCan(["folder","manage_users"],s[93])):No(s[1].relayManager.userCan(["folder","read_content"],s[93]))),e?n?(n.p(s,i),i[0]&3145730&&v(n,1)):(n=zw(s),n.c(),v(n,1),n.m(t.parentNode,t)):n&&(ce(),k(n,1,1,()=>{n=null}),fe())},i(s){r||(v(n),r=!0)},o(s){k(n),r=!1},d(s){s&&_(t),n&&n.d(s)}}}function cA(o){let e,t,r;return{c(){e=x("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){S(n,e,s),t||(r=j(e,"click",function(){nt((0,Ct.debounce)(o[73]))&&(0,Ct.debounce)(o[73]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function fA(o){let e,t,r,n=Se(o[21].values()),s=[];for(let a=0;a<n.length;a+=1)s[a]=Gw(qw(o,n,a));let i=a=>k(s[a],1,1,()=>{s[a]=null});return t=new $e({props:{description:"",name:"",$$slots:{default:[cA]},$$scope:{ctx:o}}}),{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=T(),D(t.$$.fragment)},m(a,l){for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);S(a,e,l),A(t,a,l),r=!0},p(a,l){if(l[0]&7340034|l[1]&1024|l[2]&2){n=Se(a[21].values());let f;for(f=0;f<n.length;f+=1){let u=qw(a,n,f);s[f]?(s[f].p(u,l),v(s[f],1)):(s[f]=Gw(u),s[f].c(),v(s[f],1),s[f].m(e.parentNode,e))}for(ce(),f=n.length;f<s.length;f+=1)i(f);fe()}let c={};l[0]&7|l[3]&8&&(c.$$scope={dirty:l,ctx:a}),t.$set(c)},i(a){if(!r){for(let l=0;l<n.length;l+=1)v(s[l]);v(t.$$.fragment,a),r=!0}},o(a){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)k(s[l]);k(t.$$.fragment,a),r=!1},d(a){a&&_(e),Je(s,a),R(t,a)}}}function Jw(o){let e,t,r,n,s,i,a,l=[dA,uA],c=[];function f(u,d){return u[23]?0:1}return t=f(o,[-1,-1,-1,-1]),r=c[t]=l[t](o),{c(){e=x("div"),r.c(),h(e,"class","edit-members-button svelte-sj7m72"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[23]?"Done editing":"Edit members")},m(u,d){S(u,e,d),c[t].m(e,null),s=!0,i||(a=[j(e,"click",o[55]),j(e,"keypress",o[55])],i=!0)},p(u,d){let p=t;t=f(u,d),t!==p&&(ce(),k(c[p],1,1,()=>{c[p]=null}),fe(),r=c[t],r||(r=c[t]=l[t](u),r.c()),v(r,1),r.m(e,null)),(!s||d[0]&8388608&&n!==(n=u[23]?"Done editing":"Edit members"))&&h(e,"aria-label",n)},i(u){s||(v(r),s=!0)},o(u){k(r),s=!1},d(u){u&&_(e),c[t].d(),i=!1,xe(a)}}}function uA(o){let e,t;return e=new Pa({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function dA(o){let e,t;return e=new Ta({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function pA(o){let e,t,r=o[18]&&Jw(o);return{c(){r&&r.c(),e=ve()},m(n,s){r&&r.m(n,s),S(n,e,s),t=!0},p(n,s){n[18]?r?(r.p(n,s),s[0]&262144&&v(r,1)):(r=Jw(n),r.c(),v(r,1),r.m(e.parentNode,e)):r&&(ce(),k(r,1,1,()=>{r=null}),fe())},i(n){t||(v(r),t=!0)},o(n){k(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}function mA(o){let e,t=o[87].role+"",r;return{c(){e=x("span"),r=K(t),h(e,"class","role-label")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s[0]&512&&t!==(t=n[87].role+"")&&te(r,t)},d(n){n&&_(e)}}}function hA(o){let e;function t(s,i){return s[23]?yA:gA}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function gA(o){let e,t,r,n,s,i,a,l,c=Se(o[24]),f=[];for(let u=0;u<c.length;u+=1)f[u]=Qw(Hw(o,c,u));return{c(){var u,d;e=x("div"),t=x("select");for(let p=0;p<f.length;p+=1)f[p].c();h(t,"class","dropdown"),t.disabled=r=o[87].userId===((u=o[1].loginManager.user)==null?void 0:u.id),h(t,"aria-label",n=o[87].userId===((d=o[1].loginManager.user)==null?void 0:d.id)?"Cannot modify your own role":void 0),h(t,"data-role-id",i=o[87].id),le(e,"display","flex"),le(e,"gap","8px"),le(e,"align-items","center")},m(u,d){S(u,e,d),b(e,t);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(t,null);Bn(t,o[87].role),a||(l=j(t,"change",o[54]),a=!0)},p(u,d){var p,m;if(d[0]&16777216){c=Se(u[24]);let y;for(y=0;y<c.length;y+=1){let g=Hw(u,c,y);f[y]?f[y].p(g,d):(f[y]=Qw(g),f[y].c(),f[y].m(t,null))}for(;y<f.length;y+=1)f[y].d(1);f.length=c.length}d[0]&16777730&&r!==(r=u[87].userId===((p=u[1].loginManager.user)==null?void 0:p.id))&&(t.disabled=r),d[0]&16777730&&n!==(n=u[87].userId===((m=u[1].loginManager.user)==null?void 0:m.id)?"Cannot modify your own role":void 0)&&h(t,"aria-label",n),d[0]&16777728&&s!==(s=u[87].role)&&Bn(t,u[87].role),d[0]&16777728&&i!==(i=u[87].id)&&h(t,"data-role-id",i)},d(u){u&&_(e),Je(f,u),a=!1,l()}}}function yA(o){var r;let e,t=o[87].userId!==((r=o[1].loginManager.user)==null?void 0:r.id)&&Yw(o);return{c(){t&&t.c(),e=ve()},m(n,s){t&&t.m(n,s),S(n,e,s)},p(n,s){var i;n[87].userId!==((i=n[1].loginManager.user)==null?void 0:i.id)?t?t.p(n,s):(t=Yw(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){n&&_(e),t&&t.d(n)}}}function Qw(o){let e,t=o[90].name+"",r,n;return{c(){e=x("option"),r=K(t),e.__value=n=o[90].name,Ke(e,e.__value)},m(s,i){S(s,e,i),b(e,r)},p(s,i){i[0]&16777216&&t!==(t=s[90].name+"")&&te(r,t),i[0]&16777216&&n!==(n=s[90].name)&&(e.__value=n,Ke(e,e.__value))},d(s){s&&_(e)}}}function Yw(o){let e,t,r;function n(){return o[74](o[87])}return{c(){e=x("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,i){S(s,e,i),t||(r=j(e,"click",function(){nt((0,Ct.debounce)(n))&&(0,Ct.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&_(e),t=!1,r()}}}function bA(o){let e;function t(s,i){return s[18]?hA:mA}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function Xw(o){let e,t;return e=new Ii({props:{user:o[87].user,$$slots:{default:[bA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.user=r[87].user),n[0]&25428482|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function vA(o){let e,t=o[9].values().length+"",r,n,s=o[14].userLimit+"",i,a;return{c(){e=x("span"),r=K(t),n=K(" of "),i=K(s),a=K(" seats used"),h(e,"class","faint svelte-sj7m72")},m(l,c){S(l,e,c),b(e,r),b(e,n),b(e,i),b(e,a)},p(l,c){c[0]&512&&t!==(t=l[9].values().length+"")&&te(r,t),c[0]&16384&&s!==(s=l[14].userLimit+"")&&te(i,s)},d(l){l&&_(e)}}}function xA(o){let e,t,r,n=Se(o[9].values().sort(o[34])),s=[];for(let a=0;a<n.length;a+=1)s[a]=Xw(Nw(o,n,a));let i=a=>k(s[a],1,1,()=>{s[a]=null});return t=new $e({props:{description:"",name:"",$$slots:{default:[vA]},$$scope:{ctx:o}}}),{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=T(),D(t.$$.fragment)},m(a,l){for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);S(a,e,l),A(t,a,l),r=!0},p(a,l){if(l[0]&25428482|l[1]&12582920){n=Se(a[9].values().sort(a[34]));let f;for(f=0;f<n.length;f+=1){let u=Nw(a,n,f);s[f]?(s[f].p(u,l),v(s[f],1)):(s[f]=Xw(u),s[f].c(),v(s[f],1),s[f].m(e.parentNode,e))}for(ce(),f=n.length;f<s.length;f+=1)i(f);fe()}let c={};l[0]&16896|l[3]&8&&(c.$$scope={dirty:l,ctx:a}),t.$set(c)},i(a){if(!r){for(let l=0;l<n.length;l+=1)v(s[l]);v(t.$$.fragment,a),r=!0}},o(a){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)k(s[l]);k(t.$$.fragment,a),r=!1},d(a){a&&_(e),Je(s,a),R(t,a)}}}function Zw(o){let e,t;return e=new wf({}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function wA(o){let e,t,r,n,s,i,a,l,c,f,u,d=!o[12]&&Zw(o);return{c(){e=x("div"),d&&d.c(),t=T(),r=x("div"),n=x("input"),i=T(),a=x("div"),h(n,"type","checkbox"),n.checked=o[11],n.disabled=s=!o[12],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[11]),h(r,"tabindex","0"),h(r,"class",l=o[12]?"checkbox-container":"checkbox-container checkbox-locked"),Te(r,"is-enabled",o[11]),h(e,"class","setting-item-control")},m(p,m){S(p,e,m),d&&d.m(e,null),b(e,t),b(e,r),b(r,n),b(r,i),b(r,a),c=!0,f||(u=[j(n,"change",o[75]),j(r,"keypress",o[76]),j(r,"click",o[77])],f=!0)},p(p,m){p[12]?d&&(ce(),k(d,1,1,()=>{d=null}),fe()):d?m[0]&4096&&v(d,1):(d=Zw(p),d.c(),v(d,1),d.m(e,t)),(!c||m[0]&2048)&&(n.checked=p[11]),(!c||m[0]&4096&&s!==(s=!p[12]))&&(n.disabled=s),(!c||m[0]&2048)&&h(r,"aria-checked",p[11]),(!c||m[0]&4096&&l!==(l=p[12]?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||m[0]&6144)&&Te(r,"is-enabled",p[11])},i(p){c||(v(d),c=!0)},o(p){k(d),c=!1},d(p){p&&_(e),d&&d.d(),f=!1,xe(u)}}}function _A(o){let e;return{c(){e=x("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function SA(o){let e;return{c(){e=x("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function kA(o){let e;return{c(){e=x("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function IA(o){let e;function t(s,i){return s[12]?kA:s[11]?SA:_A}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){e=x("fragment"),n.c(),h(e,"slot","description")},m(s,i){S(s,e,i),n.m(e,null)},p(s,i){r!==(r=t(s,i))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&_(e),n.d()}}}function e_(o){let e,t,r,n;e=new $e({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[EA]},$$scope:{ctx:o}}});let s=o[12]&&t_(o);return{c(){D(e.$$.fragment),t=T(),s&&s.c(),r=ve()},m(i,a){A(e,i,a),S(i,t,a),s&&s.m(i,a),S(i,r,a),n=!0},p(i,a){let l={};a[0]&2304|a[3]&8&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[12]?s?(s.p(i,a),a[0]&4096&&v(s,1)):(s=t_(i),s.c(),v(s,1),s.m(r.parentNode,r)):s&&(ce(),k(s,1,1,()=>{s=null}),fe())},i(i){n||(v(e.$$.fragment,i),v(s),n=!0)},o(i){k(e.$$.fragment,i),k(s),n=!1},d(i){i&&(_(t),_(r)),R(e,i),s&&s.d(i)}}}function CA(o){let e,t;return e=new bf({props:{value:o[8]?o[8].key:"please wait...",disabled:!o[11],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.value=r[8]?r[8].key:"please wait..."),n[0]&2048&&(s.disabled=!r[11]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function LA(o){let e;return{c(){e=x("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-sj7m72")},m(t,r){S(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function EA(o){let e,t,r,n,s=[LA,CA],i=[];function a(l,c){return l[11]?1:0}return t=a(o,[-1,-1,-1,-1]),r=i[t]=s[t](o),{c(){e=x("div"),r.c(),h(e,"class","share-key-container svelte-sj7m72")},m(l,c){S(l,e,c),i[t].m(e,null),n=!0},p(l,c){let f=t;t=a(l,c),t===f?i[t].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),v(r,1),r.m(e,null))},i(l){n||(v(r),n=!0)},o(l){k(r),n=!1},d(l){l&&_(e),i[t].d()}}}function t_(o){let e,t;return e=new $e({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[TA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function TA(o){let e,t,r;return{c(){e=x("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Ct.debounce)(o[49])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function FA(o){let e,t,r,n;e=new ar({props:{name:o[12]?"Enable key sharing":"Key sharing",$$slots:{description:[IA],default:[wA]},$$scope:{ctx:o}}});let s=o[11]&&e_(o);return{c(){D(e.$$.fragment),t=T(),s&&s.c(),r=ve()},m(i,a){A(e,i,a),S(i,t,a),s&&s.m(i,a),S(i,r,a),n=!0},p(i,a){let l={};a[0]&4096&&(l.name=i[12]?"Enable key sharing":"Key sharing"),a[0]&6144|a[3]&8&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[11]?s?(s.p(i,a),a[0]&2048&&v(s,1)):(s=e_(i),s.c(),v(s,1),s.m(r.parentNode,r)):s&&(ce(),k(s,1,1,()=>{s=null}),fe())},i(i){n||(v(e.$$.fragment,i),v(s),n=!0)},o(i){k(e.$$.fragment,i),k(s),n=!1},d(i){i&&(_(t),_(r)),R(e,i),s&&s.d(i)}}}function r_(o){let e,t,r,n,s,i,a;e=new Ze({props:{name:"Plan"}}),r=new St({props:{$$slots:{default:[$A]},$$scope:{ctx:o}}});let l=o[27]&&o[27].quota>0&&s_(o),c=o[0].provider&&o[0].provider.selfHosted&&i_(o);return{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment),n=T(),l&&l.c(),s=T(),c&&c.c(),i=ve()},m(f,u){A(e,f,u),S(f,t,u),A(r,f,u),S(f,n,u),l&&l.m(f,u),S(f,s,u),c&&c.m(f,u),S(f,i,u),a=!0},p(f,u){let d={};u[0]&67158016|u[3]&8&&(d.$$scope={dirty:u,ctx:f}),r.$set(d),f[27]&&f[27].quota>0?l?(l.p(f,u),u[0]&134217728&&v(l,1)):(l=s_(f),l.c(),v(l,1),l.m(s.parentNode,s)):l&&(ce(),k(l,1,1,()=>{l=null}),fe()),f[0].provider&&f[0].provider.selfHosted?c?(c.p(f,u),u[0]&1&&v(c,1)):(c=i_(f),c.c(),v(c,1),c.m(i.parentNode,i)):c&&(ce(),k(c,1,1,()=>{c=null}),fe())},i(f){a||(v(e.$$.fragment,f),v(r.$$.fragment,f),v(l),v(c),a=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(l),k(c),a=!1},d(f){f&&(_(t),_(n),_(s),_(i)),R(e,f),R(r,f),l&&l.d(f),c&&c.d(f)}}}function PA(o){let e,t;return e=new $e({props:{name:`Plan: ${o[14].plan}`,description:o[14].cta||"Thanks for supporting Relay development",$$slots:{default:[RA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&16384&&(s.name=`Plan: ${r[14].plan}`),n[0]&16384&&(s.description=r[14].cta||"Thanks for supporting Relay development"),n[0]&16384|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function AA(o){let e,t,r=!o[15].values()[0].active||o[15].values()[0].cancelAt,n,s;e=new $e({props:{name:`Plan: ${o[14].plan}`,description:"",$$slots:{description:[DA],default:[MA]},$$scope:{ctx:o}}});let i=r&&n_(o);return{c(){D(e.$$.fragment),t=T(),i&&i.c(),n=ve()},m(a,l){A(e,a,l),S(a,t,l),i&&i.m(a,l),S(a,n,l),s=!0},p(a,l){let c={};l[0]&16384&&(c.name=`Plan: ${a[14].plan}`),l[0]&67158016|l[3]&8&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),l[0]&32768&&(r=!a[15].values()[0].active||a[15].values()[0].cancelAt),r?i?(i.p(a,l),l[0]&32768&&v(i,1)):(i=n_(a),i.c(),v(i,1),i.m(n.parentNode,n)):i&&(ce(),k(i,1,1,()=>{i=null}),fe())},i(a){s||(v(e.$$.fragment,a),v(i),s=!0)},o(a){k(e.$$.fragment,a),k(i),s=!1},d(a){a&&(_(t),_(n)),R(e,a),i&&i.d(a)}}}function RA(o){let e,t,r;return{c(){e=x("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){S(n,e,s),t||(r=j(e,"click",function(){nt((0,Ct.debounce)(o[80]))&&(0,Ct.debounce)(o[80]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function o_(o){let e,t,r;return{c(){e=x("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){S(n,e,s),t||(r=j(e,"click",function(){nt((0,Ct.debounce)(o[79]))&&(0,Ct.debounce)(o[79]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function MA(o){let e,t,r=o[15].values()[0].active&&!o[15].values()[0].cancelAt,n,s,i,a=r&&o_(o);return{c(){e=x("button"),e.textContent="Manage",t=T(),a&&a.c(),n=ve()},m(l,c){S(l,e,c),S(l,t,c),a&&a.m(l,c),S(l,n,c),s||(i=j(e,"click",function(){nt((0,Ct.debounce)(o[78]))&&(0,Ct.debounce)(o[78]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&32768&&(r=o[15].values()[0].active&&!o[15].values()[0].cancelAt),r?a?a.p(o,c):(a=o_(o),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(l){l&&(_(e),_(t),_(n)),a&&a.d(l),s=!1,i()}}}function DA(o){let e,t=o[14].cta+"",r;return{c(){e=x("fragment"),r=K(t),h(e,"slot","description")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s[0]&16384&&t!==(t=n[14].cta+"")&&te(r,t)},d(n){n&&_(e)}}}function n_(o){let e,t;return e=new $e({props:{description:"",$$slots:{name:[OA],default:[UA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&32768|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function UA(o){let e=o[33](o[15].values()[0].cancelAt)+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&32768&&e!==(e=r[33](r[15].values()[0].cancelAt)+"")&&te(t,e)},d(r){r&&_(t)}}}function OA(o){let e;return{c(){e=x("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function $A(o){let e,t,r,n,s=[AA,PA],i=[];function a(l,c){return l[26]?0:1}return e=a(o,[-1,-1,-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),S(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ce(),k(i[f],1,1,()=>{i[f]=null}),fe(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),v(t,1),t.m(r.parentNode,r))},i(l){n||(v(t),n=!0)},o(l){k(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function s_(o){let e,t,r,n;return e=new Ze({props:{name:"Storage"}}),r=new St({props:{$$slots:{default:[jA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[0]&134217728|i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function BA(o){let e,t;return e=new ar({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[NA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function VA(o){let e,t,r,n,s,i;return e=new Fw({props:{diskUsagePercentage:Math.round(o[27].usage*100/o[27].quota)}}),r=new ar({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[HA]},$$scope:{ctx:o}}}),s=new ar({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[qA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment),n=T(),D(s.$$.fragment)},m(a,l){A(e,a,l),S(a,t,l),A(r,a,l),S(a,n,l),A(s,a,l),i=!0},p(a,l){let c={};l[0]&134217728&&(c.diskUsagePercentage=Math.round(a[27].usage*100/a[27].quota)),e.$set(c);let f={};l[0]&134217728|l[3]&8&&(f.$$scope={dirty:l,ctx:a}),r.$set(f);let u={};l[0]&134217728|l[3]&8&&(u.$$scope={dirty:l,ctx:a}),s.$set(u)},i(a){i||(v(e.$$.fragment,a),v(r.$$.fragment,a),v(s.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),k(r.$$.fragment,a),k(s.$$.fragment,a),i=!1},d(a){a&&(_(t),_(n)),R(e,a),R(r,a),R(s,a)}}}function NA(o){let e;return{c(){e=K("Unmetered by Relay")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function HA(o){let e=Ei(o[27].usage)+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=Ei(r[27].usage)+"")&&te(t,e)},d(r){r&&_(t)}}}function qA(o){let e=Ei(o[27].quota)+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=Ei(r[27].quota)+"")&&te(t,e)},d(r){r&&_(t)}}}function WA(o){let e=Ei(o[27].maxFileSize)+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=Ei(r[27].maxFileSize)+"")&&te(t,e)},d(r){r&&_(t)}}}function jA(o){let e,t,r,n,s,i=[VA,BA],a=[];function l(c,f){return c[27].metered?0:1}return e=l(o,[-1,-1,-1,-1]),t=a[e]=i[e](o),n=new ar({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[WA]},$$scope:{ctx:o}}}),{c(){t.c(),r=T(),D(n.$$.fragment)},m(c,f){a[e].m(c,f),S(c,r,f),A(n,c,f),s=!0},p(c,f){let u=e;e=l(c,f),e===u?a[e].p(c,f):(ce(),k(a[u],1,1,()=>{a[u]=null}),fe(),t=a[e],t?t.p(c,f):(t=a[e]=i[e](c),t.c()),v(t,1),t.m(r.parentNode,r));let d={};f[0]&134217728|f[3]&8&&(d.$$scope={dirty:f,ctx:c}),n.$set(d)},i(c){s||(v(t),v(n.$$.fragment,c),s=!0)},o(c){k(t),k(n.$$.fragment,c),s=!1},d(c){c&&_(r),a[e].d(c),R(n,c)}}}function i_(o){let e,t,r,n;return e=new Ze({props:{name:"Host"}}),r=new St({props:{$$slots:{default:[tR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[0]&113|i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function zA(o){let e=o[0].provider.url+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&te(t,e)},d(r){r&&_(t)}}}function KA(o){return{c:z,m:z,p:z,i:z,o:z,d:z}}function GA(o){let e,t,r=o[86].level==="warning"&&a_(o);return{c(){r&&r.c(),e=ve()},m(n,s){r&&r.m(n,s),S(n,e,s),t=!0},p(n,s){n[86].level==="warning"?r?(r.p(n,s),s[0]&1&&v(r,1)):(r=a_(n),r.c(),v(r,1),r.m(e.parentNode,e)):r&&(ce(),k(r,1,1,()=>{r=null}),fe())},i(n){t||(v(r),t=!0)},o(n){k(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}function a_(o){let e,t;return e=new $e({props:{name:"Status",description:"",$$slots:{default:[JA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&1|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function l_(o){let e,t,r,n=jn(o[86].link.text)+"",s;return{c(){e=x("br"),t=T(),r=x("a"),h(r,"href",s=o[86].link.url)},m(i,a){S(i,e,a),S(i,t,a),S(i,r,a),r.innerHTML=n},p(i,a){a[0]&1&&n!==(n=jn(i[86].link.text)+"")&&(r.innerHTML=n),a[0]&1&&s!==(s=i[86].link.url)&&h(r,"href",s)},d(i){i&&(_(e),_(t),_(r))}}}function JA(o){let e,t,r=jn(o[86].status)+"",n,s=o[86].link&&l_(o);return{c(){e=x("p"),t=new $n(!1),n=T(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-sj7m72")},m(i,a){S(i,e,a),t.m(r,e),b(e,n),s&&s.m(e,null)},p(i,a){a[0]&1&&r!==(r=jn(i[86].status)+"")&&t.p(r),i[86].link?s?s.p(i,a):(s=l_(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&_(e),s&&s.d()}}}function QA(o){return{c:z,m:z,p:z,i:z,o:z,d:z}}function c_(o){let e,t,r,n,s,i,a,l,c=[eR,ZA,XA,YA],f=[];function u(d,p){return d[4]?0:d[5]?1:d[6]?2:3}return i=u(o,[-1,-1,-1,-1]),a=f[i]=c[i](o),{c(){e=x("div"),t=x("div"),t.textContent="Relay Server Configuration",r=T(),n=x("div"),n.textContent="Copy this configuration to your Relay Server's TOML file.",s=T(),a.c(),h(t,"class","setting-item-name"),h(n,"class","setting-item-description"),h(e,"class","relay-auth-section svelte-sj7m72")},m(d,p){S(d,e,p),b(e,t),b(e,r),b(e,n),b(e,s),f[i].m(e,null),l=!0},p(d,p){let m=i;i=u(d,p),i===m?f[i].p(d,p):(ce(),k(f[m],1,1,()=>{f[m]=null}),fe(),a=f[i],a?a.p(d,p):(a=f[i]=c[i](d),a.c()),v(a,1),a.m(e,null))},i(d){l||(v(a),l=!0)},o(d){k(a),l=!1},d(d){d&&_(e),f[i].d()}}}function YA(o){let e;return{c(){e=x("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-sj7m72")},m(t,r){S(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function XA(o){let e,t;return e=new If({props:{toml:o[6]}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.toml=r[6]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ZA(o){let e,t;return{c(){e=x("div"),t=K(o[5]),h(e,"class","error-message svelte-sj7m72")},m(r,n){S(r,e,n),b(e,t)},p(r,n){n[0]&32&&te(t,r[5])},i:z,o:z,d(r){r&&_(e)}}}function eR(o){let e;return{c(){e=x("div"),e.textContent="Loading configuration...",h(e,"class","loading-message svelte-sj7m72")},m(t,r){S(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function tR(o){let e,t,r,n,s,i;e=new $e({props:{name:"URL",description:"",$$slots:{default:[zA]},$$scope:{ctx:o}}});let a={ctx:o,current:null,token:null,hasCatch:!1,pending:QA,then:GA,catch:KA,value:86,blocks:[,,,]};xi(r=o[32](o[0]),a);let l=o[0].provider.publicKey&&c_(o);return{c(){D(e.$$.fragment),t=T(),a.block.c(),n=T(),l&&l.c(),s=ve()},m(c,f){A(e,c,f),S(c,t,f),a.block.m(c,a.anchor=f),a.mount=()=>n.parentNode,a.anchor=n,S(c,n,f),l&&l.m(c,f),S(c,s,f),i=!0},p(c,f){o=c;let u={};f[0]&1|f[3]&8&&(u.$$scope={dirty:f,ctx:o}),e.$set(u),a.ctx=o,f[0]&1&&r!==(r=o[32](o[0]))&&xi(r,a)||Vc(a,o,f),o[0].provider.publicKey?l?(l.p(o,f),f[0]&1&&v(l,1)):(l=c_(o),l.c(),v(l,1),l.m(s.parentNode,s)):l&&(ce(),k(l,1,1,()=>{l=null}),fe())},i(c){i||(v(e.$$.fragment,c),v(a.block),v(l),i=!0)},o(c){k(e.$$.fragment,c);for(let f=0;f<3;f+=1){let u=a.blocks[f];k(u)}k(l),i=!1},d(c){c&&(_(t),_(n),_(s)),R(e,c),a.block.d(c),a.token=null,a=null,l&&l.d(c)}}}function f_(o){let e,t,r,n;return e=new Ze({props:{name:"Membership"}}),r=new St({props:{$$slots:{default:[oR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function rR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Ct.debounce)(o[81])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function oR(o){let e,t;return e=new $e({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[rR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function u_(o){let e,t,r,n;return e=new Ze({props:{name:"Danger zone"}}),r=new St({props:{$$slots:{default:[aR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[0]&32768|i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function nR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Ct.debounce)(o[52])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function sR(o){let e,t;return{c(){e=x("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){S(r,e,n)},p:z,d(r){r&&_(e)}}}function iR(o){let e,t;function r(i,a){return a[0]&32768&&(e=null),e==null&&(e=i[15].values().length>0&&!i[15].values()[0].cancelAt),e?sR:nR}let n=r(o,[-1,-1,-1,-1]),s=n(o);return{c(){s.c(),t=ve()},m(i,a){s.m(i,a),S(i,t,a)},p(i,a){n===(n=r(i,a))&&s?s.p(i,a):(s.d(1),s=n(i),s&&(s.c(),s.m(t.parentNode,t)))},d(i){i&&_(t),s.d(i)}}}function aR(o){let e,t;return e=new $e({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[iR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&32768|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function lR(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y,g,I,L,C,w=!o[14].owner||o[13].filter(o[64]).values().length>1,E,F,U;e=new Ko({props:{items:[{type:"home",onClick:o[66]},{type:"relay",relay:o[0]}]}});let V=o[16]&&Ww(o);n=new Ze({props:{name:"Shared Folders on this Relay Server",$$slots:{default:[nA]},$$scope:{ctx:o}}}),i=new St({props:{$$slots:{default:[fA]},$$scope:{ctx:o}}}),u=new Ze({props:{name:"Users",$$slots:{default:[pA]},$$scope:{ctx:o}}}),p=new St({props:{$$slots:{default:[xA]},$$scope:{ctx:o}}}),y=new Ze({props:{name:"Sharing",helpText:"Share keys can be shared with collaborators so that they can join the Relay Server. Once you have added all of your collaborators, you can disable the share key to prevent anyone from joining, even if they have the key."}}),I=new St({props:{$$slots:{default:[FA]},$$scope:{ctx:o}}});let P=o[25]&&r_(o),$=w&&f_(o),re=o[28]&&u_(o);return{c(){D(e.$$.fragment),t=T(),V&&V.c(),r=T(),D(n.$$.fragment),s=T(),D(i.$$.fragment),a=T(),l=x("div"),c=T(),f=x("div"),D(u.$$.fragment),d=T(),D(p.$$.fragment),m=T(),D(y.$$.fragment),g=T(),D(I.$$.fragment),L=T(),P&&P.c(),C=T(),$&&$.c(),E=T(),re&&re.c(),F=ve(),h(l,"class","spacer svelte-sj7m72"),h(f,"class","users-header")},m(W,q){A(e,W,q),S(W,t,q),V&&V.m(W,q),S(W,r,q),A(n,W,q),S(W,s,q),A(i,W,q),S(W,a,q),S(W,l,q),S(W,c,q),S(W,f,q),A(u,f,null),S(W,d,q),A(p,W,q),S(W,m,q),A(y,W,q),S(W,g,q),A(I,W,q),S(W,L,q),P&&P.m(W,q),S(W,C,q),$&&$.m(W,q),S(W,E,q),re&&re.m(W,q),S(W,F,q),U=!0},p(W,q){let M={};q[0]&1&&(M.items=[{type:"home",onClick:W[66]},{type:"relay",relay:W[0]}]),e.$set(M),W[16]?V?(V.p(W,q),q[0]&65536&&v(V,1)):(V=Ww(W),V.c(),v(V,1),V.m(r.parentNode,r)):V&&(ce(),k(V,1,1,()=>{V=null}),fe());let G={};q[0]&1835008|q[3]&8&&(G.$$scope={dirty:q,ctx:W}),n.$set(G);let B={};q[0]&7340039|q[3]&8&&(B.$$scope={dirty:q,ctx:W}),i.$set(B);let Q={};q[0]&8650752|q[3]&8&&(Q.$$scope={dirty:q,ctx:W}),u.$set(Q);let N={};q[0]&25444866|q[3]&8&&(N.$$scope={dirty:q,ctx:W}),p.$set(N);let O={};q[0]&6400|q[3]&8&&(O.$$scope={dirty:q,ctx:W}),I.$set(O),W[25]?P?(P.p(W,q),q[0]&33554432&&v(P,1)):(P=r_(W),P.c(),v(P,1),P.m(C.parentNode,C)):P&&(ce(),k(P,1,1,()=>{P=null}),fe()),q[0]&24577&&(w=!W[14].owner||W[13].filter(W[64]).values().length>1),w?$?($.p(W,q),q[0]&24577&&v($,1)):($=f_(W),$.c(),v($,1),$.m(E.parentNode,E)):$&&(ce(),k($,1,1,()=>{$=null}),fe()),W[28]?re?(re.p(W,q),q[0]&268435456&&v(re,1)):(re=u_(W),re.c(),v(re,1),re.m(F.parentNode,F)):re&&(ce(),k(re,1,1,()=>{re=null}),fe())},i(W){U||(v(e.$$.fragment,W),v(V),v(n.$$.fragment,W),v(i.$$.fragment,W),v(u.$$.fragment,W),v(p.$$.fragment,W),v(y.$$.fragment,W),v(I.$$.fragment,W),v(P),v($),v(re),U=!0)},o(W){k(e.$$.fragment,W),k(V),k(n.$$.fragment,W),k(i.$$.fragment,W),k(u.$$.fragment,W),k(p.$$.fragment,W),k(y.$$.fragment,W),k(I.$$.fragment,W),k(P),k($),k(re),U=!1},d(W){W&&(_(t),_(r),_(s),_(a),_(l),_(c),_(f),_(d),_(m),_(g),_(L),_(C),_(E),_(F)),R(e,W),V&&V.d(W),R(n,W),R(i,W),R(u),R(p,W),R(y,W),R(I,W),P&&P.d(W),$&&$.d(W),re&&re.d(W)}}}function Ei(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function cR(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function fR(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function uR(o,e,t){let r,n,s,i,a,l=z,c=()=>(l(),l=Ht(me,ne=>t(13,a=ne)),me),f,u=z,d=()=>(u(),u=Ht(q,ne=>t(14,f=ne)),q),p,m,y,g,I,L,C,w,E=z,F=()=>(E(),E=Ht(oe,ne=>t(22,w=ne)),oe),U,V,P,$,re,W;o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>u()),o.$$.on_destroy.push(()=>E());let{relay:q}=e;d();let M=q.folders;de(o,M,ne=>t(21,C=ne));let G=we(!1);de(o,G,ne=>t(20,L=ne));let{plugin:B}=e,Q=!1,N=null,O="",J=at([M,B.relayManager.relayRoles,B.relayManager.folderRoles],([ne,Be,et])=>{let Ut=Array.from(ne.values()),zr=Ut.filter(ao=>No(B.relayManager.userCan(["folder","read_content"],ao))),cr=Ut.filter(ao=>No(B.relayManager.userCan(["folder","manage_users"],ao)));return zr.length!==cr.length});de(o,J,ne=>t(19,I=ne));let{sharedFolders:oe}=e;F();let{relayRoles:me}=e;c(),B.relayManager.refreshRelay(q);function he(ne){return Ae(this,void 0,void 0,function*(){let Be=yield B.loginManager.checkRelayHost(ne.guid);if(Be.status===200)return Be.json})}function se(ne){if(!ne)return"Active";let Be=Bh.moment.utc(),et=Bh.moment.utc(ne),Ut=et.diff(Be,"days");return Ut<=0?"Subscription has ended":Ut===1?"Active for 1 more day":Ut>31?`Ends on ${et.format("YYYY-MM-DD")}`:`Active for ${Ut} more days`}function pe(ne,Be){var et;return ne.role==="Owner"&&Be.role==="Owner"?ne.userId===((et=B.loginManager.user)===null||et===void 0?void 0:et.id)?-1:1:ne.role==="Owner"&&Be.role!=="Owner"?-1:ne.role!=="Owner"&&Be.role==="Owner"||ne.user.name>Be.user.name?1:-1}let Fe=at([B.relayManager.roles],([ne])=>ne.values().sort(cR));de(o,Fe,ne=>t(24,V=ne));let ye=f.subscriptions;de(o,ye,ne=>t(15,p=ne));let Ue=at(p,ne=>{if(ne.values().length===0)return;let Be=ne.values()[0];return Be.token||B.relayManager.getSubscriptionToken(Be).then(et=>{Be.token=et}),Be});de(o,Ue,ne=>t(26,$=ne));let He=f.storageQuota;de(o,He,ne=>t(27,re=ne));let Qe=a.filter(ne=>ne.relayId===q.id);de(o,Qe,ne=>t(9,r=ne));let rt=we(!0);de(o,rt,ne=>t(10,n=ne));let Ft;dt(()=>{Ft&&Ft.value===""&&Ft.focus()});let qt=it();function zn(){return Ae(this,void 0,void 0,function*(){var ne,Be;if(!(!((ne=B.relayManager)===null||ne===void 0)&&ne.pb)){t(5,N="Not connected to relay service");return}t(4,Q=!0),t(5,N=null);try{let et=B.relayManager.pb.baseUrl+`/api/collections/relays/records/${q.id}/relay.toml`,zr=yield(yield mt(et,{method:"GET",headers:{Authorization:B.relayManager.pb.authStore.token?`Bearer ${B.relayManager.pb.authStore.token}`:""}})).text();t(6,O=zr.replace(/\{url\}/g,((Be=q.provider)===null||Be===void 0?void 0:Be.url)||""))}catch(et){t(5,N=et instanceof Error?et.message:"Failed to fetch relay configuration")}finally{t(4,Q=!1)}})}dt(()=>{var ne;Ft&&Ft.value===""&&Ft.focus(),!((ne=q.provider)===null||ne===void 0)&&ne.selfHosted&&zn()});function qr(ne){return Ae(this,void 0,void 0,function*(){var Be;if(!(!((Be=B.loginManager)===null||Be===void 0)&&Be.user))return;let et={relay:ne.id,quantity:10,user_email:B.loginManager.user.email},Ut=btoa(JSON.stringify(et)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(B.buildApiUrl(`/subscribe/${Ut}`),"_blank")})}function Wr(ne){return Ae(this,void 0,void 0,function*(){let Be=ne.token,et=ne.id;window.open(B.buildApiUrl(`/subscriptions/${et}/manage?token=${Be}`),"_blank")})}function ko(ne){return Ae(this,void 0,void 0,function*(){let Be=ne.token,et=ne.id;window.open(B.buildApiUrl(`/subscriptions/${et}/cancel?token=${Be}`),"_blank")})}function lr(ne){i&&(jr.set(ne),B.relayManager.toggleRelayInvitation(Dr,s).then(Be=>{jr.set(Be.enabled)}).catch(Be=>{jr.set(!ne),dr(Be,"Failed to toggle share key")}))}function yn(){return Ae(this,void 0,void 0,function*(){B.relayManager.leaveRelay(q),qt("goBack",{clear:!0})})}function ks(){return Ae(this,void 0,void 0,function*(){qt("goBack",{clear:!0})})}let Dr,jr=we(!0);de(o,jr,ne=>t(11,s=ne));let Io=we(!1);de(o,Io,ne=>t(23,U=ne)),B.relayManager.getRelayInvitation(q).then(ne=>{ne&&(t(8,Dr=ne),jr.set(ne.enabled))});function Kn(){return Ae(this,void 0,void 0,function*(){if(Dr)try{t(8,Dr=yield B.relayManager.rotateKey(Dr))}catch(ne){dr(ne,"Failed to rotate key.")}})}let Co=we(!1);de(o,Co,ne=>t(17,y=ne));let Gn=B.timeProvider.debounce(()=>{B.relayManager.updateRelay(q).then(()=>{Co.set(!1)})},500);function Jn(){rt.set(fR(Ft.value)),n&&Ft.value!==""&&(Co.set(!0),Gn())}function Qn(){B.relayManager.destroyRelay(q),qt("goBack",{})}function _e(ne){B.relayManager.kick(ne).catch(Be=>{dr(Be,"Failed to remove user")})}function Xe(ne,Be){return Ae(this,void 0,void 0,function*(){try{yield B.relayManager.updateRelayRole(ne,Be)}catch(et){throw dr(et,"Failed to change user role."),et}})}function ft(ne){return Ae(this,void 0,void 0,function*(){let Be=ne.target,et=r.get(Be.dataset.roleId);if(et){let Ut=et.role;try{yield Xe(et,Be.value)}catch(zr){Be.value=Ut}}})}function ie(ne){(ne instanceof MouseEvent||ne instanceof KeyboardEvent&&(ne.key==="Enter"||ne.key===" "))&&Io.update(Be=>!Be)}let Oe=B.relayManager.userCan(["relay","manage_users"],q);de(o,Oe,ne=>t(18,g=ne));let xt=B.relayManager.userCan(["relay","manage_sharing"],q);de(o,xt,ne=>t(12,i=ne));let io=B.relayManager.userCan(["relay","rename"],q);de(o,io,ne=>t(16,m=ne));let vr=B.relayManager.userCan(["relay","delete"],q);de(o,vr,ne=>t(28,W=ne));let Va=B.relayManager.userCan(["subscription","manage"],q);de(o,Va,ne=>t(25,P=ne));function Fi(ne,Be,et,Ut){return Ae(this,void 0,void 0,function*(){let zr=(0,Ct.normalizePath)(ne),cr=oe.find(vn=>vn.path==zr);if(B.vault.getFolderByPath(zr)===null&&(yield B.vault.createFolder(zr)),cr)cr.relayId=q.guid;else{let vn=Us();cr=oe.new(zr,vn,q.guid,!0)}let ao=yield B.relayManager.createRemoteFolder(cr,q,et!=null?et:!1,Be);if(et&&Ut&&Ut.length>0)for(let vn of Ut)yield B.relayManager.addFolderRole(ao,vn,"Member");cr.remote=ao,cr.connect(),B.sharedFolders.notifyListeners();try{yield cr.whenReady(),yield cr.whenSynced(),B.backgroundSync.enqueueSharedFolderSync(cr),new Ct.Notice(`Syncing files in "${zr}"...`)}catch(vn){console.error("Error triggering automatic sync:",vn),new Ct.Notice(`Failed to start automatic sync: ${vn.message}`)}return Ut&&Ut.length>0&&setTimeout(()=>{qt("manageRemoteFolder",{remoteFolder:ao})},100),cr})}let ue=new kf(B.app,q,oe,B.relayManager,Fi);function qe(ne){return Ae(this,void 0,void 0,function*(){function Be(et,Ut,zr){return Ae(this,void 0,void 0,function*(){let cr=(0,Ct.normalizePath)((0,d_.join)(zr,Ut));B.vault.getFolderByPath(cr)===null&&(yield B.vault.createFolder(cr));let ao=B.sharedFolders.new(cr,et.guid,et.relay.guid,!0);return ao.remote=et,B.sharedFolders.notifyListeners(),qt("manageRemoteFolder",{remoteFolder:ao.remote}),ao})}new Wn(B.app,B.sharedFolders,ne,[],Be).open()})}dn(()=>{ue==null||ue.destroy()});let kt=ne=>ne.role==="Owner"&&ne.relayId===q.id,Lt=(ne,Be)=>Be.guid===ne.guid,xr=()=>qt("goBack",{clear:!0});function bn(){q.name=this.value,d(t(0,q))}function Pi(ne){vt[ne?"unshift":"push"](()=>{Ft=ne,t(7,Ft)})}let x0=()=>G.update(ne=>!ne),w0=ne=>{qt("manageRemoteFolder",{remoteFolder:ne})},_0=ne=>{qe(ne)},S0=ne=>{qt("manageRemoteFolder",{remoteFolder:ne})},k0=()=>{q.version===0?new Li(B.app,"Choose or create folder...",new Set(oe.filter(Be=>!!Be.relayId).map(Be=>Be.path)).add("/"),oe,Fi).open():ue.open()},I0=ne=>{_e(ne)},C0=ne=>lr(ne.currentTarget.checked),L0=()=>lr(!s),E0=()=>lr(!s),T0=()=>{Wr($)},F0=()=>{ko($)},P0=()=>{qr(f)},A0=()=>{yn()};return o.$$set=ne=>{"relay"in ne&&d(t(0,q=ne.relay)),"plugin"in ne&&t(1,B=ne.plugin),"sharedFolders"in ne&&F(t(2,oe=ne.sharedFolders)),"relayRoles"in ne&&c(t(3,me=ne.relayRoles))},[q,B,oe,me,Q,N,O,Ft,Dr,r,n,s,i,a,f,p,m,y,g,I,L,C,w,U,V,P,$,re,W,M,G,J,he,se,pe,Fe,ye,Ue,He,Qe,rt,qt,qr,Wr,ko,lr,yn,jr,Io,Kn,Co,Jn,Qn,_e,ft,ie,Oe,xt,io,vr,Va,Fi,ue,qe,kt,Lt,xr,bn,Pi,x0,w0,_0,S0,k0,I0,C0,L0,E0,T0,F0,P0,A0]}var Vh=class extends Z{constructor(e){super(),ee(this,e,uR,lR,X,{relay:0,plugin:1,sharedFolders:2,relayRoles:3},rA,[-1,-1,-1,-1])}},Ti=Vh;function dR(o){let e,t,r,n,s,i;return r=new qp({}),{c(){e=x("div"),t=x("div"),D(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(a,l){S(a,e,l),b(e,t),A(r,t,null),n=!0,s||(i=[j(t,"click",o[0]),j(t,"keypress",o[1])],s=!0)},p:z,i(a){n||(v(r.$$.fragment,a),n=!0)},o(a){k(r.$$.fragment,a),n=!1},d(a){a&&_(e),R(r),s=!1,xe(i)}}}function pR(o){let e=it();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var Nh=class extends Z{constructor(e){super(),ee(this,e,pR,dR,X,{})}},p_=Nh;var qh=require("obsidian");function m_(o){let e,t,r,n;return e=new Ze({props:{name:"Danger zone"}}),r=new St({props:{$$slots:{default:[gR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i&256&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function mR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Delete metadata",h(e,"class","mod-destructive")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,qh.debounce)(o[6])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function hR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,qh.debounce)(o[7])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function gR(o){let e,t,r,n;return e=new $e({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[mR]},$$scope:{ctx:o}}}),r=new $e({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[hR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i&256&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i&256&&(l.$$scope={dirty:i,ctx:s}),r.$set(l)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function yR(o){let e,t,r,n,s,i;e=new Ko({props:{items:[{type:"home",onClick:o[5]},{type:"folder",folder:o[0]}]}});let a=o[0]&&m_(o);return{c(){D(e.$$.fragment),t=T(),r=x("div"),r.innerHTML=`<p style="margin: 1em; text-align: center">This Shared Folder is not on a Relay Server, or else you do not have
		permission to access it.</p>`,n=T(),a&&a.c(),s=ve(),le(r,"padding","1em"),le(r,"margin","1em"),le(r,"background","var(--background-secondary)")},m(l,c){A(e,l,c),S(l,t,c),S(l,r,c),S(l,n,c),a&&a.m(l,c),S(l,s,c),i=!0},p(l,[c]){let f={};c&1&&(f.items=[{type:"home",onClick:l[5]},{type:"folder",folder:l[0]}]),e.$set(f),l[0]?a?(a.p(l,c),c&1&&v(a,1)):(a=m_(l),a.c(),v(a,1),a.m(s.parentNode,s)):a&&(ce(),k(a,1,1,()=>{a=null}),fe())},i(l){i||(v(e.$$.fragment,l),v(a),i=!0)},o(l){k(e.$$.fragment,l),k(a),i=!1},d(l){l&&(_(t),_(r),_(n),_(s)),R(e,l),a&&a.d(l)}}}function bR(o,e,t){let{plugin:r}=e,{sharedFolder:n}=e,s=it();function i(){return Ae(this,void 0,void 0,function*(){n&&r.sharedFolders.delete(n),s("goBack",{clear:!0})})}function a(){if(n){let u=r.vault.getFolderByPath(n.path);u&&r.app.vault.trash(u,!1)}s("goBack",{})}let l=()=>s("goBack",{clear:!0}),c=()=>{i()},f=()=>{a()};return o.$$set=u=>{"plugin"in u&&t(4,r=u.plugin),"sharedFolder"in u&&t(0,n=u.sharedFolder)},[n,s,i,a,r,l,c,f]}var Hh=class extends Z{constructor(e){super(),ee(this,e,bR,yR,X,{plugin:4,sharedFolder:0})}},Cf=Hh;var Jo=require("obsidian");var q_=require("obsidian"),W_=Qo(Yn());var v_=require("obsidian");function vR(o){Ee(o,"svelte-1iq1qoa",".search-container.svelte-1iq1qoa.svelte-1iq1qoa{margin-bottom:16px}.search-input.svelte-1iq1qoa.svelte-1iq1qoa{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;max-height:400px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);margin-bottom:16px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);cursor:pointer;gap:12px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:last-child{border-bottom:none}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:hover:not(.has-access){background:var(--background-modifier-hover)}.user-item.has-access.svelte-1iq1qoa.svelte-1iq1qoa{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-1iq1qoa.svelte-1iq1qoa{margin:0;cursor:pointer}.user-avatar.svelte-1iq1qoa.svelte-1iq1qoa{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-1iq1qoa img.svelte-1iq1qoa{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;min-width:0}.user-name.svelte-1iq1qoa.svelte-1iq1qoa{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-1iq1qoa.svelte-1iq1qoa{font-size:0.8em;color:var(--text-muted);font-style:italic}.no-users.svelte-1iq1qoa.svelte-1iq1qoa{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;justify-content:space-between;align-items:center;margin-top:16px}.selection-count.svelte-1iq1qoa.svelte-1iq1qoa{color:var(--text-muted);font-size:0.9em}button.svelte-1iq1qoa.svelte-1iq1qoa:disabled{opacity:0.5;cursor:not-allowed}")}function h_(o,e,t){let r=o.slice();return r[22]=e[t],r}function xR(o){let e,t=Se(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=g_(h_(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ve()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);S(n,e,s)},p(n,s){if(s&130){t=Se(n[1]);let i;for(i=0;i<t.length;i+=1){let a=h_(n,t,i);r[i]?r[i].p(a,s):(r[i]=g_(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function wR(o){let e,t=o[0]?"No users found":"No users available",r;return{c(){e=x("div"),r=K(t),h(e,"class","no-users svelte-1iq1qoa")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0]?"No users found":"No users available")&&te(r,t)},d(n){n&&_(e)}}}function _R(o){let e=y_(o[22].user.name)+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&2&&e!==(e=y_(r[22].user.name)+"")&&te(t,e)},d(r){r&&_(t)}}}function SR(o){let e,t,r;return{c(){e=x("img"),Tr(e.src,t=o[22].user.picture)||h(e,"src",t),h(e,"alt",r=o[22].user.name),h(e,"class","svelte-1iq1qoa")},m(n,s){S(n,e,s)},p(n,s){s&2&&!Tr(e.src,t=n[22].user.picture)&&h(e,"src",t),s&2&&r!==(r=n[22].user.name)&&h(e,"alt",r)},d(n){n&&_(e)}}}function kR(o){let e;return{c(){e=x("div"),e.textContent="(You)",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function IR(o){let e;return{c(){e=x("div"),e.textContent="Already has access",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function g_(o){let e,t,r,n,s,i,a,l,c,f=o[22].user.name+"",u,d,p,m,y;function g(...P){return o[14](o[22],...P)}function I(P,$){return P[22].user.picture?SR:_R}let L=I(o,-1),C=L(o);function w(P,$){if(P[22].hasAccess)return IR;if(P[22].isCurrentUser)return kR}let E=w(o,-1),F=E&&E(o);function U(){return o[15](o[22])}function V(...P){return o[16](o[22],...P)}return{c(){e=x("div"),t=x("input"),s=T(),i=x("div"),C.c(),a=T(),l=x("div"),c=x("div"),u=K(f),d=T(),F&&F.c(),p=T(),h(t,"type","checkbox"),t.checked=r=o[22].selected,t.disabled=n=o[22].hasAccess,h(t,"class","user-checkbox svelte-1iq1qoa"),h(i,"class","user-avatar svelte-1iq1qoa"),h(c,"class","user-name svelte-1iq1qoa"),h(l,"class","user-info svelte-1iq1qoa"),h(e,"class","user-item svelte-1iq1qoa"),h(e,"role","button"),h(e,"tabindex","0"),Te(e,"has-access",o[22].hasAccess),Te(e,"is-owner",o[22].isOwner),Te(e,"is-current-user",o[22].isCurrentUser)},m(P,$){S(P,e,$),b(e,t),b(e,s),b(e,i),C.m(i,null),b(e,a),b(e,l),b(l,c),b(c,u),b(e,d),F&&F.m(e,null),b(e,p),m||(y=[j(t,"click",g),j(e,"click",U),j(e,"keydown",V)],m=!0)},p(P,$){o=P,$&2&&r!==(r=o[22].selected)&&(t.checked=r),$&2&&n!==(n=o[22].hasAccess)&&(t.disabled=n),L===(L=I(o,$))&&C?C.p(o,$):(C.d(1),C=L(o),C&&(C.c(),C.m(i,null))),$&2&&f!==(f=o[22].user.name+"")&&te(u,f),E!==(E=w(o,$))&&(F&&F.d(1),F=E&&E(o),F&&(F.c(),F.m(e,p))),$&2&&Te(e,"has-access",o[22].hasAccess),$&2&&Te(e,"is-owner",o[22].isOwner),$&2&&Te(e,"is-current-user",o[22].isCurrentUser)},d(P){P&&_(e),C.d(),F&&F.d(),m=!1,xe(y)}}}function CR(o){let e,t,r,n,s,i,a,l,c,f,u=o[2]===0?"No users selected":`${o[2]} user${o[2]===1?"":"s"} selected`,d,p,m,y,g,I,L;function C(F,U){return F[1].length===0?wR:xR}let w=C(o,-1),E=w(o);return{c(){e=x("div"),e.textContent="Invite users to this folder",t=T(),r=x("div"),n=x("div"),s=x("input"),i=T(),a=x("div"),E.c(),l=T(),c=x("div"),f=x("span"),d=K(u),p=T(),m=x("button"),y=K("Add Users"),h(e,"class","modal-title"),h(s,"type","text"),h(s,"placeholder","Search users by name..."),h(s,"class","search-input svelte-1iq1qoa"),h(n,"class","search-container svelte-1iq1qoa"),h(a,"class","user-list svelte-1iq1qoa"),h(f,"class","selection-count svelte-1iq1qoa"),h(m,"class","mod-cta svelte-1iq1qoa"),m.disabled=g=o[2]===0,h(c,"class","modal-button-container svelte-1iq1qoa"),h(r,"class","modal-content user-select-modal")},m(F,U){S(F,e,U),S(F,t,U),S(F,r,U),b(r,n),b(n,s),Ke(s,o[0]),b(r,i),b(r,a),E.m(a,null),b(r,l),b(r,c),b(c,f),b(f,d),b(c,p),b(c,m),b(m,y),I||(L=[j(s,"input",o[13]),j(m,"click",o[8])],I=!0)},p(F,[U]){U&1&&s.value!==F[0]&&Ke(s,F[0]),w===(w=C(F,U))&&E?E.p(F,U):(E.d(1),E=w(F),E&&(E.c(),E.m(a,null))),U&4&&u!==(u=F[2]===0?"No users selected":`${F[2]} user${F[2]===1?"":"s"} selected`)&&te(d,u),U&4&&g!==(g=F[2]===0)&&(m.disabled=g)},i:z,o:z,d(F){F&&(_(e),_(t),_(r)),E.d(),I=!1,xe(L)}}}function y_(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function LR(o,e,t){let r,n,s,i,{relayManager:a}=e,{folder:l}=e,{onAdd:c}=e,{preSelectedUserIds:f=[]}=e,u=we(new Set([...f]));de(o,u,P=>t(17,r=P));let d=we("");de(o,d,P=>t(0,n=P));let p=at([a.relayRoles],([P])=>P.values().filter($=>$.relayId===l.relayId).map($=>$.user)),m=at([a.folderRoles],([P])=>P.values().filter($=>$.sharedFolderId===l.id)),y=at([p,m,u],([P,$,re])=>{var W;let q=new Set($.map(B=>B.userId)),M=new Set($.filter(B=>B.role==="Owner").map(B=>B.userId)),G=(W=a.user)===null||W===void 0?void 0:W.id;return P.map(B=>{let Q=M.has(B.id),N=G===B.id,O=re.has(B.id);return{user:B,hasAccess:q.has(B.id),selected:O,isOwner:Q,isCurrentUser:N}})}),g=at([y,d],([P,$])=>{if(!$)return P;let re=$.toLowerCase();return P.filter(W=>W.user.name.toLowerCase().includes(re))}),I=at([g],([P])=>P.sort(($,re)=>$.hasAccess&&!re.hasAccess?1:!$.hasAccess&&re.hasAccess?-1:$.user.name.localeCompare(re.user.name)));de(o,I,P=>t(1,s=P));let L=at([u],([P])=>P.size);de(o,L,P=>t(2,i=P));function C(P){P.hasAccess||u.update($=>{let re=new Set($);return re.has(P.user.id)?re.delete(P.user.id):re.add(P.user.id),re})}function w(){return Ae(this,void 0,void 0,function*(){let P=r;if(P.size!==0)try{yield c(Array.from(P),"Member")}catch($){dr($)}})}function E(){n=this.value,d.set(n)}let F=(P,$)=>{$.stopPropagation(),C(P)},U=P=>C(P),V=(P,$)=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),C(P))};return o.$$set=P=>{"relayManager"in P&&t(9,a=P.relayManager),"folder"in P&&t(10,l=P.folder),"onAdd"in P&&t(11,c=P.onAdd),"preSelectedUserIds"in P&&t(12,f=P.preSelectedUserIds)},[n,s,i,u,d,I,L,C,w,a,l,c,f,E,F,U,V]}var Wh=class extends Z{constructor(e){super(),ee(this,e,LR,CR,X,{relayManager:9,folder:10,onAdd:11,preSelectedUserIds:12},vR)}},b_=Wh;var Lf=class extends v_.Modal{constructor(t,r,n,s,i){super(t);this.relayManager=r;this.folder=n;this.onAdd=s;this.preSelectedUserIds=i}onOpen(){let{contentEl:t}=this;this.component=new b_({target:t,props:{relayManager:this.relayManager,folder:this.folder,preSelectedUserIds:this.preSelectedUserIds,onAdd:async(r,n)=>{await this.onAdd(r,n),this.close()}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function ER(o){Ee(o,"svelte-fmnezc",`div.spacer.svelte-fmnezc{height:3em}.local-settings.svelte-fmnezc{margin-left:-1em;padding-left:1em;border-left:1px solid var(--color-accent)}.system3-input-invalid.svelte-fmnezc{border:1px solid var(--color-red) !important}input.system3-updating.svelte-fmnezc{border:1px solid var(--color-accent) !important}.edit-members-button.svelte-fmnezc{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-fmnezc:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-fmnezc:focus{outline:none;color:var(--icon-color-focus)}select.dropdown.svelte-fmnezc:disabled{opacity:1 !important;color:var(--text-muted) !important;-webkit-text-fill-color:var(--text-muted) !important}`)}function x_(o,e,t){let r=o.slice();return r[68]=e[t][0],r[69]=e[t][1],r}function w_(o,e,t){let r=o.slice();return r[72]=e[t],r}function __(o,e,t){let r=o.slice();return r[72]=e[t],r}function S_(o){let e;return{c(){e=x("div"),e.innerHTML=`<p style="margin: 1em; text-align: center">As Relay Server owner, you can manage this Shared Folder but cannot access
			its contents. You must be added to the Shared Folder in order to
			collaborate.</p>`,le(e,"padding","1em"),le(e,"margin","1em"),le(e,"background","var(--background-secondary)")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function k_(o){let e,t;return e=new $e({props:{name:"Name",description:"Set the Shared Folder's default name. A Shared Folder can always be renamed locally.",$$slots:{default:[TR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&33048|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function TR(o){let e,t,r,n;return{c(){e=x("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=Fr((o[15]?"system3-updating":"")+(o[8]?"":" system3-input-invalid"))+" svelte-fmnezc")},m(s,i){S(s,e,i),Ke(e,o[3]),o[56](e),r||(n=[j(e,"input",o[55]),j(e,"input",o[48])],r=!0)},p(s,i){i[0]&33024&&t!==(t=Fr((s[15]?"system3-updating":"")+(s[8]?"":" system3-input-invalid"))+" svelte-fmnezc")&&h(e,"class",t),i[0]&8&&e.value!==s[3]&&Ke(e,s[3])},d(s){s&&_(e),o[56](null),r=!1,xe(n)}}}function I_(o){let e,t,r,n;return e=new Ze({props:{name:"Add to vault"}}),r=new St({props:{$$slots:{default:[PR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[2]&32768&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function FR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Add to vault",h(e,"class","mod-cta system3-button")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Jo.debounce)(o[47])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function PR(o){let e,t;return e=new $e({props:{name:"Add this folder to your vault",description:"Download and sync this folder to your local device",$$slots:{default:[FR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function C_(o){let e,t,r,n;return e=new Ze({props:{name:"Users with access",helpText:o[7]?"":"This folder is accessible to everyone on this Relay Server.",$$slots:{default:[MR]},$$scope:{ctx:o}}}),r=new St({props:{$$slots:{default:[VR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[0]&128&&(a.helpText=s[7]?"":"This folder is accessible to everyone on this Relay Server."),i[0]&135172|i[2]&32768&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i[0]&397952|i[2]&32768&&(l.$$scope={dirty:i,ctx:s}),r.$set(l)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function L_(o){let e,t,r,n,s,i,a,l=[RR,AR],c=[];function f(u,d){return u[17]?0:1}return t=f(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=x("div"),r.c(),h(e,"class","edit-members-button svelte-fmnezc"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[17]?"Cancel editing users":"Edit users")},m(u,d){S(u,e,d),c[t].m(e,null),s=!0,i||(a=[j(e,"click",o[42]),j(e,"keypress",o[42])],i=!0)},p(u,d){let p=t;t=f(u,d),t!==p&&(ce(),k(c[p],1,1,()=>{c[p]=null}),fe(),r=c[t],r||(r=c[t]=l[t](u),r.c()),v(r,1),r.m(e,null)),(!s||d[0]&131072&&n!==(n=u[17]?"Cancel editing users":"Edit users"))&&h(e,"aria-label",n)},i(u){s||(v(r),s=!0)},o(u){k(r),s=!1},d(u){u&&_(e),c[t].d(),i=!1,xe(a)}}}function AR(o){let e,t;return e=new Pa({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function RR(o){let e,t;return e=new Ta({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function MR(o){let e,t,r=o[2].private&&o[12]&&L_(o);return{c(){r&&r.c(),e=ve()},m(n,s){r&&r.m(n,s),S(n,e,s),t=!0},p(n,s){n[2].private&&n[12]?r?(r.p(n,s),s[0]&4100&&v(r,1)):(r=L_(n),r.c(),v(r,1),r.m(e.parentNode,e)):r&&(ce(),k(r,1,1,()=>{r=null}),fe())},i(n){t||(v(r),t=!0)},o(n){k(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}function E_(o){let e;function t(s,i){return s[17]?OR:s[12]?UR:DR}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),S(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function DR(o){let e,t=o[72].role+"",r;return{c(){e=x("span"),r=K(t),h(e,"class","role-label")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s[0]&512&&t!==(t=n[72].role+"")&&te(r,t)},d(n){n&&_(e)}}}function UR(o){let e,t,r,n,s,i,a=Se(o[18]),l=[];for(let c=0;c<a.length;c+=1)l[c]=T_(__(o,a,c));return{c(){e=x("div"),t=x("select");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","dropdown svelte-fmnezc"),h(t,"data-role-id",n=o[72].id),le(e,"display","flex"),le(e,"gap","8px"),le(e,"align-items","center")},m(c,f){S(c,e,f),b(e,t);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(t,null);Bn(t,o[72].role),s||(i=j(t,"change",o[46]),s=!0)},p(c,f){if(f[0]&262144){a=Se(c[18]);let u;for(u=0;u<a.length;u+=1){let d=__(c,a,u);l[u]?l[u].p(d,f):(l[u]=T_(d),l[u].c(),l[u].m(t,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=a.length}f[0]&262656&&r!==(r=c[72].role)&&Bn(t,c[72].role),f[0]&262656&&n!==(n=c[72].id)&&h(t,"data-role-id",n)},d(c){c&&_(e),Je(l,c),s=!1,i()}}}function OR(o){let e,t,r;function n(){return o[57](o[72])}return{c(){e=x("button"),e.textContent="Remove",h(e,"class","mod-destructive")},m(s,i){S(s,e,i),t||(r=j(e,"click",function(){nt((0,Jo.debounce)(n))&&(0,Jo.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&_(e),t=!1,r()}}}function T_(o){let e,t=o[72].name+"",r,n;return{c(){e=x("option"),r=K(t),e.__value=n=o[72].name,Ke(e,e.__value)},m(s,i){S(s,e,i),b(e,r)},p(s,i){i[0]&262144&&t!==(t=s[72].name+"")&&te(r,t),i[0]&262144&&n!==(n=s[72].name)&&(e.__value=n,Ke(e,e.__value))},d(s){s&&_(e)}}}function $R(o){let e,t=o[7]&&E_(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),S(r,e,n)},p(r,n){r[7]?t?t.p(r,n):(t=E_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function F_(o){let e,t;return e=new Ii({props:{user:o[72].user,$$slots:{default:[$R]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.user=r[72].user),n[0]&397952|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function P_(o){let e,t;return e=new $e({props:{description:"",name:"",$$slots:{default:[BR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&131072|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function BR(o){let e,t,r,n;return{c(){e=x("button"),t=K("Add User"),h(e,"class","mod-cta"),h(e,"aria-label","Add user to private folder"),e.disabled=o[17]},m(s,i){S(s,e,i),b(e,t),r||(n=j(e,"click",(0,Jo.debounce)(o[45])),r=!0)},p(s,i){i[0]&131072&&(e.disabled=s[17])},d(s){s&&_(e),r=!1,n()}}}function VR(o){let e,t,r,n=Se(o[9]),s=[];for(let l=0;l<n.length;l+=1)s[l]=F_(w_(o,n,l));let i=l=>k(s[l],1,1,()=>{s[l]=null}),a=o[7]&&o[12]&&P_(o);return{c(){for(let l=0;l<s.length;l+=1)s[l].c();e=T(),a&&a.c(),t=ve()},m(l,c){for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(l,c);S(l,e,c),a&&a.m(l,c),S(l,t,c),r=!0},p(l,c){if(c[0]&397952|c[1]&36864){n=Se(l[9]);let f;for(f=0;f<n.length;f+=1){let u=w_(l,n,f);s[f]?(s[f].p(u,c),v(s[f],1)):(s[f]=F_(u),s[f].c(),v(s[f],1),s[f].m(e.parentNode,e))}for(ce(),f=n.length;f<s.length;f+=1)i(f);fe()}l[7]&&l[12]?a?(a.p(l,c),c[0]&4224&&v(a,1)):(a=P_(l),a.c(),v(a,1),a.m(t.parentNode,t)):a&&(ce(),k(a,1,1,()=>{a=null}),fe())},i(l){if(!r){for(let c=0;c<n.length;c+=1)v(s[c]);v(a),r=!0}},o(l){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)k(s[c]);k(a),r=!1},d(l){l&&(_(e),_(t)),Je(s,l),a&&a.d(l)}}}function A_(o){let e,t,r,n,s;return t=new Ze({props:{name:"Sync settings for this device",helpText:"You must have attachment storage available in order to sync attachments."}}),n=new St({props:{$$slots:{default:[WR]},$$scope:{ctx:o}}}),{c(){e=x("div"),D(t.$$.fragment),r=T(),D(n.$$.fragment),h(e,"class","local-settings svelte-fmnezc")},m(i,a){S(i,e,a),A(t,e,null),b(e,r),A(n,e,null),s=!0},p(i,a){let l={};a[0]&593e3|a[2]&32768&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(v(t.$$.fragment,i),v(n.$$.fragment,i),s=!0)},o(i){k(t.$$.fragment,i),k(n.$$.fragment,i),s=!1},d(i){i&&_(e),R(t),R(n)}}}function R_(o){let e,t;return e=new $e({props:{name:"Local path",description:"This folder has a different name in your Vault",$$slots:{default:[NR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&1024|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function NR(o){let e,t=o[10].path+"",r;return{c(){e=K("/"),r=K(t)},m(n,s){S(n,e,s),S(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[10].path+"")&&te(r,t)},d(n){n&&(_(e),_(r))}}}function M_(o){let e,t;return e=new wf({}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function HR(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[11]&&M_(o);function p(...g){return o[58](o[68],...g)}function m(){return o[59](o[68])}function y(){return o[60](o[68])}return{c(){e=x("div"),d&&d.c(),t=T(),r=x("div"),n=x("input"),i=T(),a=x("div"),h(n,"type","checkbox"),n.checked=s=o[19][o[68]]&&!o[11],n.disabled=o[5],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[19][o[68]]&&!o[11]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Te(r,"is-enabled",o[19][o[68]]&&!o[11]),h(e,"class","setting-item-control")},m(g,I){S(g,e,I),d&&d.m(e,null),b(e,t),b(e,r),b(r,n),b(r,i),b(r,a),c=!0,f||(u=[j(n,"change",p),j(r,"keypress",m),j(r,"click",y)],f=!0)},p(g,I){o=g,o[11]?d?I[0]&2048&&v(d,1):(d=M_(o),d.c(),v(d,1),d.m(e,t)):d&&(ce(),k(d,1,1,()=>{d=null}),fe()),(!c||I[0]&526400&&s!==(s=o[19][o[68]]&&!o[11]))&&(n.checked=s),(!c||I[0]&32)&&(n.disabled=o[5]),(!c||I[0]&526400&&l!==(l=o[19][o[68]]&&!o[11]))&&h(r,"aria-checked",l),(!c||I[0]&526400)&&Te(r,"is-enabled",o[19][o[68]]&&!o[11])},i(g){c||(v(d),c=!0)},o(g){k(d),c=!1},d(g){g&&_(e),d&&d.d(),f=!1,xe(u)}}}function D_(o){let e,t;return e=new ar({props:{name:o[69].name,description:o[69].description,$$slots:{default:[HR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.name=r[69].name),n[0]&64&&(s.description=r[69].description),n[0]&526432|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function U_(o){let e,t;return e=new ar({props:{name:"",$$slots:{default:[qR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&65536|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function qR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){S(n,e,s),t||(r=j(e,"click",function(){nt((0,Jo.debounce)(o[61]))&&(0,Jo.debounce)(o[61]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function WR(o){let e,t,r,n,s=o[3]!==o[10].name&&R_(o),i=Se(o[6]),a=[];for(let f=0;f<i.length;f+=1)a[f]=D_(x_(o,i,f));let l=f=>k(a[f],1,1,()=>{a[f]=null}),c=o[11]&&o[16]&&U_(o);return{c(){s&&s.c(),e=T();for(let f=0;f<a.length;f+=1)a[f].c();t=T(),c&&c.c(),r=ve()},m(f,u){s&&s.m(f,u),S(f,e,u);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(f,u);S(f,t,u),c&&c.m(f,u),S(f,r,u),n=!0},p(f,u){if(f[3]!==f[10].name?s?(s.p(f,u),u[0]&1032&&v(s,1)):(s=R_(f),s.c(),v(s,1),s.m(e.parentNode,e)):s&&(ce(),k(s,1,1,()=>{s=null}),fe()),u[0]&526432|u[1]&2){i=Se(f[6]);let d;for(d=0;d<i.length;d+=1){let p=x_(f,i,d);a[d]?(a[d].p(p,u),v(a[d],1)):(a[d]=D_(p),a[d].c(),v(a[d],1),a[d].m(t.parentNode,t))}for(ce(),d=i.length;d<a.length;d+=1)l(d);fe()}f[11]&&f[16]?c?(c.p(f,u),u[0]&67584&&v(c,1)):(c=U_(f),c.c(),v(c,1),c.m(r.parentNode,r)):c&&(ce(),k(c,1,1,()=>{c=null}),fe())},i(f){if(!n){v(s);for(let u=0;u<i.length;u+=1)v(a[u]);v(c),n=!0}},o(f){k(s),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)k(a[u]);k(c),n=!1},d(f){f&&(_(e),_(t),_(r)),s&&s.d(f),Je(a,f),c&&c.d(f)}}}function O_(o){let e,t,r,n;return e=new Ze({props:{name:"Danger zone"}}),r=new St({props:{$$slots:{default:[GR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment)},m(s,i){A(e,s,i),S(s,t,i),A(r,s,i),n=!0},p(s,i){let a={};i[0]&3212289|i[2]&32768&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(v(e.$$.fragment,s),v(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function $_(o){let e,t,r,n=o[21]&&B_(o),s=o[20]&&N_(o);return{c(){n&&n.c(),e=T(),s&&s.c(),t=ve()},m(i,a){n&&n.m(i,a),S(i,e,a),s&&s.m(i,a),S(i,t,a),r=!0},p(i,a){i[21]?n?(n.p(i,a),a[0]&2097152&&v(n,1)):(n=B_(i),n.c(),v(n,1),n.m(e.parentNode,e)):n&&(ce(),k(n,1,1,()=>{n=null}),fe()),i[20]?s?(s.p(i,a),a[0]&1048576&&v(s,1)):(s=N_(i),s.c(),v(s,1),s.m(t.parentNode,t)):s&&(ce(),k(s,1,1,()=>{s=null}),fe())},i(i){r||(v(n),v(s),r=!0)},o(i){k(n),k(s),r=!1},d(i){i&&(_(e),_(t)),n&&n.d(i),s&&s.d(i)}}}function B_(o){var n,s;let e,t,r=!((n=o[0])!=null&&n.private)&&((s=o[0])==null?void 0:s.relay.version)>0&&V_(o);return{c(){r&&r.c(),e=ve()},m(i,a){r&&r.m(i,a),S(i,e,a),t=!0},p(i,a){var l,c;!((l=i[0])!=null&&l.private)&&((c=i[0])==null?void 0:c.relay.version)>0?r?(r.p(i,a),a[0]&1&&v(r,1)):(r=V_(i),r.c(),v(r,1),r.m(e.parentNode,e)):r&&(ce(),k(r,1,1,()=>{r=null}),fe())},i(i){t||(v(r),t=!0)},o(i){k(r),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function V_(o){let e,t;return e=new $e({props:{name:"Make private",description:"Convert this folder to a private folder and manage access",$$slots:{default:[jR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function jR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Make private",h(e,"class","mod-destructive")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Jo.debounce)(o[44])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function N_(o){let e,t;return e=new $e({props:{name:"Remove from Relay Server",description:"Deletes the remote folder from the Relay Server. Local files will be preserved.",$$slots:{default:[zR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function zR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Delete from Relay Server",h(e,"class","mod-destructive")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Jo.debounce)(o[41])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function H_(o){let e,t;return e=new $e({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[KR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function KR(o){let e,t,r;return{c(){e=x("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,Jo.debounce)(o[62])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function GR(o){let e,t,r,n=o[16]&&$_(o),s=o[10]&&H_(o);return{c(){n&&n.c(),e=T(),s&&s.c(),t=ve()},m(i,a){n&&n.m(i,a),S(i,e,a),s&&s.m(i,a),S(i,t,a),r=!0},p(i,a){i[16]?n?(n.p(i,a),a[0]&65536&&v(n,1)):(n=$_(i),n.c(),v(n,1),n.m(e.parentNode,e)):n&&(ce(),k(n,1,1,()=>{n=null}),fe()),i[10]?s?(s.p(i,a),a[0]&1024&&v(s,1)):(s=H_(i),s.c(),v(s,1),s.m(t.parentNode,t)):s&&(ce(),k(s,1,1,()=>{s=null}),fe())},i(i){r||(v(n),v(s),r=!0)},o(i){k(n),k(s),r=!1},d(i){i&&(_(e),_(t)),n&&n.d(i),s&&s.d(i)}}}function JR(o){let e,t,r,n,s,i,a,l,c,f,u,d,p;e=new Ko({props:{items:[{type:"home",onClick:o[53]},{type:"relay",relay:o[2].relay,onClick:o[54]},{type:"remoteFolder",remoteFolder:{...o[2],name:o[3],private:o[7]}}]}});let m=o[12]&&!o[13]&&S_(o),y=o[14]&&k_(o),g=!o[10]&&o[13]&&I_(o),I=o[16]&&C_(o),L=o[10]&&o[19]&&o[16]&&A_(o),C=(o[20]||o[21]||o[10])&&O_(o);return{c(){D(e.$$.fragment),t=T(),m&&m.c(),r=T(),y&&y.c(),n=T(),g&&g.c(),s=T(),I&&I.c(),i=T(),a=x("div"),l=T(),L&&L.c(),c=T(),f=x("div"),u=T(),C&&C.c(),d=ve(),h(a,"class","spacer svelte-fmnezc"),h(f,"class","spacer svelte-fmnezc")},m(w,E){A(e,w,E),S(w,t,E),m&&m.m(w,E),S(w,r,E),y&&y.m(w,E),S(w,n,E),g&&g.m(w,E),S(w,s,E),I&&I.m(w,E),S(w,i,E),S(w,a,E),S(w,l,E),L&&L.m(w,E),S(w,c,E),S(w,f,E),S(w,u,E),C&&C.m(w,E),S(w,d,E),p=!0},p(w,E){let F={};E[0]&140&&(F.items=[{type:"home",onClick:w[53]},{type:"relay",relay:w[2].relay,onClick:w[54]},{type:"remoteFolder",remoteFolder:{...w[2],name:w[3],private:w[7]}}]),e.$set(F),w[12]&&!w[13]?m||(m=S_(w),m.c(),m.m(r.parentNode,r)):m&&(m.d(1),m=null),w[14]?y?(y.p(w,E),E[0]&16384&&v(y,1)):(y=k_(w),y.c(),v(y,1),y.m(n.parentNode,n)):y&&(ce(),k(y,1,1,()=>{y=null}),fe()),!w[10]&&w[13]?g?(g.p(w,E),E[0]&9216&&v(g,1)):(g=I_(w),g.c(),v(g,1),g.m(s.parentNode,s)):g&&(ce(),k(g,1,1,()=>{g=null}),fe()),w[16]?I?(I.p(w,E),E[0]&65536&&v(I,1)):(I=C_(w),I.c(),v(I,1),I.m(i.parentNode,i)):I&&(ce(),k(I,1,1,()=>{I=null}),fe()),w[10]&&w[19]&&w[16]?L?(L.p(w,E),E[0]&590848&&v(L,1)):(L=A_(w),L.c(),v(L,1),L.m(c.parentNode,c)):L&&(ce(),k(L,1,1,()=>{L=null}),fe()),w[20]||w[21]||w[10]?C?(C.p(w,E),E[0]&3146752&&v(C,1)):(C=O_(w),C.c(),v(C,1),C.m(d.parentNode,d)):C&&(ce(),k(C,1,1,()=>{C=null}),fe())},i(w){p||(v(e.$$.fragment,w),v(y),v(g),v(I),v(L),v(C),p=!0)},o(w){k(e.$$.fragment,w),k(y),k(g),k(I),k(L),k(C),p=!1},d(w){w&&(_(t),_(r),_(n),_(s),_(i),_(a),_(l),_(c),_(f),_(u),_(d)),R(e,w),m&&m.d(w),y&&y.d(w),g&&g.d(w),I&&I.d(w),L&&L.d(w),C&&C.d(w)}}}function QR(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function YR(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function XR(o,e,t){let r,n,s,i,a,l,c,f=z,u=()=>(f(),f=Ht($,ue=>t(2,c=ue)),$),d,p=z,m=()=>(p(),p=Ht(re,ue=>t(64,d=ue)),re),y,g,I,L,C,w,E,F,U,V;o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>p());let{plugin:P}=e,{remoteFolder:$}=e;u();let{sharedFolders:re}=e;m();let{relayRoles:W}=e,{folderRoles:q}=e,M=$.name,{errorLog:G=Re("ManageRemoveFolder.svelte","error")}=e;P.relayManager.refreshRemoteFolder($);let B=at([W],([ue])=>{var qe;return(qe=ue.find(kt=>kt.relayId===c.relayId))===null||qe===void 0?void 0:qe.relay});de(o,B,ue=>t(16,C=ue));let Q=at(d,ue=>ue.items().find(qe=>qe.guid===$.guid));de(o,Q,ue=>t(10,a=ue));let N=at([P.relayManager.roles],([ue])=>ue.values().sort(QR));de(o,N,ue=>t(18,E=ue));let O=at([q,W],([ue,qe])=>{if(c.private){let Lt=[];for(let xr of ue.values())xr.sharedFolderId===c.id&&qe.some(bn=>bn.userId===xr.userId)&&Lt.push(xr);return Lt}let kt=[];for(let Lt of qe.values())Lt.relayId===c.relayId&&kt.push(Lt);return kt});de(o,O,ue=>t(9,i=ue));let J=we(!1);de(o,J,ue=>t(17,w=ue));let oe=we(!0);de(o,oe,ue=>t(8,s=ue));let me,he=we(!1);de(o,he,ue=>t(15,L=ue));let se=$.name;dt(()=>{me&&me.value===""&&me.focus()});function pe(ue){return Ae(this,void 0,void 0,function*(){var qe;if(!(!((qe=P.loginManager)===null||qe===void 0)&&qe.user))return;let kt={relay:ue.id,quantity:10,user_email:P.loginManager.user.email},Lt=btoa(JSON.stringify(kt)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(P.buildApiUrl(`/subscribe/${Lt}?action="buy_storage"`),"_blank")})}let Fe=a==null?void 0:a.syncSettingsManager;de(o,Fe,ue=>t(19,F=ue));let ye=at([Q,W],([ue,qe])=>{var kt,Lt,xr;return((xr=(Lt=(kt=qe.find(bn=>{var Pi;return bn.relay===((Pi=ue==null?void 0:ue.remote)===null||Pi===void 0?void 0:Pi.relay)}))===null||kt===void 0?void 0:kt.relay)===null||Lt===void 0?void 0:Lt.storageQuota)===null||xr===void 0?void 0:xr.quota)===0});de(o,ye,ue=>t(11,l=ue));let Ue=!1;function He(ue,qe){return Ae(this,void 0,void 0,function*(){if(!Ue&&!l&&Fe){t(5,Ue=!0);try{yield Fe.toggleCategory(ue,qe),t(6,n=Object.entries(Fe.getCategories()))}catch(kt){}finally{t(5,Ue=!1)}}})}let Qe=it(),rt=P.relayManager.userCan(["folder","read_content"],$);de(o,rt,ue=>t(13,g=ue));let Ft=P.relayManager.userCan(["folder","rename"],$);de(o,Ft,ue=>t(14,I=ue));let qt=P.relayManager.userCan(["folder","delete"],$);de(o,qt,ue=>t(20,U=ue));let zn=P.relayManager.userCan(["folder","manage_users"],$);de(o,zn,ue=>t(12,y=ue));let qr=P.relayManager.userCan(["folder","make_private"],$);de(o,qr,ue=>t(21,V=ue));function Wr(ue){ue&&Qe("manageRelay",{relay:ue})}function ko(){return Ae(this,void 0,void 0,function*(){a&&P.sharedFolders.delete(a),Qe("goBack",{clear:!0})})}function lr(){if(a){let ue=P.vault.getFolderByPath(a.path);ue&&P.app.vault.trash(ue,!1)}}function yn(){return Ae(this,void 0,void 0,function*(){try{if(yield P.relayManager.deleteRemote($),a){gi(Q,a.remote=void 0,a),P.sharedFolders.notifyListeners(),Qe("manageSharedFolder",{folder:a});return}}catch(ue){G("Failed to delete remote folder:",ue)}Qe("goBack",{})})}function ks(ue){(ue instanceof MouseEvent||ue instanceof KeyboardEvent&&(ue.key==="Enter"||ue.key===" "))&&J.update(qe=>!qe)}function Dr(ue){return Ae(this,void 0,void 0,function*(){try{yield P.relayManager.removeFolderRole(ue)}catch(qe){dr(qe,"Failed to remove user from folder.")}})}function jr(){return Ae(this,void 0,void 0,function*(){try{let ue=yield P.relayManager.updateFolderPrivacy($,!0);Io()}catch(ue){dr(ue,"Failed to make folder private. Permission denied.")}})}function Io(){new Lf(P.app,P.relayManager,$,(qe,kt)=>Ae(this,void 0,void 0,function*(){try{for(let Lt of qe)yield P.relayManager.addFolderRole($,Lt,kt)}catch(Lt){dr(Lt,"Failed to add users to folder.")}})).open()}function Kn(ue,qe){return Ae(this,void 0,void 0,function*(){try{yield P.relayManager.updateFolderRole(ue,qe)}catch(kt){throw dr(kt,"Failed to change user role."),kt}})}function Co(ue){return Ae(this,void 0,void 0,function*(){let qe=ue.target,kt=i.find(Lt=>Lt.id===qe.dataset.roleId);if(kt){let Lt=kt.role;try{yield Kn(kt,qe.value)}catch(xr){qe.value=Lt}}})}function Gn(){return Ae(this,void 0,void 0,function*(){function ue(qe,kt,Lt){return Ae(this,void 0,void 0,function*(){let xr=(0,q_.normalizePath)((0,W_.join)(Lt,kt));P.vault.getFolderByPath(xr)===null&&(yield P.vault.createFolder(xr));let bn=P.sharedFolders.new(xr,qe.guid,qe.relay.guid,!0);return bn.remote=qe,P.sharedFolders.notifyListeners(),Qe("manageRemoteFolder",{remoteFolder:qe}),bn})}new Wn(P.app,P.sharedFolders,$,[],ue).open()})}let Jn=P.timeProvider.debounce(ue=>Ae(void 0,void 0,void 0,function*(){try{let qe=yield P.relayManager.updateRemoteFolder($,{name:ue});se=qe.name,t(3,M=qe.name),he.set(!1)}catch(qe){G("Failed to update folder name:",qe),(qe==null?void 0:qe.status)===400&&oe.set(!1),he.set(!1)}}),500);function Qn(){oe.set(YR(me.value));let ue=me.value.trim();s&&ue!==""&&ue!==se&&(he.set(!0),Jn(ue))}let _e=()=>Qe("goBack",{clear:!0}),Xe=()=>Wr(c.relay);function ft(){M=this.value,t(3,M)}function ie(ue){vt[ue?"unshift":"push"](()=>{me=ue,t(4,me)})}let Oe=ue=>{"sharedFolder"in ue&&Dr(ue)},xt=(ue,qe)=>He(ue,qe.currentTarget.checked),io=ue=>He(ue,!F[ue]),vr=ue=>He(ue,!F[ue]),Va=()=>{pe(C)},Fi=()=>{lr()};return o.$$set=ue=>{"plugin"in ue&&t(49,P=ue.plugin),"remoteFolder"in ue&&u(t(0,$=ue.remoteFolder)),"sharedFolders"in ue&&m(t(1,re=ue.sharedFolders)),"relayRoles"in ue&&t(50,W=ue.relayRoles),"folderRoles"in ue&&t(51,q=ue.folderRoles),"errorLog"in ue&&t(52,G=ue.errorLog)},o.$$.update=()=>{o.$$.dirty[0]&4&&t(7,r=(c==null?void 0:c.private)||!1)},t(6,n=Fe?Object.entries(Fe.getCategories()):[]),[$,re,c,M,me,Ue,n,r,s,i,a,l,y,g,I,L,C,w,E,F,U,V,B,Q,N,O,J,oe,he,pe,Fe,ye,He,Qe,rt,Ft,qt,zn,qr,Wr,lr,yn,ks,Dr,jr,Io,Co,Gn,Qn,P,W,q,G,_e,Xe,ft,ie,Oe,xt,io,vr,Va,Fi]}var jh=class extends Z{constructor(e){super(),ee(this,e,XR,JR,X,{plugin:49,remoteFolder:0,sharedFolders:1,relayRoles:50,folderRoles:51,errorLog:52},ER,[-1,-1,-1])}},Ef=jh;function ZR(o){Ee(o,"svelte-gjlxvj",".toast.svelte-gjlxvj.svelte-gjlxvj{position:absolute;top:20px;left:50%;transform:translateX(-50%);display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-radius:8px;border:1px solid;background:var(--background-primary);color:var(--text-normal);box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);min-height:48px;max-width:500px;min-width:300px;width:max-content;animation:svelte-gjlxvj-slideDown 0.3s ease-out;pointer-events:auto}.toast-error.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-error)}.toast-warning.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-warning)}.toast-success.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--interactive-accent)}@keyframes svelte-gjlxvj-slideDown{from{opacity:0;transform:translateX(-50%) translateY(-10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}.toast-icon.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;flex-shrink:0;margin-top:1px}.toast-error.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-error)}.toast-warning.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-warning)}.toast-success.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--interactive-accent)}.toast-content.svelte-gjlxvj.svelte-gjlxvj{flex:1;min-width:0}.toast-message.svelte-gjlxvj.svelte-gjlxvj{font-weight:500;margin-bottom:2px;line-height:1.4;color:var(--text-normal)}.toast-details.svelte-gjlxvj.svelte-gjlxvj{font-size:0.9em;color:var(--text-muted);line-height:1.3}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;justify-content:center;width:24px;height:24px;border:none;background:transparent;border-radius:4px;cursor:pointer;color:var(--text-muted);transition:all 0.15s ease-in-out;padding:0;flex-shrink:0}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:hover{background:var(--background-modifier-hover);color:var(--text-error)}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:focus{outline:2px solid var(--interactive-accent);outline-offset:1px}")}function j_(o){let e,t;return{c(){e=x("div"),t=K(o[1]),h(e,"class","toast-details svelte-gjlxvj")},m(r,n){S(r,e,n),b(e,t)},p(r,n){n&2&&te(t,r[1])},d(r){r&&_(e)}}}function eM(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y;var g=o[3];function I(C,w){return{props:{class:"svg-icon"}}}g&&(r=yi(g,I(o)));let L=o[1]&&j_(o);return u=new wm({props:{class:"svg-icon"}}),{c(){e=x("div"),t=x("div"),r&&D(r.$$.fragment),n=T(),s=x("div"),i=x("div"),a=K(o[0]),l=T(),L&&L.c(),c=T(),f=x("button"),D(u.$$.fragment),h(t,"class","toast-icon svelte-gjlxvj"),h(i,"class","toast-message svelte-gjlxvj"),h(s,"class","toast-content svelte-gjlxvj"),h(f,"class","toast-dismiss svelte-gjlxvj"),h(f,"aria-label","Dismiss error"),h(e,"class",d=Fr(o[2])+" svelte-gjlxvj"),h(e,"role","alert"),h(e,"aria-live","polite")},m(C,w){S(C,e,w),b(e,t),r&&A(r,t,null),b(e,n),b(e,s),b(s,i),b(i,a),b(s,l),L&&L.m(s,null),b(e,c),b(e,f),A(u,f,null),p=!0,m||(y=j(f,"click",o[4]),m=!0)},p(C,[w]){if(w&8&&g!==(g=C[3])){if(r){ce();let E=r;k(E.$$.fragment,1,0,()=>{R(E,1)}),fe()}g?(r=yi(g,I(C,w)),D(r.$$.fragment),v(r.$$.fragment,1),A(r,t,null)):r=null}(!p||w&1)&&te(a,C[0]),C[1]?L?L.p(C,w):(L=j_(C),L.c(),L.m(s,null)):L&&(L.d(1),L=null),(!p||w&4&&d!==(d=Fr(C[2])+" svelte-gjlxvj"))&&h(e,"class",d)},i(C){p||(r&&v(r.$$.fragment,C),v(u.$$.fragment,C),p=!0)},o(C){r&&k(r.$$.fragment,C),k(u.$$.fragment,C),p=!1},d(C){C&&_(e),r&&R(r),L&&L.d(),R(u),m=!1,y()}}}function tM(o,e,t){let r,n,{message:s}=e,{details:i=""}=e,{type:a="error"}=e,{autoDismiss:l=5e3}=e,c=it(),f;dt(()=>(l>0&&(f=window.setTimeout(()=>{c("dismiss")},l)),()=>{f&&clearTimeout(f)}));function u(){f&&clearTimeout(f),c("dismiss")}return o.$$set=d=>{"message"in d&&t(0,s=d.message),"details"in d&&t(1,i=d.details),"type"in d&&t(5,a=d.type),"autoDismiss"in d&&t(6,l=d.autoDismiss)},o.$$.update=()=>{o.$$.dirty&32&&t(3,r=a==="error"?ym:a==="warning"?Kp:a==="success"?Jp:im),o.$$.dirty&32&&t(2,n=`toast toast-${a}`)},[s,i,n,r,u,a,l]}var zh=class extends Z{constructor(e){super(),ee(this,e,tM,eM,X,{message:0,details:1,type:5,autoDismiss:6},ZR)}},z_=zh;function rM(o){Ee(o,"svelte-ml1z9c",".toast-container.svelte-ml1z9c{position:fixed;top:0;left:0;width:100vw;height:0;pointer-events:none;z-index:1000}")}function K_(o,e,t){let r=o.slice();return r[3]=e[t][0],r[4]=e[t][1],r}function G_(o,e){let t,r,n;function s(){return e[2](e[3])}return r=new z_({props:{message:e[4].message,details:e[4].details,type:e[4].type,autoDismiss:e[4].autoDismiss,source:e[4].source}}),r.$on("dismiss",s),{key:o,first:null,c(){t=ve(),D(r.$$.fragment),this.first=t},m(i,a){S(i,t,a),A(r,i,a),n=!0},p(i,a){e=i;let l={};a&1&&(l.message=e[4].message),a&1&&(l.details=e[4].details),a&1&&(l.type=e[4].type),a&1&&(l.autoDismiss=e[4].autoDismiss),a&1&&(l.source=e[4].source),r.$set(l)},i(i){n||(v(r.$$.fragment,i),n=!0)},o(i){k(r.$$.fragment,i),n=!1},d(i){i&&_(t),R(r,i)}}}function oM(o){let e,t=[],r=new Map,n,s=Se(o[0]),i=a=>a[3];for(let a=0;a<s.length;a+=1){let l=K_(o,s,a),c=i(l);r.set(c,t[a]=G_(c,l))}return{c(){e=x("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","toast-container svelte-ml1z9c")},m(a,l){S(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,[l]){l&1&&(s=Se(a[0]),ce(),t=pn(t,l,i,1,a,s,r,e,Ea,G_,null,K_),fe())},i(a){if(!n){for(let l=0;l<s.length;l+=1)v(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)k(t[l]);n=!1},d(a){a&&_(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function nM(o,e,t){let r,n;de(o,Sf,i=>t(1,n=i));let s=i=>Rw(i);return o.$$.update=()=>{o.$$.dirty&2&&t(0,r=Object.entries(n).filter(([i,a])=>a.visible))},[r,n,s]}var Kh=class extends Z{constructor(e){super(),ee(this,e,nM,oM,X,{},rM)}},J_=Kh;function sM(o){Ee(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function iM(o){let e,t,r,n,s=o[0].networkStatus.status&&Q_(o);return{c(){e=x("div"),t=x("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),le(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),le(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(i,a){S(i,e,a),b(e,t),s&&s.m(t,null),r||(n=[j(e,"click",o[22]),j(e,"keypress",o[23])],r=!0)},p(i,a){i[0].networkStatus.status?s?s.p(i,a):(s=Q_(i),s.c(),s.m(t,null)):s&&(s.d(1),s=null),a&1&&le(t,"color",i[0].networkStatus.status.color?i[0].networkStatus.status.color:"var(--text-on-accent)",1),a&1&&le(e,"background-color",i[0].networkStatus.status.backgroundColor?i[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:z,o:z,d(i){i&&_(e),s&&s.d(),r=!1,xe(n)}}}function aM(o){let e,t;return e=new p_({}),e.$on("goBack",o[14]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p:z,i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Q_(o){let e,t=jn(o[0].networkStatus.status.status)+"",r;return{c(){e=new $n(!1),r=ve(),e.a=r},m(n,s){e.m(t,n,s),S(n,r,s)},p(n,s){s&1&&t!==(t=jn(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(_(r),e.d())}}}function lM(o){let e,t;return e=new Ox({props:{plugin:o[0],$$slots:{default:[dM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&134217729&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function cM(o){let e,t;return e=new Ti({props:{plugin:o[0],relayRoles:o[5],relay:o[2],sharedFolders:o[9]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function fM(o){let e,t;return e=new Cf({props:{plugin:o[0],sharedFolder:o[1]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uM(o){let e,t;return e=new Ef({props:{plugin:o[0],remoteFolder:o[3],sharedFolders:o[9],relayRoles:o[5],folderRoles:o[4].folderRoles}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&8&&(s.remoteFolder=r[3]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function dM(o){let e,t;return e=new Go({props:{relays:o[6],subscriptions:o[7],providers:o[8],plugin:o[0]}}),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),e.$on("createRelay",o[13]),e.$on("joinRelay",o[16]),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function pM(o){let e,t;return e=new J_({}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Y_(o){let e,t=o[0].version+"",r;return{c(){e=x("span"),r=K(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&te(r,t)},d(n){n&&_(e)}}}function mM(o){let e,t,r,n,s,i,a,l=ze().enableToasts,c,f,u,d=[aM,iM],p=[];function m(w,E){return w[2]||w[1]||w[3]?0:w[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=p[e]=d[e](o));let y=[uM,fM,cM,lM],g=[];function I(w,E){return w[3]?0:w[1]?1:w[2]?2:3}s=I(o,-1),i=g[s]=y[s](o);let L=l&&pM(o),C=o[0].manifest.version!==o[0].version&&Y_(o);return{c(){t&&t.c(),r=T(),n=x("div"),i.c(),a=T(),L&&L.c(),c=T(),C&&C.c(),f=ve(),h(n,"class","vertical-tab-content svelte-d22j3")},m(w,E){~e&&p[e].m(w,E),S(w,r,E),S(w,n,E),g[s].m(n,null),S(w,a,E),L&&L.m(w,E),S(w,c,E),C&&C.m(w,E),S(w,f,E),u=!0},p(w,[E]){let F=e;e=m(w,E),e===F?~e&&p[e].p(w,E):(t&&(ce(),k(p[F],1,1,()=>{p[F]=null}),fe()),~e?(t=p[e],t?t.p(w,E):(t=p[e]=d[e](w),t.c()),v(t,1),t.m(r.parentNode,r)):t=null);let U=s;s=I(w,E),s===U?g[s].p(w,E):(ce(),k(g[U],1,1,()=>{g[U]=null}),fe(),i=g[s],i?i.p(w,E):(i=g[s]=y[s](w),i.c()),v(i,1),i.m(n,null)),w[0].manifest.version!==w[0].version?C?C.p(w,E):(C=Y_(w),C.c(),C.m(f.parentNode,f)):C&&(C.d(1),C=null)},i(w){u||(v(t),v(i),v(L),u=!0)},o(w){k(t),k(i),k(L),u=!1},d(w){w&&(_(r),_(n),_(a),_(c),_(f)),~e&&p[e].d(w),g[s].d(),L&&L.d(w),C&&C.d(w)}}}function hM(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,i=n.app,a=n.relayManager,l=a.relayRoles,c=a.relays;de(o,c,M=>t(21,r=M));let f=a.subscriptions,u=a.providers,d=n.sharedFolders,p,m=Go,y,g,I=[{component:Go}],{close:L}=e;function C(M){if(t(2,y=void 0),t(1,p=void 0),t(3,g=void 0),M==="/"){t(20,m=Go);return}let G=new URLSearchParams(M.split("?")[1]||""),B=G.get("id");if(M.startsWith("/relays")){B?(t(2,y=a.relays.find(Q=>Q.guid===B||Q.id===B)),t(20,m=Ti)):t(20,m=Go);return}if(M.startsWith("/shared-folders")){if(B){t(1,p=d.find(N=>N.guid===B));let Q=G.get("relay");Q&&t(2,y=a.relays.find(N=>N.guid===Q||N.id===Q)),p!=null&&p.remote?(t(3,g=p.remote),t(2,y=p.remote.relay),t(20,m=Ef)):t(20,m=Cf)}return}}function w(M){I.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(2,y=M.detail.relay),t(1,p=void 0),t(3,g=void 0),t(20,m=Ti)}function E(M){I.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(1,p=M.detail.folder),t(3,g=M.detail.remoteFolder),t(2,y=M.detail.relay),t(20,m=Cf)}function F(M){I.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(1,p=void 0),t(3,g=M.detail.remoteFolder),t(2,y=M.detail.relay),t(20,m=Ef)}function U(M){return Ae(this,void 0,void 0,function*(){try{I.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(2,y=yield n.relayManager.createRelay("")),t(20,m=Ti)}catch(G){dr(G,"Failed to create relay")}})}function V(M){if(M.detail.clear){I.length=0,t(2,y=void 0),t(1,p=void 0),t(3,g=void 0),t(20,m=Go);return}let G=I.pop();if(G)for(;G;){if(!G.currentRelay&&!G.sharedFolder&&!G.remoteFolder)t(2,y=G.currentRelay),t(1,p=G.sharedFolder),t(3,g=G.remoteFolder),t(20,m=G.component);else if(G.sharedFolder&&d.has(G.sharedFolder)){t(2,y=G.currentRelay),t(1,p=G.sharedFolder),t(3,g=G.remoteFolder),t(20,m=G.component);break}else if(G.remoteFolder){t(2,y=G.currentRelay),t(1,p=G.sharedFolder),t(3,g=G.remoteFolder),t(20,m=G.component);break}else if(G.currentRelay&&a.relays.get(G.currentRelay.id)){t(2,y=G.currentRelay),t(1,p=G.sharedFolder),t(3,g=G.remoteFolder),t(20,m=G.component);break}G=I.pop()}else t(2,y=void 0),t(1,p=void 0),t(3,g=void 0),t(20,m=Go)}function P(M){I.length=0,L()}function $(M){t(2,y=M.detail.relay),t(20,m=Ti)}function re(){var M;!((M=n.networkStatus.status)===null||M===void 0)&&M.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let W=()=>{var M,G;(M=n.networkStatus.status)!=null&&M.versions?re():(G=n.networkStatus.status)!=null&&G.link&&window.open(n.networkStatus.status.link)},q=()=>{var M,G;(M=n.networkStatus.status)!=null&&M.versions?re():(G=n.networkStatus.status)!=null&&G.link&&window.open(n.networkStatus.status.link)};return o.$$set=M=>{"plugin"in M&&t(0,n=M.plugin),"path"in M&&t(18,s=M.path),"close"in M&&t(19,L=M.close)},o.$$.update=()=>{o.$$.dirty&262144&&s&&C(s),o.$$.dirty&2097156&&y&&!r.has(y.id)&&(t(2,y=void 0),t(20,m=Go)),o.$$.dirty&2&&p&&!d.has(p)&&(t(1,p=void 0),t(3,g=void 0),t(20,m=Go)),o.$$.dirty&1048590&&(m||y||p||g)&&setTimeout(()=>{let M=document.querySelector(".vertical-tab-content");M&&(M.scrollTop=0)},0)},[n,p,y,g,a,l,c,f,u,d,w,E,F,U,V,P,$,re,s,L,m,r,W,q]}var Gh=class extends Z{constructor(e){super(),ee(this,e,hM,mM,X,{plugin:0,path:18,close:19},sM)}},X_=Gh;var Tf=class extends Z_.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;this.targetEl=e.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new X_({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(e){var t;(t=this.component)==null||t.$set({path:e})}hide(){var e;try{(e=this.component)==null||e.$destroy()}catch(t){console.warn(t)}}destroy(){this.hide(),this.plugin=null}};var a1=require("obsidian");function gM(o){Ee(o,"svelte-74c8lg",".endpoint-config-modal.svelte-74c8lg.svelte-74c8lg{padding:0}.tenant-list-section.svelte-74c8lg.svelte-74c8lg{margin:16px 0}.tenant-card.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;justify-content:space-between;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.tenant-card.svelte-74c8lg.svelte-74c8lg:hover{background:var(--background-modifier-hover)}.tenant-card.active.svelte-74c8lg.svelte-74c8lg{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.tenant-info.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:12px;flex:1}.tenant-logo.svelte-74c8lg.svelte-74c8lg{width:4em;height:4em;object-fit:contain;border-radius:4px;background:var(--background-secondary);padding:4px}.tenant-details.svelte-74c8lg.svelte-74c8lg{flex:1}.tenant-name.svelte-74c8lg.svelte-74c8lg{font-weight:500;color:var(--text-normal);margin-bottom:2px}.tenant-url.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.tenant-env.svelte-74c8lg.svelte-74c8lg{font-size:0.8em;color:var(--text-faint);text-transform:capitalize}.tenant-actions.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:8px}.add-tenant-container.svelte-74c8lg.svelte-74c8lg{display:flex;gap:8px;align-items:center}.endpoint-url-input.svelte-74c8lg.svelte-74c8lg{flex:1;padding:6px 12px;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);color:var(--text-normal)}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg{border-color:var(--text-error) !important;box-shadow:0 0 0 1px var(--text-error) !important;transition:border-color 0.3s ease, box-shadow 0.3s ease}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg:focus{border-color:var(--text-error) !important;box-shadow:0 0 0 2px var(--text-error) !important}.add-tenant-container.svelte-74c8lg button.mod-cta.svelte-74c8lg{background:var(--interactive-accent);color:var(--text-on-accent);padding:6px 12px;white-space:nowrap}.error-banner.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;justify-content:space-between;margin:12px 0;padding:10px 12px;background-color:rgba(255, 0, 0, 0.1);color:var(--text-normal);border:1px solid rgba(255, 0, 0, 0.3);border-radius:var(--radius-s);animation:svelte-74c8lg-error-slide-in 0.3s ease-out}.error-content.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;gap:8px;flex:1}.error-icon.svelte-74c8lg.svelte-74c8lg{font-size:1em;line-height:1.2;margin-top:2px}.error-text.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;line-height:1.4;color:var(--text-normal)}.error-dismiss.svelte-74c8lg.svelte-74c8lg{background:none;border:none;color:var(--text-muted);font-size:1.2em;font-weight:normal;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s ease;opacity:0.6}.error-dismiss.svelte-74c8lg.svelte-74c8lg:hover{opacity:1}@keyframes svelte-74c8lg-error-slide-in{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}.apply-section.svelte-74c8lg.svelte-74c8lg{display:flex;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid var(--background-modifier-border)}.apply-btn.svelte-74c8lg.svelte-74c8lg{padding:8px 20px;font-size:0.9em}")}function e1(o,e,t){let r=o.slice();return r[32]=e[t],r}function yM(o){let e,t,r,n,s,i=o[5]?"Adding...":"Add Tenant",a,l,c,f;return{c(){e=x("div"),t=x("input"),n=T(),s=x("button"),a=K(i),h(t,"type","text"),h(t,"placeholder","https://auth.example.com"),h(t,"class","endpoint-url-input svelte-74c8lg"),h(t,"title",r=o[6].error),Te(t,"endpoint-input-invalid",!o[6].isValid||o[2]),h(s,"class","mod-cta svelte-74c8lg"),s.disabled=l=o[5]||!o[0].trim()||!o[6].isValid,h(e,"class","add-tenant-container svelte-74c8lg")},m(u,d){S(u,e,d),b(e,t),Ke(t,o[0]),b(e,n),b(e,s),b(s,a),c||(f=[j(t,"input",o[20]),j(s,"click",o[12])],c=!0)},p(u,d){d[0]&64&&r!==(r=u[6].error)&&h(t,"title",r),d[0]&1&&t.value!==u[0]&&Ke(t,u[0]),d[0]&68&&Te(t,"endpoint-input-invalid",!u[6].isValid||u[2]),d[0]&32&&i!==(i=u[5]?"Adding...":"Add Tenant")&&te(a,i),d[0]&97&&l!==(l=u[5]||!u[0].trim()||!u[6].isValid)&&(s.disabled=l)},d(u){u&&_(e),c=!1,xe(f)}}}function t1(o){let e,t,r,n,s,i,a,l,c,f;return{c(){e=x("div"),t=x("div"),r=x("span"),r.textContent="\u26A0\uFE0F",n=T(),s=x("span"),i=K(o[1]),a=T(),l=x("button"),l.textContent="\xD7",h(r,"class","error-icon svelte-74c8lg"),h(s,"class","error-text svelte-74c8lg"),h(t,"class","error-content svelte-74c8lg"),h(l,"class","error-dismiss svelte-74c8lg"),h(l,"title","Dismiss error"),h(e,"class","error-banner svelte-74c8lg")},m(u,d){S(u,e,d),b(e,t),b(t,r),b(t,n),b(t,s),b(s,i),b(e,a),b(e,l),c||(f=j(l,"click",o[11]),c=!0)},p(u,d){d[0]&2&&te(i,u[1])},d(u){u&&_(e),c=!1,f()}}}function r1(o){let e,t,r;return{c(){e=x("img"),Tr(e.src,t=o[8].logo)||h(e,"src",t),h(e,"alt",r=o[8].customer||"Default Tenant"),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){S(n,e,s)},p(n,s){s[0]&256&&!Tr(e.src,t=n[8].logo)&&h(e,"src",t),s[0]&256&&r!==(r=n[8].customer||"Default Tenant")&&h(e,"alt",r)},d(n){n&&_(e)}}}function o1(o){let e,t,r;return{c(){e=x("img"),Tr(e.src,t=o[32].logo)||h(e,"src",t),h(e,"alt",r=o[32].name),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){S(n,e,s)},p(n,s){s[0]&16&&!Tr(e.src,t=n[32].logo)&&h(e,"src",t),s[0]&16&&r!==(r=n[32].name)&&h(e,"alt",r)},d(n){n&&_(e)}}}function n1(o){let e,t=o[32].environment+"",r;return{c(){e=x("div"),r=K(t),h(e,"class","tenant-env svelte-74c8lg")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s[0]&16&&t!==(t=n[32].environment+"")&&te(r,t)},d(n){n&&_(e)}}}function s1(o,e){let t,r,n,s,i,a=e[32].name+"",l,c,f,u=e[32].tenantUrl+"",d,p,m,y,g,I,L,C,w=e[32].logo&&o1(e),E=e[32].environment&&n1(e);function F(){return e[22](e[32])}function U(){return e[23](e[32])}function V(...P){return e[24](e[32],...P)}return{key:o,first:null,c(){t=x("div"),r=x("div"),w&&w.c(),n=T(),s=x("div"),i=x("div"),l=K(a),c=T(),f=x("div"),d=K(u),p=T(),E&&E.c(),m=T(),y=x("div"),g=x("button"),g.textContent="Remove",I=T(),h(i,"class","tenant-name svelte-74c8lg"),h(f,"class","tenant-url svelte-74c8lg"),h(s,"class","tenant-details svelte-74c8lg"),h(r,"class","tenant-info svelte-74c8lg"),h(g,"class","mod-destructive"),h(g,"title","Remove this tenant"),h(y,"class","tenant-actions svelte-74c8lg"),h(t,"class","tenant-card svelte-74c8lg"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to switch to this tenant"),Te(t,"active",e[32].id===e[3]),this.first=t},m(P,$){S(P,t,$),b(t,r),w&&w.m(r,null),b(r,n),b(r,s),b(s,i),b(i,l),b(s,c),b(s,f),b(f,d),b(s,p),E&&E.m(s,null),b(t,m),b(t,y),b(y,g),b(t,I),L||(C=[j(g,"click",Uc(F)),j(t,"click",U),j(t,"keydown",V)],L=!0)},p(P,$){e=P,e[32].logo?w?w.p(e,$):(w=o1(e),w.c(),w.m(r,n)):w&&(w.d(1),w=null),$[0]&16&&a!==(a=e[32].name+"")&&te(l,a),$[0]&16&&u!==(u=e[32].tenantUrl+"")&&te(d,u),e[32].environment?E?E.p(e,$):(E=n1(e),E.c(),E.m(s,null)):E&&(E.d(1),E=null),$[0]&24&&Te(t,"active",e[32].id===e[3])},d(P){P&&_(t),w&&w.d(),E&&E.d(),L=!1,xe(C)}}}function bM(o){var se,pe,Fe;let e,t,r,n,s,i=o[1]&&o[1].trim(),a,l,c,f,u,d,p,m,y,g,I=(((se=o[8])==null?void 0:se.customer)||"Default Tenant")+"",L,C,w,E,F,U=(((pe=o[8])==null?void 0:pe.environment)||o[10].environment)+"",V,P,$,re,W=[],q=new Map,M,G,B,Q,N,O;n=new $e({props:{name:"Add Enterprise Tenant",description:"Enter your organization's tenant URL",$$slots:{default:[yM]},$$scope:{ctx:o}}});let J=i&&t1(o),oe=((Fe=o[8])==null?void 0:Fe.logo)&&r1(o),me=Se(o[4]),he=ye=>ye[32].id;for(let ye=0;ye<me.length;ye+=1){let Ue=e1(o,me,ye),He=he(Ue);q.set(He,W[ye]=s1(He,Ue))}return{c(){e=x("div"),t=x("div"),t.innerHTML="<p>Manage your organization&#39;s enterprise Relay tenants. Add tenants to switch between different enterprise deployments.</p>",r=T(),D(n.$$.fragment),s=T(),J&&J.c(),a=T(),l=x("div"),c=x("div"),c.textContent="Available Tenants",f=T(),u=x("div"),d=x("div"),p=x("div"),oe&&oe.c(),m=T(),y=x("div"),g=x("div"),L=K(I),C=T(),w=x("div"),w.textContent=`${o[10].authUrl}`,E=T(),F=x("div"),V=K(U),P=T(),$=x("div"),$.innerHTML="",re=T();for(let ye=0;ye<W.length;ye+=1)W[ye].c();M=T(),G=x("div"),B=x("button"),B.textContent="Apply",h(t,"class","setting-item-description"),le(t,"margin-bottom","16px"),h(c,"class","setting-item-name"),h(g,"class","tenant-name svelte-74c8lg"),h(w,"class","tenant-url svelte-74c8lg"),h(F,"class","tenant-env svelte-74c8lg"),h(y,"class","tenant-details svelte-74c8lg"),h(p,"class","tenant-info svelte-74c8lg"),h($,"class","tenant-actions svelte-74c8lg"),h(d,"class","tenant-card svelte-74c8lg"),h(d,"role","button"),h(d,"tabindex","0"),h(d,"title","Click to use default tenant"),Te(d,"active",!o[3]),h(u,"class","tenant-list"),h(l,"class","tenant-list-section svelte-74c8lg"),h(B,"class","mod-cta apply-btn svelte-74c8lg"),h(G,"class","apply-section svelte-74c8lg"),h(e,"class","endpoint-config-modal svelte-74c8lg")},m(ye,Ue){S(ye,e,Ue),b(e,t),b(e,r),A(n,e,null),b(e,s),J&&J.m(e,null),b(e,a),b(e,l),b(l,c),b(l,f),b(l,u),b(u,d),b(d,p),oe&&oe.m(p,null),b(p,m),b(p,y),b(y,g),b(g,L),b(y,C),b(y,w),b(y,E),b(y,F),b(F,V),b(d,P),b(d,$),b(u,re);for(let He=0;He<W.length;He+=1)W[He]&&W[He].m(u,null);b(e,M),b(e,G),b(G,B),Q=!0,N||(O=[j(d,"click",o[15]),j(d,"keydown",o[21]),j(B,"click",o[25])],N=!0)},p(ye,Ue){var Qe,rt,Ft;let He={};Ue[0]&101|Ue[1]&16&&(He.$$scope={dirty:Ue,ctx:ye}),n.$set(He),Ue[0]&2&&(i=ye[1]&&ye[1].trim()),i?J?J.p(ye,Ue):(J=t1(ye),J.c(),J.m(e,a)):J&&(J.d(1),J=null),(Qe=ye[8])!=null&&Qe.logo?oe?oe.p(ye,Ue):(oe=r1(ye),oe.c(),oe.m(p,m)):oe&&(oe.d(1),oe=null),(!Q||Ue[0]&256)&&I!==(I=(((rt=ye[8])==null?void 0:rt.customer)||"Default Tenant")+"")&&te(L,I),(!Q||Ue[0]&256)&&U!==(U=(((Ft=ye[8])==null?void 0:Ft.environment)||ye[10].environment)+"")&&te(V,U),(!Q||Ue[0]&8)&&Te(d,"active",!ye[3]),Ue[0]&24600&&(me=Se(ye[4]),W=pn(W,Ue,he,1,ye,me,q,u,Nc,s1,null,e1))},i(ye){Q||(v(n.$$.fragment,ye),Q=!0)},o(ye){k(n.$$.fragment,ye),Q=!1},d(ye){ye&&_(e),R(n),J&&J.d(),oe&&oe.d();for(let Ue=0;Ue<W.length;Ue+=1)W[Ue].d();N=!1,xe(O)}}}function vM(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=it(),f="",u=!1,d={isValid:!0,error:""},p="",m=!1,y="",g=!1,I=0,L=l.loginManager.getEndpointManager().getDefaultUrls(),C=null;function w(){t(18,I++,I)}function E(){t(1,p=""),t(2,m=!1)}function F(O){if(!O.trim())return{isValid:!0,error:""};try{let J=new URL(O);if(l.loginManager.getEndpointManager().isStaging()){if(J.protocol!=="https:"&&J.protocol!=="http:")return{isValid:!1,error:"Only HTTP and HTTPS URLs are allowed in development"}}else if(J.protocol!=="https:")return{isValid:!1,error:"Only HTTPS URLs are allowed in production"};return J.hostname.length<3?{isValid:!1,error:"Invalid hostname"}:{isValid:!0,error:""}}catch(J){return{isValid:!1,error:"Invalid URL format"}}}function U(){return Ae(this,void 0,void 0,function*(){if(f.trim()&&d.isValid){t(5,u=!0);try{let O=yield l.loginManager.getEndpointManager().addTenant(f);O.success?(t(0,f=""),t(1,p=""),t(2,m=!1),w(),t(7,g=!0),O.tenantId&&(yield V(O.tenantId))):(console.log("Add tenant failed with error:",O.error),t(1,p=O.error||"Failed to add tenant"),t(2,m=!0),w())}catch(O){let J=O instanceof Error?O.message:"Unknown error occurred";t(1,p=`Error adding tenant: ${J}`),t(2,m=!0)}finally{t(5,u=!1)}}})}function V(O){return Ae(this,void 0,void 0,function*(){try{let J=yield l.loginManager.getEndpointManager().switchToTenant(O);J.success?(t(7,g=!0),w()):t(1,p=J.error||"Failed to switch tenant")}catch(J){let oe=J instanceof Error?J.message:"Unknown error occurred";t(1,p=`Error switching tenant: ${oe}`)}})}function P(O){return Ae(this,void 0,void 0,function*(){try{(yield l.loginManager.getEndpointManager().removeTenant(O))?(t(7,g=!0),w()):t(1,p="Failed to remove tenant")}catch(J){let oe=J instanceof Error?J.message:"Unknown error occurred";t(1,p=`Error removing tenant: ${oe}`)}})}function $(){return Ae(this,void 0,void 0,function*(){yield l.endpointSettings.update(O=>Object.assign(Object.assign({},O),{activeTenantId:void 0})),l.loginManager.getEndpointManager().clearValidatedEndpoints(),t(7,g=!0),w()})}function re(){return Ae(this,void 0,void 0,function*(){try{return yield l.loginManager.getEndpointManager().getCustomerInfo()}catch(O){return null}})}function W(){return Ae(this,void 0,void 0,function*(){try{let O=l.loginManager.getEndpointManager();t(8,C=yield O.getDefaultTenantInfo())}catch(O){console.log("Failed to load default tenant info:",O),t(8,C=null)}})}dt(()=>{W()});function q(){f=this.value,t(0,f)}let M=O=>O.key==="Enter"||O.key===" "?$():null,G=O=>P(O.id),B=O=>V(O.id),Q=(O,J)=>J.key==="Enter"||J.key===" "?V(O.id):null,N=()=>{c(g?"apply":"close")};return o.$$set=O=>{"plugin"in O&&t(16,l=O.plugin)},o.$$.update=()=>{o.$$.dirty[0]&327680&&t(19,r=l.endpointSettings.get()),o.$$.dirty[0]&524288&&t(4,n=r.tenants||[]),o.$$.dirty[0]&524288&&t(3,s=r.activeTenantId),o.$$.dirty[0]&24&&(i=n.find(O=>O.id===s)),o.$$.dirty[0]&65536&&(a=l.loginManager.getEndpointManager().hasValidatedEndpoints()),o.$$.dirty[0]&131079&&(t(6,d=F(f)),f!==y&&y!==""&&(m&&t(2,m=!1),p&&t(1,p="")),t(17,y=f))},[f,p,m,s,n,u,d,g,C,c,L,E,U,V,P,$,l,y,I,r,q,M,G,B,Q,N]}var Jh=class extends Z{constructor(e){super(),ee(this,e,vM,bM,X,{plugin:16},gM,[-1,-1])}},i1=Jh;var Ff=class extends a1.Modal{constructor(t,r,n){super(t);this.plugin=r;this.reload=n;this.setTitle("Enterprise Tenant Configuration")}onOpen(){let{contentEl:t}=this;this.component=new i1({target:t,props:{plugin:this.plugin,reload:this.reload}}),this.component.$on("close",()=>{this.close()}),this.component.$on("apply",()=>{this.close(),setTimeout(()=>{this.reload()},100)})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var v0=require("obsidian");var d1=require("obsidian");var f1=require("obsidian");function xM(o){Ee(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function l1(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function c1(o){let e,t,r,n=o[8]+"",s,i,a,l,c=o[8]+"",f,u,d,p,m,y,g,I,L,C,w,E;function F(){return o[6](o[8])}function U(){return o[7](o[8])}return{c(){e=x("div"),t=x("div"),r=x("div"),s=K(n),i=T(),a=x("div"),l=K("Toggle "),f=K(c),u=K(" on or off"),d=T(),p=x("div"),m=x("div"),y=x("input"),I=T(),L=x("div"),h(r,"class","setting-item-name"),h(a,"class","setting-item-description"),h(t,"class","setting-item-info"),h(y,"type","checkbox"),h(y,"tabindex","-1"),y.checked=g=o[9],h(L,"class","checkbox-toggle"),h(m,"role","checkbox"),h(m,"aria-checked",C=o[9]),h(m,"tabindex","0"),h(m,"class","checkbox-container svelte-4kkvmr"),Te(m,"is-enabled",o[9]),h(p,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(V,P){S(V,e,P),b(e,t),b(t,r),b(r,s),b(t,i),b(t,a),b(a,l),b(a,f),b(a,u),b(e,d),b(e,p),b(p,m),b(m,y),b(m,I),b(m,L),w||(E=[j(m,"keypress",F),j(m,"click",U)],w=!0)},p(V,P){o=V,P&2&&n!==(n=o[8]+"")&&te(s,n),P&2&&c!==(c=o[8]+"")&&te(f,c),P&2&&g!==(g=o[9])&&(y.checked=g),P&2&&C!==(C=o[9])&&h(m,"aria-checked",C),P&2&&Te(m,"is-enabled",o[9])},d(V){V&&_(e),w=!1,xe(E)}}}function wM(o){let e,t,r,n,s,i,a,l,c,f=Se(Object.entries(o[1]).filter(o[5]).sort()),u=[];for(let d=0;d<f.length;d+=1)u[d]=c1(l1(o,f,d));return{c(){e=x("div"),t=x("h2"),t.textContent="Feature Flags",r=T();for(let d=0;d<u.length;d+=1)u[d].c();n=T(),s=x("div"),i=x("div"),a=x("button"),a.textContent="Apply",h(a,"aria-label","apply flag settings"),h(a,"tabindex","0"),h(i,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,p){S(d,e,p),b(e,t),b(e,r);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(e,null);b(e,n),b(e,s),b(s,i),b(i,a),l||(c=[j(a,"click",function(){nt(o[0])&&o[0].apply(this,arguments)}),j(a,"keypress",function(){nt(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[p]){if(o=d,p&10){f=Se(Object.entries(o[1]).filter(o[5]).sort());let m;for(m=0;m<f.length;m+=1){let y=l1(o,f,m);u[m]?u[m].p(y,p):(u[m]=c1(y),u[m].c(),u[m].m(e,n))}for(;m<u.length;m+=1)u[m].d(1);u.length=f.length}},i:z,o:z,d(d){d&&_(e),Je(u,d),l=!1,xe(c)}}}function _M(o,e,t){let r,n,{reload:s}=e,i=Ir.getInstance();de(o,i,u=>t(4,n=u));function a(u){let d=!r[u];t(1,r[u]=d,r),i.setFlag(u,r[u])}dt(()=>{Object.keys(r).forEach(u=>{let d=document.getElementById(`toggle-${u}`);d&&(0,f1.setIcon)(d,"check")})});let l=([u,d])=>Kl(u),c=u=>{if(!Kl(u))throw new Error("Unexpected feature flag!");a(u)},f=u=>{if(!Kl(u))throw new Error("Unexpected feature flag!");a(u)};return o.$$set=u=>{"reload"in u&&t(0,s=u.reload)},o.$$.update=()=>{o.$$.dirty&16&&t(1,r=Object.assign({},n.flags))},[s,r,i,a,n,l,c,f]}var Qh=class extends Z{constructor(e){super(),ee(this,e,_M,wM,X,{reload:0},xM)}},u1=Qh;var Pf=class extends d1.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new u1({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var _1=require("obsidian");var x1=require("obsidian");function p1(o,e,t){let r=o.slice();return r[13]=e[t],r}function m1(o,e,t){let r=o.slice();return r[16]=e[t],r}function SM(o){let e,t,r;return{c(){e=x("button"),e.textContent="Refresh"},m(n,s){S(n,e,s),t||(r=j(e,"click",(0,x1.debounce)(o[12])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function kM(o){let e=navigator.userAgent+"",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p:z,d(r){r&&_(t)}}}function IM(o){let e;return{c(){e=K(o[1])},m(t,r){S(t,e,r)},p(t,r){r&2&&te(e,t[1])},d(t){t&&_(e)}}}function CM(o){let e;return{c(){e=K(o[2])},m(t,r){S(t,e,r)},p(t,r){r&4&&te(e,t[2])},d(t){t&&_(e)}}}function LM(o){let e;return{c(){e=K(o[3])},m(t,r){S(t,e,r)},p(t,r){r&8&&te(e,t[3])},d(t){t&&_(e)}}}function EM(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=K(e)},m(r,n){S(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&te(t,e)},d(r){r&&_(t)}}}function TM(o){let e,t,r,n,s,i,a,l,c,f;return e=new $e({props:{name:"User Agent",description:"",$$slots:{default:[kM]},$$scope:{ctx:o}}}),r=new $e({props:{name:"Fetch",description:"",$$slots:{default:[IM]},$$scope:{ctx:o}}}),s=new $e({props:{name:"Response",description:"",$$slots:{default:[CM]},$$scope:{ctx:o}}}),a=new $e({props:{name:"Blink Fetch",description:"",$$slots:{default:[LM]},$$scope:{ctx:o}}}),c=new $e({props:{name:"Startup Time",description:"",$$slots:{default:[EM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=T(),D(r.$$.fragment),n=T(),D(s.$$.fragment),i=T(),D(a.$$.fragment),l=T(),D(c.$$.fragment)},m(u,d){A(e,u,d),S(u,t,d),A(r,u,d),S(u,n,d),A(s,u,d),S(u,i,d),A(a,u,d),S(u,l,d),A(c,u,d),f=!0},p(u,d){let p={};d&524288&&(p.$$scope={dirty:d,ctx:u}),e.$set(p);let m={};d&524290&&(m.$$scope={dirty:d,ctx:u}),r.$set(m);let y={};d&524292&&(y.$$scope={dirty:d,ctx:u}),s.$set(y);let g={};d&524296&&(g.$$scope={dirty:d,ctx:u}),a.$set(g);let I={};d&524289&&(I.$$scope={dirty:d,ctx:u}),c.$set(I)},i(u){f||(v(e.$$.fragment,u),v(r.$$.fragment,u),v(s.$$.fragment,u),v(a.$$.fragment,u),v(c.$$.fragment,u),f=!0)},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),k(s.$$.fragment,u),k(a.$$.fragment,u),k(c.$$.fragment,u),f=!1},d(u){u&&(_(t),_(n),_(i),_(l)),R(e,u),R(r,u),R(s,u),R(a,u),R(c,u)}}}function h1(o){let e,t=`${o[16]}`,r,n;return{c(){e=x("div"),r=K(t),n=T()},m(s,i){S(s,e,i),b(e,r),b(e,n)},p(s,i){i&16&&t!==(t=`${s[16]}`)&&te(r,t)},d(s){s&&_(e)}}}function FM(o){let e,t=Se(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=h1(m1(o,t,n));return{c(){e=x("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){S(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&16){t=Se(Object.keys(n[4].cancelControllers));let i;for(i=0;i<t.length;i+=1){let a=m1(n,t,i);r[i]?r[i].p(a,s):(r[i]=h1(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function PM(o){let e,t;return e=new $e({props:{name:"",description:"",$$slots:{description:[FM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&524304&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function g1(o){let e,t=`${o[13]}`,r,n;return{c(){e=x("div"),r=K(t),n=T()},m(s,i){S(s,e,i),b(e,r),b(e,n)},p(s,i){i&32&&t!==(t=`${s[13]}`)&&te(r,t)},d(s){s&&_(e)}}}function AM(o){let e,t=Se(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=g1(p1(o,t,n));return{c(){e=x("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){S(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=Se(n[5]);let i;for(i=0;i<t.length;i+=1){let a=p1(n,t,i);r[i]?r[i].p(a,s):(r[i]=g1(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function RM(o){let e,t;return e=new $e({props:{name:"",description:"",$$slots:{description:[AM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&524320&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function MM(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y;return n=new Ze({props:{name:"Environment",$$slots:{default:[SM]},$$scope:{ctx:o}}}),i=new St({props:{$$slots:{default:[TM]},$$scope:{ctx:o}}}),l=new Ze({props:{name:"Connections"}}),f=new St({props:{$$slots:{default:[PM]},$$scope:{ctx:o}}}),d=new Ze({props:{name:"Log Files"}}),m=new St({props:{$$slots:{default:[RM]},$$scope:{ctx:o}}}),{c(){e=x("div"),e.textContent="Debug Info",t=T(),r=x("div"),D(n.$$.fragment),s=T(),D(i.$$.fragment),a=T(),D(l.$$.fragment),c=T(),D(f.$$.fragment),u=T(),D(d.$$.fragment),p=T(),D(m.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(g,I){S(g,e,I),S(g,t,I),S(g,r,I),A(n,r,null),b(r,s),A(i,r,null),b(r,a),A(l,r,null),b(r,c),A(f,r,null),b(r,u),A(d,r,null),b(r,p),A(m,r,null),y=!0},p(g,[I]){let L={};I&524288&&(L.$$scope={dirty:I,ctx:g}),n.$set(L);let C={};I&524303&&(C.$$scope={dirty:I,ctx:g}),i.$set(C);let w={};I&524304&&(w.$$scope={dirty:I,ctx:g}),f.$set(w);let E={};I&524320&&(E.$$scope={dirty:I,ctx:g}),m.$set(E)},i(g){y||(v(n.$$.fragment,g),v(i.$$.fragment,g),v(l.$$.fragment,g),v(f.$$.fragment,g),v(d.$$.fragment,g),v(m.$$.fragment,g),y=!0)},o(g){k(n.$$.fragment,g),k(i.$$.fragment,g),k(l.$$.fragment,g),k(f.$$.fragment,g),k(d.$$.fragment,g),k(m.$$.fragment,g),y=!1},d(g){g&&(_(e),_(t),_(r)),R(n),R(i),R(l),R(f),R(d),R(m)}}}function y1(){try{return Response.toString()}catch(o){return"undefined"}}function b1(){try{return fetch.toString()}catch(o){return"undefined"}}function v1(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function DM(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=we(y1());de(o,c,g=>t(2,n=g));let f=we(b1());de(o,f,g=>t(1,r=g));let u=we(v1());de(o,u,g=>t(3,s=g));let d=we(l.loginManager.pb);de(o,d,g=>t(4,i=g));let p=we([]);de(o,p,g=>t(5,a=g)),ql().then(g=>{p.set(g)});function m(){c.set(y1()),f.set(b1()),u.set(v1()),d.set(l.loginManager.pb)}let y=()=>{m()};return o.$$set=g=>{"plugin"in g&&t(0,l=g.plugin)},[l,r,n,s,i,a,c,f,u,d,p,m,y]}var Yh=class extends Z{constructor(e){super(),ee(this,e,DM,MM,X,{plugin:0})}},w1=Yh;var Af=class extends _1.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new w1({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var S1=require("obsidian"),Rf=class{notify(e){new S1.Notice(e)}},Mf=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var A1=require("obsidian");var F1=require("obsidian");function UM(o){Ee(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function k1(o,e,t){let r=o.slice();return r[21]=e[t],r}function OM(o){let e,t,r,n,s,i,a,l,c,f,u,d,p;r=new $e({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),a=new $e({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[VM]},$$scope:{ctx:o}}});let m=o[4]&&I1(o);return f=new $e({props:{name:"",description:"",$$slots:{default:[HM]},$$scope:{ctx:o}}}),{c(){e=x("div"),t=x("div"),D(r.$$.fragment),n=T(),s=x("textarea"),i=T(),D(a.$$.fragment),l=T(),m&&m.c(),c=T(),D(f.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(y,g){S(y,e,g),b(e,t),A(r,t,null),b(t,n),b(t,s),Ke(s,o[3]),b(t,i),A(a,t,null),b(t,l),m&&m.m(t,null),b(e,c),A(f,e,null),u=!0,d||(p=j(s,"input",o[13]),d=!0)},p(y,g){g&8&&Ke(s,y[3]);let I={};g&16777232&&(I.$$scope={dirty:g,ctx:y}),a.$set(I),y[4]?m?(m.p(y,g),g&16&&v(m,1)):(m=I1(y),m.c(),v(m,1),m.m(t,null)):m&&(ce(),k(m,1,1,()=>{m=null}),fe());let L={};g&16777293&&(L.$$scope={dirty:g,ctx:y}),f.$set(L)},i(y){u||(v(r.$$.fragment,y),v(a.$$.fragment,y),v(m),v(f.$$.fragment,y),u=!0)},o(y){k(r.$$.fragment,y),k(a.$$.fragment,y),k(m),k(f.$$.fragment,y),u=!1},d(y){y&&_(e),R(r),R(a),m&&m.d(),R(f),d=!1,p()}}}function $M(o){let e;return{c(){e=x("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){S(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function BM(o){let e,t,r;return t=new $e({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=x("div"),D(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){S(n,e,s),A(t,e,null),r=!0},p:z,i(n){r||(v(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function VM(o){let e,t,r,n,s,i;return{c(){e=x("div"),t=x("input"),r=T(),n=x("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Te(e,"is-enabled",o[4])},m(a,l){S(a,e,l),b(e,t),b(e,r),b(e,n),s||(i=[j(e,"keypress",WM),j(e,"click",o[14])],s=!0)},p(a,l){l&16&&(t.checked=a[4]),l&16&&h(e,"aria-checked",a[4]),l&16&&Te(e,"is-enabled",a[4])},d(a){a&&_(e),s=!1,xe(i)}}}function I1(o){let e,t;return e=new $e({props:{name:"Logs",description:"",$$slots:{description:[NM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function C1(o){let e,t=`${o[21]}
`,r,n;return{c(){e=x("div"),r=K(t),n=T()},m(s,i){S(s,e,i),b(e,r),b(e,n)},p(s,i){i&32&&t!==(t=`${s[21]}
`)&&te(r,t)},d(s){s&&_(e)}}}function NM(o){let e,t=Se(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=C1(k1(o,t,n));return{c(){e=x("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){S(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=Se(n[5]);let i;for(i=0;i<t.length;i+=1){let a=k1(n,t,i);r[i]?r[i].p(a,s):(r[i]=C1(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function HM(o){let e,t,r,n;return{c(){e=x("button"),t=K("Send"),e.disabled=o[2]},m(s,i){S(s,e,i),b(e,t),r||(n=j(e,"click",o[15]),r=!0)},p(s,i){i&4&&(e.disabled=s[2])},d(s){s&&_(e),r=!1,n()}}}function qM(o){let e,t,r,n,s,i,a=[BM,$M,OM],l=[];function c(f,u){return f[1]?0:f[2]&&!f[1]?1:2}return n=c(o,-1),s=l[n]=a[n](o),{c(){e=x("div"),e.textContent="Send Bug Report",t=T(),r=x("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(f,u){S(f,e,u),S(f,t,u),S(f,r,u),l[n].m(r,null),i=!0},p(f,[u]){let d=n;n=c(f,u),n===d?l[n].p(f,u):(ce(),k(l[d],1,1,()=>{l[d]=null}),fe(),s=l[n],s?s.p(f,u):(s=l[n]=a[n](f),s.c()),v(s,1),s.m(r,null))},i(f){i||(v(s),i=!0)},o(f){k(s),i=!1},d(f){f&&(_(e),_(t),_(r)),l[n].d()}}}function L1(){try{return Response.toString()}catch(o){return"undefined"}}function E1(){try{return fetch.toString()}catch(o){return"undefined"}}function T1(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var WM=()=>{};function jM(o,e,t){let r,n,s,i,a,l,{plugin:c}=e,f=we(L1()),u=we(E1()),d=we(T1()),p=we("");de(o,p,V=>t(3,s=V));let m=we(!1);de(o,m,V=>t(4,i=V));let y=we(!1),g=we(!1);de(o,g,V=>t(2,n=V));let I=we(!1);de(o,I,V=>t(1,r=V));let L=we(c.loginManager.pb);de(o,L,V=>t(6,l=V));let C=we([]);de(o,C,V=>t(5,a=V)),ql().then(V=>{C.set(V)});function w(){f.set(L1()),u.set(E1()),d.set(T1()),L.set(c.loginManager.pb)}function E(){s=this.value,p.set(s)}let F=()=>{let V=!i;m.set(V)},U=async()=>{var P;let V=`Bug Report

`;if(V+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(P=l==null?void 0:l.authStore.model)==null?void 0:P.id,loadTime:c.loadTime,description:s},null,2),V+=`

`,m){let $=await Rb();V+=$}(0,F1.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:V,headers:{"Content-Type":"text/plain"}}).then(()=>{I.set(!0)}),g.set(!0)};return o.$$set=V=>{"plugin"in V&&t(0,c=V.plugin)},[c,r,n,s,i,a,l,p,m,g,I,L,C,E,F,U]}var Xh=class extends Z{constructor(e){super(),ee(this,e,jM,qM,X,{plugin:0},UM)}},P1=Xh;var Df=class extends A1.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new P1({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var N1=require("obsidian");async function R1(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,i=[],a=0,l=0,c=0,f=0;for(let u of n)if(u.name){try{let d=await new Promise((p,m)=>{let y=indexedDB.open(u.name);y.onerror=()=>m(y.error),y.onsuccess=g=>p(g.target.result)});try{let p=Array.from(d.objectStoreNames);if(!p.includes("updates")||!p.includes("custom"))continue;let m=d.transaction(["updates","custom"],"readonly"),y=m.objectStore("updates"),g=m.objectStore("custom"),I=await new Promise(C=>{let w=g.get("appId");w.onsuccess=()=>C(w.result||"")});a++;let L=await new Promise((C,w)=>{let E=y.count();E.onsuccess=()=>C(E.result),E.onerror=()=>w(E.error)});if(l+=L,L>0){let C=0;if(await new Promise((w,E)=>{let F=y.openCursor();F.onsuccess=U=>{let V=U.target.result;if(V){let P=V.value instanceof Uint8Array?V.value.byteLength:JSON.stringify(V.value).length;C+=P,V.continue()}else w()},F.onerror=()=>E(F.error)}),c+=C,C>1024*1024&&(!t||I===e)){let w=await new Promise(U=>{let V=g.get("path");V.onsuccess=()=>U(V.result||"")}),E=await new Promise(U=>{let V=g.get("relay");V.onsuccess=()=>U(V.result||"")}),F=!u.name.startsWith(`${e}-relay`);i.push({slug:`${u.name}/${y.name}`,path:w,relay:E,appId:I||"unknown",count:L,estimatedSizeMB:Math.round(C/(1024*1024)*100)/100,isLegacy:F})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${u.name}:`,d);continue}f++,r&&r(f/n.length*100)}return{totalStores:a,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:i.sort((u,d)=>d.estimatedSizeMB-u.estimatedSizeMB)}}async function M1(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((i,a)=>{let l=s.clear();l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var ioe=require("obsidian");function zM(o){Ee(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function D1(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function U1(o,e,t){let r=o.slice();return r[22]=e[t],r}function KM(o){let e,t,r,n,s,i=o[0].databaseCount.toLocaleString()+"",a,l,c,f,u,d,p,m,y=o[0].totalStores+"",g,I,L,C,w,E,F=o[0].totalItems.toLocaleString()+"",U,V,P,$,re,W,q=o[0].totalSizeMB.toFixed(2)+"",M,G,B,Q,N;function O(he,se){if(he[0].databaseCount>45e3)return YM;if(he[0].databaseCount>4e4)return QM}let J=O(o,-1),oe=J&&J(o),me=o[0].largeStores.length>0&&O1(o);return{c(){e=x("div"),t=x("div"),r=x("div"),r.textContent="Global Database Limit",n=T(),s=x("div"),a=K(i),l=K(" / 50,000"),c=T(),oe&&oe.c(),f=T(),u=x("div"),d=x("div"),d.textContent="Relay Databases",p=T(),m=x("div"),g=K(y),I=T(),L=x("div"),C=x("div"),C.textContent="Document Updates",w=T(),E=x("div"),U=K(F),V=T(),P=x("div"),$=x("div"),$.textContent="Total Size",re=T(),W=x("div"),M=K(q),G=K(" MB"),B=T(),me&&me.c(),Q=ve(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Te(s,"system3-warning",o[0].databaseCount>4e4),Te(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(m,"class","system3-stat-value svelte-1n3w4sk"),h(u,"class","system3-stat-item svelte-1n3w4sk"),h(C,"class","system3-stat-label svelte-1n3w4sk"),h(E,"class","system3-stat-value svelte-1n3w4sk"),h(L,"class","system3-stat-item svelte-1n3w4sk"),h($,"class","system3-stat-label svelte-1n3w4sk"),h(W,"class","system3-stat-value svelte-1n3w4sk"),h(P,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(he,se){S(he,e,se),b(e,t),b(t,r),b(t,n),b(t,s),b(s,a),b(s,l),b(t,c),oe&&oe.m(t,null),b(e,f),b(e,u),b(u,d),b(u,p),b(u,m),b(m,g),b(e,I),b(e,L),b(L,C),b(L,w),b(L,E),b(E,U),b(e,V),b(e,P),b(P,$),b(P,re),b(P,W),b(W,M),b(W,G),S(he,B,se),me&&me.m(he,se),S(he,Q,se),N=!0},p(he,se){(!N||se&1)&&i!==(i=he[0].databaseCount.toLocaleString()+"")&&te(a,i),(!N||se&1)&&Te(s,"system3-warning",he[0].databaseCount>4e4),(!N||se&1)&&Te(s,"system3-critical",he[0].databaseCount>45e3),J!==(J=O(he,se))&&(oe&&oe.d(1),oe=J&&J(he),oe&&(oe.c(),oe.m(t,null))),(!N||se&1)&&y!==(y=he[0].totalStores+"")&&te(g,y),(!N||se&1)&&F!==(F=he[0].totalItems.toLocaleString()+"")&&te(U,F),(!N||se&1)&&q!==(q=he[0].totalSizeMB.toFixed(2)+"")&&te(M,q),he[0].largeStores.length>0?me?(me.p(he,se),se&1&&v(me,1)):(me=O1(he),me.c(),v(me,1),me.m(Q.parentNode,Q)):me&&(ce(),k(me,1,1,()=>{me=null}),fe())},i(he){N||(v(me),N=!0)},o(he){k(me),N=!1},d(he){he&&(_(e),_(B),_(Q)),oe&&oe.d(),me&&me.d(he)}}}function GM(o){let e,t;return{c(){e=x("div"),t=K(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){S(r,e,n),b(e,t)},p(r,n){n&32&&te(t,r[5])},i:z,o:z,d(r){r&&_(e)}}}function JM(o){let e,t,r,n,s,i,a;return{c(){e=x("div"),t=x("div"),r=T(),n=x("div"),n.textContent="Analyzing Databases...",s=T(),i=x("div"),a=x("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(a,"class","system3-progress-fill svelte-1n3w4sk"),le(a,"width",o[4]+"%"),h(i,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){S(l,e,c),b(e,t),b(e,r),b(e,n),b(e,s),b(e,i),b(i,a)},p(l,c){c&16&&le(a,"width",l[4]+"%")},i:z,o:z,d(l){l&&_(e)}}}function QM(o){let e;return{c(){e=x("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function YM(o){let e;return{c(){e=x("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function O1(o){let e,t,r,n;e=new Ze({props:{name:"Large Stores (>1MB)"}});let s=Se(o[2]),i=[];for(let l=0;l<s.length;l+=1)i[l]=B1(D1(o,s,l));let a=l=>k(i[l],1,1,()=>{i[l]=null});return{c(){D(e.$$.fragment),t=T();for(let l=0;l<i.length;l+=1)i[l].c();r=ve()},m(l,c){A(e,l,c),S(l,t,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,c);S(l,r,c),n=!0},p(l,c){if(c&2052){s=Se(l[2]);let f;for(f=0;f<s.length;f+=1){let u=D1(l,s,f);i[f]?(i[f].p(u,c),v(i[f],1)):(i[f]=B1(u),i[f].c(),v(i[f],1),i[f].m(r.parentNode,r))}for(ce(),f=s.length;f<i.length;f+=1)a(f);fe()}},i(l){if(!n){v(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)v(i[c]);n=!0}},o(l){k(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)k(i[c]);n=!1},d(l){l&&(_(t),_(r)),R(e,l),Je(i,l)}}}function XM(o){let e,t,r,n,s;function i(){return o[17](o[22])}return{c(){e=x("div"),t=x("button"),t.textContent="Delete",r=T(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(a,l){S(a,e,l),b(e,t),S(a,r,l),n||(s=j(t,"click",i),n=!0)},p(a,l){o=a},d(a){a&&(_(e),_(r)),n=!1,s()}}}function $1(o){let e,t;return e=new $e({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[XM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function B1(o){let e,t,r,n;e=new Ze({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=Se(o[19]),i=[];for(let l=0;l<s.length;l+=1)i[l]=$1(U1(o,s,l));let a=l=>k(i[l],1,1,()=>{i[l]=null});return{c(){D(e.$$.fragment),t=T();for(let l=0;l<i.length;l+=1)i[l].c();r=ve()},m(l,c){A(e,l,c),S(l,t,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,c);S(l,r,c),n=!0},p(l,c){let f={};if(c&4&&(f.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(f),c&2052){s=Se(l[19]);let u;for(u=0;u<s.length;u+=1){let d=U1(l,s,u);i[u]?(i[u].p(d,c),v(i[u],1)):(i[u]=$1(d),i[u].c(),v(i[u],1),i[u].m(r.parentNode,r))}for(ce(),u=s.length;u<i.length;u+=1)a(u);fe()}},i(l){if(!n){v(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)v(i[c]);n=!0}},o(l){k(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)k(i[c]);n=!1},d(l){l&&(_(t),_(r)),R(e,l),Je(i,l)}}}function ZM(o){let e,t,r,n,s,i,a,l,c,f,u,d,p,m,y,g,I,L=[JM,GM,KM],C=[];function w(E,F){return E[3]?0:E[5]?1:E[0]?2:-1}return~(p=w(o,-1))&&(m=C[p]=L[p](o)),{c(){e=x("div"),e.textContent="Relay database analysis",t=T(),r=x("div"),n=x("div"),s=x("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,i=T(),a=x("div"),l=x("div"),c=x("input"),f=T(),u=x("div"),d=T(),m&&m.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(u,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Te(l,"is-enabled",o[1]),h(a,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(E,F){S(E,e,F),S(E,t,F),S(E,r,F),b(r,n),b(n,s),b(n,i),b(n,a),b(a,l),b(l,c),b(l,f),b(l,u),b(r,d),~p&&C[p].m(r,null),y=!0,g||(I=[j(l,"keypress",o[15]),j(l,"click",o[16])],g=!0)},p(E,[F]){(!y||F&2)&&(c.checked=E[1]),(!y||F&2)&&h(l,"aria-checked",E[1]),(!y||F&2)&&Te(l,"is-enabled",E[1]);let U=p;p=w(E,F),p===U?~p&&C[p].p(E,F):(m&&(ce(),k(C[U],1,1,()=>{C[U]=null}),fe()),~p?(m=C[p],m?m.p(E,F):(m=C[p]=L[p](E),m.c()),v(m,1),m.m(r,null)):m=null)},i(E){y||(v(m),y=!0)},o(E){k(m),y=!1},d(E){E&&(_(e),_(t),_(r)),~p&&C[p].d(),g=!1,xe(I)}}}function eD(o,e,t){let r,n,s,i,a,l;var c;let{plugin:f}=e,u=we(!0);de(o,u,E=>t(3,i=E));let d=we(0);de(o,d,E=>t(4,a=E));let p=we(null);de(o,p,E=>t(0,s=E));let m=we(null);de(o,m,E=>t(5,l=E));let y=!1;function g(){return Ae(this,void 0,void 0,function*(){u.set(!0),m.set(null);try{let E=yield R1({appId:f.appId,filterByAppId:!y,onProgress:F=>d.set(F)});p.set(E)}catch(E){m.set(`Analysis failed: ${E.message}`)}finally{u.set(!1)}})}function I(E){return Ae(this,void 0,void 0,function*(){try{yield M1(E),s&&gi(p,s.largeStores=s.largeStores.filter(F=>F.slug!==E),s)}catch(F){m.set(`Failed to delete ${E}: ${F.message}`)}})}dt(()=>{g()});let L=()=>{t(1,y=!y),g()},C=()=>{t(1,y=!y),g()},w=E=>I(E.slug);return o.$$set=E=>{"plugin"in E&&t(12,f=E.plugin)},o.$$.update=()=>{o.$$.dirty&8193&&t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((E,F)=>{let U=F.relay||"local";return E[U]||(E[U]=[]),E[U].push(F),E},{}))!==null&&c!==void 0?c:{}),o.$$.dirty&16384&&t(2,n=Object.entries(r).sort(([E],[F])=>E==="local"?-1:F==="local"?1:E.localeCompare(F)))},[s,y,n,i,a,l,u,d,p,m,g,I,f,c,r,L,C,w]}var Zh=class extends Z{constructor(e){super(),ee(this,e,eD,ZM,X,{plugin:12},zM)}},V1=Zh;var Uf=class extends N1.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new V1({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var doe=require("obsidian");function eg(o){return o.startsWith("v")?o.slice(1):o}function tD(o,e){return o.map((t,r)=>[t,e[r]])}function rD(o,e){try{let t=eg(o).split(".").map(parseInt),r=eg(e).split(".").map(parseInt);for(let[n,s]of tD(t,r))if(n>s)return!0}catch(t){}return!1}var Of=class extends pt{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.observableName="UpdateManager";this.githubReleases=new sn("system3-relay/releases"),this.releaseChannels=new sn("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await mt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return ze().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await mt(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<300*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(a=>{this.githubReleases.set(a.tag_name,a),s.add(a.tag_name)}),n.forEach(a=>{s.has(a)||this.githubReleases.delete(a)});let i=await this.fetchLatestRelease();i&&(i.latest=!0,this.githubReleases.set(i.tag_name,i)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<300*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let i=await this.fetchLatestTagFromChannel(s);if(!i)return null;let a=n.find(l=>eg(l.tag_name)===i);return a?(this.releaseChannels.set(s,a),this.notifyListeners(),a):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let i=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${i}`);let a=await mt(i);if(!a.ok)throw new Error("unable to fetch manifest");return await a.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(i=>i.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await mt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return ze().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&rD(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var s0=require("obsidian");var o0=require("obsidian");function oD(o){Ee(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function H1(o,e,t){let r=o.slice();return r[66]=e[t],r}function q1(o){let e,t;return e=new ar({props:{name:"Show all releases",$$slots:{default:[nD]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function nD(o){let e,t,r,n,s,i;return{c(){e=x("div"),t=x("input"),r=T(),n=x("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Te(e,"is-enabled",o[6])},m(a,l){S(a,e,l),b(e,t),b(e,r),b(e,n),s||(i=[j(e,"click",o[41]),j(e,"keydown",o[42])],s=!0)},p(a,l){l[0]&64&&(t.checked=a[6]),l[0]&64&&h(e,"aria-checked",a[6]),l[0]&64&&Te(e,"is-enabled",a[6])},d(a){a&&_(e),s=!1,xe(i)}}}function sD(o){let e,t,r=!o[1]&&W1(o);function n(a,l){if(a[11])return fD;if(a[16])return cD}let s=n(o,[-1,-1,-1]),i=s&&s(o);return{c(){r&&r.c(),e=T(),i&&i.c(),t=ve()},m(a,l){r&&r.m(a,l),S(a,e,l),i&&i.m(a,l),S(a,t,l)},p(a,l){a[1]?r&&(r.d(1),r=null):r?r.p(a,l):(r=W1(a),r.c(),r.m(e.parentNode,e)),s===(s=n(a,l))&&i?i.p(a,l):(i&&i.d(1),i=s&&s(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(_(e),_(t)),r&&r.d(a),i&&i.d(a)}}}function iD(o){let e;return{c(){e=x("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function aD(o){let e;return{c(){e=x("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function lD(o){let e;return{c(){e=x("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function W1(o){let e,t,r,n=!o[8].some(o[40]),s,i=o[5]&&j1(o),a=o[4]&&z1(o),l=n&&K1(o),c=!o[1]&&G1(o);return{c(){e=x("div"),i&&i.c(),t=T(),a&&a.c(),r=T(),l&&l.c(),s=T(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(f,u){S(f,e,u),i&&i.m(e,null),b(e,t),a&&a.m(e,null),b(e,r),l&&l.m(e,null),b(e,s),c&&c.m(e,null)},p(f,u){f[5]?i?i.p(f,u):(i=j1(f),i.c(),i.m(e,t)):i&&(i.d(1),i=null),f[4]?a?a.p(f,u):(a=z1(f),a.c(),a.m(e,r)):a&&(a.d(1),a=null),u[0]&256&&(n=!f[8].some(f[40])),n?l?l.p(f,u):(l=K1(f),l.c(),l.m(e,s)):l&&(l.d(1),l=null),f[1]?c&&(c.d(1),c=null):c?c.p(f,u):(c=G1(f),c.c(),c.m(e,null))},d(f){f&&_(e),i&&i.d(),a&&a.d(),l&&l.d(),c&&c.d()}}}function j1(o){let e,t,r,n,s;return{c(){e=x("div"),t=x("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(i,a){S(i,e,a),b(e,t),n||(s=[j(e,"click",o[43]),j(e,"keydown",o[44])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="stable")&&h(e,"aria-selected",r)},d(i){i&&_(e),n=!1,xe(s)}}}function z1(o){let e,t,r,n,s;return{c(){e=x("div"),t=x("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(i,a){S(i,e,a),b(e,t),n||(s=[j(e,"click",o[45]),j(e,"keydown",o[46])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="beta")&&h(e,"aria-selected",r)},d(i){i&&_(e),n=!1,xe(s)}}}function K1(o){let e,t,r,n,s;return{c(){e=x("div"),t=x("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(i,a){S(i,e,a),b(e,t),n||(s=[j(e,"click",o[47]),j(e,"keydown",o[48])],n=!0)},p(i,a){a[0]&1025&&r!==(r=i[10]===i[0].version)&&h(e,"aria-selected",r)},d(i){i&&_(e),n=!1,xe(s)}}}function G1(o){let e,t=Se(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=J1(H1(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ve()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);S(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=Se(n[8]);let i;for(i=0;i<t.length;i+=1){let a=H1(n,t,i);r[i]?r[i].p(a,s):(r[i]=J1(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),Je(r,n)}}}function J1(o){let e,t,r=o[66].tag_name+"",n,s,i,a,l,c;function f(){return o[49](o[66])}function u(...d){return o[50](o[66],...d)}return{c(){e=x("div"),t=x("div"),n=K(r),s=T(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(r0(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",a=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,p){S(d,e,p),b(e,t),b(t,n),b(e,s),l||(c=[j(e,"click",f),j(e,"keydown",u)],l=!0)},p(d,p){o=d,p[0]&256&&r!==(r=o[66].tag_name+"")&&te(n,r),p[0]&256&&i!==(i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(r0(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",i),p[0]&1280&&a!==(a=o[10]===o[66].tag_name)&&h(e,"aria-selected",a)},d(d){d&&_(e),l=!1,xe(c)}}}function cD(o){let e,t,r,n,s,i,a;return{c(){e=x("div"),t=x("div"),r=K(o[16]),n=T(),s=x("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){S(l,e,c),b(e,t),b(t,r),b(e,n),b(e,s),i||(a=j(s,"click",o[37]),i=!0)},p(l,c){c[0]&65536&&te(r,l[16])},d(l){l&&_(e),i=!1,a()}}}function fD(o){var W;let e,t,r,n,s,i,a=(W=o[38](o[10]))==null?void 0:W.prerelease,l,c,f,u,d,p,m,y,g,I,L=a&&Q1(o),C=o[12][o[10]]==="beta-alias"&&Y1(o),w=o[12][o[10]]==="stable-alias"&&X1(o);function E(q,M){if(M[0]&9216&&(d=null),M[0]&1024&&(p=null),d==null&&(d=!!((q[38](q[10])||q[13][q[10]]==="stable-alias"||q[13][q[10]]==="beta-alias")&&!q[28](q[10]))),d)return dD;if(p==null&&(p=!!q[28](q[10])),p)return uD}let F=E(o,[-1,-1,-1]),U=F&&F(o);function V(q,M){return q[13][q[10]]==="stable-alias"||q[13][q[10]]==="beta-alias"||q[9]==="development"?yD:q[10]?gD:hD}let P=V(o,[-1,-1,-1]),$=P(o),re=o[15]&&Z1(o);return{c(){e=x("div"),t=x("div"),r=x("h3"),n=K("Release Details: "),s=K(o[10]),i=T(),L&&L.c(),l=T(),C&&C.c(),c=T(),w&&w.c(),f=T(),u=x("div"),U&&U.c(),m=T(),y=x("div"),g=x("div"),$.c(),I=T(),re&&re.c(),h(r,"class","svelte-12doke6"),h(u,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(g,"class","release-changelog-content svelte-12doke6"),h(y,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(q,M){S(q,e,M),b(e,t),b(t,r),b(r,n),b(r,s),b(r,i),L&&L.m(r,null),b(r,l),C&&C.m(r,null),b(r,c),w&&w.m(r,null),b(t,f),b(t,u),U&&U.m(u,null),b(e,m),b(e,y),b(y,g),$.m(g,null),b(e,I),re&&re.m(e,null)},p(q,M){var G;M[0]&1024&&te(s,q[10]),M[0]&1024&&(a=(G=q[38](q[10]))==null?void 0:G.prerelease),a?L||(L=Q1(q),L.c(),L.m(r,l)):L&&(L.d(1),L=null),q[12][q[10]]==="beta-alias"?C||(C=Y1(q),C.c(),C.m(r,c)):C&&(C.d(1),C=null),q[12][q[10]]==="stable-alias"?w||(w=X1(q),w.c(),w.m(r,null)):w&&(w.d(1),w=null),F===(F=E(q,M))&&U?U.p(q,M):(U&&U.d(1),U=F&&F(q),U&&(U.c(),U.m(u,null))),P===(P=V(q,M))&&$?$.p(q,M):($.d(1),$=P(q),$&&($.c(),$.m(g,null))),q[15]?re?re.p(q,M):(re=Z1(q),re.c(),re.m(e,null)):re&&(re.d(1),re=null)},d(q){q&&_(e),L&&L.d(),C&&C.d(),w&&w.d(),U&&U.d(),$.d(),re&&re.d()}}}function Q1(o){let e;return{c(){e=x("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function Y1(o){let e;return{c(){e=x("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function X1(o){let e;return{c(){e=x("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function uD(o){let e;return{c(){e=x("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function dD(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?mD:pD}let i=s(o,[-1,-1,-1]),a=i(o);return{c(){e=x("button"),a.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){S(l,e,c),a.m(e,null),r||(n=j(e,"click",o[51]),r=!0)},p(l,c){i!==(i=s(l,c))&&(a.d(1),a=i(l),a&&(a.c(),a.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&_(e),a.d(),r=!1,n()}}}function pD(o){let e;return{c(){e=K("Install")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function mD(o){let e;return{c(){e=K("Installing...")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function hD(o){let e;return{c(){e=K('"No changelog available"')},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function gD(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:xD,then:vD,catch:bD,value:65};return xi(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=ve(),r.block.c()},m(s,i){S(s,e,i),r.block.m(s,r.anchor=i),r.mount=()=>e.parentNode,r.anchor=e},p(s,i){var a;o=s,r.ctx=o,i[0]&1024&&t!==(t=o[34](((a=o[38](o[10]))==null?void 0:a.body)||"No changelog available"))&&xi(t,r)||Vc(r,o,i)},d(s){s&&_(e),r.block.d(s),r.token=null,r=null}}}function yD(o){let e;function t(s,i){if(s[13][s[10]]==="stable-alias")return SD;if(s[13][s[10]]==="beta-alias")return _D;if(s[10]===s[0].version)return wD}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=ve()},m(s,i){n&&n.m(s,i),S(s,e,i)},p(s,i){r!==(r=t(s,i))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n&&n.d(s)}}}function bD(o){return{c:z,m:z,p:z,d:z}}function vD(o){let e,t=o[65]+"",r;return{c(){e=new $n(!1),r=ve(),e.a=r},m(n,s){e.m(t,n,s),S(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(_(r),e.d())}}}function xD(o){let e;return{c(){e=K('"loading..."')},m(t,r){S(t,e,r)},p:z,d(t){t&&_(e)}}}function wD(o){let e;return{c(){e=x("p"),e.textContent="Current development version"},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function _D(o){let e;return{c(){e=x("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function SD(o){let e;return{c(){e=x("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function Z1(o){let e,t,r,n,s,i=o[11].version+"",a,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),f,u,d,p,m,y=o[11].name+"",g,I,L,C,w,E,F=o[11].author+"",U,V,P,$,re,W,q=o[11].description+"",M,G,B,Q,N,O,J=o[11].isDesktopOnly?"Yes":"No",oe,me,he,se,pe,Fe,ye=o[11].minAppVersion+"",Ue,He=c&&e0(o);return{c(){e=x("div"),t=x("div"),r=x("span"),r.textContent="Version:",n=T(),s=x("span"),a=K(i),l=T(),He&&He.c(),f=T(),u=x("div"),d=x("span"),d.textContent="Name:",p=T(),m=x("span"),g=K(y),I=T(),L=x("div"),C=x("span"),C.textContent="Author:",w=T(),E=x("span"),U=K(F),V=T(),P=x("div"),$=x("span"),$.textContent="Description:",re=T(),W=x("span"),M=K(q),G=T(),B=x("div"),Q=x("span"),Q.textContent="isDesktopOnly:",N=T(),O=x("span"),oe=K(J),me=T(),he=x("div"),se=x("span"),se.textContent="minAppVersion:",pe=T(),Fe=x("span"),Ue=K(ye),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(m,"class","manifest-value svelte-12doke6"),h(u,"class","manifest-field svelte-12doke6"),h(C,"class","manifest-label svelte-12doke6"),h(E,"class","manifest-value svelte-12doke6"),h(L,"class","manifest-field svelte-12doke6"),h($,"class","manifest-label svelte-12doke6"),h(W,"class","manifest-value svelte-12doke6"),h(P,"class","manifest-field svelte-12doke6"),h(Q,"class","manifest-label svelte-12doke6"),h(O,"class","manifest-value svelte-12doke6"),h(B,"class","manifest-field svelte-12doke6"),h(se,"class","manifest-label svelte-12doke6"),h(Fe,"class","manifest-value svelte-12doke6"),h(he,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(Qe,rt){S(Qe,e,rt),b(e,t),b(t,r),b(t,n),b(t,s),b(s,a),b(t,l),He&&He.m(t,null),b(e,f),b(e,u),b(u,d),b(u,p),b(u,m),b(m,g),b(e,I),b(e,L),b(L,C),b(L,w),b(L,E),b(E,U),b(e,V),b(e,P),b(P,$),b(P,re),b(P,W),b(W,M),b(e,G),b(e,B),b(B,Q),b(B,N),b(B,O),b(O,oe),b(e,me),b(e,he),b(he,se),b(he,pe),b(he,Fe),b(Fe,Ue)},p(Qe,rt){rt[0]&2048&&i!==(i=Qe[11].version+"")&&te(a,i),rt[0]&3072&&(c=Qe[10]!==Qe[11].version&&!Qe[10].startsWith("v"+Qe[11].version)),c?He||(He=e0(Qe),He.c(),He.m(t,null)):He&&(He.d(1),He=null),rt[0]&2048&&y!==(y=Qe[11].name+"")&&te(g,y),rt[0]&2048&&F!==(F=Qe[11].author+"")&&te(U,F),rt[0]&2048&&q!==(q=Qe[11].description+"")&&te(M,q),rt[0]&2048&&J!==(J=Qe[11].isDesktopOnly?"Yes":"No")&&te(oe,J),rt[0]&2048&&ye!==(ye=Qe[11].minAppVersion+"")&&te(Ue,ye)},d(Qe){Qe&&_(e),He&&He.d()}}}function e0(o){let e;return{c(){e=x("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function kD(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,i,a,l,c,f,u=!o[1]&&q1(o);function d(y,g){return y[7]?lD:y[3].length===0?aD:y[8].length===0?iD:sD}let p=d(o,[-1,-1,-1]),m=p(o);return{c(){e=x("div"),r=K(t),n=T(),s=x("div"),i=x("div"),a=T(),l=x("div"),u&&u.c(),c=T(),m.c(),h(e,"class","modal-title"),h(i,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(y,g){S(y,e,g),b(e,r),S(y,n,g),S(y,s,g),b(s,i),b(s,a),b(s,l),u&&u.m(l,null),b(s,c),m.m(s,null),f=!0},p(y,g){(!f||g[0]&2)&&t!==(t=y[1]?"Relay installer":"Relay releases")&&te(r,t),y[1]?u&&(ce(),k(u,1,1,()=>{u=null}),fe()):u?(u.p(y,g),g[0]&2&&v(u,1)):(u=q1(y),u.c(),v(u,1),u.m(l,null)),p===(p=d(y,g))&&m?m.p(y,g):(m.d(1),m=p(y),m&&(m.c(),m.m(s,null)))},i(y){f||(v(u),f=!0)},o(y){k(u),f=!1},d(y){y&&(_(e),_(n),_(s)),u&&u.d(),m.d()}}}var t0="system3-relay";function Ss(o){return o.startsWith("v")?o.substring(1):o}function r0(o){return(o==null?void 0:o.prerelease)===!0}function ID(o,e,t){let r,n,s,i,a,l,c,f,u,d,p,m,y,g,I,L,{plugin:C}=e,{version:w}=e,E=we(C.manifest.version),F=we(!1),U=we(""),V=we(""),P=we(!1);de(o,P,ie=>t(7,c=ie));let $=we(!1);de(o,$,ie=>t(6,l=ie));let re=we(null);de(o,re,ie=>t(11,p=ie));let W=we("");de(o,W,ie=>t(10,d=ie));let q=we(null),M=we(null);de(o,M,ie=>t(16,L=ie));let G=we(!1);de(o,G,ie=>t(15,I=ie));let B=we(null);de(o,B,ie=>t(5,s=ie));let Q=we(null);de(o,Q,ie=>t(4,n=ie));let N=we(null);de(o,N,ie=>t(53,a=ie));let O=we(null);de(o,O,ie=>t(52,i=ie));let J=we(!1),oe=!1,me=we(null);de(o,me,ie=>t(14,g=ie));let he=C.app;function se(ie){let Oe=Ss(ie),xt=Ss(C.version);return Oe===xt}let pe=we({});de(o,pe,ie=>t(13,y=ie));let Fe=we({});de(o,Fe,ie=>t(12,m=ie));let ye=we(C.releaseSettings.get().channel);de(o,ye,ie=>t(9,u=ie)),dt(()=>{rt(),Ue(),!w&&!r.some(ie=>{ie.tag_name,C.version})?ye.set(null):ye.set(C.releaseSettings.get().channel),re.set({version:w||C.version,name:C.manifest.name,author:C.manifest.author,description:C.manifest.description,isDesktopOnly:C.manifest.isDesktopOnly,minAppVersion:C.manifest.minAppVersion}),W.set(w||C.version)});function Ue(){return Ae(this,void 0,void 0,function*(){J.set(!0);try{let ie=yield C.updateManager.fetchRepoManifest("manifest.json");ie&&(B.set(ie),N.set(ie.version));let Oe=yield C.updateManager.fetchRepoManifest("manifest-beta.json");Oe&&(Q.set(Oe),O.set(Oe.version))}catch(ie){C.error("Error fetching main branch manifests:",ie)}finally{J.set(!1)}})}let He=at(C.updateManager,()=>C.updateManager.releases);de(o,He,ie=>t(3,r=ie));let Qe=at([He,$],()=>r&&r.length>0?qt(l).sort():[]);de(o,Qe,ie=>t(8,f=ie)),r.forEach(ie=>Ae(void 0,void 0,void 0,function*(){try{let Oe=yield C.updateManager.fetchReleaseManifest(ie);Oe&&pe.update(xt=>Object.assign(Object.assign({},xt),{[ie.tag_name]:Oe.version}))}catch(Oe){}}));function rt(){return Ae(this,void 0,void 0,function*(){P.set(!0);try{yield C.updateManager.getReleases(),qt(l)}catch(ie){C.error("Error refreshing GitHub releases:",ie)}finally{P.set(!1)}})}function Ft(ie){return Ae(this,void 0,void 0,function*(){let Oe=document.createElement("div");return yield o0.MarkdownRenderer.render(C.app,ie,Oe,"",C),Oe.innerHTML})}function qt(ie){return ie?r:w?r.filter(Oe=>w===Ss(Oe.tag_name)):r.filter(Oe=>{let xt=Oe.tag_name;return zn(Oe)})}function zn(ie){if(ie.prerelease||ie.draft)return!1;if(ie.latest||Ss(ie.tag_name)===a||Ss(ie.tag_name)===i)return!0;let Oe=new Date(ie.created_at),xt=new Date;return xt.setMonth(xt.getMonth()-3),Oe>xt}function qr(ie){return Ae(this,void 0,void 0,function*(){M.set(null),q.set(ie);try{let Oe=lr(ie);if(!Oe){M.set(`Could not find release for ${ie}`);return}let xt=yield C.updateManager.fetchReleaseManifest(Oe);xt?(re.set(xt),W.set(ie),G.set(!1),pe.update(io=>Object.assign(Object.assign({},io),{[ie]:xt.version}))):M.set(`Could not find manifest for ${ie}`)}catch(Oe){C.error("Error fetching manifest:",Oe),M.set(`Error fetching manifest: ${Oe.message||"Unknown error"}`)}finally{q.set(null)}})}function Wr(ie){let Oe=ie==="stable"?s:n;if(Oe){let xt=Oe.version;ye.set(ie);let io=[...r.values()].find(vr=>Ss(vr.tag_name)===Ss(xt));io?(ie==="stable"?Fe.update(vr=>Object.assign(Object.assign({},vr),{[io.tag_name]:"stable-alias"})):Fe.update(vr=>Object.assign(Object.assign({},vr),{[io.tag_name]:"beta-alias"})),qr(io.tag_name)):(re.set(Oe),W.set(xt),ie==="stable"?Fe.update(vr=>Object.assign(Object.assign({},vr),{[xt]:"stable-alias"})):Fe.update(vr=>Object.assign(Object.assign({},vr),{[xt]:"beta-alias"})),G.set(!1))}else M.set(`Could not find ${ie} manifest`)}function ko(){re.set(null),W.set(""),M.set(null)}function lr(ie){return[...r.values()].find(Oe=>Oe.tag_name===ie)}function yn(ie){return Ae(this,void 0,void 0,function*(){try{me.set(ie);let Oe=lr(ie);if(!Oe)throw new Error(`Could not find release for ${ie}`);let xt=yield C.updateManager.fetchReleaseManifest(Oe);if(!xt)throw new Error(`Could not find manifest for ${ie}`);t(2,oe=!0),yield he.plugins.installPlugin(C.repo,ie,xt),yield he.plugins.disablePlugin(t0),yield he.plugins.enablePlugin(t0)}catch(Oe){console.error(`Error installing version ${ie}:`,Oe),C&&C.error(`Error installing version ${ie}:`,Oe)}finally{C&&(t(2,oe=!1),me.set(null))}})}let ks=ie=>se(ie.tag_name),Dr=()=>{$.update(ie=>!ie)},jr=ie=>{(ie.key==="Enter"||ie.key===" ")&&$.update(Oe=>!Oe)},Io=()=>{C.releaseSettings.update(ie=>({...ie,channel:"stable"})),ye.set("stable"),Wr("stable")},Kn=ie=>{(ie.key==="Enter"||ie.key===" ")&&(C.releaseSettings.update(Oe=>({...Oe,channel:"stable"})),ye.set("stable"),Wr("stable"))},Co=()=>{C.releaseSettings.update(ie=>({...ie,channel:"beta"})),ye.set("beta"),Wr("beta")},Gn=ie=>{(ie.key==="Enter"||ie.key===" ")&&(C.releaseSettings.update(Oe=>({...Oe,channel:"beta"})),ye.set("beta"),Wr("beta"))},Jn=()=>{ye.set(null),re.set({version:C.manifest.version,name:C.manifest.name,author:C.manifest.author,description:C.manifest.description,isDesktopOnly:C.manifest.isDesktopOnly,minAppVersion:C.manifest.minAppVersion}),W.set(C.version),G.set(!1)},Qn=ie=>{(ie.key==="Enter"||ie.key===" ")&&(ye.set(null),re.set({version:C.manifest.version,name:C.manifest.name,author:C.manifest.author,description:C.manifest.description,isDesktopOnly:C.manifest.isDesktopOnly,minAppVersion:C.manifest.minAppVersion}),W.set(C.version),G.set(!1))},_e=ie=>{ye.set(null),qr(ie.tag_name)},Xe=(ie,Oe)=>{(Oe.key==="Enter"||Oe.key===" ")&&(ye.set(null),qr(ie.tag_name))},ft=async()=>{yn(d)};return o.$$set=ie=>{"plugin"in ie&&t(0,C=ie.plugin),"version"in ie&&t(1,w=ie.version)},[C,w,oe,r,n,s,l,c,f,u,d,p,m,y,g,I,L,P,$,re,W,M,G,B,Q,N,O,me,se,pe,Fe,ye,He,Qe,Ft,qr,Wr,ko,lr,yn,ks,Dr,jr,Io,Kn,Co,Gn,Jn,Qn,_e,Xe,ft]}var tg=class extends Z{constructor(e){super(),ee(this,e,ID,kD,X,{plugin:0,version:1},oD,[-1,-1,-1])}},n0=tg;var Ba=class extends s0.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new n0({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var g0=require("obsidian");function CD(o){Ee(o,"svelte-1yric5k",".self-host-modal.svelte-1yric5k{padding:0 0 20px 0}.host-list-section.svelte-1yric5k{margin:16px 0}.public-key-section.svelte-1yric5k{margin:16px 0}.loading-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.host-list.svelte-1yric5k{display:flex;flex-direction:column;margin-top:8px}.host-card.svelte-1yric5k{display:flex;align-items:center;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.host-card.svelte-1yric5k:hover{background:var(--background-modifier-hover)}.host-card.active.svelte-1yric5k{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.host-info.svelte-1yric5k{display:flex;flex-direction:column;gap:4px;flex:1}.host-url.svelte-1yric5k{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.host-key-indicator.svelte-1yric5k{font-size:0.8em;color:var(--text-faint)}.add-host-card.svelte-1yric5k{border-style:dashed;opacity:0.8}.add-host-card.svelte-1yric5k:hover{opacity:1}.host-url-input.svelte-1yric5k{width:100%;border:none;background:transparent;color:var(--text-muted);font-size:0.85em;font-family:var(--font-monospace);padding:0;outline:none}.host-url-input.svelte-1yric5k:focus{color:var(--text-normal)}.host-url-input.svelte-1yric5k::placeholder{color:var(--text-faint);opacity:0.8}.host-input-invalid.svelte-1yric5k{color:var(--text-error) !important}.error-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}.modal-button-container.svelte-1yric5k{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.loading-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.error-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}")}function i0(o,e,t){let r=o.slice();return r[30]=e[t],r}function a0(o,e,t){let r=o.slice();return r[33]=e[t],r}function l0(o){let e,t=o[0].user.name+"",r,n;return{c(){e=x("option"),r=K(t),n=K(" (Personal)"),e.__value="user",Ke(e,e.__value)},m(s,i){S(s,e,i),b(e,r),b(e,n)},p(s,i){i[0]&1&&t!==(t=s[0].user.name+"")&&te(r,t)},d(s){s&&_(e)}}}function c0(o){let e,t=o[33].name+"",r,n;return{c(){e=x("option"),r=K(t),e.__value=n=o[33].id,Ke(e,e.__value)},m(s,i){S(s,e,i),b(e,r)},p(s,i){i[0]&8&&t!==(t=s[33].name+"")&&te(r,t),i[0]&8&&n!==(n=s[33].id)&&(e.__value=n,Ke(e,e.__value))},d(s){s&&_(e)}}}function LD(o){let e,t,r,n,s,i,a=o[0].user&&l0(o),l=Se(o[3]),c=[];for(let f=0;f<l.length;f+=1)c[f]=c0(a0(o,l,f));return{c(){e=x("select"),a&&a.c(),t=ve();for(let f=0;f<c.length;f+=1)c[f].c();h(e,"class","owner-select"),e.disabled=n=o[8]<=1},m(f,u){S(f,e,u),a&&a.m(e,null),b(e,t);for(let d=0;d<c.length;d+=1)c[d]&&c[d].m(e,null);Bn(e,o[16]()),s||(i=j(e,"change",o[15]),s=!0)},p(f,u){if(f[0].user?a?a.p(f,u):(a=l0(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[0]&8){l=Se(f[3]);let d;for(d=0;d<l.length;d+=1){let p=a0(f,l,d);c[d]?c[d].p(p,u):(c[d]=c0(p),c[d].c(),c[d].m(e,null))}for(;d<c.length;d+=1)c[d].d(1);c.length=l.length}u[0]&256&&n!==(n=f[8]<=1)&&(e.disabled=n)},d(f){f&&_(e),a&&a.d(),Je(c,f),s=!1,i()}}}function f0(o){let e,t=o[2].submit+"",r;return{c(){e=x("div"),r=K(t),h(e,"class","error-message svelte-1yric5k")},m(n,s){S(n,e,s),b(e,r)},p(n,s){s[0]&4&&t!==(t=n[2].submit+"")&&te(r,t)},d(n){n&&_(e)}}}function u0(o){let e;return{c(){e=x("div"),e.textContent="Legacy host",h(e,"class","host-key-indicator svelte-1yric5k")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function d0(o,e){let t,r,n,s=e[30].url+"",i,a,l,c,f,u=e[30].keyType==="legacy"&&u0(e);function d(){return e[22](e[30])}function p(...m){return e[23](e[30],...m)}return{key:o,first:null,c(){var m;t=x("div"),r=x("div"),n=x("div"),i=K(s),a=T(),u&&u.c(),l=T(),h(n,"class","host-url svelte-1yric5k"),h(r,"class","host-info svelte-1yric5k"),h(t,"class","host-card svelte-1yric5k"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to select this host"),Te(t,"active",((m=e[10])==null?void 0:m.id)===e[30].id),this.first=t},m(m,y){S(m,t,y),b(t,r),b(r,n),b(n,i),b(r,a),u&&u.m(r,null),b(t,l),c||(f=[j(t,"click",d),j(t,"keydown",p)],c=!0)},p(m,y){var g;e=m,y[0]&2049&&s!==(s=e[30].url+"")&&te(i,s),e[30].keyType==="legacy"?u||(u=u0(e),u.c(),u.m(r,null)):u&&(u.d(1),u=null),y[0]&3073&&Te(t,"active",((g=e[10])==null?void 0:g.id)===e[30].id)},d(m){m&&_(t),u&&u.d(),c=!1,xe(f)}}}function p0(o){let e,t,r,n,s,i,a,l,c=[PD,FD,TD,ED],f=[];function u(d,p){return d[5]?0:d[6]?1:d[7]?2:3}return i=u(o,[-1,-1]),a=f[i]=c[i](o),{c(){e=x("div"),t=x("div"),t.textContent="Relay Server Configuration",r=T(),n=x("div"),n.textContent="Copy this configuration to your Relay Server's TOML file.",s=T(),a.c(),h(t,"class","setting-item-name"),h(n,"class","setting-item-description"),h(e,"class","public-key-section svelte-1yric5k")},m(d,p){S(d,e,p),b(e,t),b(e,r),b(e,n),b(e,s),f[i].m(e,null),l=!0},p(d,p){let m=i;i=u(d,p),i===m?f[i].p(d,p):(ce(),k(f[m],1,1,()=>{f[m]=null}),fe(),a=f[i],a?a.p(d,p):(a=f[i]=c[i](d),a.c()),v(a,1),a.m(e,null))},i(d){l||(v(a),l=!0)},o(d){k(a),l=!1},d(d){d&&_(e),f[i].d()}}}function ED(o){let e;return{c(){e=x("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-1yric5k")},m(t,r){S(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function TD(o){let e,t;return e=new If({props:{toml:o[7]}}),{c(){D(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.toml=r[7]),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function FD(o){let e,t;return{c(){e=x("div"),t=K(o[6]),h(e,"class","error-message svelte-1yric5k")},m(r,n){S(r,e,n),b(e,t)},p(r,n){n[0]&64&&te(t,r[6])},i:z,o:z,d(r){r&&_(e)}}}function PD(o){let e;return{c(){e=x("div"),e.textContent="Loading configuration...",h(e,"class","loading-message svelte-1yric5k")},m(t,r){S(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function AD(o){let e;return{c(){e=K("Create Relay Server")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function RD(o){let e;return{c(){e=K("Creating...")},m(t,r){S(t,e,r)},d(t){t&&_(e)}}}function MD(o){let e,t,r,n,s,i,a,l,c,f,u,d,p=[],m=new Map,y,g,I,L,C,w,E,F,U,V,P,$,re;n=new $e({props:{name:"Owner",description:"Select who will own this self-hosted relay server.",$$slots:{default:[LD]},$$scope:{ctx:o}}});let W=o[2].submit&&f0(o),q=Se(o[11].values().filter(o[21])),M=O=>O[30].id;for(let O=0;O<q.length;O+=1){let J=i0(o,q,O),oe=M(J);m.set(oe,p[O]=d0(oe,J))}let G=!o[10]&&p0(o);function B(O,J){return O[4]?RD:AD}let Q=B(o,[-1,-1]),N=Q(o);return{c(){e=x("div"),t=x("div"),t.innerHTML=`<p>Create a new self-hosted Relay Server. Select an existing host or add a
			new one.</p>`,r=T(),D(n.$$.fragment),s=T(),W&&W.c(),i=T(),a=x("div"),l=x("div"),l.textContent="Relay Server URL",c=T(),f=x("div"),f.textContent=`This should be accessible to users within your private network, but not
			exposed to the public internet.`,u=T(),d=x("div");for(let O=0;O<p.length;O+=1)p[O].c();y=T(),g=x("div"),I=x("div"),L=x("input"),w=T(),G&&G.c(),E=T(),F=x("div"),U=x("button"),N.c(),h(t,"class","setting-item-description"),le(t,"margin-bottom","16px"),h(l,"class","setting-item-name"),h(f,"class","setting-item-description"),h(L,"type","url"),h(L,"placeholder","https://relay.my-corp.ts.net"),h(L,"class","host-url-input svelte-1yric5k"),h(L,"title",C=o[2].url),Te(L,"host-input-invalid",o[2].url),h(I,"class","host-info svelte-1yric5k"),h(g,"class","host-card add-host-card svelte-1yric5k"),h(d,"class","host-list svelte-1yric5k"),h(a,"class","host-list-section svelte-1yric5k"),h(U,"class","mod-cta"),U.disabled=V=o[4]||!o[10]&&(!o[1].trim()||!!o[2].url),h(F,"class","modal-button-container svelte-1yric5k"),h(e,"class","self-host-modal svelte-1yric5k")},m(O,J){S(O,e,J),b(e,t),b(e,r),A(n,e,null),b(e,s),W&&W.m(e,null),b(e,i),b(e,a),b(a,l),b(a,c),b(a,f),b(a,u),b(a,d);for(let oe=0;oe<p.length;oe+=1)p[oe]&&p[oe].m(d,null);b(d,y),b(d,g),b(g,I),b(I,L),Ke(L,o[1]),b(e,w),G&&G.m(e,null),b(e,E),b(e,F),b(F,U),N.m(U,null),P=!0,$||(re=[j(L,"click",o[24]),j(L,"input",o[25]),j(U,"click",o[14])],$=!0)},p(O,J){let oe={};J[0]&265|J[1]&32&&(oe.$$scope={dirty:J,ctx:O}),n.$set(oe),O[2].submit?W?W.p(O,J):(W=f0(O),W.c(),W.m(e,i)):W&&(W.d(1),W=null),J[0]&11265&&(q=Se(O[11].values().filter(O[21])),p=pn(p,J,M,1,O,q,m,d,Nc,d0,y,i0)),(!P||J[0]&4&&C!==(C=O[2].url))&&h(L,"title",C),J[0]&2&&L.value!==O[1]&&Ke(L,O[1]),(!P||J[0]&4)&&Te(L,"host-input-invalid",O[2].url),O[10]?G&&(ce(),k(G,1,1,()=>{G=null}),fe()):G?(G.p(O,J),J[0]&1024&&v(G,1)):(G=p0(O),G.c(),v(G,1),G.m(e,E)),Q!==(Q=B(O,J))&&(N.d(1),N=Q(O),N&&(N.c(),N.m(U,null))),(!P||J[0]&1046&&V!==(V=O[4]||!O[10]&&(!O[1].trim()||!!O[2].url)))&&(U.disabled=V)},i(O){P||(v(n.$$.fragment,O),v(G),P=!0)},o(O){k(n.$$.fragment,O),k(G),P=!1},d(O){O&&_(e),R(n),W&&W.d();for(let J=0;J<p.length;J+=1)p[J].d();G&&G.d(),N.d(),$=!1,xe(re)}}}function m0(o){if(!o.trim())return"URL is required";try{let e=new URL(o);return["http:","https:"].includes(e.protocol)?void 0:"URL must use http or https protocol"}catch(e){return"Please enter a valid URL"}}function DD(o,e,t){let r,n,s,i,a,l=z,c=()=>(l(),l=Ht(r,O=>t(11,a=O)),r);o.$$.on_destroy.push(()=>l());let{onConfirm:f}=e,{relayManager:u}=e,d="",p=!1,m={},y=we(null);de(o,y,O=>t(10,i=O));let g=null,I=!1,L=!1,C=null,w="",E="",F=null;function U(){t(2,m={});let O=m0(d);return O&&t(2,m.url=O,m),Object.keys(m).length===0}function V(O){y.set(O)}function P(){y.set(null),t(1,d=""),t(2,m={})}function $(){return Ae(this,void 0,void 0,function*(){m.submit&&(delete m.submit,t(2,m),t(1,d),t(18,g));let O=(F==null?void 0:F.type)==="org"?F.org.id:void 0;if(i){t(4,p=!0);try{yield f(void 0,i.id,O)}catch(J){t(2,m.submit=J instanceof Error?J.message:"Failed to create relay: Unknown error",m),t(2,m),t(1,d),t(18,g)}finally{t(4,p=!1)}}else{if(!U()||p)return;t(4,p=!0);try{yield f(d.trim(),void 0,O)}catch(J){t(2,m.submit=J instanceof Error?J.message:"Failed to create relay: Unknown error",m),t(2,m),t(1,d),t(18,g)}finally{t(4,p=!1)}}})}function re(O){O.target.value==="user"&&u.user&&t(20,F={type:"user",user:u.user})}function W(){return F?F.type==="user"?"user":F.org.id:""}function q(){return Ae(this,void 0,void 0,function*(){if(!(u!=null&&u.pb)){t(6,C="Not connected to relay service");return}t(5,L=!0),t(6,C=null);try{let O=u.pb.baseUrl+"/templates/relay.toml",J=yield mt(O,{method:"GET",headers:{Authorization:u.pb.authStore.token?`Bearer ${u.pb.authStore.token}`:""}});t(19,E=yield J.text())}catch(O){t(6,C=O instanceof Error?O.message:"Failed to fetch configuration")}finally{t(5,L=!1)}})}dt(()=>{q();let O=u.providers.values().filter(J=>J.selfHosted&&u.relays.some((oe,me)=>oe.providerId===J.id));O.length>0&&y.set(O[0])});let M=O=>O.selfHosted&&u.relays.some((J,oe)=>J.providerId===O.id),G=O=>V(O),B=(O,J)=>J.key==="Enter"||J.key===" "?V(O):null,Q=()=>V(null);function N(){d=this.value,t(1,d)}return o.$$set=O=>{"onConfirm"in O&&t(17,f=O.onConfirm),"relayManager"in O&&t(0,u=O.relayManager)},o.$$.update=()=>{o.$$.dirty[0]&1&&c(t(9,r=u.providers)),o.$$.dirty[0]&1048577&&!F&&u.user&&t(20,F={type:"user",user:u.user}),o.$$.dirty[0]&9&&t(8,s=(u.user?1:0)+n.length),o.$$.dirty[0]&262150&&(d.trim()?(I=!0,g&&clearTimeout(g),t(18,g=setTimeout(()=>{let O=m0(d);O?t(2,m.url=O,m):m.url&&(delete m.url,t(2,m),t(1,d),t(18,g))},500))):(m.url&&(delete m.url,t(2,m),t(1,d),t(18,g)),I=!1)),o.$$.dirty[0]&524290&&t(7,w=E?E.replace(/\{url\}/g,d||""):"")},t(3,n=[]),[u,d,m,n,p,L,C,w,s,r,i,a,y,V,$,re,W,f,g,E,F,M,G,B,Q,N]}var rg=class extends Z{constructor(e){super(),ee(this,e,DD,MD,X,{onConfirm:17,relayManager:0},CD,[-1,-1])}},h0=rg;var $f=class extends g0.Modal{constructor(t,r,n){super(t);this.relayManager=r;this.onSuccess=n;this.setTitle("Self Host Relay Server")}onOpen(){let{contentEl:t}=this;this.component=new h0({target:t,props:{relayManager:this.relayManager,onConfirm:async(r,n,s)=>{let i=await this.relayManager.createSelfHostedRelay(r,n,s);this.close(),this.onSuccess(i)}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var UD={debugging:!1},OD={release:{channel:"stable"},sharedFolders:[],endpoints:{},...pa,...UD},Bf=class extends v0.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="2336be2";this.repo="No-Instructions/Relay"}enableDebugging(t){Hl(!0),console.warn("RelayInstances",Zt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){Hl(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return Hl(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return this.loginManager.getEndpointManager().getApiUrl()+t}openEndpointConfigurationModal(){new Ff(this.app,this,()=>{this.reload()}).open()}async validateAndApplyEndpoints(){var n;let t=this.endpointSettings.get();if(!t.activeTenantId||!((n=t.tenants)!=null&&n.length)){new lt.Notice("Please configure an enterprise tenant first",4e3);return}let r=new lt.Notice("Validating endpoints...",0);try{let s=await this.loginManager.validateAndApplyEndpoints();r.hide(),s.success?(await this.endpointSettings.update(i=>({...i,_lastValidationError:void 0,_lastValidationAttempt:void 0})),new lt.Notice("\u2713 Endpoints validated and applied successfully!",5e3),s.licenseInfo&&this.log("License validation successful:",s.licenseInfo)):(await this.endpointSettings.update(i=>({...i,_lastValidationError:s.error,_lastValidationAttempt:Date.now()})),new lt.Notice(`\u274C Validation failed: ${s.error}`,8e3))}catch(s){r.hide();let i=s instanceof Error?s.message:"Unknown error";await this.endpointSettings.update(a=>({...a,_lastValidationError:i,_lastValidationAttempt:Date.now()})),new lt.Notice(`\u274C Validation error: ${i}`,8e3)}}resetToDefaultEndpoints(){this.loginManager.getEndpointManager().clearValidatedEndpoints(),this.endpointSettings.update(()=>({})),new lt.Notice("Reset to default endpoints",3e3)}async validateEndpointsOnStartup(t){var s;let r=this.endpointSettings.get();if(!r.activeTenantId||!((s=r.tenants)!=null&&s.length)){this.log("No active enterprise tenant configured, using defaults");return}let n=r.tenants.find(i=>i.id===r.activeTenantId);if(!n){this.log("Active tenant not found, using defaults");return}this.log("Enterprise tenant configured, validating on startup...",{tenantId:n.id,tenantUrl:n.tenantUrl,tenantName:n.name});try{let i=await t.validateAndSetEndpoints(5e3);i.success?(await this.endpointSettings.update(a=>({...a,_lastValidationError:void 0,_lastValidationAttempt:void 0})),this.log("\u2713 Enterprise tenant validated and applied on startup",{licenseInfo:i.licenseInfo})):(this.error("\u274C Enterprise tenant validation failed on startup",i.error),await this.endpointSettings.update(a=>({...a,_lastValidationError:i.error,_lastValidationAttempt:Date.now()})),new lt.Notice(`\u274C Custom endpoints failed validation: ${i.error}`,8e3))}catch(i){let a=i instanceof Error?i.message:"Unknown error";this.error("Startup endpoint validation error:",a),await this.endpointSettings.update(l=>({...l,_lastValidationError:a,_lastValidationAttempt:Date.now()})),new lt.Notice(`\u274C Endpoint validation error: ${a}`,8e3)}}async onload(){this.appId=this.app.appId;let t=lt.moment.now();Zt.set(this,"plugin"),this.timeProvider=new oi,this.register(()=>{this.timeProvider.destroy()});let r=(0,lt.normalizePath)(`${this.app.vault.configDir}/plugins/${this.manifest.id}/relay.log`);Ab(new Mf(this.app.vault),this.timeProvider,r,{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Rf,this.debug=Re("[System 3][Relay]","debug"),this.log=Re("[System 3][Relay]","log"),this.warn=Re("[System 3][Relay]","warn"),this.error=Re("[System 3][Relay]","error"),this.settings=new wc(this,OD),await this.settings.load(),this.featureSettings=new no(this.settings,"(enable*)"),this.debugSettings=new no(this.settings,"(debugging)"),this.folderSettings=new no(this.settings,"sharedFolders"),this.releaseSettings=new no(this.settings,"release"),this.loginSettings=new no(this.settings,"login"),this.endpointSettings=new no(this.settings,"endpoints"),Ir.getInstance().setSettings(this.featureSettings),this.settingsTab=new Tf(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new Of(this,this.timeProvider,this.releaseSettings),this.register(this.debugSettings.subscribe(l=>{l.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let c=new Pf(this.app,()=>{this.reload()});this.openModals.push(c),c.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let c=new Df(this.app,this);this.openModals.push(c),c.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let c=new Af(this.app,this);this.openModals.push(c),c.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let c=new Ba(this.app,this);this.openModals.push(c),c.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let c=new Uf(this.app,this);this.openModals.push(c),c.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}));let s=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+s),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{this.openSettings()}}),this.addCommand({id:"configure-endpoints",name:"Configure enterprise tenant",callback:()=>{this.openEndpointConfigurationModal()}}),ze().enableSelfManageHosts&&this.addCommand({id:"register-host",name:"Register self-hosted Relay Server",callback:()=>{let l=new $f(this.app,this.relayManager,c=>{this.openSettings(`/relays?id=${c.id}`)});this.openModals.push(l),l.open()}}),this.register(this.updateManager.subscribe(()=>{let l=this.updateManager.getNewRelease();l?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${l.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(l)}}),this.log(`Update available: v${this.version} \u2192 ${l.tag_name}`)):this.removeCommand("update-plugin")})),this.vault=this.app.vault;let i=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Cc(this.appId);let a=new fc(this.endpointSettings);await this.validateEndpointsOnStartup(a),this.loginManager=new uc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this),this.loginSettings,a),this.relayManager=new xc(this.loginManager),this.sharedFolders=new Pc(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new pc(this.loginManager,this.timeProvider,i,3),this.networkStatus=new Nv(this.timeProvider,"https://api.system3.md/health?version=2336be2"),this.backgroundSync=new Lc(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new lt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new cf(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),y0.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(l=>l.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(_i,l=>new tf(l)),this.registerEvent(this.app.workspace.on("file-menu",(l,c)=>{if(c instanceof lt.TFolder){let f=this.sharedFolders.find(u=>u.path===c.path);if(!f)return;f.relayId?(l.addItem(u=>{u.setTitle("Relay: Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${f.relayId}`)})}),l.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${f.guid}`)})}),l.addItem(u=>{u.setTitle(f.connected?"Relay: Disconnect":"Relay: Connect").setIcon("satellite").onClick(()=>{f.connected?(f.shouldConnect=!1,f.disconnect()):(f.shouldConnect=!0,f.connect()),this._liveViews.refresh("folder connection toggle")})})):l.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${f.guid}`)})}),f.relayId&&f.connected&&l.addItem(u=>{u.setTitle("Relay: Sync").setIcon("folder-sync").onClick(()=>{f.netSync()})})}else if(c instanceof lt.TFile){let f=this.sharedFolders.lookup(c.path),u=f==null?void 0:f.getFile(c);u&&Er(u)&&(l.addItem(d=>{d.setTitle("Relay: Download").setIcon("cloud-download").onClick(async()=>{await u.pull(),new lt.Notice(`Download complete: ${u.name}`)})}),this.debugSettings.get().debugging&&l.addItem(d=>{d.setTitle("Relay: Verify upload").setIcon("search-check").onClick(async()=>{let p=await u.verifyUpload();new lt.Notice(`${u.name} ${p?"on server":"missing from server"}`)})}),l.addItem(d=>{d.setTitle("Relay: Upload").setIcon("cloud-upload").onClick(async()=>{await u.push(!0);let p=await u.verifyUpload();new lt.Notice(`${p?"File uploaded:":"File upload failed:"} ${u.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=lt.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let i=new no(this.settings,`sharedFolders/[guid=${r}]`),a={guid:r,path:t};return n&&(a.relay=n),i.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:mi.defaultFlags}),!0),new Fc(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,i,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let i=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=i==null?void 0:i.instance)!=null&&s.options)||!i.enabled){this.warn("Webviewer plugin not found or not initialized");return}let a=i.instance.options,l=Object.getOwnPropertyDescriptor(a,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(a,"openExternalURLs",{get(){var p;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((p=d==null?void 0:d.detail)!=null&&p.url)){let m=d.detail.url;for(let y of t.interceptedUrls)if(typeof y=="string"&&m.startsWith(y)||y instanceof RegExp&&y.test(m))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(a,"openExternalURLs",l)}),this.loginManager.getWebviewIntercepts().forEach(d=>{this.debug("Intercepting Webviewer for URL pattern",d.source),this.interceptedUrls.push(d)});let f=this.loginManager.getEndpointManager().getApiUrl(),u=new RegExp(f.replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(i){this.error("Failed to patch webviewer:",i)}}setup(){this.folderNavDecorations=new df(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Re("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",a=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Re("[System 3][Relay][Vault]","log"),n=a=>{},s=a=>n(a);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",a=>{let l=this.sharedFolders.lookup(a.path);l&&(l.placeHold([a]).length>0?l.uploadFile(a):l.whenReady().then(f=>{f.getFile(a)}))})),this.registerEvent(this.app.vault.on("delete",a=>{if(a instanceof lt.TFolder){let c=this.sharedFolders.find(f=>f.path===a.path);if(c){this.sharedFolders.delete(c);return}}let l=this.sharedFolders.lookup(a.path);l&&(r("Delete",a.path),l.whenReady().then(c=>{c.proxy.deleteFile(a.path)}))})),this.registerEvent(this.app.vault.on("rename",(a,l)=>{if(a instanceof lt.TFolder){let d=this.sharedFolders.find(p=>p.path==l);if(d){d.move(a.path),this.sharedFolders.update();return}}let c=this.sharedFolders.lookup(l),f=this.sharedFolders.lookup(a.path),u=c||f;c&&f?(r("Rename",a.path,l),c.renameFile(a,l),f.renameFile(a,l),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):u&&(r("Rename",a.path,l),u.renameFile(a,l),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",a=>{let l=this.sharedFolders.lookup(a.path);if(l){r("Modify",a.path);let c=l.proxy.getFile(a);c&&Er(c)&&c.sync(),this.timeProvider.setTimeout(()=>{this.app.metadataCache.trigger("resolve",c)},10)}}));let i=this;Ar().patch(lt.MarkdownView.prototype,{onUnloadFile(a){return function(l){return i._liveViews.wipe(),a.call(this,l)}}}),Ar().patch(this.app.vault,{process(a){return function(l,c,f){try{let u=i.sharedFolders.lookup(l.path);if(u){let d=u.proxy.getFile(l);l instanceof lt.TFile&&d&&wo(d)&&d.process(c)}}catch(u){i.log(u)}return a.call(this,l,c,f)}}}),this.patchWebviewer(),Pn(on.enableNewLinkFormat,()=>{Ar().patch(lt.MetadataCache.prototype,{fileToLinktext(a){return function(l,c,f){if(i.sharedFolders.lookup(l.path)){f===void 0&&(f=!0);let d=l.extension==="md"&&f?l.basename:l.name,p=(0,lt.normalizePath)(l.name),m=i.app.metadataCache.uniqueFileLookup.get(p.toLowerCase());if(m&&m.length===1&&m[0]===l)return d;{let y=l.extension==="md"&&f?l.path.slice(0,l.path.length-3):l.path,g=(0,b0.relative)(c,y);return g==="../"+d?"./"+d:g}}return a.call(this,l,c,f)}}})}),this.registerObsidianProtocolHandler("relay/settings/relays",async a=>{let l=a,c=new URLSearchParams({...l}).toString(),f=`/${l.action.split("/").slice(-1)}?${c}`;this.openSettings(f)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async a=>{let l=a,c=new URLSearchParams({...l}).toString(),f=`/${l.action.split("/").slice(-1)}?${c}`;this.openSettings(f)}),this.registerObsidianProtocolHandler("relay/upgrade",async a=>{var f;let c=(f=a.version)==null?void 0:f.trim();this.installVersion(c)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Ba(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,lt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,i,a,l,c,f,u,d,p,m,y;Aa.destroy(),(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(_i),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(i=this.tokenStore)==null||i.stop(),(a=this.tokenStore)==null||a.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(f=this.networkStatus)==null||f.destroy(),this.networkStatus=null,this.openModals.forEach(g=>{g.close()}),this.openModals.length=0,(u=this.sharedFolders)==null||u.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(p=this.loginManager)==null||p.destroy(),this.loginManager=null,(m=this.backgroundSync)==null||m.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(y=this.app)==null||y.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,Ir.destroy(),this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.loginSettings.destroy(),this.loginSettings=null,this.endpointSettings.destroy(),this.endpointSettings=null,this.interceptedUrls.length=0,ho.destroy(),this.notifier=null,Vb(),xd()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
lucide-svelte/dist/icons/arrow-right-left.svelte:
lucide-svelte/dist/icons/arrow-right.svelte:
lucide-svelte/dist/icons/check.svelte:
lucide-svelte/dist/icons/chevron-left.svelte:
lucide-svelte/dist/icons/chevron-right.svelte:
lucide-svelte/dist/icons/circle-alert.svelte:
lucide-svelte/dist/icons/circle-check-big.svelte:
lucide-svelte/dist/icons/circle-help.svelte:
lucide-svelte/dist/icons/download.svelte:
lucide-svelte/dist/icons/folder-lock.svelte:
lucide-svelte/dist/icons/folder-open.svelte:
lucide-svelte/dist/icons/folder.svelte:
lucide-svelte/dist/icons/home.svelte:
lucide-svelte/dist/icons/info.svelte:
lucide-svelte/dist/icons/layers.svelte:
lucide-svelte/dist/icons/lock.svelte:
lucide-svelte/dist/icons/message-square-heart.svelte:
lucide-svelte/dist/icons/satellite.svelte:
lucide-svelte/dist/icons/settings.svelte:
lucide-svelte/dist/icons/square-pen.svelte:
lucide-svelte/dist/icons/triangle-alert.svelte:
lucide-svelte/dist/icons/user-round-x.svelte:
lucide-svelte/dist/icons/x.svelte:
lucide-svelte/dist/icons/index.js:
lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/
